# Claude Code Provider Manager 产品设计文档

## 产品概述

**产品名称**: Claude Code Provider Manager  
**版本**: 1.0  
**类型**: 命令行管理工具  
**目标用户**: Claude Code 用户，特别是需要管理多个 AI 服务提供商的开发者

## 产品定位

这是一个 Windows 批处理脚本工具，用于管理 Claude Code 客户端的多个 AI 服务提供商配置。它简化了在不同 API 端点、认证令牌和模型配置之间的切换过程。

## 核心功能

### 1. 提供商管理
- **添加提供商**: 支持添加新的 API 端点配置
- **切换提供商**: 快速在不同配置间切换
- **编辑提供商**: 修改现有提供商的配置信息
- **删除提供商**: 移除不需要的提供商配置

### 2. 配置参数支持
- `ANTHROPIC_BASE_URL`: API 基础 URL
- `ANTHROPIC_AUTH_TOKEN`: 认证令牌
- `ANTHROPIC_MODEL`: 主要模型配置
- `ANTHROPIC_SMALL_FAST_MODEL`: 小型快速模型配置

### 3. 系统集成
- 环境变量自动设置与清理
- Windows 注册表操作
- 配置文件持久化存储

## 用户界面设计

### 主菜单
```
========================================
        Claude Code Provider Manager
========================================

Please select an option:
1. Add Provider
2. Switch Provider
3. Edit Provider
4. Delete Provider
5. Open Claude in New Window
6. Exit
```

### 状态显示
实时显示当前活跃的提供商配置：
- 当前 BASE_URL（显示完整或默认）
- 当前 AUTH_TOKEN（安全截断显示）
- 当前 MODEL 设置
- 当前 SMALL_FAST_MODEL 设置

## 技术架构

### 数据存储
- **配置文件**: `%USERPROFILE%\.cc-providers.txt`
- **格式**: 管道分隔符（`|`）分割的四字段格式
- **字段**: `BASE_URL|AUTH_TOKEN|MODEL|SMALL_FAST_MODEL`

### 环境变量管理
- 使用 `setx` 命令进行持久化设置
- 使用 `reg delete` 清理无效环境变量
- 即时生效的会话变量设置

### 错误处理
- 输入验证（空值检查）
- 重复配置检测
- 无效选项处理
- 文件操作异常处理

## 用户体验设计

### 交互流程
1. **启动**: 显示当前状态和主菜单
2. **操作选择**: 数字键快速选择功能
3. **参数输入**: 逐步引导式输入
4. **确认反馈**: 操作结果即时反馈
5. **返回循环**: 自动返回主菜单继续操作

### 便利性功能
- 输入取消机制（'C' 键）
- 默认值保持（编辑时按 Enter 保持原值）
- 安全显示（TOKEN 截断显示）
- 批量操作支持

## 安全考虑

### 敏感信息保护
- AUTH_TOKEN 在显示时进行截断（仅显示前20字符）
- 配置文件存储在用户个人目录
- 支持环境变量的安全清理

### 数据完整性
- 临时文件机制防止配置丢失
- 原子性操作（编辑/删除使用临时文件）
- 输入验证防止无效配置

## 扩展性设计

### 配置格式兼容性
- 字段可选机制（MODEL 和 SMALL_FAST_MODEL 可为空）
- 向后兼容的配置文件格式
- 字符串处理的 trim 功能

### 功能模块化
- 独立的功能子程序（`:add_provider`, `:switch_provider` 等）
- 可复用的工具函数（`:trim`, `:unload_provider_silent`）
- 清晰的控制流程

## 目标用户场景

### 开发环境管理
- 开发者在测试和生产环境间切换
- 多团队使用不同的 AI 服务实例
- A/B 测试不同的模型配置

### 企业部署
- 内部 AI 服务代理配置
- 不同项目使用不同的 API 配额
- 合规性要求的服务隔离

## 成功指标

### 功能指标
- 配置切换时间 < 5秒
- 支持无限数量的提供商配置
- 100% 的环境变量设置成功率

### 用户体验指标
- 学习成本 < 5分钟
- 操作错误率 < 1%
- 用户满意度 > 90%

## 未来改进方向

### 短期优化
- 添加配置验证（URL 格式检查）
- 支持配置导入/导出
- 增加批量操作功能

### 长期规划
- GUI 界面版本
- 跨平台支持（Linux/macOS）
- 云端配置同步
- 团队配置共享

## 风险评估

### 技术风险
- Windows 环境变量限制
- 批处理脚本的错误处理局限性
- 配置文件并发访问问题

### 安全风险
- 明文存储的认证令牌
- 环境变量可能被其他进程访问
- 配置文件权限管理

### 缓解措施
- 文件权限最小化
- 定期清理无效配置
- 用户教育和最佳实践指南

---

**文档版本**: 1.0  
**创建日期**: 2025-08-18  
**文档状态**: 初版  