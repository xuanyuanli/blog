<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式基础-CAP理论 | 轩辕李的博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/blog/img/favicon.ico">
    <meta name="description" content="轩辕李的技术博客,自我成长，变得更强">
    <meta name="keywords" content="个人技术博客,前端,后端,运维,技术文档,学习,面试,JavaScript,js,java,vue,python,css3,css,html5,Node,markdown,Kubernetes,Docker">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8b6f9cb2.css" as="style"><link rel="preload" href="/blog/assets/js/app.01ab09a8.js" as="script"><link rel="preload" href="/blog/assets/js/2.cb21dba0.js" as="script"><link rel="preload" href="/blog/assets/js/31.8e7b1f6c.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cbae5994.js"><link rel="prefetch" href="/blog/assets/js/11.26bc7671.js"><link rel="prefetch" href="/blog/assets/js/12.392b3b8d.js"><link rel="prefetch" href="/blog/assets/js/13.97cc2b3c.js"><link rel="prefetch" href="/blog/assets/js/14.b79e5598.js"><link rel="prefetch" href="/blog/assets/js/15.4d568dd9.js"><link rel="prefetch" href="/blog/assets/js/16.7ad9f978.js"><link rel="prefetch" href="/blog/assets/js/17.c47d4b76.js"><link rel="prefetch" href="/blog/assets/js/18.fbaa3fcc.js"><link rel="prefetch" href="/blog/assets/js/19.18e1e200.js"><link rel="prefetch" href="/blog/assets/js/20.3b21dfb0.js"><link rel="prefetch" href="/blog/assets/js/21.a2e08dd0.js"><link rel="prefetch" href="/blog/assets/js/22.62c8aa6e.js"><link rel="prefetch" href="/blog/assets/js/23.d3ae3372.js"><link rel="prefetch" href="/blog/assets/js/24.9a14eb44.js"><link rel="prefetch" href="/blog/assets/js/25.3ffcdbe0.js"><link rel="prefetch" href="/blog/assets/js/26.4e3cd358.js"><link rel="prefetch" href="/blog/assets/js/27.8102072e.js"><link rel="prefetch" href="/blog/assets/js/28.39d6e807.js"><link rel="prefetch" href="/blog/assets/js/29.73d719e5.js"><link rel="prefetch" href="/blog/assets/js/3.43307d58.js"><link rel="prefetch" href="/blog/assets/js/30.42de7b92.js"><link rel="prefetch" href="/blog/assets/js/32.a5b7465f.js"><link rel="prefetch" href="/blog/assets/js/33.2c2cfdb0.js"><link rel="prefetch" href="/blog/assets/js/34.e456df99.js"><link rel="prefetch" href="/blog/assets/js/35.ea2eb292.js"><link rel="prefetch" href="/blog/assets/js/36.2d18424c.js"><link rel="prefetch" href="/blog/assets/js/37.e0439f11.js"><link rel="prefetch" href="/blog/assets/js/38.e3ca0fed.js"><link rel="prefetch" href="/blog/assets/js/39.121c55c9.js"><link rel="prefetch" href="/blog/assets/js/4.981852e7.js"><link rel="prefetch" href="/blog/assets/js/40.c09dfbff.js"><link rel="prefetch" href="/blog/assets/js/41.43ccf10c.js"><link rel="prefetch" href="/blog/assets/js/42.96587c01.js"><link rel="prefetch" href="/blog/assets/js/43.ac2e4f7a.js"><link rel="prefetch" href="/blog/assets/js/44.f8991bcc.js"><link rel="prefetch" href="/blog/assets/js/45.96c75153.js"><link rel="prefetch" href="/blog/assets/js/5.e552e1f2.js"><link rel="prefetch" href="/blog/assets/js/6.dd64a897.js"><link rel="prefetch" href="/blog/assets/js/7.63e76dfa.js"><link rel="prefetch" href="/blog/assets/js/8.009721ba.js"><link rel="prefetch" href="/blog/assets/js/9.7a30687e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8b6f9cb2.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="轩辕李的博客" class="logo"> <span class="site-name can-hide">轩辕李的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/blog/server/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/server/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/blog/server/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/blog/server/util/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/blog/server/distribution/" class="nav-link">分布式</a></li><li class="dropdown-item"><!----> <a href="/blog/server/think/" class="nav-link">心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/blog/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/htmlcss/" class="nav-link">HTML&amp;CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/blog/operation/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/operation/linuxc/" class="nav-link">Linux &amp; C</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/blog/english-corner/" class="nav-link">英语角</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xuanyuanli/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/xuanyuanli/Img@master/picx/image.5k3g1yhljok0.jpg"> <div class="blogger-info"><h3>轩辕李</h3> <span>勇猛精进，星辰大海</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/blog/server/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/server/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/blog/server/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/blog/server/util/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/blog/server/distribution/" class="nav-link">分布式</a></li><li class="dropdown-item"><!----> <a href="/blog/server/think/" class="nav-link">心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/blog/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/htmlcss/" class="nav-link">HTML&amp;CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/blog/operation/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/operation/linuxc/" class="nav-link">Linux &amp; C</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/blog/english-corner/" class="nav-link">英语角</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xuanyuanli/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>分布式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/3a018a/" aria-current="page" class="active sidebar-link">分布式基础-CAP理论</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#为啥要有cap" class="sidebar-link">为啥要有CAP</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#什么是cap" class="sidebar-link">什么是CAP</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#为何选择ca-放弃分区容错性-加强一致性和可用性" class="sidebar-link">为何选择CA：放弃分区容错性，加强一致性和可用性</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#为何选择cp-放弃可用性-或部分可用" class="sidebar-link">为何选择CP：放弃可用性，或部分可用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/3a018a/#paxos" class="sidebar-link">Paxos</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#为何选择ap-放弃一致性-追求分区容错性和可用性" class="sidebar-link">为何选择AP：放弃一致性，追求分区容错性和可用性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/3a018a/#base理论" class="sidebar-link">BASE理论</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#跳出cap" class="sidebar-link">跳出CAP</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/3a018a/#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>心得</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/blog/server/#后端" data-v-06225672>后端</a></li><li data-v-06225672><a href="/blog/server/#分布式" data-v-06225672>分布式</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/xuanyuanli" target="_blank" title="作者" class="beLink" data-v-06225672>轩辕李</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">分布式基础-CAP理论<!----></h1>  <div class="theme-vdoing-content content__default"><p>对于刚进入分布式领域的你来说，常会怀有一系列错误的假设。<br>
基本上每个人都会预设下面的8条假定：</p> <ol><li>网络是稳定的</li> <li>网络传输的延迟是零</li> <li>网络的带宽是无穷大</li> <li>网络是安全的</li> <li>网络的拓扑不会改变</li> <li>只有一个系统管理员</li> <li>传输数据的成本是零</li> <li>整个网络是同构的</li></ol> <p>而有了这些错误假定，就是系统设计悲剧的开始。

相应地，为了设计好一个分布式系统，你应该牢记以下的前提：</p> <ol><li>网络不总是稳定的</li> <li>网络传输的延迟不可能为零</li> <li>网络的带宽是有限的，要充分利用</li> <li>网络的默认设置是非安全的</li> <li>网络的拓扑会改变</li> <li>会有多个系统管理员</li> <li>传输数据的成本是需要考虑的</li> <li>整个网络是非同构的</li></ol> <h2 id="为啥要有cap"><a href="#为啥要有cap" class="header-anchor">#</a> 为啥要有CAP</h2> <p>有了以上的8条前提，可以想象设计一个好的分布式系统是非常困难的。<br>
当你遇到巨大难题的时候，如果有人提纲挈领的给一个指导，那么想必你的工作会顺利不少。<br>
那么在业界，存不存在这样的理论指导呢？<br>
当然是有的，这要感谢Eric Brewer教授，他在2000年7月，提出了著名的CAP猜想：</p> <blockquote><blockquote><p>在一个不稳定（消息要么乱序要么丢了）的网络环境里（分布式异步模型），能否始终保持数据一致</p></blockquote></blockquote> <p>2年后，Seth Gilbert和Nancy Lynch从理论上证明了CAP理论，原始论文请<a href="https://users.ece.cmu.edu/~adrian/731-sp04/readings/GL-cap.pdf" target="_blank" rel="noopener noreferrer">点击查看<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>CAP理论告诉你，不要幻想了，在分布式环境中，不能既要...又要...还要，做系统要有所取舍。</p> <h2 id="什么是cap"><a href="#什么是cap" class="header-anchor">#</a> 什么是CAP</h2> <p>CAP分别表示：</p> <ul><li>一致性（Consistency）：也就是一个副本修改数据时，其他副本也要更新；一般用到的方式是：等其他副本也写入完成，才算真正写入成功</li> <li>可用性（Available）：是指系统提供的服务必须一直处于可用的状态，对于用户的每一个操作请求总是能在有限时间内返回结果</li> <li>分区容错（Partition Tolerance）：是指分布式系统在遇到任何网络分区故障的时候，仍然需要能保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障</li></ul> <p>用图片表示是这样的：<br> <img src="https://cdn.staticaly.com/gh/xuanyuanli/Img@master/picx/image.62zjbqkpi6o0.png" alt="image"></p> <p>这里就不给出CAP理论的证明了，我们主要来讨论CAP理论的应用</p> <h2 id="为何选择ca-放弃分区容错性-加强一致性和可用性"><a href="#为何选择ca-放弃分区容错性-加强一致性和可用性" class="header-anchor">#</a> 为何选择CA：放弃分区容错性，加强一致性和可用性</h2> <p>选择CA的系统，就是要放弃分区容错，那么简单理解，可以说你放弃了系统是分布式的，而追求一个单体架构。<br>
最容易想到的就是单节点的关系型数据库，保持了强一致性和可用性，但天生不支持分布式。<br>
那不禁要问，没有了分区容忍，还叫分布式系统么？ 确实不能叫分布式系统了。<br>
其实对于分布式系统工程实践，CAP 理论更合适的描述是：<strong>在满足分区容错的前提下，没有算法能同时满足数据一致性和服务可用性。</strong></p> <h2 id="为何选择cp-放弃可用性-或部分可用"><a href="#为何选择cp-放弃可用性-或部分可用" class="header-anchor">#</a> 为何选择CP：放弃可用性，或部分可用</h2> <p>对于做网站的工程师来说，CP是最先被摒弃的模式。因为可用性对网站来说是生命线，运维同学对此应该深有体会，如果网站服务宕机，那将是最严重的生产事故。<br>
那么放弃可用性，就没有存在的场景了么？<br>
大千世界，如此复杂，肯定还是会有CP发展的空间的。比如说银行系统来说，一致性是其生命线，分区容错也是要保证的，这时候允许出现不可用，当出现故障的时候，客户需要耐心等待一下，但是金融数据绝对不能出错。</p> <p>同时你还需要注意到，关于可用性，其中有一些弹性空间的。也就是好的系统，会出现部分不可用，而不是完全不可用。这方面，著名的Paxos就是其中翘楚。</p> <h3 id="paxos"><a href="#paxos" class="header-anchor">#</a> Paxos</h3> <p>Mike Burrows说世界上只有一种一致性算法，就是Paxos。<br>
Paxos算法基本上是一个民主选举算法--大多数的决定会成为整个集群的统一决定。任何一个点都可以提出要修改某个数据的提案，是否通过这个提案取决于这个集群中是否有超过半数的结点同意。<br>
在业界，Paxos算法因为Google的chubby和ZooKeeper而被人熟知。</p> <p>关于Paxos算法的详解，参考<a href="https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95" target="_blank" rel="noopener noreferrer">维基百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
其实Zookeeper也未完全实现Paxos，而是使用了ZAB协议，参考<a href="https://zhuanlan.zhihu.com/p/145305409" target="_blank" rel="noopener noreferrer">Zookeeper协议篇-Paxos算法与ZAB协议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="为何选择ap-放弃一致性-追求分区容错性和可用性"><a href="#为何选择ap-放弃一致性-追求分区容错性和可用性" class="header-anchor">#</a> 为何选择AP：放弃一致性，追求分区容错性和可用性</h2> <p>你首先要明确，CAP中的C值得是强一致性，也就是要求多节点组成的被调要能像单节点一样运作、操作具备原子性，数据在时间、时序上都有要求。<br>
前面讲到的可用性，显然是在 0% 到 100% 之间连续变化的。对于一致性来说，也是如此，大多数情况下，工程实现上是灵活的，一致性也可以分为多个不同的含义。</p> <ul><li>Weak 弱一致性：当你写入一个新值后，读操作在数据副本上可能读出来，也可能读不出来。比如说一些日志系统</li> <li>Eventually 最终一致性：当你写入一个新值后，有可能读不出来，但在某个时间窗口之后保证最终能读出来。比如说事务补偿</li> <li>Strong 强一致性：新的数据一旦写入，在任意副本任意时刻都能读到新值。比如说文件系统</li></ul> <p>当可用性和一致性含义增加的时候，情况变得复杂了。<br>
你做系统设计的时候，要根据自己的业务系统选择适当的方式来实现最终的目标，这就需要创意思考，谨慎权衡了。<br>
这也是为什么做架构设计的时候会有3种或以上的方案，多个技术方案进行评审无疑会增强决策的准确性，减少出错概率。</p> <h3 id="base理论"><a href="#base理论" class="header-anchor">#</a> BASE理论</h3> <p>既然可用性和一致性是灵活的，业界也发展出来了基于CAP的其他最佳实践，BASE就是其中的代表。<br>
BASE是Basically Available（基本可用）、Soft state（软状态）和Eventually consistent（最终一致性）三个短语的缩写，他的核心思想是：强一致性是困难的，那么就要根据业务特定，采用适当的方式来使系统达到最终一致性。</p> <ul><li>基本可用：是指分布式系统在出现不可预知的故障时，允许损失部分可用性。例如响应时间的损失、功能上的损失</li> <li>软状态：是指允许系统数据存在的中间状态，并认为该中间状态的存在不影响系统的整体可用性，及允许系统主机间进行数据同步的过程存在一定的延时。软状态，其实就是一种灰度状态，过渡状态。</li> <li>最终一致性：其强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能达到一个一致的状态。因此，最终一致性的本质是需要系统保证最终数据能够达到一致，而不需要实时保证系统数据的强一致性</li></ul> <p>对于BASE理论的应用，工程实践可以参考<a href="https://zhuanlan.zhihu.com/p/114740132" target="_blank" rel="noopener noreferrer">Eureka原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="跳出cap"><a href="#跳出cap" class="header-anchor">#</a> 跳出CAP</h2> <p>CAP只是一种理论指导，有了他，你对问题理解的更加深刻，但也不意味着你就要固步自封了。<br>
跳出CAP，思路延伸为如何规划分区期间的操作和分区之后的恢复。例如，Oracle数据库的DataGuard复制组件包含三种模式：</p> <ul><li>最大保护模式（Maximum Protection）：即强同步复制模式，写操作要求主库先将操作日志（数据库的 redo/undo 日志）同步到至少一个备库才可以返回客户端成功。这种模式保证即使主库出现无法恢复的故障，比如硬盘损坏，也不会丢失数据；</li> <li>最大性能模式（Maximum Performance）：即异步复制模式，写操作只需要在主库上执行成功就可以返回客户端成功，主库上的后台线程会将重做日志通过异步的方式复制到备库。这种方式保证了性能及可用性，但是可能丢失数据；</li> <li>最大可用性模式（Maximum Availability）：上述两种模式的折中。正常情况下相当于最大保护模式，如果主备之间的网络出现故障，切换为最大性能模式。</li></ul> <p>这就是一种经典的用法。<br>
你会发现，在很多时候通过细致地管理分区期间的不变性约束，两方面的性质都可以取得最佳的表现。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>回到最初的问题，CAP理论就像是经济学中蒙代尔不可能三角一样，带你进入了更高的层面分析问题，让你知道设计一个系统时的基础约束，前辈走过了很多路，帮你剔除了很多错误答案，接下来的路上就要靠你自己了。<br>
本文的分析和总结也是挂一漏万，要多研究现有的优秀分布式系统，分析其设计理念和对CAP的实现，你才可以更快地成长。</p> <p><strong>祝你变得更强！</strong></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xuanyuanli/blog/edit/main/docs/01.后端/19.分布式/01.分布式基础-CAP理论.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/blog/tags/?tag=CAP" title="标签">#CAP</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/09/12, 22:05:54</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/blog/pages/ade902/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">从Eclipse到IDEA，金字塔到太空堡垒</div></a> <a href="/blog/pages/d50067/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">关于“编程的本质”的探讨</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/pages/ade902/" class="prev">从Eclipse到IDEA，金字塔到太空堡垒</a></span> <span class="next"><a href="/blog/pages/d50067/">关于“编程的本质”的探讨</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/pages/f36bf8/"><div>
            Java 文件操作
            <!----></div></a> <span class="date">09-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/pages/88c2d0/"><div>
            Java IO
            <!----></div></a> <span class="date">08-25</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/pages/d2e513/"><div>
            Java集合
            <!----></div></a> <span class="date">08-06</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:xuanyuanli999@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xuanyuanli" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>xuanyuanli | <a href="https://github.com/xuanyuanli/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/blog/assets/js/app.01ab09a8.js" defer></script><script src="/blog/assets/js/2.cb21dba0.js" defer></script><script src="/blog/assets/js/31.8e7b1f6c.js" defer></script>
  </body>
</html>
