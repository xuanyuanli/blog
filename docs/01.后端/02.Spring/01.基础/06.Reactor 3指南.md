---
title: Reactor 3æŒ‡å—
date: 2023-11-21 20:43:26
permalink: /pages/c97521/
categories:
  - åç«¯
  - SpringåŸºç¡€
tags:
  - Reactor
author: 
  name: è½©è¾•æ
  link: https://github.com/xuanyuanli
---


## ä¸€ã€Reactor 3ç®€ä»‹

[Reactor 3](https://projectreactor.io/docs/core/release/reference/gettingStarted.html) æ˜¯ä¸€ä¸ªåŸºäº Java çš„[å“åº”å¼ç¼–ç¨‹](/pages/2fa7b3/)åº“ï¼Œå®ƒæ˜¯ `Project Reactor` çš„æ ¸å¿ƒå®ç°ï¼Œæ—¨åœ¨ä¸º Java å¼€å‘è€…æä¾›ä¸€å¥—é«˜æ•ˆã€çµæ´»çš„å“åº”å¼ç¼–ç¨‹å·¥å…·ã€‚Reactor 3 çš„è®¾è®¡çµæ„Ÿæ¥æºäº `Reactive Streams` è§„èŒƒï¼Œè¯¥è§„èŒƒå®šä¹‰äº†å“åº”å¼ç¼–ç¨‹çš„æ ‡å‡†æ¥å£ï¼Œä½¿å¾—ä¸åŒçš„å“åº”å¼åº“å¯ä»¥äº’ç›¸å…¼å®¹ã€‚

<!-- more -->

Reactor 3 çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š
1. **Flux å’Œ Mono**ï¼šReactor 3 æä¾›äº†ä¸¤ç§æ ¸å¿ƒæ•°æ®ç±»å‹ï¼š
   - `Flux`ï¼šè¡¨ç¤ºä¸€ä¸ªåŒ…å« 0 åˆ° N ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—ã€‚
   - `Mono`ï¼šè¡¨ç¤ºä¸€ä¸ªåŒ…å« 0 æˆ– 1 ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—ã€‚
   è¿™ä¸¤ç§ç±»å‹ä¸ºå¼€å‘è€…æä¾›äº†çµæ´»çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚

2. **ä¸°å¯Œçš„æ“ä½œç¬¦**ï¼šReactor 3 æä¾›äº†å¤§é‡çš„æ“ä½œç¬¦ï¼ˆå¦‚ `map`ã€`flatMap`ã€`filter` ç­‰ï¼‰ï¼Œç”¨äºå¯¹æ•°æ®æµè¿›è¡Œè½¬æ¢ã€è¿‡æ»¤ã€åˆå¹¶ç­‰æ“ä½œã€‚è¿™äº›æ“ä½œç¬¦ä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾åœ°æ„å»ºå¤æ‚çš„æ•°æ®å¤„ç†ç®¡é“ã€‚

3. **èƒŒå‹æ”¯æŒ**ï¼šReactor 3 å®Œå…¨æ”¯æŒ `èƒŒå‹ï¼ˆBackpressureï¼‰` æœºåˆ¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„é€Ÿç‡ä¸åŒ¹é…é—®é¢˜ï¼Œé¿å…ç³»ç»Ÿèµ„æºçš„æµªè´¹ã€‚

4. **ä¸ Spring ç”Ÿæ€çš„æ— ç¼é›†æˆ**ï¼šReactor 3 æ˜¯ `Spring WebFlux` çš„åº•å±‚å®ç°ï¼Œèƒ½å¤Ÿä¸ Spring æ¡†æ¶æ— ç¼é›†æˆï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜æ€§èƒ½çš„å“åº”å¼ Web åº”ç”¨ç¨‹åºã€‚

5. **é«˜æ€§èƒ½ä¸ä½å»¶è¿Ÿ**ï¼šReactor 3 åœ¨è®¾è®¡ä¸Šæ³¨é‡æ€§èƒ½ä¼˜åŒ–ï¼Œèƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®æµï¼ŒåŒæ—¶ä¿æŒä½å»¶è¿Ÿã€‚

## äºŒã€å®‰è£…ä¸è®¾ç½®

### 1. ç¯å¢ƒå‡†å¤‡

#### a. Javaç‰ˆæœ¬è¦æ±‚

Reactor 3 æ˜¯åŸºäº Java çš„å“åº”å¼ç¼–ç¨‹åº“ï¼Œå› æ­¤éœ€è¦ç¡®ä¿å¼€å‘ç¯å¢ƒä¸­å®‰è£…äº†åˆé€‚çš„ Java ç‰ˆæœ¬ã€‚Reactor 3 æ”¯æŒçš„æœ€ä½ Java ç‰ˆæœ¬ä¸º `Java 8`ï¼Œä½†å»ºè®®ä½¿ç”¨ `Java 11` æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚

å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å½“å‰ Java ç‰ˆæœ¬ï¼š

```bash
java -version
```

å¦‚æœæœªå®‰è£… Java æˆ–ç‰ˆæœ¬è¿‡ä½ï¼Œå¯ä»¥ä» [Oracle JDK](https://www.oracle.com/java/technologies/javase-downloads.html) æˆ– [OpenJDK](https://openjdk.java.net/) ä¸‹è½½å¹¶å®‰è£…åˆé€‚çš„ç‰ˆæœ¬ã€‚

#### b. æ·»åŠ ä¾èµ–é¡¹

Reactor 3 å¯ä»¥é€šè¿‡ Maven æˆ– Gradle æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ„å»ºå·¥å…·çš„ä¾èµ–é…ç½®ï¼š

**Maven é…ç½®ï¼š**

åœ¨ `pom.xml` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```xml
<dependencies>
    <!-- Reactor Core -->
    <dependency>
        <groupId>io.projectreactor</groupId>
        <artifactId>reactor-core</artifactId>
        <version>3.6.12</version>
    </dependency>
    <!-- Reactor Test (å¯é€‰ï¼Œç”¨äºæµ‹è¯•) -->
    <dependency>
        <groupId>io.projectreactor</groupId>
        <artifactId>reactor-test</artifactId>
        <version>3.6.12</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

**Gradle é…ç½®ï¼š**

åœ¨ `build.gradle` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```groovy
dependencies {
    // Reactor Core
    implementation 'io.projectreactor:reactor-core:3.6.12'
    // Reactor Test (å¯é€‰ï¼Œç”¨äºæµ‹è¯•)
    testImplementation 'io.projectreactor:reactor-test:3.6.12'
}
```

### 2. ç¬¬ä¸€ä¸ªReactorç¨‹åº

#### a. åˆ›å»ºç®€å•çš„Fluxå’ŒMonoåºåˆ—

åœ¨ Reactor 3 ä¸­ï¼Œ`Flux` å’Œ `Mono` æ˜¯ä¸¤ç§æ ¸å¿ƒæ•°æ®ç±»å‹ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†å¤šä¸ªå…ƒç´ å’Œå•ä¸ªå…ƒç´ çš„å¼‚æ­¥æ•°æ®æµã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºç®€å• `Flux` å’Œ `Mono` åºåˆ—çš„ç¤ºä¾‹ä»£ç ï¼š

```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

public class FirstReactorProgram {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªå…ƒç´ çš„ Fluxï¼ˆ0-N ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—ï¼‰
        Flux<String> flux = Flux.just("Apple", "Banana", "Cherry");
        
        // åˆ›å»ºä¸€ä¸ªåŒ…å«å•ä¸ªå…ƒç´ çš„ Monoï¼ˆ0-1 ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—ï¼‰
        Mono<String> mono = Mono.just("Hello Reactor");
        
        // æ³¨æ„ï¼šä»…ä»…åˆ›å»º Flux å’Œ Mono ä¸ä¼šè§¦å‘ä»»ä½•æ“ä½œ
        // å¿…é¡»é€šè¿‡ subscribe() æ–¹æ³•è®¢é˜…æ‰ä¼šå¼€å§‹æ‰§è¡Œ
        System.out.println("Flux å’Œ Mono åˆ›å»ºå®Œæˆï¼Œä½†å°šæœªæ‰§è¡Œ");
    }
}
```

#### b. è®¢é˜…å’Œå¤„ç†æ•°æ®

åˆ›å»º `Flux` å’Œ `Mono` åºåˆ—åï¼Œéœ€è¦é€šè¿‡ `subscribe` æ–¹æ³•è®¢é˜…æ•°æ®æµå¹¶å¤„ç†æ•°æ®ã€‚ä»¥ä¸‹æ˜¯è®¢é˜…å’Œå¤„ç†æ•°æ®çš„ç¤ºä¾‹ä»£ç ï¼š

```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

public class FirstReactorProgram {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªå…ƒç´ çš„ Flux
        Flux<String> flux = Flux.just("Apple", "Banana", "Cherry");

        // è®¢é˜…å¹¶å¤„ç† Flux ä¸­çš„æ•°æ®
        // subscribe æ–¹æ³•æ”¯æŒä¸‰ä¸ª lambda è¡¨è¾¾å¼å‚æ•°ï¼š
        // 1. onNext: å¤„ç†æ¯ä¸ªæ•°æ®å…ƒç´ 
        // 2. onError: å¤„ç†é”™è¯¯æƒ…å†µï¼ˆå¯é€‰ï¼‰
        // 3. onComplete: å¤„ç†æµå®Œæˆäº‹ä»¶ï¼ˆå¯é€‰ï¼‰
        flux.subscribe(
            fruit -> System.out.println("ğŸ Received fruit: " + fruit), // å¤„ç†æ¯ä¸ªå…ƒç´ 
            error -> System.err.println("âŒ Error occurred: " + error),    // å¤„ç†é”™è¯¯
            () -> System.out.println("âœ… Flux completed successfully")         // å¤„ç†å®Œæˆäº‹ä»¶
        );

        System.out.println("------- åˆ†éš”çº¿ -------");
        
        // åˆ›å»ºä¸€ä¸ªåŒ…å«å•ä¸ªå…ƒç´ çš„ Mono
        Mono<String> mono = Mono.just("Hello Reactor");

        // è®¢é˜…å¹¶å¤„ç† Mono ä¸­çš„æ•°æ®
        mono.subscribe(
            message -> System.out.println("ğŸ“¨ Received message: " + message), // å¤„ç†å…ƒç´ 
            error -> System.err.println("âŒ Error occurred: " + error),        // å¤„ç†é”™è¯¯
            () -> System.out.println("âœ… Mono completed successfully")             // å¤„ç†å®Œæˆäº‹ä»¶
        );
        
        // ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€åŒ–çš„è®¢é˜…æ–¹å¼ï¼Œåªå¤„ç†æ•°æ®å…ƒç´ 
        Mono.just("Simple subscription").subscribe(System.out::println);
    }
}
```

**ä»£ç è¯´æ˜ï¼š**
1. **Flux ç¤ºä¾‹**ï¼š
  - ä½¿ç”¨ `Flux.just` åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå…ƒç´ çš„ `Flux` åºåˆ—ã€‚
  - é€šè¿‡ `subscribe` æ–¹æ³•è®¢é˜…æ•°æ®æµï¼Œå¹¶åˆ†åˆ«å¤„ç†å…ƒç´ ã€é”™è¯¯å’Œå®Œæˆäº‹ä»¶ã€‚

2. **Mono ç¤ºä¾‹**ï¼š
  - ä½¿ç”¨ `Mono.just` åˆ›å»ºä¸€ä¸ªåŒ…å«å•ä¸ªå…ƒç´ çš„ `Mono` åºåˆ—ã€‚
  - é€šè¿‡ `subscribe` æ–¹æ³•è®¢é˜…æ•°æ®æµï¼Œå¹¶åˆ†åˆ«å¤„ç†å…ƒç´ ã€é”™è¯¯å’Œå®Œæˆäº‹ä»¶ã€‚

**è¿è¡Œç»“æœï¼š**
```
ğŸ Received fruit: Apple
ğŸ Received fruit: Banana
ğŸ Received fruit: Cherry
âœ… Flux completed successfully
------- åˆ†éš”çº¿ -------
ğŸ“¨ Received message: Hello Reactor
âœ… Mono completed successfully
Simple subscription
```

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»æˆåŠŸåˆ›å»ºäº†ç¬¬ä¸€ä¸ª Reactor ç¨‹åºï¼Œå¹¶å­¦ä¼šäº†å¦‚ä½•è®¢é˜…å’Œå¤„ç†æ•°æ®æµã€‚æ¥ä¸‹æ¥ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢ Reactor 3 çš„æ ¸å¿ƒæ¦‚å¿µå’Œé«˜çº§ç‰¹æ€§ã€‚

## ä¸‰ã€æ ¸å¿ƒæ¦‚å¿µ

### 1. Flux å’Œ Mono

åœ¨ Reactor 3 ä¸­ï¼Œ`Flux` å’Œ `Mono` æ˜¯ä¸¤ç§æ ¸å¿ƒæ•°æ®ç±»å‹ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†å¤šä¸ªå…ƒç´ å’Œå•ä¸ªå…ƒç´ çš„å¼‚æ­¥æ•°æ®æµã€‚å®ƒä»¬æ˜¯å“åº”å¼ç¼–ç¨‹çš„åŸºç¡€ï¼Œç†è§£å®ƒä»¬çš„ç‰¹æ€§å’Œç”¨æ³•æ˜¯æŒæ¡ Reactor 3 çš„å…³é”®ã€‚

> **æ ¸å¿ƒåŒºåˆ«**ï¼š
> - `Flux` ç±»ä¼¼äº Java 8 çš„ `Stream`ï¼Œä½†æ˜¯ç”¨äºå¼‚æ­¥å¤„ç†ï¼Œå¯ä»¥å‘å‡º 0 åˆ° N ä¸ªå…ƒç´ 
> - `Mono` ç±»ä¼¼äº `Optional` æˆ– `CompletableFuture`ï¼Œä½†æ›´é€‚åˆå“åº”å¼ç¼–ç¨‹åœºæ™¯ï¼Œæœ€å¤šå‘å‡º 1 ä¸ªå…ƒç´ 
> - ä¸¤è€…éƒ½æ˜¯**å†·æµ**ï¼ˆCold Streamï¼‰ï¼Œåªæœ‰åœ¨è®¢é˜…æ—¶æ‰å¼€å§‹æ‰§è¡Œ
> - ä¸¤è€…éƒ½éµå¾ª **Reactive Streams** è§„èŒƒï¼Œæ”¯æŒèƒŒå‹æœºåˆ¶


#### a. Flux ç±»å‹è¯¦è§£

`Flux` æ˜¯ä¸€ä¸ªè¡¨ç¤º **0 åˆ° N ä¸ªå…ƒç´ ** çš„å¼‚æ­¥åºåˆ—ã€‚å®ƒå¯ä»¥å‘å‡ºå¤šä¸ªå…ƒç´ ï¼Œå¹¶åœ¨åºåˆ—ç»“æŸæ—¶å‘å‡ºå®Œæˆä¿¡å·ï¼Œæˆ–è€…åœ¨å‘ç”Ÿé”™è¯¯æ—¶å‘å‡ºé”™è¯¯ä¿¡å·ã€‚`Flux` é€‚ç”¨äºå¤„ç†å¤šä¸ªæ•°æ®é¡¹çš„åœºæ™¯ï¼Œä¾‹å¦‚ä»æ•°æ®åº“è¯»å–å¤šæ¡è®°å½•ã€å¤„ç†äº‹ä»¶æµç­‰ã€‚

**Flux çš„ç”Ÿå‘½å‘¨æœŸ**ï¼š
- **onNext**ï¼šå‘å‡ºæ•°æ®å…ƒç´ 
- **onComplete**ï¼šåºåˆ—æ­£å¸¸ç»“æŸ
- **onError**ï¼šåºåˆ—å› é”™è¯¯ç»“æŸ

**Flux çš„åˆ›å»ºæ–¹å¼ï¼š**
1. **é™æ€å·¥å‚æ–¹æ³•**ï¼š
  - `Flux.just(T... data)`ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šå…ƒç´ çš„ `Flux`ã€‚
  - `Flux.fromIterable(Iterable<T> iterable)`ï¼šä»é›†åˆæˆ–è¿­ä»£å™¨åˆ›å»º `Flux`ã€‚
  - `Flux.range(int start, int count)`ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è¿ç»­æ•´æ•°çš„ `Flux`ã€‚
  - `Flux.interval(Duration period)`ï¼šåˆ›å»ºä¸€ä¸ªæŒ‰å›ºå®šæ—¶é—´é—´éš”å‘å‡ºå…ƒç´ çš„ `Flux`ã€‚

2. **åŠ¨æ€ç”Ÿæˆ**ï¼š
  - ä½¿ç”¨ `Flux.generate` æˆ– `Flux.create` åŠ¨æ€ç”Ÿæˆæ•°æ®æµã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import java.time.Duration;
import java.util.Arrays;
import java.util.List;

public class FluxExample {
    public static void main(String[] args) {
        System.out.println("=== Flux åˆ›å»ºæ–¹å¼æ¼”ç¤º ===");
        
        // 1. ä½¿ç”¨ just() åˆ›å»ºåŒ…å«å›ºå®šå…ƒç´ çš„ Flux
        Flux<String> fruitFlux = Flux.just("Apple", "Banana", "Cherry");
        fruitFlux.subscribe(fruit -> System.out.println("ğŸ Fruit: " + fruit));
        
        // 2. ä»é›†åˆåˆ›å»º Flux
        List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5);
        Flux<Integer> numberFlux = Flux.fromIterable(numbers);
        numberFlux.subscribe(num -> System.out.println("ğŸ”¢ Number: " + num));
        
        // 3. åˆ›å»ºæ•°å­—èŒƒå›´çš„ Flux
        Flux<Integer> rangeFlux = Flux.range(10, 5); // ä»10å¼€å§‹ï¼Œç”Ÿæˆ5ä¸ªæ•°å­—
        rangeFlux.subscribe(num -> System.out.println("ğŸ“Š Range: " + num));
        
        System.out.println("\n=== æ—¶é—´é—´éš” Flux æ¼”ç¤º ===");
        
        // 4. åˆ›å»ºä¸€ä¸ªæŒ‰æ—¶é—´é—´éš”å‘å‡ºå…ƒç´ çš„ Flux
        Flux<Long> intervalFlux = Flux.interval(Duration.ofSeconds(1))
                                      .take(5); // åªå–å‰ 5 ä¸ªå…ƒç´ 

        intervalFlux.subscribe(
            value -> System.out.println("â° Interval " + value + " at " + System.currentTimeMillis()),
            error -> System.err.println("âŒ Error: " + error),
            () -> System.out.println("âœ… Interval Flux completed")
        );

        // 5. åˆ›å»ºç©ºçš„ Flux
        Flux<String> emptyFlux = Flux.empty();
        emptyFlux.subscribe(
            data -> System.out.println("Data: " + data),
            error -> System.err.println("Error: " + error),
            () -> System.out.println("ğŸ“­ Empty Flux completed")
        );

        // é˜²æ­¢ä¸»çº¿ç¨‹é€€å‡ºï¼ˆå¼‚æ­¥æ“ä½œéœ€è¦ç­‰å¾…ï¼‰
        try {
            System.out.println("â³ ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ...");
            Thread.sleep(6000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
```

**è¿è¡Œç»“æœï¼š**
```
=== Flux åˆ›å»ºæ–¹å¼æ¼”ç¤º ===
ğŸ Fruit: Apple
ğŸ Fruit: Banana
ğŸ Fruit: Cherry
ğŸ”¢ Number: 1
ğŸ”¢ Number: 2
ğŸ”¢ Number: 3
ğŸ”¢ Number: 4
ğŸ”¢ Number: 5
ğŸ“Š Range: 10
ğŸ“Š Range: 11
ğŸ“Š Range: 12
ğŸ“Š Range: 13
ğŸ“Š Range: 14
ğŸ“­ Empty Flux completed

=== æ—¶é—´é—´éš” Flux æ¼”ç¤º ===
â³ ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ...
â° Interval 0 at 1640000000000
â° Interval 1 at 1640000001000
â° Interval 2 at 1640000002000
â° Interval 3 at 1640000003000
â° Interval 4 at 1640000004000
âœ… Interval Flux completed
```


#### b. Mono ç±»å‹è¯¦è§£

`Mono` æ˜¯ä¸€ä¸ªè¡¨ç¤º **0 æˆ– 1 ä¸ªå…ƒç´ ** çš„å¼‚æ­¥åºåˆ—ã€‚å®ƒé€šå¸¸ç”¨äºå¤„ç†å•ä¸ªæ•°æ®é¡¹çš„åœºæ™¯ï¼Œä¾‹å¦‚ä»æ•°æ®åº“è¯»å–ä¸€æ¡è®°å½•ã€å¤„ç†å•ä¸ª HTTP è¯·æ±‚ç­‰ã€‚

**Mono çš„ç”Ÿå‘½å‘¨æœŸ**ï¼š
- **onNext**ï¼šå‘å‡ºæ•°æ®å…ƒç´ ï¼ˆæœ€å¤šä¸€ä¸ªï¼‰
- **onComplete**ï¼šåºåˆ—æ­£å¸¸ç»“æŸï¼ˆå¯èƒ½æ²¡æœ‰å‘å‡ºä»»ä½•å…ƒç´ ï¼‰
- **onError**ï¼šåºåˆ—å› é”™è¯¯ç»“æŸ

**Mono çš„åˆ›å»ºæ–¹å¼ï¼š**
1. **é™æ€å·¥å‚æ–¹æ³•**ï¼š
  - `Mono.just(T data)`ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šå…ƒç´ çš„ `Mono`ã€‚
  - `Mono.empty()`ï¼šåˆ›å»ºä¸€ä¸ªä¸åŒ…å«ä»»ä½•å…ƒç´ çš„ `Mono`ã€‚
  - `Mono.error(Throwable error)`ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«é”™è¯¯ä¿¡å·çš„ `Mono`ã€‚
  - `Mono.fromCallable(Callable<T> callable)`ï¼šä» `Callable` åˆ›å»º `Mono`ã€‚

2. **åŠ¨æ€ç”Ÿæˆ**ï¼š
  - ä½¿ç”¨ `Mono.create` åŠ¨æ€ç”Ÿæˆæ•°æ®æµã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Mono;

public class MonoExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªåŒ…å«å•ä¸ªå…ƒç´ çš„ Mono
        Mono<String> mono = Mono.just("Hello Reactor");

        // è®¢é˜…å¹¶å¤„ç† Mono ä¸­çš„æ•°æ®
        mono.subscribe(
            message -> System.out.println("Received: " + message), // å¤„ç†å…ƒç´ 
            error -> System.err.println("Error: " + error),        // å¤„ç†é”™è¯¯
            () -> System.out.println("Mono completed")             // å¤„ç†å®Œæˆäº‹ä»¶
        );

        // åˆ›å»ºä¸€ä¸ªç©ºçš„ Mono
        Mono<String> emptyMono = Mono.empty();

        emptyMono.subscribe(
            message -> System.out.println("Received: " + message),
            error -> System.err.println("Error: " + error),
            () -> System.out.println("Empty Mono completed")
        );
    }
}
```

**è¿è¡Œç»“æœï¼š**
```
Received: Hello Reactor
Mono completed
Empty Mono completed
```

### 2. æ“ä½œç¬¦

Reactor 3 æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œç”¨äºå¯¹æ•°æ®æµè¿›è¡Œè½¬æ¢ã€è¿‡æ»¤ã€åˆå¹¶ç­‰æ“ä½œã€‚è¿™äº›æ“ä½œç¬¦æ˜¯å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…è½»æ¾åœ°æ„å»ºå¤æ‚çš„æ•°æ®å¤„ç†ç®¡é“ã€‚ä»¥ä¸‹æ˜¯ä¸‰ç±»å¸¸ç”¨çš„æ“ä½œç¬¦ï¼šæ•°æ®è½¬æ¢æ“ä½œç¬¦ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦ä»¥åŠåˆå¹¶ä¸æ‹†åˆ†æ“ä½œç¬¦ã€‚

#### a. æ•°æ®è½¬æ¢æ“ä½œç¬¦

æ•°æ®è½¬æ¢æ“ä½œç¬¦ç”¨äºå¯¹æ•°æ®æµä¸­çš„å…ƒç´ è¿›è¡Œè½¬æ¢æˆ–æ˜ å°„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ•°æ®è½¬æ¢æ“ä½œç¬¦ï¼š

1. **`map`**ï¼šå°†å…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚
2. **`flatMap`**ï¼šå°†å…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ª `Flux` æˆ– `Mono`ï¼Œå¹¶å°†ç»“æœå±•å¹³ã€‚
3. **`filter`**ï¼šæ ¹æ®æ¡ä»¶è¿‡æ»¤å…ƒç´ ã€‚
4. **`concatMap`**ï¼šç±»ä¼¼äº `flatMap`ï¼Œä½†ä¿æŒé¡ºåºã€‚
5. **`switchMap`**ï¼šå°†å…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ª `Flux` æˆ– `Mono`ï¼Œå¹¶å–æ¶ˆä¹‹å‰çš„è®¢é˜…ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

public class TransformationOperators {
    public static void main(String[] args) {
        System.out.println("=== æ•°æ®è½¬æ¢æ“ä½œç¬¦æ¼”ç¤º ===");
        
        // 1. ä½¿ç”¨ map è½¬æ¢å…ƒç´ ï¼ˆä¸€å¯¹ä¸€è½¬æ¢ï¼‰
        System.out.println("\n--- map æ“ä½œç¬¦ ---");
        Flux<Integer> numbers = Flux.just(1, 2, 3, 4, 5);
        numbers.map(n -> n * 2)  // å°†æ¯ä¸ªæ•°å­—ä¹˜ä»¥2
               .subscribe(result -> System.out.println("ğŸ”¢ " + result));

        // 2. ä½¿ç”¨ flatMap è½¬æ¢å¹¶å±•å¹³ï¼ˆä¸€å¯¹å¤šè½¬æ¢ï¼Œå¼‚æ­¥ï¼‰
        System.out.println("\n--- flatMap æ“ä½œç¬¦ ---");
        Flux<String> words = Flux.just("Hello", "World");
        words.flatMap(word -> Flux.fromArray(word.split("")))  // å°†æ¯ä¸ªå•è¯æ‹†åˆ†æˆå­—ç¬¦
             .subscribe(letter -> System.out.println("ğŸ“ " + letter));

        // 3. ä½¿ç”¨ concatMap è½¬æ¢å¹¶å±•å¹³ï¼ˆä¿æŒé¡ºåºï¼‰
        System.out.println("\n--- concatMap æ“ä½œç¬¦ ---");
        Flux.just("First", "Second")
            .concatMap(word -> Flux.fromArray(word.split(""))
                .delayElements(java.time.Duration.ofMillis(100)))  // æ·»åŠ å»¶è¿Ÿæ¼”ç¤ºé¡ºåºä¿æŒ
            .subscribe(letter -> System.out.println("ğŸ¯ " + letter));

        // 4. ä½¿ç”¨ filter è¿‡æ»¤å…ƒç´ 
        System.out.println("\n--- filter æ“ä½œç¬¦ ---");
        Flux.range(1, 10)
            .filter(n -> n % 2 == 0)  // åªä¿ç•™å¶æ•°
            .subscribe(even -> System.out.println("âœ¨ Even number: " + even));

        // 5. ä½¿ç”¨ take é™åˆ¶å…ƒç´ æ•°é‡
        System.out.println("\n--- take æ“ä½œç¬¦ ---");
        Flux.range(1, 100)
            .take(3)  // åªå–å‰3ä¸ªå…ƒç´ 
            .subscribe(num -> System.out.println("ğŸª First 3: " + num));
            
        // 6. ä½¿ç”¨ skip è·³è¿‡å…ƒç´ 
        System.out.println("\n--- skip æ“ä½œç¬¦ ---");
        Flux.range(1, 10)
            .skip(5)  // è·³è¿‡å‰5ä¸ªå…ƒç´ 
            .subscribe(num -> System.out.println("â­ï¸ After skip: " + num));

        // ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
```

#### b. é”™è¯¯å¤„ç†æ“ä½œç¬¦

é”™è¯¯å¤„ç†æ“ä½œç¬¦ç”¨äºå¤„ç†æ•°æ®æµä¸­çš„é”™è¯¯ä¿¡å·ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é”™è¯¯å¤„ç†æ“ä½œç¬¦ï¼š

1. **`onErrorReturn`**ï¼šåœ¨å‘ç”Ÿé”™è¯¯æ—¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚
2. **`onErrorResume`**ï¼šåœ¨å‘ç”Ÿé”™è¯¯æ—¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ª `Flux` æˆ– `Mono`ã€‚
3. **`onErrorMap`**ï¼šå°†é”™è¯¯è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„é”™è¯¯ã€‚
4. **`retry`**ï¼šåœ¨å‘ç”Ÿé”™è¯¯æ—¶é‡è¯•è®¢é˜…ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;
import java.time.Duration;

public class ErrorHandlingOperators {
    public static void main(String[] args) {
        System.out.println("=== é”™è¯¯å¤„ç†æ“ä½œç¬¦æ¼”ç¤º ===");
        
        // åˆ›å»ºä¸€ä¸ªåŒ…å«é”™è¯¯çš„ Flux
        Flux<Integer> fluxWithError = Flux.just(1, 2, 3)
                .concatWith(Flux.error(new RuntimeException("ğŸ’¥ Something went wrong!")));

        // 1. ä½¿ç”¨ onErrorReturn æä¾›é»˜è®¤å€¼
        System.out.println("\n--- onErrorReturn æ“ä½œç¬¦ ---");
        fluxWithError.onErrorReturn(-1)
                     .subscribe(
                         value -> System.out.println("âœ… Value: " + value),
                         error -> System.err.println("âŒ Error: " + error),
                         () -> System.out.println("ğŸ Completed with default value")
                     );

        // 2. ä½¿ç”¨ onErrorResume åˆ‡æ¢åˆ°å¤‡ç”¨æµ
        System.out.println("\n--- onErrorResume æ“ä½œç¬¦ ---");
        fluxWithError.onErrorResume(error -> {
                         System.out.println("ğŸ”„ Error detected, switching to backup stream: " + error.getMessage());
                         return Flux.just(4, 5, 6);
                     })
                     .subscribe(
                         value -> System.out.println("ğŸ“¦ Backup value: " + value),
                         error -> System.err.println("âŒ Unexpected error: " + error),
                         () -> System.out.println("ğŸ Completed with backup stream")
                     );

        // 3. ä½¿ç”¨ onErrorMap è½¬æ¢é”™è¯¯ç±»å‹
        System.out.println("\n--- onErrorMap æ“ä½œç¬¦ ---");
        fluxWithError.onErrorMap(RuntimeException.class, 
                                ex -> new IllegalStateException("ğŸ­ Transformed error: " + ex.getMessage()))
                     .subscribe(
                         value -> System.out.println("âœ… Value: " + value),
                         error -> System.err.println("ğŸ­ Transformed error: " + error),
                         () -> System.out.println("ğŸ Completed")
                     );

        // 4. ä½¿ç”¨ retry é‡è¯•æ“ä½œ
        System.out.println("\n--- retry æ“ä½œç¬¦ ---");
        Flux.just(1, 2, 3)
            .concatWith(Flux.error(new RuntimeException("âš ï¸ Temporary error")))
            .retry(2)  // æœ€å¤šé‡è¯•2æ¬¡
            .subscribe(
                value -> System.out.println("ğŸ”„ Retry value: " + value),
                error -> System.err.println("âŒ Final error after retries: " + error.getMessage()),
                () -> System.out.println("ğŸ Completed successfully")
            );

        // 5. ä½¿ç”¨ retryWhen è‡ªå®šä¹‰é‡è¯•ç­–ç•¥
        System.out.println("\n--- retryWhen æ“ä½œç¬¦ ---");
        Flux.just(1, 2)
            .concatWith(Flux.error(new RuntimeException("ğŸ•°ï¸ Retry with delay")))
            .retryWhen(retrySignal -> retrySignal
                .take(3)  // æœ€å¤šé‡è¯•3æ¬¡
                .delayElements(Duration.ofMillis(500)))  // æ¯æ¬¡é‡è¯•é—´éš”500ms
            .subscribe(
                value -> System.out.println("â° Delayed retry value: " + value),
                error -> System.err.println("âŒ Final error: " + error.getMessage()),
                () -> System.out.println("ğŸ Completed with delayed retry")
            );

        // ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
```

#### c. åˆå¹¶ä¸æ‹†åˆ†æ“ä½œç¬¦

åˆå¹¶ä¸æ‹†åˆ†æ“ä½œç¬¦ç”¨äºå°†å¤šä¸ªæ•°æ®æµåˆå¹¶ä¸ºä¸€ä¸ªï¼Œæˆ–å°†ä¸€ä¸ªæ•°æ®æµæ‹†åˆ†ä¸ºå¤šä¸ªã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„åˆå¹¶ä¸æ‹†åˆ†æ“ä½œç¬¦ï¼š

1. **`merge`**ï¼šå°†å¤šä¸ª `Flux` åˆå¹¶ä¸ºä¸€ä¸ªã€‚
2. **`concat`**ï¼šæŒ‰é¡ºåºè¿æ¥å¤šä¸ª `Flux`ã€‚
3. **`zip`**ï¼šå°†å¤šä¸ª `Flux` çš„å…ƒç´ æŒ‰ç´¢å¼•ç»„åˆã€‚
4. **`groupBy`**ï¼šæ ¹æ®æ¡ä»¶å°† `Flux` æ‹†åˆ†ä¸ºå¤šä¸ªç»„ã€‚
5. **`window`**ï¼šå°† `Flux` æ‹†åˆ†ä¸ºå¤šä¸ªçª—å£ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;

public class CombiningAndSplittingOperators {
    public static void main(String[] args) {
        // ä½¿ç”¨ merge åˆå¹¶å¤šä¸ª Flux
        Flux<Integer> flux1 = Flux.just(1, 2, 3);
        Flux<Integer> flux2 = Flux.just(4, 5, 6);
        Flux.merge(flux1, flux2)
            .subscribe(System.out::println); // è¾“å‡º: 1, 2, 3, 4, 5, 6

        // ä½¿ç”¨ concat æŒ‰é¡ºåºè¿æ¥å¤šä¸ª Flux
        Flux.concat(flux1, flux2)
            .subscribe(System.out::println); // è¾“å‡º: 1, 2, 3, 4, 5, 6

        // ä½¿ç”¨ zip ç»„åˆå¤šä¸ª Flux
        Flux<String> names = Flux.just("Alice", "Bob", "Charlie");
        Flux<Integer> ages = Flux.just(25, 30, 35);
        Flux.zip(names, ages, (name, age) -> name + " is " + age + " years old")
            .subscribe(System.out::println); // è¾“å‡º: Alice is 25 years old, Bob is 30 years old, Charlie is 35 years old

        // ä½¿ç”¨ groupBy åˆ†ç»„
        Flux<Integer> numbers = Flux.just(1, 2, 3, 4, 5);
        numbers.groupBy(n -> n % 2 == 0 ? "Even" : "Odd")
               .subscribe(group -> group.collectList()
                                       .subscribe(list -> System.out.println(group.key() + ": " + list)));
        // è¾“å‡º: Odd: [1, 3, 5], Even: [2, 4]
    }
}
```

### 3. èƒŒå‹ï¼ˆBackpressureï¼‰

èƒŒå‹ï¼ˆ`Backpressure`ï¼‰æ˜¯å“åº”å¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œç”¨äºè§£å†³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´é€Ÿç‡ä¸åŒ¹é…çš„é—®é¢˜ã€‚å½“ç”Ÿäº§è€…ç”Ÿæˆæ•°æ®çš„é€Ÿåº¦å¿«äºæ¶ˆè´¹è€…å¤„ç†æ•°æ®çš„é€Ÿåº¦æ—¶ï¼ŒèƒŒå‹æœºåˆ¶å¯ä»¥é˜²æ­¢æ•°æ®ç§¯å‹ï¼Œé¿å…ç³»ç»Ÿèµ„æºè€—å°½ã€‚

> **ä¸ºä»€ä¹ˆéœ€è¦èƒŒå‹**ï¼š
> - åœ¨ä¼ ç»Ÿçš„ **push æ¨¡å‹**ä¸­ï¼Œç”Ÿäº§è€…ä¸»åŠ¨æ¨é€æ•°æ®ï¼Œå¦‚æœé€Ÿåº¦è¿‡å¿«ä¼šå¯¼è‡´å†…å­˜æº¢å‡º
> - **pull æ¨¡å‹**è®©æ¶ˆè´¹è€…æ§åˆ¶æ•°æ®è¯·æ±‚é€Ÿç‡ï¼Œä½†å“åº”æ€§ä¸å¤Ÿå¥½
> - **èƒŒå‹æœºåˆ¶**ç»“åˆäº†ä¸¤è€…ä¼˜åŠ¿ï¼šæ¶ˆè´¹è€…å¯ä»¥åŠ¨æ€æ§åˆ¶æ•°æ®æµé€Ÿç‡ï¼Œæ—¢ä¿è¯å“åº”æ€§åˆé¿å…èµ„æºè€—å°½
> - è¿™æ˜¯ **Reactive Streams** è§„èŒƒçš„æ ¸å¿ƒè®¾è®¡åŸåˆ™ä¹‹ä¸€

#### a. èƒŒå‹åŸç†

**èƒŒå‹çš„æ ¸å¿ƒæ€æƒ³**æ˜¯è®©æ¶ˆè´¹è€…èƒ½å¤Ÿæ§åˆ¶ç”Ÿäº§è€…çš„æ•°æ®ç”Ÿæˆé€Ÿç‡ï¼Œä»è€Œé¿å…æ•°æ®ç§¯å‹ã€‚åœ¨ Reactor 3 ä¸­ï¼ŒèƒŒå‹æ˜¯é€šè¿‡ `å“åº”å¼æµè§„èŒƒï¼ˆReactive Streams Specificationï¼‰` å®ç°çš„ï¼Œè¯¥è§„èŒƒå®šä¹‰äº†ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒæ¥å£ï¼š

1. `Publisher`ï¼šæ•°æ®ç”Ÿäº§è€…ï¼Œè´Ÿè´£ç”Ÿæˆæ•°æ®ã€‚
2. `Subscriber`ï¼šæ•°æ®æ¶ˆè´¹è€…ï¼Œè´Ÿè´£å¤„ç†æ•°æ®ã€‚
3. `Subscription`ï¼šè¿æ¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æ¡¥æ¢ï¼Œç”¨äºæ§åˆ¶æ•°æ®æµã€‚
4. `Processor`ï¼šåŒæ—¶æ‰®æ¼”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„è§’è‰²ã€‚

**èƒŒå‹çš„å·¥ä½œæµç¨‹ï¼š**
1. æ¶ˆè´¹è€…é€šè¿‡ `Subscription` å‘ç”Ÿäº§è€…è¯·æ±‚ä¸€å®šæ•°é‡çš„æ•°æ®ã€‚
2. ç”Ÿäº§è€…æ ¹æ®æ¶ˆè´¹è€…çš„è¯·æ±‚ç”Ÿæˆæ•°æ®ï¼Œå¹¶å°†æ•°æ®å‘é€ç»™æ¶ˆè´¹è€…ã€‚
3. æ¶ˆè´¹è€…å¤„ç†å®Œæ•°æ®åï¼Œå¯ä»¥ç»§ç»­è¯·æ±‚æ›´å¤šæ•°æ®ã€‚

**èƒŒå‹çš„ä¼˜åŠ¿ï¼š**
- é¿å…æ•°æ®ç§¯å‹ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚
- æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚
- æ”¯æŒåŠ¨æ€è°ƒæ•´æ•°æ®ç”Ÿæˆé€Ÿç‡ã€‚

#### b. å®ç°èƒŒå‹ç­–ç•¥

Reactor 3 æä¾›äº†å¤šç§èƒŒå‹ç­–ç•¥ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„èƒŒå‹ç­–ç•¥åŠå…¶å®ç°æ–¹å¼ï¼š

1. **`onBackpressureBuffer`**ï¼š
  - å°†æœªå¤„ç†çš„æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°æ¶ˆè´¹è€…å‡†å¤‡å¥½å¤„ç†ã€‚
  - é€‚ç”¨äºæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†æ•°æ®é‡ä¸å¤§çš„åœºæ™¯ã€‚

   **ç¤ºä¾‹ä»£ç ï¼š**
   ```java
   import reactor.core.publisher.Flux;
   import reactor.core.scheduler.Schedulers;
   import reactor.core.Disposable;

   public class BackpressureBufferExample {
       public static void main(String[] args) {
           System.out.println("=== onBackpressureBuffer æ¼”ç¤º ===");
           
           // åˆ›å»ºä¸€ä¸ªå¿«é€Ÿç”Ÿäº§æ•°æ®çš„ Flux
           Disposable subscription = Flux.range(1, 1000)
               .onBackpressureBuffer(100)  // è®¾ç½®ç¼“å†²åŒºå¤§å°ä¸º 100
               .publishOn(Schedulers.parallel())  // åˆ‡æ¢åˆ°å¹¶è¡Œçº¿ç¨‹
               .subscribe(
                   data -> {
                       try {
                           Thread.sleep(10); // æ¨¡æ‹Ÿæ…¢é€Ÿæ¶ˆè´¹è€…ï¼ˆæ¯ä¸ªå…ƒç´ å¤„ç†10msï¼‰
                       } catch (InterruptedException e) {
                           Thread.currentThread().interrupt();
                       }
                       System.out.println("ğŸ“¦ Processed: " + data);
                   },
                   error -> System.err.println("âŒ Error: " + error),
                   () -> System.out.println("âœ… Buffer processing completed")
               );

           // ç­‰å¾…å¤„ç†å®Œæˆ
           try {
               Thread.sleep(5000);  // ç­‰å¾…è¶³å¤Ÿé•¿çš„æ—¶é—´
               subscription.dispose();  // æ¸…ç†èµ„æº
           } catch (InterruptedException e) {
               Thread.currentThread().interrupt();
           }
       }
   }
   ```

2. **`onBackpressureDrop`**ï¼š
  - å½“æ¶ˆè´¹è€…æ— æ³•å¤„ç†æ•°æ®æ—¶ï¼Œç›´æ¥ä¸¢å¼ƒå¤šä½™çš„æ•°æ®ã€‚
  - é€‚ç”¨äºå¯ä»¥å®¹å¿æ•°æ®ä¸¢å¤±çš„åœºæ™¯ã€‚

   **ç¤ºä¾‹ä»£ç ï¼š**
   ```java
   import reactor.core.publisher.Flux;
   import reactor.core.scheduler.Schedulers;

   public class BackpressureDropExample {
       public static void main(String[] args) {
           Flux.range(1, 1000)
               .onBackpressureDrop(dropped -> System.out.println("Dropped: " + dropped))
               .publishOn(Schedulers.parallel())
               .subscribe(
                   data -> {
                       try {
                           Thread.sleep(10); // æ¨¡æ‹Ÿæ…¢é€Ÿæ¶ˆè´¹è€…
                       } catch (InterruptedException e) {
                           e.printStackTrace();
                       }
                       System.out.println("Received: " + data);
                   },
                   error -> System.err.println("Error: " + error),
                   () -> System.out.println("Completed")
               );
       }
   }
   ```

3. **`onBackpressureLatest`**ï¼š
  - å½“æ¶ˆè´¹è€…æ— æ³•å¤„ç†æ•°æ®æ—¶ï¼Œä¿ç•™æœ€æ–°çš„æ•°æ®ï¼Œä¸¢å¼ƒæ—§æ•°æ®ã€‚
  - é€‚ç”¨äºéœ€è¦å®æ—¶æ•°æ®çš„åœºæ™¯ã€‚

   **ç¤ºä¾‹ä»£ç ï¼š**
   ```java
   import reactor.core.publisher.Flux;
   import reactor.core.scheduler.Schedulers;

   public class BackpressureLatestExample {
       public static void main(String[] args) {
           Flux.range(1, 1000)
               .onBackpressureLatest()
               .publishOn(Schedulers.parallel())
               .subscribe(
                   data -> {
                       try {
                           Thread.sleep(10); // æ¨¡æ‹Ÿæ…¢é€Ÿæ¶ˆè´¹è€…
                       } catch (InterruptedException e) {
                           e.printStackTrace();
                       }
                       System.out.println("Received: " + data);
                   },
                   error -> System.err.println("Error: " + error),
                   () -> System.out.println("Completed")
               );
       }
   }
   ```

4. **`limitRate`**ï¼š
  - é™åˆ¶ç”Ÿäº§è€…çš„æ•°æ®ç”Ÿæˆé€Ÿç‡ï¼Œä½¿å…¶ä¸æ¶ˆè´¹è€…çš„å¤„ç†é€Ÿç‡åŒ¹é…ã€‚
  - é€‚ç”¨äºéœ€è¦åŠ¨æ€è°ƒæ•´é€Ÿç‡çš„åœºæ™¯ã€‚

   **ç¤ºä¾‹ä»£ç ï¼š**
   ```java
   import reactor.core.publisher.Flux;
   import reactor.core.scheduler.Schedulers;

   public class LimitRateExample {
       public static void main(String[] args) {
           Flux.range(1, 1000)
               .limitRate(10) // æ¯æ‰¹å¤„ç† 10 ä¸ªå…ƒç´ 
               .publishOn(Schedulers.parallel())
               .subscribe(
                   data -> {
                       try {
                           Thread.sleep(10); // æ¨¡æ‹Ÿæ…¢é€Ÿæ¶ˆè´¹è€…
                       } catch (InterruptedException e) {
                           e.printStackTrace();
                       }
                       System.out.println("Received: " + data);
                   },
                   error -> System.err.println("Error: " + error),
                   () -> System.out.println("Completed")
               );
       }
   }
   ```

### 4. Sinks

åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œ**Sinks** æ˜¯ Reactor æä¾›çš„ä¸€ä¸ªå¼ºå¤§å·¥å…·ï¼Œç”¨äºæ‰‹åŠ¨æ§åˆ¶æ•°æ®æµçš„ç”Ÿæˆå’Œå‘å¸ƒã€‚å®ƒå…è®¸å¼€å‘è€…ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºå’Œç®¡ç†æ•°æ®æµï¼Œé€‚ç”¨äºéœ€è¦åŠ¨æ€ç”Ÿæˆæ•°æ®çš„åœºæ™¯ã€‚

#### a. Sinks çš„ä½œç”¨
- **æ‰‹åŠ¨æ§åˆ¶æ•°æ®æµ**ï¼šé€šè¿‡ Sinksï¼Œå¼€å‘è€…å¯ä»¥æ‰‹åŠ¨è§¦å‘æ•°æ®çš„å‘å¸ƒã€å®Œæˆæˆ–é”™è¯¯å¤„ç†ã€‚
- **æ”¯æŒå¤šç§æ•°æ®æµç±»å‹**ï¼šSinks æ”¯æŒ `Mono` å’Œ `Flux` ä¸¤ç§æ•°æ®æµç±»å‹ã€‚
- **çº¿ç¨‹å®‰å…¨**ï¼šSinks æä¾›äº†çº¿ç¨‹å®‰å…¨çš„ APIï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒã€‚


#### b. Sinks çš„ç±»å‹
Reactor æä¾›äº†å¤šç§ Sinks ç±»å‹ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š

1. **Sinks.One**ï¼š
  - ç”¨äºç”Ÿæˆ `Mono` æ•°æ®æµã€‚
  - åªèƒ½å‘å¸ƒä¸€ä¸ªæ•°æ®é¡¹æˆ–ä¸€ä¸ªé”™è¯¯ã€‚
  - é€‚ç”¨äºå•æ¬¡æ•°æ®å‘å¸ƒçš„åœºæ™¯ã€‚

2. **Sinks.Many**ï¼š
  - ç”¨äºç”Ÿæˆ `Flux` æ•°æ®æµã€‚
  - å¯ä»¥å‘å¸ƒå¤šä¸ªæ•°æ®é¡¹ã€å®Œæˆä¿¡å·æˆ–é”™è¯¯ã€‚
  - æ”¯æŒå¤šç§å‘å¸ƒæ¨¡å¼ï¼ˆå¦‚ `unicast`ã€`multicast`ã€`replay`ï¼‰ã€‚

#### c. Sinks çš„ä½¿ç”¨ç¤ºä¾‹

##### ç¤ºä¾‹ 1ï¼šä½¿ç”¨ `Sinks.One` åˆ›å»º Mono
```java
import reactor.core.publisher.Mono;
import reactor.core.publisher.Sinks;

public class SinksOneExample {
    public static void main(String[] args) {
        // åˆ›å»º Sinks.One
        Sinks.One<String> sink = Sinks.one();

        // è·å– Mono
        Mono<String> mono = sink.asMono();

        // è®¢é˜… Mono
        mono.subscribe(System.out::println);

        // å‘å¸ƒæ•°æ®
        sink.tryEmitValue("Hello, Sinks.One!");
    }
}
```

**è¾“å‡ºï¼š**
```
Hello, Sinks.One!
```

##### ç¤ºä¾‹ 2ï¼šä½¿ç”¨ `Sinks.Many` åˆ›å»º Flux
```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Sinks;

public class SinksManyExample {
    public static void main(String[] args) {
        // åˆ›å»º Sinks.Manyï¼ˆä½¿ç”¨ multicast æ¨¡å¼ï¼‰
        Sinks.Many<String> sink = Sinks.many().multicast().onBackpressureBuffer();

        // è·å– Flux
        Flux<String> flux = sink.asFlux();

        // è®¢é˜… Flux
        flux.subscribe(System.out::println);

        // å‘å¸ƒå¤šä¸ªæ•°æ®é¡¹
        sink.tryEmitNext("Data 1");
        sink.tryEmitNext("Data 2");
        sink.tryEmitNext("Data 3");

        // å®Œæˆæ•°æ®æµ
        sink.tryEmitComplete();
    }
}
```

**è¾“å‡ºï¼š**
```
Data 1
Data 2
Data 3
```

##### ç¤ºä¾‹ 3ï¼šå¤„ç†é”™è¯¯
```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Sinks;

public class SinksErrorExample {
    public static void main(String[] args) {
        // åˆ›å»º Sinks.Many
        Sinks.Many<String> sink = Sinks.many().multicast().onBackpressureBuffer();

        // è·å– Flux
        Flux<String> flux = sink.asFlux();

        // è®¢é˜… Flux å¹¶å¤„ç†é”™è¯¯
        flux.subscribe(
            System.out::println,
            error -> System.err.println("Error: " + error.getMessage())
        );

        // å‘å¸ƒæ•°æ®
        sink.tryEmitNext("Data 1");

        // å‘å¸ƒé”™è¯¯
        sink.tryEmitError(new RuntimeException("Something went wrong!"));
    }
}
```

**è¾“å‡ºï¼š**
```
Data 1
Error: Something went wrong!
```

#### d. Sinks çš„å‘å¸ƒæ¨¡å¼

`Sinks.Many` æ”¯æŒå¤šç§å‘å¸ƒæ¨¡å¼ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯æ¯ç§å‘å¸ƒæ¨¡å¼çš„è¯¦ç»†è¯´æ˜åŠä»£ç ç¤ºä¾‹ï¼š

##### 1. Unicast æ¨¡å¼
- **ç‰¹ç‚¹**ï¼š
  - åªå…è®¸ä¸€ä¸ªè®¢é˜…è€…ã€‚
  - å¦‚æœå°è¯•æ·»åŠ ç¬¬äºŒä¸ªè®¢é˜…è€…ï¼Œä¼šæŠ›å‡º `IllegalStateException`ã€‚
  - é€‚ç”¨äºç‚¹å¯¹ç‚¹çš„æ•°æ®æµã€‚

- **ç¤ºä¾‹**ï¼š
```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Sinks;

public class SinksUnicastExample {
    public static void main(String[] args) {
        // åˆ›å»º Sinks.Manyï¼ˆä½¿ç”¨ unicast æ¨¡å¼ï¼‰
        Sinks.Many<String> sink = Sinks.many().unicast().onBackpressureBuffer();

        // è·å– Flux
        Flux<String> flux = sink.asFlux();

        // è®¢é˜… Flux
        flux.subscribe(data -> System.out.println("Subscriber 1: " + data));

        // å‘å¸ƒæ•°æ®
        sink.tryEmitNext("Data 1");
        sink.tryEmitNext("Data 2");

        // å°è¯•æ·»åŠ ç¬¬äºŒä¸ªè®¢é˜…è€…ï¼ˆä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰
        try {
            flux.subscribe(data -> System.out.println("Subscriber 2: " + data));
        } catch (IllegalStateException e) {
            System.err.println("Error: " + e.getMessage());
        }

        // å®Œæˆæ•°æ®æµ
        sink.tryEmitComplete();
    }
}
```

**è¾“å‡ºï¼š**
```
Subscriber 1: Data 1
Subscriber 1: Data 2
Error: UnicastProcessor allows only a single Subscriber
```

##### 2. Multicast æ¨¡å¼
- **ç‰¹ç‚¹**ï¼š
  - å…è®¸å¤šä¸ªè®¢é˜…è€…ã€‚
  - æ–°è®¢é˜…è€…åªèƒ½æ¥æ”¶åˆ°è®¢é˜…ä¹‹åå‘å¸ƒçš„æ•°æ®ã€‚
  - é€‚ç”¨äºå¹¿æ’­åœºæ™¯ã€‚

- **ç¤ºä¾‹**ï¼š
```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Sinks;

public class SinksMulticastExample {
    public static void main(String[] args) {
        // åˆ›å»º Sinks.Manyï¼ˆä½¿ç”¨ multicast æ¨¡å¼ï¼‰
        Sinks.Many<String> sink = Sinks.many().multicast().onBackpressureBuffer();

        // è·å– Flux
        Flux<String> flux = sink.asFlux();

        // è®¢é˜… Flux
        flux.subscribe(data -> System.out.println("Subscriber 1: " + data));

        // å‘å¸ƒæ•°æ®
        sink.tryEmitNext("Data 1");
        sink.tryEmitNext("Data 2");

        // æ·»åŠ ç¬¬äºŒä¸ªè®¢é˜…è€…
        flux.subscribe(data -> System.out.println("Subscriber 2: " + data));

        // å‘å¸ƒæ›´å¤šæ•°æ®
        sink.tryEmitNext("Data 3");

        // å®Œæˆæ•°æ®æµ
        sink.tryEmitComplete();
    }
}
```

**è¾“å‡ºï¼š**
```
Subscriber 1: Data 1
Subscriber 1: Data 2
Subscriber 1: Data 3
Subscriber 2: Data 3
```

##### 3. Replay æ¨¡å¼
- **ç‰¹ç‚¹**ï¼š
  - ç¼“å­˜å†å²æ•°æ®ï¼Œæ–°è®¢é˜…è€…å¯ä»¥æ¥æ”¶åˆ°ä¹‹å‰å‘å¸ƒçš„æ•°æ®ã€‚
  - æ”¯æŒé…ç½®ç¼“å­˜å¤§å°æˆ–æ—¶é—´çª—å£ã€‚
  - é€‚ç”¨äºéœ€è¦é‡æ”¾æ•°æ®çš„åœºæ™¯ã€‚

- **ç¤ºä¾‹**ï¼š
```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Sinks;

public class SinksReplayExample {
    public static void main(String[] args) {
        // åˆ›å»º Sinks.Manyï¼ˆä½¿ç”¨ replay æ¨¡å¼ï¼Œç¼“å­˜æœ€è¿‘ 2 ä¸ªæ•°æ®é¡¹ï¼‰
        Sinks.Many<String> sink = Sinks.many().replay().limit(2);

        // è·å– Flux
        Flux<String> flux = sink.asFlux();

        // å‘å¸ƒæ•°æ®
        sink.tryEmitNext("Data 1");
        sink.tryEmitNext("Data 2");
        sink.tryEmitNext("Data 3");

        // è®¢é˜… Flux
        flux.subscribe(data -> System.out.println("Subscriber 1: " + data));

        // æ·»åŠ ç¬¬äºŒä¸ªè®¢é˜…è€…
        flux.subscribe(data -> System.out.println("Subscriber 2: " + data));

        // å®Œæˆæ•°æ®æµ
        sink.tryEmitComplete();
    }
}
```

**è¾“å‡ºï¼š**
```
Subscriber 1: Data 2
Subscriber 1: Data 3
Subscriber 2: Data 2
Subscriber 2: Data 3
```

## å››ã€é«˜çº§ç‰¹æ€§

åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œå¹¶å‘ä¸çº¿ç¨‹ç®¡ç†æ˜¯è‡³å…³é‡è¦çš„é«˜çº§ç‰¹æ€§ã€‚Reactor 3 æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥ç®¡ç†çº¿ç¨‹å’Œå¹¶å‘æ‰§è¡Œï¼Œç¡®ä¿æ•°æ®æµçš„é«˜æ•ˆå¤„ç†ã€‚ä»¥ä¸‹æ˜¯å…³äºå¹¶å‘ä¸çº¿ç¨‹ç®¡ç†çš„ä¸¤ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼š**Scheduler è°ƒåº¦å™¨**å’Œ**å¤šçº¿ç¨‹æ‰§è¡Œ**ã€‚

### 1. å¹¶å‘ä¸çº¿ç¨‹ç®¡ç†

#### a. Scheduler è°ƒåº¦å™¨

**Scheduler** æ˜¯ Reactor 3 ä¸­ç”¨äºæ§åˆ¶ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒå…è®¸å¼€å‘è€…å°†ä»»åŠ¡åˆ†é…åˆ°ä¸åŒçš„çº¿ç¨‹æ± ä¸­ï¼Œä»è€Œå®ç°å¹¶å‘æ‰§è¡Œã€‚Reactor æä¾›äº†å¤šç§å†…ç½®çš„ Schedulerï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š

1. **`Schedulers.immediate()`**ï¼š
  - åœ¨å½“å‰çº¿ç¨‹ä¸­ç«‹å³æ‰§è¡Œä»»åŠ¡ã€‚
  - é€‚ç”¨äºä¸éœ€è¦åˆ‡æ¢çº¿ç¨‹çš„åœºæ™¯ã€‚

2. **`Schedulers.single()`**ï¼š
  - ä½¿ç”¨å•ä¸ªçº¿ç¨‹æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚
  - é€‚ç”¨äºéœ€è¦é¡ºåºæ‰§è¡Œçš„åœºæ™¯ã€‚

3. **`Schedulers.parallel()`**ï¼š
  - ä½¿ç”¨å›ºå®šå¤§å°çš„çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ã€‚
  - é€‚ç”¨äº CPU å¯†é›†å‹ä»»åŠ¡ã€‚

4. **`Schedulers.elastic()`**ï¼š
  - ä½¿ç”¨å¯æ‰©å±•çš„çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ã€‚
  - é€‚ç”¨äº I/O å¯†é›†å‹ä»»åŠ¡ã€‚

5. **`Schedulers.boundedElastic()`**ï¼š
  - ä½¿ç”¨æœ‰é™åˆ¶çš„å¼¹æ€§çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ã€‚
  - é€‚ç”¨äºéœ€è¦æ§åˆ¶èµ„æºä½¿ç”¨çš„ I/O å¯†é›†å‹ä»»åŠ¡ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.core.scheduler.Schedulers;

public class SchedulerExample {
    public static void main(String[] args) {
        // ä½¿ç”¨ parallel Scheduler æ‰§è¡Œä»»åŠ¡
        Flux.range(1, 10)
            .parallel()
            .runOn(Schedulers.parallel())
            .subscribe(i -> {
                System.out.println("Processing " + i + " on thread: " + Thread.currentThread().getName());
            });

        // ä½¿ç”¨ elastic Scheduler æ‰§è¡Œä»»åŠ¡
        Flux.range(1, 10)
            .publishOn(Schedulers.elastic())
            .subscribe(i -> {
                System.out.println("Processing " + i + " on thread: " + Thread.currentThread().getName());
            });

        // ä½¿ç”¨ boundedElastic Scheduler æ‰§è¡Œä»»åŠ¡
        Flux.range(1, 10)
            .publishOn(Schedulers.boundedElastic())
            .subscribe(i -> {
                System.out.println("Processing " + i + " on thread: " + Thread.currentThread().getName());
            });
    }
}
```

#### b. å¤šçº¿ç¨‹æ‰§è¡Œ

åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

1. **`publishOn`**ï¼š
  - å°†åç»­æ“ä½œåˆ‡æ¢åˆ°æŒ‡å®šçš„ Scheduler çº¿ç¨‹ä¸­æ‰§è¡Œã€‚
  - é€‚ç”¨äºéœ€è¦å°†éƒ¨åˆ†æ“ä½œåˆ†é…åˆ°ä¸åŒçº¿ç¨‹çš„åœºæ™¯ã€‚

2. **`subscribeOn`**ï¼š
  - å°†æ•´ä¸ªè®¢é˜…è¿‡ç¨‹ï¼ˆåŒ…æ‹¬æ•°æ®ç”Ÿæˆå’Œå¤„ç†ï¼‰åˆ‡æ¢åˆ°æŒ‡å®šçš„ Scheduler çº¿ç¨‹ä¸­æ‰§è¡Œã€‚
  - é€‚ç”¨äºéœ€è¦å°†æ•´ä¸ªæ•°æ®æµåˆ†é…åˆ°ä¸åŒçº¿ç¨‹çš„åœºæ™¯ã€‚

3. **`parallel`**ï¼š
  - å°†æ•°æ®æµå¹¶è¡ŒåŒ–å¤„ç†ï¼Œä½¿ç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†æ•°æ®ã€‚
  - é€‚ç”¨äºéœ€è¦å¹¶è¡Œå¤„ç†çš„åœºæ™¯ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.core.scheduler.Schedulers;

public class MultiThreadExecutionExample {
    public static void main(String[] args) throws InterruptedException {
        // ä½¿ç”¨ publishOn åˆ‡æ¢çº¿ç¨‹
        Flux.range(1, 5)
            .map(i -> {
                System.out.println("Map 1 on thread: " + Thread.currentThread().getName());
                return i * 2;
            })
            .publishOn(Schedulers.parallel())
            .map(i -> {
                System.out.println("Map 2 on thread: " + Thread.currentThread().getName());
                return i + 1;
            })
            .subscribe(i -> System.out.println("Received: " + i + " on thread: " + Thread.currentThread().getName()));

        // ä½¿ç”¨ subscribeOn åˆ‡æ¢çº¿ç¨‹
        Flux.range(1, 5)
            .subscribeOn(Schedulers.elastic())
            .map(i -> {
                System.out.println("Map on thread: " + Thread.currentThread().getName());
                return i * 2;
            })
            .subscribe(i -> System.out.println("Received: " + i + " on thread: " + Thread.currentThread().getName()));

        // ä½¿ç”¨ parallel å¹¶è¡Œå¤„ç†
        Flux.range(1, 10)
            .parallel()
            .runOn(Schedulers.parallel())
            .map(i -> {
                System.out.println("Processing " + i + " on thread: " + Thread.currentThread().getName());
                return i * 2;
            })
            .sequential()
            .subscribe(i -> System.out.println("Received: " + i + " on thread: " + Thread.currentThread().getName()));

        // ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆ
        Thread.sleep(1000);
    }
}
```

### 2. æµ‹è¯•

åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œæµ‹è¯•æ˜¯ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ã€‚Reactor æä¾›äº†å¼ºå¤§çš„æµ‹è¯•å·¥å…·ï¼Œå¦‚ **StepVerifier** å’Œ **TestPublisher**ï¼Œå¸®åŠ©å¼€å‘è€…éªŒè¯æ•°æ®æµçš„æ­£ç¡®æ€§å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯å…³äºæµ‹è¯•çš„ä¸¤ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼š**ä½¿ç”¨ StepVerifier è¿›è¡Œæµ‹è¯•**å’Œ **TestPublisher çš„ä½¿ç”¨**ã€‚

#### a. ä½¿ç”¨ StepVerifier è¿›è¡Œæµ‹è¯•

**StepVerifier** æ˜¯ Reactor æä¾›çš„æµ‹è¯•å·¥å…·ï¼Œç”¨äºéªŒè¯æ•°æ®æµçš„è¡Œä¸ºã€‚å®ƒå¯ä»¥æ¨¡æ‹Ÿè®¢é˜…è¿‡ç¨‹ï¼Œå¹¶é€æ­¥éªŒè¯æ•°æ®æµä¸­çš„æ¯ä¸ªå…ƒç´ ã€é”™è¯¯å’Œå®Œæˆä¿¡å·ã€‚

**StepVerifier çš„ä¸»è¦åŠŸèƒ½ï¼š**
1. éªŒè¯æ•°æ®æµä¸­çš„å…ƒç´ æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
2. éªŒè¯æ•°æ®æµæ˜¯å¦æŒ‰é¢„æœŸå®Œæˆæˆ–æŠ›å‡ºé”™è¯¯ã€‚
3. æ”¯æŒæ—¶é—´ç›¸å…³çš„æµ‹è¯•ï¼ˆå¦‚ `virtualTime`ï¼‰ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.test.StepVerifier;

public class StepVerifierExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªç®€å•çš„ Flux
        Flux<Integer> flux = Flux.range(1, 5);

        // ä½¿ç”¨ StepVerifier æµ‹è¯• Flux
        StepVerifier.create(flux)
            .expectNext(1) // éªŒè¯ç¬¬ä¸€ä¸ªå…ƒç´ 
            .expectNext(2) // éªŒè¯ç¬¬äºŒä¸ªå…ƒç´ 
            .expectNext(3) // éªŒè¯ç¬¬ä¸‰ä¸ªå…ƒç´ 
            .expectNext(4) // éªŒè¯ç¬¬å››ä¸ªå…ƒç´ 
            .expectNext(5) // éªŒè¯ç¬¬äº”ä¸ªå…ƒç´ 
            .expectComplete() // éªŒè¯æ•°æ®æµå®Œæˆ
            .verify(); // å¯åŠ¨æµ‹è¯•

        // æµ‹è¯•åŒ…å«é”™è¯¯çš„ Flux
        Flux<Integer> errorFlux = Flux.range(1, 5)
            .map(i -> {
                if (i == 3) throw new RuntimeException("Error at 3");
                return i;
            });

        StepVerifier.create(errorFlux)
            .expectNext(1) // éªŒè¯ç¬¬ä¸€ä¸ªå…ƒç´ 
            .expectNext(2) // éªŒè¯ç¬¬äºŒä¸ªå…ƒç´ 
            .expectError(RuntimeException.class) // éªŒè¯æŠ›å‡ºå¼‚å¸¸
            .verify(); // å¯åŠ¨æµ‹è¯•
    }
}
```

**è™šæ‹Ÿæ—¶é—´æµ‹è¯•ï¼š**
å¯¹äºæ¶‰åŠæ—¶é—´æ“ä½œçš„æ•°æ®æµï¼ˆå¦‚ `delayElements`ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `StepVerifier.withVirtualTime` æ¥æ¨¡æ‹Ÿæ—¶é—´æµé€ï¼Œé¿å…å®é™…ç­‰å¾…ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.test.StepVerifier;
import java.time.Duration;

public class VirtualTimeExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå»¶è¿Ÿçš„ Flux
        Flux<Integer> delayedFlux = Flux.range(1, 5)
            .delayElements(Duration.ofSeconds(1));

        // ä½¿ç”¨è™šæ‹Ÿæ—¶é—´æµ‹è¯•
        StepVerifier.withVirtualTime(() -> delayedFlux)
            .expectSubscription() // éªŒè¯è®¢é˜…
            .thenAwait(Duration.ofSeconds(5)) // æ¨¡æ‹Ÿç­‰å¾… 5 ç§’
            .expectNext(1, 2, 3, 4, 5) // éªŒè¯æ‰€æœ‰å…ƒç´ 
            .expectComplete() // éªŒè¯å®Œæˆ
            .verify(); // å¯åŠ¨æµ‹è¯•
    }
}
```

#### b. TestPublisher çš„ä½¿ç”¨

**TestPublisher** æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•çš„å·¥å…·ç±»ï¼Œå…è®¸å¼€å‘è€…æ‰‹åŠ¨æ§åˆ¶æ•°æ®æµçš„å‘å¸ƒè¡Œä¸ºã€‚å®ƒå¯ä»¥æ¨¡æ‹Ÿå„ç§åœºæ™¯ï¼Œå¦‚æ­£å¸¸æ•°æ®å‘å¸ƒã€é”™è¯¯æŠ›å‡ºå’Œå®Œæˆä¿¡å·ã€‚

**TestPublisher çš„ä¸»è¦åŠŸèƒ½ï¼š**
1. æ‰‹åŠ¨å‘å¸ƒæ•°æ®ã€‚
2. æ¨¡æ‹Ÿé”™è¯¯å’Œå®Œæˆä¿¡å·ã€‚
3. æ”¯æŒèƒŒå‹æµ‹è¯•ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Flux;
import reactor.test.publisher.TestPublisher;
import reactor.test.StepVerifier;

public class TestPublisherExample {
    @Test
    public void testTestPublisher() {
        // åˆ›å»ºä¸€ä¸ª TestPublisher
        TestPublisher<Integer> testPublisher = TestPublisher.create();

        // åˆ›å»ºä¸€ä¸ª Flux å¹¶è®¢é˜…
        Flux<Integer> flux = testPublisher.flux();
        StepVerifier.create(flux)
            .then(() -> testPublisher.next(1, 2, 3)) // æ‰‹åŠ¨å‘å¸ƒæ•°æ®
            .expectNext(1, 2, 3) // éªŒè¯æ•°æ®
            .then(() -> testPublisher.error(new RuntimeException("Test Error"))) // æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯
            .expectError(RuntimeException.class) // éªŒè¯é”™è¯¯
            .verify(); // å¯åŠ¨æµ‹è¯•
    }
}
```

**èƒŒå‹æµ‹è¯•ï¼š**
TestPublisher è¿˜å¯ä»¥ç”¨äºæµ‹è¯•èƒŒå‹è¡Œä¸ºï¼ŒéªŒè¯æ¶ˆè´¹è€…æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ•°æ®æµã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import org.junit.jupiter.api.Test;
import reactor.core.publisher.Flux;
import reactor.test.publisher.TestPublisher;
import reactor.test.StepVerifier;

public class BackpressureTestExample {
    @Test
    public void testBackpressure() {
        // åˆ›å»ºä¸€ä¸ª TestPublisher
        TestPublisher<Integer> testPublisher = TestPublisher.create();

        // åˆ›å»ºä¸€ä¸ª Flux å¹¶è®¢é˜…
        Flux<Integer> flux = testPublisher.flux();
        StepVerifier.create(flux, 1) // è®¾ç½®åˆå§‹è¯·æ±‚é‡ä¸º 1
            .then(() -> testPublisher.next(1)) // å‘å¸ƒç¬¬ä¸€ä¸ªå…ƒç´ 
            .expectNext(1) // éªŒè¯ç¬¬ä¸€ä¸ªå…ƒç´ 
            .thenRequest(2) // è¯·æ±‚ä¸¤ä¸ªå…ƒç´ 
            .then(() -> testPublisher.next(2, 3)) // å‘å¸ƒä¸¤ä¸ªå…ƒç´ 
            .expectNext(2, 3) // éªŒè¯ä¸¤ä¸ªå…ƒç´ 
            .thenCancel() // å–æ¶ˆè®¢é˜…
            .verify(); // å¯åŠ¨æµ‹è¯•
    }
}
```

### 3. é›†æˆ Spring WebFlux

Spring WebFlux æ˜¯ Spring 5 å¼•å…¥çš„å“åº”å¼ Web æ¡†æ¶ï¼ŒåŸºäº Reactor å®ç°ï¼Œæ”¯æŒéé˜»å¡ã€å¼‚æ­¥çš„ç¼–ç¨‹æ¨¡å‹ã€‚é€šè¿‡é›†æˆ Spring WebFluxï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºé«˜æ€§èƒ½çš„å“åº”å¼ Web åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯å…³äºé›†æˆ Spring WebFlux çš„ä¸¤ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼š**æ„å»ºå“åº”å¼ Web åº”ç”¨ç¨‹åº**å’Œ **Spring Cloud Gateway é›†æˆæ¡ˆä¾‹**ã€‚

#### a. æ„å»ºå“åº”å¼ Web åº”ç”¨ç¨‹åº

**Spring WebFlux çš„æ ¸å¿ƒç‰¹æ€§ï¼š**
1. åŸºäº Reactor çš„å“åº”å¼ç¼–ç¨‹æ¨¡å‹ã€‚
2. æ”¯æŒéé˜»å¡ I/Oï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚
3. æä¾›æ³¨è§£é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å‹ï¼ˆå¦‚ `@RestController`ï¼‰å’Œå‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ã€‚

**æ„å»ºå“åº”å¼ Web åº”ç”¨ç¨‹åºçš„æ­¥éª¤ï¼š**
1. æ·»åŠ  Spring WebFlux ä¾èµ–ã€‚
2. å®šä¹‰å“åº”å¼æ§åˆ¶å™¨ã€‚
3. é…ç½®è·¯ç”±å’Œå¤„ç†å™¨ã€‚
4. å¯åŠ¨åº”ç”¨ç¨‹åºã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

1. **æ·»åŠ ä¾èµ–ï¼ˆMavenï¼‰ï¼š**

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
</dependencies>
```

2. **å®šä¹‰å“åº”å¼æ§åˆ¶å™¨ï¼š**

```java
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

@RestController
@RequestMapping("/api")
public class ReactiveController {

    @GetMapping("/numbers")
    public Flux<Integer> getNumbers() {
        return Flux.range(1, 10); // è¿”å› 1 åˆ° 10 çš„æ•°å­—æµ
    }
}
```

3. **å¯åŠ¨åº”ç”¨ç¨‹åºï¼š**

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ReactiveWebApplication {
    public static void main(String[] args) {
        SpringApplication.run(ReactiveWebApplication.class, args);
    }
}
```

4. **æµ‹è¯• APIï¼š**
  - å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œè®¿é—® `http://localhost:8080/api/numbers`ï¼Œå°†è¿”å› `[1,2,3,4,5,6,7,8,9,10]`ã€‚

#### b. Spring Cloud Gateway é›†æˆæ¡ˆä¾‹

**Spring Cloud Gateway** æ˜¯ Spring Cloud æä¾›çš„ API ç½‘å…³ï¼ŒåŸºäº Spring WebFlux å®ç°ï¼Œæ”¯æŒå“åº”å¼ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå¯ä»¥ç”¨äºè·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€é™æµã€ç†”æ–­ç­‰åœºæ™¯ã€‚

**Spring Cloud Gateway çš„æ ¸å¿ƒç‰¹æ€§ï¼š**
1. åŸºäºè·¯ç”±çš„è¯·æ±‚è½¬å‘ã€‚
2. æ”¯æŒè¿‡æ»¤å™¨ï¼ˆFilterï¼‰æœºåˆ¶ã€‚
3. é›†æˆ Hystrix å®ç°ç†”æ–­å’Œé™çº§ã€‚

**é›†æˆ Spring Cloud Gateway çš„æ­¥éª¤ï¼š**
1. æ·»åŠ  Spring Cloud Gateway ä¾èµ–ã€‚
2. é…ç½®è·¯ç”±è§„åˆ™ã€‚
3. å¯åŠ¨ç½‘å…³æœåŠ¡ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

1. **æ·»åŠ ä¾èµ–ï¼ˆMavenï¼‰ï¼š**

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-gateway</artifactId>
    </dependency>
</dependencies>
```

2. **é…ç½®è·¯ç”±è§„åˆ™ï¼š**

```yaml
# application.yml
spring:
  cloud:
    gateway:
      routes:
        - id: service_route
          uri: http://localhost:8080 # ç›®æ ‡æœåŠ¡åœ°å€
          predicates:
            - Path=/api/** # åŒ¹é…è·¯å¾„
          filters:
            - AddRequestHeader=X-Request-Foo, Bar # æ·»åŠ è¯·æ±‚å¤´
```

3. **å¯åŠ¨ç½‘å…³æœåŠ¡ï¼š**

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class GatewayApplication {
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
    }
}
```

4. **æµ‹è¯•ç½‘å…³ï¼š**
  - å¯åŠ¨ç½‘å…³æœåŠ¡åï¼Œè®¿é—® `http://localhost:8081/api/numbers`ï¼ˆå‡è®¾ç½‘å…³è¿è¡Œåœ¨ 8081 ç«¯å£ï¼‰ï¼Œç½‘å…³ä¼šå°†è¯·æ±‚è½¬å‘åˆ° `http://localhost:8080/api/numbers`ã€‚

**è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼š**
å¯ä»¥é€šè¿‡å®ç° `GatewayFilter` æˆ– `GlobalFilter` æ¥å£æ¥è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import org.springframework.cloud.gateway.filter.GatewayFilter;
import org.springframework.cloud.gateway.filter.factory.AbstractGatewayFilterFactory;
import org.springframework.stereotype.Component;
import reactor.core.publisher.Mono;

@Component
public class CustomFilter extends AbstractGatewayFilterFactory<CustomFilter.Config> {

    public CustomFilter() {
        super(Config.class);
    }

    @Override
    public GatewayFilter apply(Config config) {
        return (exchange, chain) -> {
            System.out.println("Custom Filter: Request path - " + exchange.getRequest().getPath());
            return chain.filter(exchange).then(Mono.fromRunnable(() -> {
                System.out.println("Custom Filter: Response status - " + exchange.getResponse().getStatusCode());
            }));
        };
    }

    public static class Config {
        // é…ç½®å‚æ•°
    }
}
```

## äº”ã€æœ€ä½³å®è·µ

åœ¨å“åº”å¼ç¼–ç¨‹å’Œ Spring WebFlux çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéµå¾ªæœ€ä½³å®è·µå¯ä»¥æ˜¾è‘—æå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯å…³äº **æ€§èƒ½ä¼˜åŒ–å»ºè®®** å’Œ **å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ** çš„è¯¦ç»†å†…å®¹ã€‚

### 1. æ€§èƒ½ä¼˜åŒ–å»ºè®®

**å“åº”å¼ç¼–ç¨‹çš„æ€§èƒ½ä¼˜åŒ–ä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š**

#### a. åˆç†ä½¿ç”¨çº¿ç¨‹æ± 
- **é—®é¢˜**ï¼šå“åº”å¼ç¼–ç¨‹ä¾èµ–äºéé˜»å¡ I/Oï¼Œä½†æŸäº›é˜»å¡æ“ä½œï¼ˆå¦‚æ•°æ®åº“è®¿é—®ï¼‰å¯èƒ½ä¼šå ç”¨çº¿ç¨‹èµ„æºã€‚
- **å»ºè®®**ï¼š
  - ä½¿ç”¨ `Schedulers.boundedElastic()` å¤„ç†é˜»å¡ I/O æ“ä½œã€‚
  - ä½¿ç”¨ `Schedulers.parallel()` å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡ã€‚
  - é¿å…åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œé˜»å¡æ“ä½œã€‚
  - åˆç†é…ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…åˆ›å»ºè¿‡å¤šçº¿ç¨‹ã€‚

> **æ³¨æ„**ï¼š`Schedulers.elastic()` åœ¨æ–°ç‰ˆæœ¬ä¸­å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨ `Schedulers.boundedElastic()`ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Mono;
import reactor.core.scheduler.Schedulers;

public class ThreadPoolExample {
    public static void main(String[] args) {
        Mono.fromCallable(() -> {
                // æ¨¡æ‹Ÿé˜»å¡æ“ä½œ
                Thread.sleep(1000);
                return "Blocking Operation Completed";
            })
            .subscribeOn(Schedulers.boundedElastic()) // ä½¿ç”¨å¼¹æ€§çº¿ç¨‹æ± 
            .subscribe(System.out::println);

        // é˜²æ­¢ä¸»çº¿ç¨‹é€€å‡º
        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

#### b. å‡å°‘ä¸å¿…è¦çš„è®¢é˜…
- **é—®é¢˜**ï¼šé¢‘ç¹è®¢é˜…å’Œå–æ¶ˆè®¢é˜…ä¼šå¢åŠ å¼€é”€ã€‚
- **å»ºè®®**ï¼š
  - å°½é‡å¤ç”¨ `Flux` æˆ– `Mono` å®ä¾‹ã€‚
  - ä½¿ç”¨ `cache()` æ“ä½œç¬¦ç¼“å­˜æ•°æ®æµç»“æœã€‚
  - ä½¿ç”¨ `share()` æ“ä½œç¬¦åœ¨å¤šä¸ªè®¢é˜…è€…ä¹‹é—´å…±äº«æ•°æ®æµã€‚
  - é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºæ–°çš„å“åº”å¼æµã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;

public class CacheExample {
    public static void main(String[] args) {
        Flux<Integer> cachedFlux = Flux.range(1, 5)
            .cache(); // ç¼“å­˜æ•°æ®æµ

        cachedFlux.subscribe(System.out::println); // ç¬¬ä¸€æ¬¡è®¢é˜…
        cachedFlux.subscribe(System.out::println); // ç¬¬äºŒæ¬¡è®¢é˜…ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜
    }
}
```

#### c. ä¼˜åŒ–èƒŒå‹å¤„ç†
- **é—®é¢˜**ï¼šæ•°æ®ç”Ÿäº§é€Ÿåº¦è¿‡å¿«å¯èƒ½å¯¼è‡´æ¶ˆè´¹è€…æ— æ³•å¤„ç†ã€‚
- **å»ºè®®**ï¼š
  - ä½¿ç”¨ `onBackpressureBuffer`ã€`onBackpressureDrop` æˆ– `onBackpressureLatest` æ“ä½œç¬¦å¤„ç†èƒŒå‹ã€‚
  - æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„èƒŒå‹ç­–ç•¥ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

public class BackpressureExample {
    public static void main(String[] args) {
        Flux.range(1, 100)
            .onBackpressureBuffer(10) // ç¼“å†² 10 ä¸ªå…ƒç´ 
            .subscribe(System.out::println);
    }
}
```

#### d. ä½¿ç”¨è™šæ‹Ÿæ—¶é—´æµ‹è¯•
- **é—®é¢˜**ï¼šæ—¶é—´ç›¸å…³çš„æµ‹è¯•ï¼ˆå¦‚ `delayElements`ï¼‰å¯èƒ½å¯¼è‡´æµ‹è¯•æ—¶é—´è¿‡é•¿ã€‚
- **å»ºè®®**ï¼š
  - ä½¿ç”¨ `StepVerifier.withVirtualTime` æ¨¡æ‹Ÿæ—¶é—´æµé€ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.test.StepVerifier;
import java.time.Duration;

public class VirtualTimeExample {
    public static void main(String[] args) {
        Flux<Integer> delayedFlux = Flux.range(1, 5)
            .delayElements(Duration.ofSeconds(1));

        StepVerifier.withVirtualTime(() -> delayedFlux)
            .expectSubscription()
            .thenAwait(Duration.ofSeconds(5)) // æ¨¡æ‹Ÿç­‰å¾… 5 ç§’
            .expectNext(1, 2, 3, 4, 5)
            .expectComplete()
            .verify();
    }
}
```

### 2. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### a. æ•°æ®æµæœªè§¦å‘
- **é—®é¢˜**ï¼šæ•°æ®æµæœªæŒ‰é¢„æœŸè§¦å‘ã€‚
- **åŸå› **ï¼šå“åº”å¼æµæ˜¯**å†·å¯åŠ¨**çš„ï¼Œåªæœ‰åœ¨è®¢é˜…æ—¶æ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - æ£€æŸ¥æ˜¯å¦é—æ¼äº† `subscribe()` æ–¹æ³•ã€‚
  - ç¡®ä¿æ•°æ®æºæ­£ç¡®åˆå§‹åŒ–ã€‚
  - å¯¹äºéœ€è¦ç«‹å³æ‰§è¡Œçš„æ“ä½œï¼Œè€ƒè™‘ä½¿ç”¨ `block()` æˆ– `blockFirst()`ï¼ˆä»…ç”¨äºæµ‹è¯•æˆ–ç‰¹æ®Šåœºæ™¯ï¼‰ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;

public class SubscriptionExample {
    public static void main(String[] args) {
        Flux<Integer> flux = Flux.range(1, 5);
        flux.subscribe(System.out::println); // å¿…é¡»è°ƒç”¨ subscribe
    }
}
```

#### b. å†…å­˜æ³„æ¼
- **é—®é¢˜**ï¼šæœªå–æ¶ˆè®¢é˜…å¯¼è‡´å†…å­˜æ³„æ¼ã€‚
- **åŸå› **ï¼šé•¿æœŸè¿è¡Œçš„æµï¼ˆå¦‚ `Flux.interval()`ï¼‰å¦‚æœä¸å–æ¶ˆè®¢é˜…ï¼Œä¼šä¸€ç›´å ç”¨å†…å­˜ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ `Disposable` ç®¡ç†è®¢é˜…ï¼Œå¹¶åœ¨ä¸å†éœ€è¦æ—¶è°ƒç”¨ `dispose()` æ–¹æ³•ã€‚
  - åœ¨ Spring åº”ç”¨ä¸­ï¼Œè€ƒè™‘ä½¿ç”¨ `@PreDestroy` æ³¨è§£è‡ªåŠ¨æ¸…ç†èµ„æºã€‚
  - ä½¿ç”¨ `CompositeDisposable` ç®¡ç†å¤šä¸ªè®¢é˜…ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;
import reactor.core.Disposable;

public class DisposableExample {
    public static void main(String[] args) {
        Flux<Integer> flux = Flux.range(1, 100);
        Disposable disposable = flux.subscribe(System.out::println);

        // å–æ¶ˆè®¢é˜…
        disposable.dispose();
    }
}
```

#### c. é˜»å¡æ“ä½œå¯¼è‡´æ€§èƒ½ä¸‹é™
- **é—®é¢˜**ï¼šåœ¨å“åº”å¼æµä¸­æ‰§è¡Œé˜»å¡æ“ä½œï¼ˆå¦‚æ•°æ®åº“è®¿é—®ï¼‰å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
- **åŸå› **ï¼šé˜»å¡æ“ä½œä¼šå ç”¨å“åº”å¼æµçš„çº¿ç¨‹ï¼Œè¿èƒŒäº†éé˜»å¡çš„è®¾è®¡åŸåˆ™ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - å°†é˜»å¡æ“ä½œæ”¾åˆ°å•ç‹¬çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä½¿ç”¨ `subscribeOn(Schedulers.boundedElastic())`ã€‚
  - ä½¿ç”¨å“åº”å¼æ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚ R2DBCï¼‰æ›¿ä»£ä¼ ç»Ÿçš„ JDBCã€‚
  - é¿å…åœ¨å“åº”å¼æµä¸­ä½¿ç”¨ `block()` æ–¹æ³•ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Mono;
import reactor.core.scheduler.Schedulers;

public class BlockingOperationExample {
    public static void main(String[] args) {
        Mono.fromCallable(() -> {
                // æ¨¡æ‹Ÿé˜»å¡æ“ä½œ
                Thread.sleep(1000);
                return "Blocking Operation Completed";
            })
            .subscribeOn(Schedulers.boundedElastic()) // ä½¿ç”¨å¼¹æ€§çº¿ç¨‹æ± 
            .subscribe(System.out::println);

        // é˜²æ­¢ä¸»çº¿ç¨‹é€€å‡º
        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

#### d. èƒŒå‹å¤„ç†ä¸å½“
- **é—®é¢˜**ï¼šæ•°æ®ç”Ÿäº§é€Ÿåº¦è¿‡å¿«ï¼Œæ¶ˆè´¹è€…æ— æ³•å¤„ç†ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨èƒŒå‹æ“ä½œç¬¦ï¼ˆå¦‚ `onBackpressureBuffer`ï¼‰æˆ–è°ƒæ•´ç”Ÿäº§è€…çš„é€Ÿç‡ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```java
import reactor.core.publisher.Flux;

public class BackpressureSolutionExample {
    public static void main(String[] args) {
        Flux.range(1, 100)
            .onBackpressureBuffer(10) // ç¼“å†² 10 ä¸ªå…ƒç´ 
            .subscribe(System.out::println);
    }
}
```

## å…­ã€æ€»ç»“

Reactor 3 ä½œä¸ºå“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒåº“ï¼Œä¸º Java å¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å¼‚æ­¥ã€éé˜»å¡ç¼–ç¨‹èƒ½åŠ›ã€‚é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œæ‚¨å·²ç»æŒæ¡äº†ï¼š

1. **æ ¸å¿ƒæ¦‚å¿µ**ï¼š`Flux` å’Œ `Mono` çš„ä½¿ç”¨ï¼Œæ“ä½œç¬¦çš„åº”ç”¨ï¼ŒèƒŒå‹æœºåˆ¶çš„ç†è§£ã€‚
2. **é«˜çº§ç‰¹æ€§**ï¼šå¹¶å‘å¤„ç†ã€æµ‹è¯•æ–¹æ³•ã€ä¸ Spring WebFlux çš„é›†æˆã€‚
3. **æœ€ä½³å®è·µ**ï¼šæ€§èƒ½ä¼˜åŒ–æŠ€å·§å’Œå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚

å“åº”å¼ç¼–ç¨‹ä¸ä»…ä»…æ˜¯ä¸€ç§æŠ€æœ¯é€‰æ‹©ï¼Œæ›´æ˜¯ä¸€ç§æ€ç»´æ–¹å¼çš„è½¬å˜ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºï¼š
- é«˜å¹¶å‘ã€é«˜ååé‡çš„åº”ç”¨åœºæ™¯
- I/O å¯†é›†å‹çš„ç³»ç»Ÿ
- éœ€è¦å¤„ç†æµå¼æ•°æ®çš„åº”ç”¨
- å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é—´é€šä¿¡

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®ï¼š
- ä»ç®€å•çš„åœºæ™¯å¼€å§‹ï¼Œé€æ­¥æ·±å…¥ç†è§£å“åº”å¼ç¼–ç¨‹
- å……åˆ†åˆ©ç”¨ Reactor çš„æµ‹è¯•å·¥å…·ç¡®ä¿ä»£ç è´¨é‡
- éµå¾ªæœ€ä½³å®è·µï¼Œé¿å…å¸¸è§é™·é˜±
- ç»“åˆ Spring ç”Ÿæ€ç³»ç»Ÿå‘æŒ¥æœ€å¤§ä»·å€¼

**ç¥ä½ å˜å¾—æ›´å¼º!**
