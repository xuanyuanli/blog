---
title: Javaå¼€å‘è€…è½¬æˆ˜Pythonï¼šé›¶åŸºç¡€å¿«é€Ÿå…¥é—¨
date: 2025-01-13 20:10:00
permalink: /pages/python-for-java-dev/
categories:
  - åç«¯
  - å…¶ä»–è¯­è¨€
tags:
  - Python
author:
  name: è½©è¾•æ
  link: https://github.com/xuanyuanli
---

## ä¸€ã€Pythonç®€ä»‹ä¸ç¯å¢ƒæ­å»º

### 1ã€Pythonçš„å‘å±•å†ç¨‹ä¸ç‰¹ç‚¹

ä½œä¸ºJavaå¼€å‘è€…,ä½ å¯èƒ½å¬è¿‡è¿™æ ·ä¸€ä¸ªæ®µå­:"äººç”Ÿè‹¦çŸ­,æˆ‘ç”¨Python"ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€å¥å£å·,è€Œæ˜¯Pythonç®€æ´é«˜æ•ˆçš„çœŸå®å†™ç…§ã€‚

<!-- more -->

#### 1.1ã€Pythonçš„å†å²æ¼”è¿›

Pythonç”±Guido van Rossumåœ¨1989å¹´åœ£è¯èŠ‚æœŸé—´åˆ›é€ ,åˆè¡·æ˜¯å¼€å‘ä¸€é—¨æ—¢ç®€å•åˆå¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€ã€‚è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£å®ƒçš„æ¼”è¿›å†ç¨‹:

- **Python 1.0**(1994å¹´):ç¡®ç«‹äº†æ ¸å¿ƒè®¾è®¡ç†å¿µ,å¼•å…¥lambdaã€mapã€filterç­‰å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§
- **Python 2.x**(2000-2010å¹´):é€æ¸æµè¡Œ,æˆä¸ºç§‘å­¦è®¡ç®—å’ŒWebå¼€å‘çš„é‡è¦å·¥å…·ã€‚æœ€åç‰ˆæœ¬æ˜¯Python 2.7(2010å¹´)
- **Python 3.x**(2008å¹´è‡³ä»Š):**å½»åº•é‡æ–°è®¾è®¡**,ä¿®æ­£äº†è®¸å¤šå†å²é—ç•™é—®é¢˜,ä½†ä¸å‘åå…¼å®¹Python 2

éœ€è¦æ³¨æ„çš„æ˜¯,Python 2å·²ç»åœ¨2020å¹´1æœˆ1æ—¥æ­£å¼åœæ­¢ç»´æŠ¤ã€‚å¦‚æœä½ æ˜¯ç°åœ¨å¼€å§‹å­¦ä¹ Python,**ç›´æ¥å­¦Python 3å°±å¥½**,å®Œå…¨ä¸ç”¨çº ç»“Python 2ã€‚

#### 1.2ã€3çš„é‡å¤§æ”¹è¿›

ä½œä¸ºJavaå¼€å‘è€…,ä½ ä¼šæ¬£èµPython 3å¸¦æ¥çš„è¿™äº›æ”¹è¿›:

- **ç»Ÿä¸€çš„Unicodeå­—ç¬¦ä¸²å¤„ç†**:æ‰€æœ‰å­—ç¬¦ä¸²é»˜è®¤Unicode,å‘Šåˆ«Javaæ—©æœŸçš„å­—ç¬¦ç¼–ç å™©æ¢¦
- **æ›´æ¸…æ™°çš„æ•´æ•°é™¤æ³•**:`3/2`å¾—åˆ°`1.5`è€Œä¸æ˜¯`1`,æ•´é™¤ä½¿ç”¨`//`æ“ä½œç¬¦
- **æ”¹è¿›çš„å¼‚å¸¸è¯­æ³•**:ç±»ä¼¼Javaçš„`catch`è¯­æ³•,`except Exception as e`æ›´ç›´è§‚
- **ç±»å‹æ³¨è§£æ”¯æŒ**(Python 3.5+):è®©ä¹ æƒ¯é™æ€ç±»å‹çš„Javaå¼€å‘è€…æ›´èˆ’é€‚
- **å¼‚æ­¥ç¼–ç¨‹åŸç”Ÿæ”¯æŒ**(Python 3.5+):`async/await`è¯­æ³•,ç±»ä¼¼Javaçš„CompletableFuture

#### 1.3ã€Pythonçš„è®¾è®¡å“²å­¦

åœ¨Pythonäº¤äº’ç¯å¢ƒä¸­è¾“å…¥`import this`,ä½ ä¼šçœ‹åˆ°"The Zen of Python"(Pythonä¹‹ç¦…)ã€‚è¿™æ˜¯Pythonçš„è®¾è®¡ç†å¿µ,å…¶ä¸­å‡ æ¡ç‰¹åˆ«å€¼å¾—Javaå¼€å‘è€…å…³æ³¨:

```
ä¼˜ç¾èƒœäºä¸‘é™‹(Beautiful is better than ugly)
æ˜äº†èƒœäºæ™¦æ¶©(Explicit is better than implicit)
ç®€æ´èƒœäºå¤æ‚(Simple is better than complex)
å¯è¯»æ€§å¾ˆé‡è¦(Readability counts)
```

å¯¹æ¯”Javaå†—é•¿çš„æ ·æ¿ä»£ç ,Pythonè¿½æ±‚çš„æ˜¯**ç”¨æœ€å°‘çš„ä»£ç è¡¨è¾¾æœ€æ¸…æ™°çš„æ„å›¾**ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ªPersonç±»:

```java
// Javaå†™æ³•
public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public int getAge() { return age; }
    public void setAge(int age) { this.age = age; }

    @Override
    public String toString() {
        return "Person{name='" + name + "', age=" + age + "}";
    }
}
```

```python
# Pythonå†™æ³•(ä½¿ç”¨dataclass)
from dataclasses import dataclass

@dataclass
class Person:
    name: str
    age: int
```

çœ‹åˆ°å·®è·äº†å§?Pythonåªç”¨4è¡Œä»£ç å°±å®ç°äº†Javaéœ€è¦20å¤šè¡Œå®Œæˆçš„åŠŸèƒ½ã€‚

#### 1.4ã€Pythonçš„æ ¸å¿ƒä¼˜åŠ¿

1. **ç®€æ´æ˜“è¯»çš„è¯­æ³•**:ç”¨ç¼©è¿›ä»£æ›¿èŠ±æ‹¬å·,ä»£ç ç»“æ„ä¸€ç›®äº†ç„¶ã€‚ä¹ æƒ¯äº†Javaçš„ä½ å¯èƒ½ä¸€å¼€å§‹ä¸é€‚åº”,ä½†å¾ˆå¿«å°±ä¼šçˆ±ä¸Šè¿™ç§æ¸…çˆ½çš„æ„Ÿè§‰

2. **ä¸°å¯Œçš„æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹ç”Ÿæ€**:Pythonè‡ªå¸¦"ç”µæ± "(batteries included),æ ‡å‡†åº“å‡ ä¹è¦†ç›–äº†æ—¥å¸¸å¼€å‘çš„å„ä¸ªæ–¹é¢ã€‚å†åŠ ä¸ŠPyPI(Python Package Index)ä¸Š50ä¸‡+çš„ç¬¬ä¸‰æ–¹åŒ…,ä½ å‡ ä¹æ€»èƒ½æ‰¾åˆ°ç°æˆçš„è½®å­

3. **åŠ¨æ€ç±»å‹ä¸è§£é‡Šæ‰§è¡Œ**:æ— éœ€ç¼–è¯‘,å†™å®Œå³è·‘ã€‚è¿™å¯¹å¿«é€ŸåŸå‹å¼€å‘å’Œè„šæœ¬ç¼–å†™ç‰¹åˆ«å‹å¥½ã€‚å½“ç„¶,ä½ ä¹Ÿå¯ä»¥ç”¨ç±»å‹æ³¨è§£+é™æ€æ£€æŸ¥å·¥å…·æ¥è·å¾—ç±»å‹å®‰å…¨

4. **è·¨å¹³å°å…¼å®¹æ€§**:å†™ä¸€æ¬¡,åˆ°å¤„è¿è¡Œâ€”â€”è¿™æ¬¡æ˜¯çœŸçš„ã€‚ä¸åƒJavaè¿˜éœ€è¦è€ƒè™‘ä¸åŒJVMçš„å·®å¼‚,Pythonçš„è·¨å¹³å°èƒ½åŠ›æ›´åŠ å½»åº•

5. **å¤šèŒƒå¼ç¼–ç¨‹æ”¯æŒ**:é¢å‘å¯¹è±¡ã€å‡½æ•°å¼ã€è¿‡ç¨‹å¼â€”â€”æƒ³æ€ä¹ˆå†™å°±æ€ä¹ˆå†™ã€‚Pythonä¸åƒJavaé‚£æ ·å¼ºåˆ¶é¢å‘å¯¹è±¡,ä½ å¯ä»¥æ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©ç¼–ç¨‹èŒƒå¼

### 2ã€Pythonä¸Javaçš„æ ¸å¿ƒå·®å¼‚

ä»Javaè½¬åˆ°Python,æœ€å¤§çš„æ„Ÿå—å°±æ˜¯"è½»è£…ä¸Šé˜µ"ã€‚ä½†è½»è£…ä¸ä»£è¡¨ç®€é™‹,è®©æˆ‘ä»¬çœ‹çœ‹ä¸¤è€…çš„æ ¸å¿ƒå·®å¼‚ã€‚

#### 2.1ã€è¿è¡Œæœºåˆ¶å·®å¼‚

**ç¼–è¯‘å‹ vs è§£é‡Šå‹**

```java
// Java: ç¼–è¯‘åè¿è¡Œ
javac HelloWorld.java  // ç”Ÿæˆ .classå­—èŠ‚ç 
java HelloWorld        // JVMæ‰§è¡Œå­—èŠ‚ç 
```

```python
# Python: ç›´æ¥è§£é‡Šæ‰§è¡Œ
python hello_world.py  # è§£é‡Šå™¨ç›´æ¥è¿è¡Œ
```

Javaæ˜¯å…¸å‹çš„ç¼–è¯‘å‹è¯­è¨€(ä¸¥æ ¼è¯´æ˜¯å…ˆç¼–è¯‘æˆå­—èŠ‚ç å†ç”±JVMè§£é‡Šæ‰§è¡Œ),è€ŒPythonæ˜¯è§£é‡Šå‹è¯­è¨€ã€‚è¿™å¸¦æ¥å‡ ä¸ªç›´æ¥å½±å“:

- **å¼€å‘é€Ÿåº¦**:Pythonæ”¹å®Œä»£ç ç›´æ¥è·‘,æ— éœ€ç¼–è¯‘ç¯èŠ‚,è¿­ä»£æ›´å¿«
- **è¿è¡Œæ€§èƒ½**:Javaé€šå¸¸æ¯”Pythonå¿«3-10å€(ä½†å¯¹å¤§å¤šæ•°Webåº”ç”¨æ¥è¯´,æ€§èƒ½ç“¶é¢ˆåœ¨I/Oè€Œéè®¡ç®—)
- **é”™è¯¯å‘ç°**:Javaåœ¨ç¼–è¯‘æœŸå°±èƒ½å‘ç°ç±»å‹é”™è¯¯,Pythonè¦åˆ°è¿è¡Œæ—¶æ‰æš´éœ²(ä½†å¯ä»¥ç”¨ç±»å‹æ£€æŸ¥å·¥å…·å¼¥è¡¥)

#### 2.2ã€ç±»å‹ç³»ç»Ÿå·®å¼‚

**é™æ€ç±»å‹ vs åŠ¨æ€ç±»å‹**

è¿™æ˜¯æœ€æ ¸å¿ƒçš„å·®å¼‚ä¹‹ä¸€:

```java
// Java: é™æ€ç±»å‹,å˜é‡ç±»å‹ç¼–è¯‘æœŸç¡®å®š
String name = "å¼ ä¸‰";
name = 123;  // ç¼–è¯‘é”™è¯¯!
```

```python
# Python: åŠ¨æ€ç±»å‹,å˜é‡åªæ˜¯å¯¹è±¡çš„å¼•ç”¨
name = "å¼ ä¸‰"
name = 123  # å®Œå…¨åˆæ³•,nameç°åœ¨æŒ‡å‘æ•´æ•°å¯¹è±¡
```

åŠ¨æ€ç±»å‹çš„ä¼˜åŠ¿:
- ä»£ç æ›´ç®€æ´,ä¸éœ€è¦å†™ç±»å‹å£°æ˜
- çµæ´»æ€§æ›´é«˜,é¸­å­ç±»å‹(duck typing)è®©å¤šæ€æ›´è‡ªç„¶

åŠ¨æ€ç±»å‹çš„åŠ£åŠ¿:
- ç±»å‹é”™è¯¯è¦åˆ°è¿è¡Œæ—¶æ‰æš´éœ²
- IDEçš„ä»£ç è¡¥å…¨å’Œé‡æ„èƒ½åŠ›ç›¸å¯¹è¾ƒå¼±

**å¥½æ¶ˆæ¯**:Python 3.5+å¼•å…¥äº†ç±»å‹æ³¨è§£,å¯ä»¥ä¸¤å…¨å…¶ç¾:

```python
def greet(name: str) -> str:
    return f"Hello, {name}"

# é…åˆmypyå·¥å…·åšé™æ€æ£€æŸ¥
result: int = greet("å¼ ä¸‰")  # mypyä¼šè­¦å‘Šç±»å‹ä¸åŒ¹é…
```

**æ˜¾å¼ç±»å‹å£°æ˜ vs ç±»å‹æ¨æ–­**

```java
// Javaéœ€è¦æ˜¾å¼å£°æ˜
Map<String, List<Integer>> data = new HashMap<>();
```

```python
# Pythonç›´æ¥æ¨æ–­
data = {}  # ç©ºå­—å…¸
data = {"scores": [95, 87, 92]}  # è‡ªåŠ¨æ¨æ–­ä¸ºdict[str, list[int]]
```

Pythonçš„ç±»å‹æ¨æ–­è®©ä»£ç æ›´ç®€æ´,ä½†å¦‚æœä½ ä¹ æƒ¯äº†Javaçš„æ˜ç¡®æ€§,ä¹Ÿå¯ä»¥åŠ ä¸Šç±»å‹æ³¨è§£:

```python
from typing import Dict, List

data: Dict[str, List[int]] = {"scores": [95, 87, 92]}
```

#### 2.3ã€æ€§èƒ½ä¸å†…å­˜ç®¡ç†

**æ€§èƒ½ç‰¹æ€§å¯¹æ¯”**

| ç»´åº¦ | Java | Python |
|-----|------|--------|
| å¯åŠ¨é€Ÿåº¦ | è¾ƒæ…¢(JVMå¯åŠ¨å¼€é”€) | å¿«(ç›´æ¥è§£é‡Šæ‰§è¡Œ) |
| è¿è¡Œé€Ÿåº¦ | å¿«(JITç¼–è¯‘ä¼˜åŒ–) | è¾ƒæ…¢(è§£é‡Šæ‰§è¡Œ) |
| å†…å­˜å ç”¨ | è¾ƒå¤§(JVMå †) | è¾ƒå° |
| å¤šçº¿ç¨‹ | çœŸæ­£çš„å¹¶è¡Œ | GILé™åˆ¶(åé¢ä¼šè®²) |

å®é™…é¡¹ç›®ä¸­,Pythonçš„"æ…¢"å¾€å¾€æ²¡æƒ³è±¡ä¸­é‚£ä¹ˆä¸¥é‡,å› ä¸º:
1. æ€§èƒ½ç“¶é¢ˆé€šå¸¸åœ¨I/Oè€ŒéCPU
2. å¯ä»¥ç”¨Cæ‰©å±•åŠ é€Ÿå…³é”®ä»£ç (NumPyã€Pandasåº•å±‚éƒ½æ˜¯C)
3. å¼€å‘æ•ˆç‡çš„æå‡èƒ½å¼¥è¡¥è¿è¡Œæ•ˆç‡çš„æŸå¤±

**å†…å­˜ç®¡ç†æœºåˆ¶**

```java
// Java: åƒåœ¾å›æ”¶(GC)
Object obj = new Object();
obj = null;  // ç­‰å¾…GCå›æ”¶
```

```python
# Python: å¼•ç”¨è®¡æ•° + åƒåœ¾å›æ”¶
obj = SomeClass()
obj = None  # å¼•ç”¨è®¡æ•°ä¸º0,ç«‹å³å›æ”¶
```

Pythonä½¿ç”¨å¼•ç”¨è®¡æ•°ä½œä¸ºä¸»è¦å†…å­˜ç®¡ç†æœºåˆ¶,é…åˆå‘¨æœŸæ€§åƒåœ¾å›æ”¶å¤„ç†å¾ªç¯å¼•ç”¨ã€‚è¿™æ„å‘³ç€:
- å¯¹è±¡é”€æ¯æ›´åŠæ—¶(å¼•ç”¨è®¡æ•°å½’é›¶å³å›æ”¶)
- ä½†å¾ªç¯å¼•ç”¨éœ€è¦GCä»‹å…¥
- å¯ä»¥ç”¨`with`è¯­å¥æ˜ç¡®ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ

#### 2.4ã€ä»£ç ç»„ç»‡ä¸è¯­æ³•é£æ ¼

**ä»£ç ç»„ç»‡æ–¹å¼**

```java
// Java: å¼ºåˆ¶é¢å‘å¯¹è±¡,ä¸€åˆ‡çš†ç±»
public class MathUtils {
    public static int add(int a, int b) {
        return a + b;
    }
}
```

```python
# Python: æ¨¡å—åŒ–,æ›´çµæ´»
# å¯ä»¥ç›´æ¥å†™å‡½æ•°,ä¸éœ€è¦ç±»
def add(a, b):
    return a + b

# å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ç±»
class MathUtils:
    @staticmethod
    def add(a, b):
        return a + b
```

Pythonçš„æ¨¡å—å°±æ˜¯æ–‡ä»¶,ä¸éœ€è¦åƒJavaé‚£æ ·åŒ…åå’Œç›®å½•ç»“æ„å®Œå…¨å¯¹åº”ã€‚ä¸€ä¸ªç®€å•çš„å·¥å…·å‡½æ•°,Pythonå¯ä»¥ç›´æ¥å†™åœ¨æ¨¡å—çº§åˆ«,è€ŒJavaå¿…é¡»å¥—ä¸Šä¸€ä¸ªç±»ã€‚

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Java | Python | è¿ç§»å»ºè®® |
|-----|------|--------|---------|
| ç±»å‹ç³»ç»Ÿ | é™æ€ | åŠ¨æ€(å¯é€‰æ³¨è§£) | å¤æ‚é¡¹ç›®å»ºè®®ç”¨ç±»å‹æ³¨è§£ |
| è¿è¡Œæ–¹å¼ | ç¼–è¯‘+è§£é‡Š | ç›´æ¥è§£é‡Š | ä¹ æƒ¯çƒ­é‡è½½çš„å¿«æ„Ÿ |
| æ€§èƒ½ | é«˜ | ä¸­ç­‰ | ç“¶é¢ˆå¤„è€ƒè™‘ç”¨Cæ‰©å±• |
| è¯­æ³•é£æ ¼ | å†—é•¿ä¸¥è°¨ | ç®€æ´çµæ´» | æ‹¥æŠ±ç®€æ´,ä½†æ³¨æ„è§„èŒƒ |
| å¹¶å‘æ¨¡å‹ | å¤šçº¿ç¨‹å‹å¥½ | å¤šè¿›ç¨‹ä¸ºä¸» | äº†è§£GILçš„å½±å“ |
| å­¦ä¹ æ›²çº¿ | é™¡å³­ | å¹³ç¼“ | ä½†ç²¾é€šåŒæ ·éœ€è¦æ—¶é—´ |

### 3ã€Pythonç¯å¢ƒæ­å»º

å¯¹Javaå¼€å‘è€…æ¥è¯´,Pythonçš„ç¯å¢ƒæ­å»ºæ¯”JDKç®€å•å¤šäº†â€”â€”æ²¡æœ‰é‚£ä¹ˆå¤šç‰ˆæœ¬å…¼å®¹æ€§çš„å‘,ä¹Ÿä¸éœ€è¦é…ç½®CLASSPATHã€‚

#### 3.1ã€Pythonå®‰è£…

æˆªè‡³2024å¹´,Python 3.13æ˜¯æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚ä¸è¿‡å®é™…é¡¹ç›®ä¸­,Python 3.9+ éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚

**Windowså®‰è£…**

1. è®¿é—® [python.org](https://python.org) ä¸‹è½½Windowså®‰è£…åŒ…
2. **é‡è¦**:å®‰è£…æ—¶å‹¾é€‰"Add Python to PATH",è¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨é…ç½®ç¯å¢ƒå˜é‡äº†
3. å»ºè®®é€‰æ‹©"Custom Installation",å¯ä»¥é€‰æ‹©å®‰è£…ä½ç½®å’Œç»„ä»¶

```bash
# éªŒè¯å®‰è£…
python --version    # è¾“å‡º: Python 3.13.x
pip --version      # pipæ˜¯Pythonçš„åŒ…ç®¡ç†å™¨,ç±»ä¼¼Maven
```

**macOSå®‰è£…**

æ¨èä½¿ç”¨Homebrew,æ¯”å®˜æ–¹å®‰è£…åŒ…æ›´æ–¹ä¾¿ç®¡ç†:

```bash
# å®‰è£…Homebrew(å¦‚æœæ²¡æœ‰)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# å®‰è£…Python
brew install python@3.13

# éªŒè¯
python3 --version
pip3 --version
```

**Linuxå®‰è£…**

å¤§å¤šæ•°ç°ä»£Linuxå‘è¡Œç‰ˆéƒ½é¢„è£…äº†Python,ä½†å¯èƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬:

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.13 python3.13-pip python3.13-venv

# CentOS/RHEL/Fedora
sudo dnf install python3.13 python3.13-pip

# éªŒè¯
python3.13 --version
```

#### 3.2ã€è™šæ‹Ÿç¯å¢ƒç®¡ç†

Javaå¼€å‘è€…å¯¹ä¾èµ–å†²çªåº”è¯¥ä¸é™Œç”Ÿ(ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªjaråŒ…)ã€‚Pythonç”¨è™šæ‹Ÿç¯å¢ƒè§£å†³è¿™ä¸ªé—®é¢˜,ç±»ä¼¼äºDockerä½†æ›´è½»é‡ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç¯å¢ƒ?**

æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯:
- é¡¹ç›®Aéœ€è¦Django 3.2
- é¡¹ç›®Béœ€è¦Django 4.0
- å…¨å±€åªèƒ½å®‰è£…ä¸€ä¸ªç‰ˆæœ¬...

è™šæ‹Ÿç¯å¢ƒè®©æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ç‹¬ç«‹çš„Pythonç¯å¢ƒ,å®Œç¾è§£å†³ç‰ˆæœ¬å†²çªã€‚

**venvâ€”â€”Pythonå®˜æ–¹æ–¹æ¡ˆ**

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ(ç±»ä¼¼åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonå®‰è£…)
python -m venv myproject_env

# Windowsæ¿€æ´»
myproject_env\Scripts\activate

# macOS/Linuxæ¿€æ´»
source myproject_env/bin/activate

# æ¿€æ´»å,å‘½ä»¤è¡Œå‰ç¼€ä¼šæ˜¾ç¤ºç¯å¢ƒå
(myproject_env) $ python --version

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```

**virtualenvâ€”â€”ç¬¬ä¸‰æ–¹å¢å¼ºç‰ˆ**

åŠŸèƒ½æ›´ä¸°å¯Œ,æ”¯æŒæ›´å¤šPythonç‰ˆæœ¬:

```bash
# å®‰è£…
pip install virtualenv

# åˆ›å»ºç¯å¢ƒ(å¯ä»¥æŒ‡å®šPythonç‰ˆæœ¬)
virtualenv -p python3.9 myproject_env

# ä½¿ç”¨æ–¹å¼å’Œvenvç›¸åŒ
```

**condaâ€”â€”æ•°æ®ç§‘å­¦ç•Œçš„ç‘å£«å†›åˆ€**

å¦‚æœä½ è¦åšæ•°æ®ç§‘å­¦æˆ–æœºå™¨å­¦ä¹ ,æ¨ècondaã€‚å®ƒä¸ä»…ç®¡ç†PythonåŒ…,è¿˜èƒ½ç®¡ç†C++åº“ã€RåŒ…ç­‰:

```bash
# å®‰è£…Miniconda(è½»é‡ç‰ˆ)æˆ–Anaconda(å®Œæ•´ç‰ˆ)
# ä¸‹è½½åœ°å€: https://conda.io/

# åˆ›å»ºç¯å¢ƒ
conda create -n myproject python=3.13

# æ¿€æ´»
conda activate myproject

# å®‰è£…åŒ…(condaä¼šè‡ªåŠ¨è§£å†³ä¾èµ–)
conda install numpy pandas matplotlib

# åˆ—å‡ºç¯å¢ƒ
conda env list
```

#### 3.3ã€IDEä¸ç¼–è¾‘å™¨é€‰æ‹©

ä»Javaç”Ÿæ€è½¬æ¥,ä½ éœ€è¦é€‰æ‹©è¶æ‰‹çš„å¼€å‘å·¥å…·:

**PyCharmâ€”â€”Pythonç•Œçš„IntelliJ IDEA**

JetBrainså‡ºå“,ç•Œé¢å’Œå¿«æ·é”®ä¸IDEAç±»ä¼¼,é€‚åˆJavaå¼€å‘è€…:

- **ä¼˜ç‚¹**:æ™ºèƒ½ä»£ç è¡¥å…¨ã€å¼ºå¤§çš„è°ƒè¯•ã€é‡æ„å·¥å…·ã€Gité›†æˆ
- **ç¼ºç‚¹**:æ¯”è¾ƒé‡,å¯åŠ¨æ…¢
- **é€‚åˆ**:å¤§å‹é¡¹ç›®,å›¢é˜Ÿå¼€å‘

ä¸»è¦åŠŸèƒ½:
- æ™ºèƒ½ä»£ç è¡¥å…¨å’Œé”™è¯¯æ£€æµ‹
- å¼ºå¤§çš„è°ƒè¯•å™¨(ç±»ä¼¼IDEAçš„è°ƒè¯•ä½“éªŒ)
- å†…ç½®ç»ˆç«¯å’Œæ•°æ®åº“å·¥å…·
- ç‰ˆæœ¬æ§åˆ¶é›†æˆ

**VS Codeâ€”â€”å¾®è½¯çš„è½»é‡é€‰æ‹©**

- **ä¼˜ç‚¹**:å¯åŠ¨å¿«,æ’ä»¶ä¸°å¯Œ,å†…å­˜å ç”¨å°
- **ç¼ºç‚¹**:éœ€è¦é…ç½®æ’ä»¶æ‰èƒ½è·å¾—å®Œæ•´ä½“éªŒ
- **é€‚åˆ**:å¿«é€Ÿå¼€å‘,å¤šè¯­è¨€é¡¹ç›®

æ¨èæ’ä»¶:
- Python(å¾®è½¯å®˜æ–¹)
- Pylance(ç±»å‹æ£€æŸ¥å’Œæ™ºèƒ½æç¤º)
- Python Docstring Generator
- GitLens

**Jupyter Notebookâ€”â€”äº¤äº’å¼å¼€å‘**

ç‰¹åˆ«é€‚åˆæ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ :

```bash
# å®‰è£…
pip install jupyter

# å¯åŠ¨
jupyter notebook

# æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ http://localhost:8888
```

Jupyterçš„ä¼˜åŠ¿:
- ä»£ç ã€æ–‡æ¡£ã€å›¾è¡¨æ··åˆç¼–å†™
- é€ä¸ªå•å…ƒæ ¼æ‰§è¡Œä»£ç 
- å¯è§†åŒ–ç»“æœç›´æ¥å±•ç¤º
- æ”¯æŒMarkdownæ–‡æ¡£

#### 3.4ã€pipåŒ…ç®¡ç†å™¨

pipæ˜¯Pythonçš„æ ‡å‡†åŒ…ç®¡ç†å™¨,ç±»ä¼¼Mavenä½†æ›´ç®€å•:

**pipåŸºç¡€å‘½ä»¤**

```bash
# å®‰è£…åŒ…
pip install requests

# å®‰è£…ç‰¹å®šç‰ˆæœ¬
pip install django==4.0

# å®‰è£…æœ€æ–°ç‰ˆæœ¬
pip install --upgrade numpy

# å¸è½½
pip uninstall requests

# åˆ—å‡ºå·²å®‰è£…çš„åŒ…
pip list

# æ˜¾ç¤ºåŒ…ä¿¡æ¯
pip show requests

# æœç´¢åŒ…(å·²åºŸå¼ƒ,å»ºè®®å»PyPIç½‘ç«™æœç´¢)
```

**requirements.txtâ€”â€”ä¾èµ–ç®¡ç†æ–‡ä»¶**

ç±»ä¼¼äºMavençš„pom.xml,ä½†æ›´ç®€æ´:

```bash
# ç”Ÿæˆå½“å‰ç¯å¢ƒçš„ä¾èµ–åˆ—è¡¨
pip freeze > requirements.txt

# requirements.txtå†…å®¹ç¤ºä¾‹:
# Django==4.2.0
# requests==2.31.0
# numpy==1.24.3

# åœ¨æ–°ç¯å¢ƒä¸­å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

**å›½å†…é•œåƒæºé…ç½®â€”â€”å‘Šåˆ«é¾Ÿé€Ÿä¸‹è½½**

é»˜è®¤pipä»å›½å¤–æºä¸‹è½½,é€Ÿåº¦æ„Ÿäººã€‚é…ç½®å›½å†…é•œåƒæº:

**ä¸´æ—¶ä½¿ç”¨**:
```bash
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ requests
```

**æ°¸ä¹…é…ç½®**(æ¨è):

Windows: åœ¨ `%APPDATA%\pip\pip.ini` æ–‡ä»¶ä¸­æ·»åŠ :
```ini
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple/
trusted-host = pypi.tuna.tsinghua.edu.cn
```

macOS/Linux: åœ¨ `~/.pip/pip.conf` æ–‡ä»¶ä¸­æ·»åŠ :
```ini
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple/
trusted-host = pypi.tuna.tsinghua.edu.cn
```

**å¸¸ç”¨å›½å†…é•œåƒæº**:
- æ¸…åå¤§å­¦: `https://pypi.tuna.tsinghua.edu.cn/simple/`
- é˜¿é‡Œäº‘: `https://mirrors.aliyun.com/pypi/simple/`
- è…¾è®¯äº‘: `https://mirrors.cloud.tencent.com/pypi/simple/`

**å¿«é€Ÿä¸Šæ‰‹æ£€éªŒ**

å®‰è£…å®Œæˆå,è®©æˆ‘ä»¬å†™ç¬¬ä¸€ä¸ªPythonç¨‹åº:

```python
# hello.py
def greet(name):
    return f"Hello, {name}! æ¬¢è¿æ¥åˆ°Pythonä¸–ç•Œ!"

if __name__ == "__main__":
    print(greet("Javaå¼€å‘è€…"))
    print("Pythonå®‰è£…æˆåŠŸ! ğŸ‰")
```

è¿è¡Œ:
```bash
python hello.py
```

å¦‚æœçœ‹åˆ°è¾“å‡º,æ­å–œä½ ,Pythonç¯å¢ƒæ­å»ºæˆåŠŸ!

**å°è´´å£«**:
1. å»ºè®®æ¯ä¸ªé¡¹ç›®éƒ½ç”¨ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒ
2. requirements.txtè¦çº³å…¥ç‰ˆæœ¬æ§åˆ¶
3. å®šæœŸæ›´æ–°pipæœ¬èº«:`python -m pip install --upgrade pip`
4. å¦‚æœç½‘ç»œä¸ç¨³å®š,å¯ä»¥è€ƒè™‘ä½¿ç”¨condaæ›¿ä»£pip

## äºŒã€PythonåŸºç¡€è¯­æ³•

### 1ã€å˜é‡ä¸æ•°æ®ç±»å‹

ä»Javaè½¬åˆ°Pythonï¼Œç¬¬ä¸€ä¸ªæƒŠå–œå°±æ˜¯ï¼šä¸ç”¨å†™ç±»å‹å£°æ˜äº†ï¼ä½†è¿™ä¸ä»£è¡¨Pythonæ²¡æœ‰ç±»å‹ï¼Œåªæ˜¯æ›´åŠ çµæ´»ã€‚

#### 1.1ã€å˜é‡å£°æ˜ä¸å‘½åè§„èŒƒ

**Pythonçš„å˜é‡å£°æ˜**

```java
// Java: å¿…é¡»å£°æ˜ç±»å‹
int age = 25;
String name = "å¼ ä¸‰";
```

```python
# Python: ç›´æ¥èµ‹å€¼å³å¯
age = 25
name = "å¼ ä¸‰"
```

Pythonçš„å˜é‡æœ¬è´¨ä¸Šæ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ˆç±»ä¼¼Javaçš„å¼•ç”¨ç±»å‹ï¼‰ï¼Œèµ‹å€¼æ—¶ä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚

**å‘½åè§„èŒƒ**

Pythonå’ŒJavaçš„å‘½åé£æ ¼æœ‰äº›å·®å¼‚ï¼š

```python
# Pythoné£æ ¼ - æ¨èä½¿ç”¨
user_name = "å¼ ä¸‰"          # å˜é‡å’Œå‡½æ•°ï¼šsnake_caseï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰
MAX_SIZE = 100             # å¸¸é‡ï¼šå…¨å¤§å†™+ä¸‹åˆ’çº¿
class UserProfile:         # ç±»åï¼šPascalCaseï¼ˆå¤§é©¼å³°ï¼‰
    pass

# Javaé£æ ¼ - åœ¨Pythonä¸­ä¸æ¨è
userName = "å¼ ä¸‰"           # camelCaseåœ¨Pythonä¸å¸¸ç”¨
```

**å‘½åè§„åˆ™**ï¼š
- åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- ä¸èƒ½ä»¥æ•°å­—å¼€å¤´
- åŒºåˆ†å¤§å°å†™ï¼ˆ`name`å’Œ`Name`æ˜¯ä¸åŒå˜é‡ï¼‰
- ä¸èƒ½ä½¿ç”¨Pythonå…³é”®å­—ï¼ˆ`if`ã€`for`ã€`class`ç­‰ï¼‰

**ç‰¹æ®Šå‘½åçº¦å®š**ï¼š
```python
_internal_var = "ç§æœ‰å˜é‡"    # å•ä¸‹åˆ’çº¿å¼€å¤´ï¼šå†…éƒ¨ä½¿ç”¨ï¼ˆçº¦å®šï¼Œéå¼ºåˆ¶ï¼‰
__private_var = "æ›´ç§æœ‰"      # åŒä¸‹åˆ’çº¿å¼€å¤´ï¼šåç§°æ”¹å†™ï¼ˆé¿å…å­ç±»å†²çªï¼‰
__magic__ = "é­”æœ¯æ–¹æ³•"        # åŒä¸‹åˆ’çº¿å‰åï¼š1ã€Pythonå†…ç½®ç‰¹æ®Šæ–¹æ³•-é­”æ³•æ–¹æ³•ï¼Œç”¨äºè‡ªå®šä¹‰ç±»çš„è¡Œä¸ºï¼›2ã€ç‰¹æ®Šå†…ç½®å±æ€§ï¼Œç”±è§£é‡Šå™¨è‡ªåŠ¨è®¾ç½®
```

#### 1.2ã€åŸºæœ¬æ•°æ®ç±»å‹

Pythonçš„ç±»å‹ç³»ç»Ÿæ¯”Javaç®€å•ï¼Œä½†è¯¥æœ‰çš„éƒ½æœ‰ã€‚

**æ•°å€¼ç±»å‹**

```python
# int - æ•´æ•°ï¼ˆæ²¡æœ‰å¤§å°é™åˆ¶ï¼ï¼‰
age = 25
big_num = 123456789012345678901234567890  # Javaçš„longéƒ½è£…ä¸ä¸‹

# float - æµ®ç‚¹æ•°
price = 99.99
scientific = 1.5e10  # ç§‘å­¦è®¡æ•°æ³•ï¼š1.5 Ã— 10^10

# complex - å¤æ•°ï¼ˆJavaæ²¡æœ‰åŸç”Ÿæ”¯æŒï¼‰
z = 3 + 4j
print(z.real)  # è¾“å‡º: 3.0
print(z.imag)  # è¾“å‡º: 4.0
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦è€ƒè™‘å¤§å°
int age = 25;              // 32ä½
long bigNum = 123456L;     // 64ä½
BigInteger huge = new BigInteger("123..."); // ä»»æ„å¤§å°

double price = 99.99;      // 64ä½
float f = 99.99f;          // 32ä½
```

**å¸ƒå°”ç±»å‹**

```python
# bool - æ³¨æ„é¦–å­—æ¯å¤§å†™ï¼
is_active = True   # ä¸æ˜¯true
is_valid = False   # ä¸æ˜¯false

# å¸ƒå°”è¿ç®—
result = True and False  # ä½¿ç”¨ andï¼Œä¸æ˜¯ &&
result = True or False   # ä½¿ç”¨ orï¼Œä¸æ˜¯ ||
result = not True        # ä½¿ç”¨ notï¼Œä¸æ˜¯ !
```

**Pythonçš„"çœŸå€¼"ï¼ˆTruthy/Falsyï¼‰**

è¿™æ˜¯Pythonçš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œä»¥ä¸‹å€¼ä¼šè¢«å½“ä½œ`False`ï¼š
```python
# è¿™äº›éƒ½æ˜¯"å‡"
bool(0)          # False
bool(0.0)        # False
bool("")         # False - ç©ºå­—ç¬¦ä¸²
bool([])         # False - ç©ºåˆ—è¡¨
bool({})         # False - ç©ºå­—å…¸
bool(None)       # False

# å…¶ä»–åŸºæœ¬éƒ½æ˜¯"çœŸ"
bool(1)          # True
bool("hello")    # True
bool([1, 2])     # True
```

è¿™è®©æ¡ä»¶åˆ¤æ–­æ›´ç®€æ´ï¼š
```python
# Pythoné£æ ¼
if user_list:  # ç›´æ¥åˆ¤æ–­ï¼Œç©ºåˆ—è¡¨ä¸ºFalse
    process(user_list)

# ä¸éœ€è¦åƒJavaé‚£æ ·
# if (userList != null && !userList.isEmpty()) { ... }
```

**å­—ç¬¦ä¸²**

```python
# str - å­—ç¬¦ä¸²ï¼ˆä¸å¯å˜ç±»å‹ï¼‰
name = "å¼ ä¸‰"
message = 'Hello'
```

å…³äºå­—ç¬¦ä¸²çš„æ›´å¤šå†…å®¹ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†è®²è§£ã€‚

**Noneç±»å‹**

```python
# None - ç›¸å½“äºJavaçš„null
result = None

# åˆ¤æ–­None
if result is None:  # æ¨èç”¨ is
    print("æ²¡æœ‰ç»“æœ")

if result == None:  # ä¹Ÿå¯ä»¥ï¼Œä½†ä¸æ¨è
    print("æ²¡æœ‰ç»“æœ")
```

å¯¹æ¯”Javaï¼š
```java
String result = null;
if (result == null) {
    System.out.println("æ²¡æœ‰ç»“æœ");
}
```

#### 1.3ã€ç±»å‹è½¬æ¢ä¸ç±»å‹æ£€æŸ¥

**ç±»å‹è½¬æ¢**

```python
# æ˜¾å¼è½¬æ¢
age_str = "25"
age = int(age_str)      # å­—ç¬¦ä¸² â†’ æ•´æ•°

price = 99.99
price_int = int(price)  # æµ®ç‚¹ â†’ æ•´æ•°ï¼ˆæˆªæ–­ï¼Œä¸æ˜¯å››èˆäº”å…¥ï¼‰

num = 100
num_str = str(num)      # æ•´æ•° â†’ å­—ç¬¦ä¸²
num_float = float(num)  # æ•´æ•° â†’ æµ®ç‚¹

# è½¬æ¢å¤±è´¥ä¼šæŠ›å¼‚å¸¸
try:
    int("abc")  # ValueError
except ValueError as e:
    print(f"è½¬æ¢å¤±è´¥: {e}")
```

**ç±»å‹æ£€æŸ¥**

```python
# type() - è·å–ç±»å‹
age = 25
print(type(age))        # <class 'int'>
print(type(age) == int) # True

# isinstance() - ç±»å‹æ£€æŸ¥ï¼ˆæ¨èï¼Œæ”¯æŒç»§æ‰¿ï¼‰
age = 25
print(isinstance(age, int))           # True
print(isinstance(age, (int, float)))  # True - æ£€æŸ¥å¤šä¸ªç±»å‹

# å¯¹æ¯”Java
# if (obj instanceof String) { ... }
```

**ç±»å‹æ³¨è§£ï¼ˆType Hintsï¼‰**

Python 3.5+æ”¯æŒç±»å‹æ³¨è§£ï¼Œè®©Javaå¼€å‘è€…æ›´èˆ’é€‚ï¼š

```python
# åŠ ä¸Šç±»å‹æ³¨è§£
def greet(name: str, age: int) -> str:
    return f"Hello, {name}! You are {age} years old."

# å˜é‡ç±»å‹æ³¨è§£
user_name: str = "å¼ ä¸‰"
score: float = 95.5
users: list[str] = ["å¼ ä¸‰", "æå››"]

# æ³¨æ„ï¼šè¿™åªæ˜¯"æ³¨è§£"ï¼Œè¿è¡Œæ—¶ä¸ä¼šæ£€æŸ¥ï¼
result = greet("å¼ ä¸‰", "25")  # ä¼ äº†å­—ç¬¦ä¸²ï¼Œä¸ä¼šæŠ¥é”™
# éœ€è¦é…åˆmypyç­‰å·¥å…·åšé™æ€æ£€æŸ¥
```

#### 1.4ã€ä¸Javaçš„ç±»å‹ç³»ç»Ÿå¯¹æ¯”

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| ç±»å‹å£°æ˜ | å¼ºåˆ¶ | å¯é€‰ï¼ˆç±»å‹æ³¨è§£ï¼‰ |
| åŸºæœ¬ç±»å‹ | æœ‰ï¼ˆint, doubleç­‰ï¼‰ | æ— ï¼Œä¸€åˆ‡çš†å¯¹è±¡ |
| åŒ…è£…ç±»å‹ | æœ‰ï¼ˆInteger, Doubleç­‰ï¼‰ | æ— éœ€åŒºåˆ† |
| æ•´æ•°èŒƒå›´ | å›ºå®šï¼ˆint 32ä½, long 64ä½ï¼‰ | ä»»æ„å¤§å° |
| å­—ç¬¦ç±»å‹ | æœ‰ï¼ˆcharï¼‰ | æ— ï¼Œç”¨å•å­—ç¬¦å­—ç¬¦ä¸² |
| ç©ºå€¼ | null | None |
| ç±»å‹æ£€æŸ¥æ—¶æœº | ç¼–è¯‘æœŸ | è¿è¡ŒæœŸï¼ˆå¯ç”¨å·¥å…·é™æ€æ£€æŸ¥ï¼‰ |

**å®æˆ˜å»ºè®®**ï¼š
1. å°è„šæœ¬å¯ä»¥ä¸å†™ç±»å‹æ³¨è§£ï¼Œè¿½æ±‚å¿«é€Ÿå¼€å‘
2. å¤§é¡¹ç›®å»ºè®®åŠ ä¸Šç±»å‹æ³¨è§£ï¼Œé…åˆmypyæ£€æŸ¥
3. åˆ©ç”¨Pythonçš„"é¸­å­ç±»å‹"ï¼Œå…³æ³¨å¯¹è±¡è¡Œä¸ºè€Œéç±»å‹
4. å–„ç”¨`isinstance()`åšè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥

**å°æŠ€å·§**ï¼š

```python
# å¤šé‡èµ‹å€¼
x, y, z = 1, 2, 3

# å˜é‡äº¤æ¢ï¼ˆJavaéœ€è¦ä¸­é—´å˜é‡ï¼‰
a, b = b, a

# é“¾å¼æ¯”è¾ƒï¼ˆJavaåšä¸åˆ°ï¼‰
age = 25
if 18 <= age < 60:  # ç›¸å½“äº age >= 18 and age < 60
    print("å·¥ä½œå¹´é¾„æ®µ")
```

### 2ã€å­—ç¬¦ä¸²æ“ä½œ

å­—ç¬¦ä¸²æ˜¯ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼ŒPythonçš„å­—ç¬¦ä¸²æ“ä½œæ¯”Javaç®€æ´å¤ªå¤šäº†ã€‚

#### 2.1ã€å­—ç¬¦ä¸²å®šä¹‰æ–¹å¼

**å•å¼•å·ã€åŒå¼•å·ã€ä¸‰å¼•å·**

```python
# å•å¼•å·å’ŒåŒå¼•å·å®Œå…¨ç­‰ä»·
name1 = 'Python'
name2 = "Python"
print(name1 == name2)  # True

# ä¼˜åŠ¿ï¼šå¯ä»¥äº’ç›¸åµŒå¥—
message1 = "He said 'Hello'"
message2 = 'She replied "Hi"'

# ä¸‰å¼•å·ï¼šå¤šè¡Œå­—ç¬¦ä¸²ï¼ˆç›¸å½“äºJavaçš„æ–‡æœ¬å—ï¼‰
long_text = """
è¿™æ˜¯ä¸€æ®µ
å¤šè¡Œæ–‡æœ¬
å¯ä»¥éšæ„æ¢è¡Œ
"""

sql = '''
SELECT * FROM users
WHERE age > 18
  AND status = 'active'
'''
```

å¯¹æ¯”Javaï¼ˆJava 15+æ‰æ”¯æŒæ–‡æœ¬å—ï¼‰ï¼š
```java
// Java 15+
String sql = """
    SELECT * FROM users
    WHERE age > 18
      AND status = 'active'
    """;
```

#### 2.2ã€å­—ç¬¦ä¸²æ ¼å¼åŒ–

Pythonæœ‰ä¸‰ç§å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹å¼ï¼Œæ¨èä½¿ç”¨f-stringï¼ˆæœ€ç°ä»£ã€æœ€ç®€æ´ï¼‰ã€‚

**% æ ¼å¼åŒ–ï¼ˆè€å¼å†™æ³•ï¼‰**

```python
name = "å¼ ä¸‰"
age = 25
# ç±»ä¼¼Cè¯­è¨€çš„printf
message = "æˆ‘å«%sï¼Œä»Šå¹´%då²" % (name, age)
print(message)  # æˆ‘å«å¼ ä¸‰ï¼Œä»Šå¹´25å²

# æ ¼å¼æ§åˆ¶
price = 99.999
print("ä»·æ ¼ï¼š%.2få…ƒ" % price)  # ä»·æ ¼ï¼š100.00å…ƒ
```

**str.format()ï¼ˆPython 2.6+ï¼‰**

```python
name = "å¼ ä¸‰"
age = 25

# ä½ç½®å‚æ•°
message = "æˆ‘å«{}ï¼Œä»Šå¹´{}å²".format(name, age)

# ç´¢å¼•å‚æ•°
message = "æˆ‘å«{0}ï¼Œä»Šå¹´{1}å²ï¼Œ{0}å¾ˆé«˜å…´è®¤è¯†ä½ ".format(name, age)

# å‘½åå‚æ•°ï¼ˆæ¨èï¼Œå¯è¯»æ€§å¥½ï¼‰
message = "æˆ‘å«{name}ï¼Œä»Šå¹´{age}å²".format(name=name, age=age)

# æ ¼å¼æ§åˆ¶
price = 99.999
print("ä»·æ ¼ï¼š{:.2f}å…ƒ".format(price))  # ä»·æ ¼ï¼š100.00å…ƒ

# å¡«å……å’Œå¯¹é½
print("{:>10}".format("å³å¯¹é½"))   # "      å³å¯¹é½"
print("{:<10}".format("å·¦å¯¹é½"))   # "å·¦å¯¹é½      "
print("{:^10}".format("å±…ä¸­"))     # "   å±…ä¸­   "
print("{:0>5}".format("42"))      # "00042"
```

**f-stringï¼ˆPython 3.6+ï¼Œå¼ºçƒˆæ¨èï¼ï¼‰**

```python
name = "å¼ ä¸‰"
age = 25
score = 95.678

# æœ€ç®€æ´çš„æ–¹å¼
message = f"æˆ‘å«{name}ï¼Œä»Šå¹´{age}å²"

# å¯ä»¥ç›´æ¥åœ¨{}ä¸­å†™è¡¨è¾¾å¼
print(f"æ˜å¹´æˆ‘{age + 1}å²")
print(f"æˆç»©ï¼š{score:.2f}åˆ†")  # æˆç»©ï¼š95.68åˆ†

# æ”¯æŒå¤æ‚è¡¨è¾¾å¼
users = ["å¼ ä¸‰", "æå››", "ç‹äº”"]
print(f"å…±æœ‰{len(users)}ä¸ªç”¨æˆ·")

# å¯ä»¥è°ƒç”¨æ–¹æ³•
text = "hello"
print(f"å¤§å†™ï¼š{text.upper()}")  # å¤§å†™ï¼šHELLO

# å¤šè¡Œf-string
message = (
    f"å§“åï¼š{name}\n"
    f"å¹´é¾„ï¼š{age}\n"
    f"æˆç»©ï¼š{score:.2f}"
)

# Python 3.8+ æ”¯æŒ = è°ƒè¯•
x = 10
print(f"{x=}")  # x=10ï¼ˆæ˜¾ç¤ºå˜é‡åå’Œå€¼ï¼Œè°ƒè¯•åˆ©å™¨ï¼‰
```

å¯¹æ¯”Javaï¼š
```java
// Javaä¼ ç»Ÿæ–¹å¼
String message = String.format("æˆ‘å«%sï¼Œä»Šå¹´%då²", name, age);

// Java 15+ æ–‡æœ¬å— + formatted()
String message = """
    å§“åï¼š%s
    å¹´é¾„ï¼š%d
    """.formatted(name, age);
```

#### 2.3ã€å¸¸ç”¨å­—ç¬¦ä¸²æ–¹æ³•

Pythonçš„å­—ç¬¦ä¸²æ–¹æ³•éå¸¸ä¸°å¯Œï¼Œè€Œä¸”éƒ½è¿”å›æ–°å­—ç¬¦ä¸²ï¼ˆå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼‰ã€‚

**å¤§å°å†™è½¬æ¢**

```python
text = "Hello World"

print(text.upper())       # HELLO WORLD
print(text.lower())       # hello world
print(text.capitalize())  # Hello worldï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
print(text.title())       # Hello Worldï¼ˆæ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ï¼‰
print(text.swapcase())    # hELLO wORLDï¼ˆå¤§å°å†™äº’æ¢ï¼‰
```

**æŸ¥æ‰¾å’Œåˆ¤æ–­**

```python
text = "Hello Python"

# æŸ¥æ‰¾å­ä¸²
print(text.find("Python"))      # 6ï¼ˆè¿”å›ç´¢å¼•ï¼‰
print(text.find("Java"))        # -1ï¼ˆæ‰¾ä¸åˆ°ï¼‰
print(text.index("Python"))     # 6ï¼ˆæ‰¾ä¸åˆ°ä¼šæŠ›å¼‚å¸¸ï¼‰

# åˆ¤æ–­
print(text.startswith("Hello")) # True
print(text.endswith("Python"))  # True
print("123".isdigit())          # Trueï¼ˆæ˜¯å¦å…¨æ˜¯æ•°å­—ï¼‰
print("abc".isalpha())          # Trueï¼ˆæ˜¯å¦å…¨æ˜¯å­—æ¯ï¼‰
print("abc123".isalnum())       # Trueï¼ˆæ˜¯å¦å…¨æ˜¯å­—æ¯æˆ–æ•°å­—ï¼‰
print("  ".isspace())           # Trueï¼ˆæ˜¯å¦å…¨æ˜¯ç©ºç™½å­—ç¬¦ï¼‰
```

**æ›¿æ¢å’Œåˆ†å‰²**

```python
text = "Hello Python Python"

# æ›¿æ¢
print(text.replace("Python", "Java"))        # Hello Java Java
print(text.replace("Python", "Java", 1))     # Hello Java Pythonï¼ˆåªæ›¿æ¢1æ¬¡ï¼‰

# åˆ†å‰²
csv = "å¼ ä¸‰,25,åŒ—äº¬"
parts = csv.split(",")
print(parts)  # ['å¼ ä¸‰', '25', 'åŒ—äº¬']

# å¤šè¡Œåˆ†å‰²
text = "ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ\nç¬¬ä¸‰è¡Œ"
lines = text.splitlines()
print(lines)  # ['ç¬¬ä¸€è¡Œ', 'ç¬¬äºŒè¡Œ', 'ç¬¬ä¸‰è¡Œ']

# è¿æ¥ï¼ˆåå‘æ“ä½œï¼‰
words = ["Hello", "Python", "World"]
result = " ".join(words)
print(result)  # Hello Python World
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦æ›´å¤šä»£ç 
String[] parts = csv.split(",");
String result = String.join(" ", words);
```

**å»é™¤ç©ºç™½**

```python
text = "  Hello Python  "

print(text.strip())   # "Hello Python"ï¼ˆå»é™¤ä¸¤ç«¯ç©ºç™½ï¼‰
print(text.lstrip())  # "Hello Python  "ï¼ˆå»é™¤å·¦ä¾§ï¼‰
print(text.rstrip())  # "  Hello Python"ï¼ˆå»é™¤å³ä¾§ï¼‰

# å»é™¤æŒ‡å®šå­—ç¬¦
url = "https://example.com/"
print(url.rstrip("/"))  # https://example.com
```

#### 2.4ã€å­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ

è¿™æ˜¯Pythonçš„ç‰¹è‰²åŠŸèƒ½ï¼Œæ¯”Javaçš„substring()çµæ´»å¤šäº†ï¼

**åŸºæœ¬åˆ‡ç‰‡**

```python
text = "Python"

# è¯­æ³•ï¼š[start:end:step]
print(text[0])      # Pï¼ˆå•ä¸ªå­—ç¬¦ï¼‰
print(text[0:3])    # Pytï¼ˆç´¢å¼•0åˆ°2ï¼Œä¸åŒ…å«3ï¼‰
print(text[:3])     # Pytï¼ˆçœç•¥startï¼Œä»å¤´å¼€å§‹ï¼‰
print(text[3:])     # honï¼ˆçœç•¥endï¼Œåˆ°æœ«å°¾ï¼‰
print(text[:])      # Pythonï¼ˆå®Œæ•´å¤åˆ¶ï¼‰

# è´Ÿç´¢å¼•ï¼ˆä»å³å¾€å·¦æ•°ï¼‰
print(text[-1])     # nï¼ˆæœ€åä¸€ä¸ªå­—ç¬¦ï¼‰
print(text[-3:])    # honï¼ˆæœ€å3ä¸ªå­—ç¬¦ï¼‰
print(text[:-1])    # Pythoï¼ˆé™¤äº†æœ€åä¸€ä¸ªï¼‰

# æ­¥é•¿
print(text[::2])    # Ptoï¼ˆæ¯éš”ä¸€ä¸ªå–ä¸€ä¸ªï¼‰
print(text[::-1])   # nohtyPï¼ˆåè½¬å­—ç¬¦ä¸²ï¼ï¼‰
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦ç”¨substring
String text = "Python";
String sub = text.substring(0, 3);  // Pyt

// åè½¬éœ€è¦StringBuilder
String reversed = new StringBuilder(text).reverse().toString();
```

**åˆ‡ç‰‡çš„å®ç”¨æŠ€å·§**

```python
# å»é™¤æ–‡ä»¶æ‰©å±•å
filename = "document.pdf"
name = filename[:-4]  # document

# æå–åŸŸå
email = "user@example.com"
domain = email[email.index("@")+1:]  # example.com

# æ¯éš”Nä¸ªå­—ç¬¦æ’å…¥åˆ†éš”ç¬¦
card = "1234567890123456"
formatted = "-".join([card[i:i+4] for i in range(0, len(card), 4)])
print(formatted)  # 1234-5678-9012-3456
```

#### 2.5ã€åŸå§‹å­—ç¬¦ä¸²ä¸è½¬ä¹‰å­—ç¬¦

**è½¬ä¹‰å­—ç¬¦**

```python
# å¸¸è§è½¬ä¹‰å­—ç¬¦
print("ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ")     # æ¢è¡Œ
print("å§“åï¼š\tå¼ ä¸‰")       # åˆ¶è¡¨ç¬¦
print("è·¯å¾„ï¼šC:\\Users")    # åæ–œæ 
print("ä»–è¯´ï¼š\"ä½ å¥½\"")     # åŒå¼•å·
```

**åŸå§‹å­—ç¬¦ä¸²ï¼ˆraw stringï¼‰**

```python
# æ­£åˆ™è¡¨è¾¾å¼å’ŒWindowsè·¯å¾„ç‰¹åˆ«æœ‰ç”¨
path = r"C:\Users\å¼ ä¸‰\Documents"  # ä¸éœ€è¦è½¬ä¹‰
regex = r"\d+\.\d+"                # æ­£åˆ™è¡¨è¾¾å¼

# å¯¹æ¯”æ™®é€šå­—ç¬¦ä¸²
path_normal = "C:\\Users\\å¼ ä¸‰\\Documents"  # éœ€è¦åŒåæ–œæ 
```

å¯¹æ¯”Javaï¼š
```java
// Javaä¹Ÿéœ€è¦è½¬ä¹‰
String path = "C:\\Users\\å¼ ä¸‰\\Documents";

// Java 15+ æ”¯æŒåŸå§‹å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆé¢„è§ˆç‰¹æ€§ï¼‰
```

**Unicodeå­—ç¬¦**

```python
# Unicodeå­—ç¬¦
print("\u4e2d\u6587")  # ä¸­æ–‡
print("\U0001F600")    # ğŸ˜€ï¼ˆemojiï¼‰

# Python 3é»˜è®¤UTF-8ï¼Œç›´æ¥å†™ä¸­æ–‡å’Œemoji
message = "ä½ å¥½ ğŸ‰"
```

**å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§**

```python
text = "Python"
# text[0] = "J"  # TypeError: 'str' object does not support item assignment

# éœ€è¦åˆ›å»ºæ–°å­—ç¬¦ä¸²
text = "J" + text[1:]  # "Jython"

# æˆ–è€…ç”¨replace
text = text.replace("P", "J")
```

#### 2.6ã€å­—ç¬¦ä¸²æ€§èƒ½æç¤º

**æ‹¼æ¥å¤§é‡å­—ç¬¦ä¸²**

```python
# âŒ é”™è¯¯æ–¹å¼ï¼šåœ¨å¾ªç¯ä¸­ç”¨+æ‹¼æ¥ï¼ˆO(nÂ²)å¤æ‚åº¦ï¼‰
result = ""
for i in range(1000):
    result += str(i)

# âœ… æ­£ç¡®æ–¹å¼ï¼šç”¨joinï¼ˆO(n)å¤æ‚åº¦ï¼‰
result = "".join(str(i) for i in range(1000))

# âœ… æˆ–è€…ç”¨åˆ—è¡¨ç§¯ç´¯å†join
parts = []
for i in range(1000):
    parts.append(str(i))
result = "".join(parts)
```

å¯¹æ¯”Javaï¼š
```java
// Javaä¹Ÿæ˜¯åŒæ ·çš„é“ç†
// âŒ String result = "";
//    for (int i = 0; i < 1000; i++) result += i;

// âœ… StringBuilder sb = new StringBuilder();
//    for (int i = 0; i < 1000; i++) sb.append(i);
//    String result = sb.toString();
```

**å°ç»“å¯¹æ¯”è¡¨**

| æ“ä½œ | Java | Python |
|-----|------|--------|
| æ ¼å¼åŒ– | String.format() | f-stringï¼ˆæ¨èï¼‰ |
| åˆ†å‰² | split() | split() |
| è¿æ¥ | String.join() | str.join() |
| æ›¿æ¢ | replace() | replace() |
| åˆ‡ç‰‡ | substring() | [start:end] |
| åè½¬ | StringBuilder.reverse() | [::-1] |
| å¤šè¡Œæ–‡æœ¬ | """..."""ï¼ˆJava 15+ï¼‰ | """...""" |

Pythonçš„å­—ç¬¦ä¸²æ“ä½œæ›´ç®€æ´ç›´è§‚ï¼Œå°¤å…¶æ˜¯f-stringå’Œåˆ‡ç‰‡è¯­æ³•ï¼Œèƒ½å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼

### 3ã€è¿ç®—ç¬¦

Pythonçš„è¿ç®—ç¬¦å’ŒJavaå¤§éƒ¨åˆ†ç›¸ä¼¼ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç‹¬ç‰¹çš„åœ°æ–¹ï¼Œç‰¹åˆ«æ˜¯æˆå‘˜è¿ç®—ç¬¦å’Œèº«ä»½è¿ç®—ç¬¦ã€‚

#### 3.1ã€ç®—æœ¯è¿ç®—ç¬¦

```python
a = 10
b = 3

print(a + b)   # 13 - åŠ æ³•
print(a - b)   # 7  - å‡æ³•
print(a * b)   # 30 - ä¹˜æ³•
print(a / b)   # 3.333... - é™¤æ³•ï¼ˆæ³¨æ„ï¼šæ€»æ˜¯è¿”å›æµ®ç‚¹æ•°ï¼ï¼‰
print(a // b)  # 3  - æ•´é™¤ï¼ˆå‘ä¸‹å–æ•´ï¼‰
print(a % b)   # 1  - å–æ¨¡
print(a ** b)  # 1000 - å¹‚è¿ç®—ï¼ˆ10çš„3æ¬¡æ–¹ï¼‰
```

**é‡ç‚¹å·®å¼‚**ï¼š

```java
// Java
int a = 10, b = 3;
System.out.println(a / b);  // 3ï¼ˆæ•´æ•°é™¤æ³•ï¼‰
```

```python
# Python
a, b = 10, 3
print(a / b)   # 3.3333...ï¼ˆæ€»æ˜¯æµ®ç‚¹é™¤æ³•ï¼‰
print(a // b)  # 3ï¼ˆæ•´é™¤ï¼‰
```

**å¹‚è¿ç®—**æ˜¯Pythonçš„ç‰¹è‰²ï¼š

```python
# Pythonæœ‰ä¸“é—¨çš„å¹‚è¿ç®—ç¬¦
print(2 ** 10)  # 1024

# Javaéœ€è¦ç”¨Math.pow()
# Math.pow(2, 10)
```

**å¤åˆèµ‹å€¼**ï¼š

```python
x = 10
x += 5   # x = x + 5
x -= 3   # x = x - 3
x *= 2   # x = x * 2
x /= 4   # x = x / 4
x //= 2  # x = x // 2
x %= 3   # x = x % 3
x **= 2  # x = x ** 2
```

#### 3.2ã€æ¯”è¾ƒè¿ç®—ç¬¦

```python
a = 10
b = 20

print(a == b)   # False - ç­‰äº
print(a != b)   # True  - ä¸ç­‰äº
print(a > b)    # False - å¤§äº
print(a < b)    # True  - å°äº
print(a >= b)   # False - å¤§äºç­‰äº
print(a <= b)   # True  - å°äºç­‰äº
```

**é“¾å¼æ¯”è¾ƒ**ï¼ˆPythonç‹¬æœ‰ï¼Œè¶…çº§å®ç”¨ï¼ï¼‰ï¼š

```python
age = 25

# Pythonå¯ä»¥è¿™æ ·å†™
if 18 <= age < 60:
    print("å·¥ä½œå¹´é¾„æ®µ")

# ç›¸å½“äºï¼ˆä½†æ›´ç®€æ´ï¼‰
if age >= 18 and age < 60:
    print("å·¥ä½œå¹´é¾„æ®µ")

# å¤šé‡æ¯”è¾ƒ
x = 5
if 1 < x < 10 < 100:  # å®Œå…¨åˆæ³•ï¼
    print("xåœ¨1åˆ°10ä¹‹é—´ï¼Œ10å°äº100")
```

å¯¹æ¯”Javaï¼š
```java
// Javaä¸æ”¯æŒé“¾å¼æ¯”è¾ƒ
if (age >= 18 && age < 60) {
    System.out.println("å·¥ä½œå¹´é¾„æ®µ");
}
```

#### 3.3ã€é€»è¾‘è¿ç®—ç¬¦

```python
# Pythonä½¿ç”¨è‹±æ–‡å•è¯ï¼Œæ›´æ˜“è¯»
a = True
b = False

print(a and b)   # False - é€»è¾‘ä¸ï¼ˆJavaç”¨&&ï¼‰
print(a or b)    # True  - é€»è¾‘æˆ–ï¼ˆJavaç”¨||ï¼‰
print(not a)     # False - é€»è¾‘éï¼ˆJavaç”¨!ï¼‰
```

**çŸ­è·¯æ±‚å€¼**ï¼š

```python
# andï¼šå¦‚æœç¬¬ä¸€ä¸ªä¸ºFalseï¼Œä¸ä¼šè®¡ç®—ç¬¬äºŒä¸ª
def expensive_check():
    print("æ‰§è¡Œäº†æ˜‚è´µçš„æ£€æŸ¥")
    return True

x = False
if x and expensive_check():  # expensive_check()ä¸ä¼šæ‰§è¡Œ
    print("éƒ½ä¸ºçœŸ")

# orï¼šå¦‚æœç¬¬ä¸€ä¸ªä¸ºTrueï¼Œä¸ä¼šè®¡ç®—ç¬¬äºŒä¸ª
x = True
if x or expensive_check():  # expensive_check()ä¸ä¼šæ‰§è¡Œ
    print("è‡³å°‘ä¸€ä¸ªä¸ºçœŸ")
```

**é€»è¾‘è¿ç®—çš„è¿”å›å€¼**ï¼ˆPythonçš„ç‹¬ç‰¹ä¹‹å¤„ï¼‰ï¼š

```python
# andè¿”å›ç¬¬ä¸€ä¸ªå‡å€¼ï¼Œæˆ–æœ€åä¸€ä¸ªå€¼
print(5 and 10)      # 10ï¼ˆéƒ½ä¸ºçœŸï¼Œè¿”å›æœ€åä¸€ä¸ªï¼‰
print(0 and 10)      # 0ï¼ˆç¬¬ä¸€ä¸ªä¸ºå‡ï¼‰
print("" and "abc")  # ""ï¼ˆç©ºå­—ç¬¦ä¸²ä¸ºå‡ï¼‰

# orè¿”å›ç¬¬ä¸€ä¸ªçœŸå€¼ï¼Œæˆ–æœ€åä¸€ä¸ªå€¼
print(5 or 10)       # 5ï¼ˆç¬¬ä¸€ä¸ªä¸ºçœŸï¼‰
print(0 or 10)       # 10ï¼ˆç¬¬ä¸€ä¸ªä¸ºå‡ï¼Œè¿”å›ç¬¬äºŒä¸ªï¼‰
print("" or "abc")   # "abc"

# å®ç”¨æŠ€å·§ï¼šæä¾›é»˜è®¤å€¼
name = input_name or "åŒ¿åç”¨æˆ·"  # å¦‚æœinput_nameä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å€¼
```

#### 3.4ã€ä½è¿ç®—ç¬¦

ä¸Javaå®Œå…¨ç›¸åŒï¼š

```python
a = 60  # 0011 1100
b = 13  # 0000 1101

print(a & b)   # 12 (0000 1100) - æŒ‰ä½ä¸
print(a | b)   # 61 (0011 1101) - æŒ‰ä½æˆ–
print(a ^ b)   # 49 (0011 0001) - æŒ‰ä½å¼‚æˆ–
print(~a)      # -61 - æŒ‰ä½å–å
print(a << 2)  # 240 (1111 0000) - å·¦ç§»
print(a >> 2)  # 15 (0000 1111) - å³ç§»
```

#### 3.5ã€æˆå‘˜è¿ç®—ç¬¦ï¼ˆPythonç‹¬æœ‰ï¼‰

è¿™æ˜¯Pythonçš„ç‰¹è‰²ï¼Œè¶…çº§å¥½ç”¨ï¼

```python
# in - æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨åºåˆ—ä¸­
fruits = ["è‹¹æœ", "é¦™è•‰", "æ©™å­"]
print("è‹¹æœ" in fruits)      # True
print("è‘¡è„" in fruits)      # False

# not in - æ£€æŸ¥å…ƒç´ æ˜¯å¦ä¸åœ¨åºåˆ—ä¸­
print("è‘¡è„" not in fruits)  # True

# é€‚ç”¨äºå„ç§å®¹å™¨
text = "Hello Python"
print("Python" in text)      # True

numbers = {1, 2, 3, 4, 5}
print(3 in numbers)          # True

user_dict = {"name": "å¼ ä¸‰", "age": 25}
print("name" in user_dict)   # Trueï¼ˆæ£€æŸ¥é”®ï¼‰
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦ç”¨contains()æ–¹æ³•
List<String> fruits = Arrays.asList("è‹¹æœ", "é¦™è•‰", "æ©™å­");
boolean hasApple = fruits.contains("è‹¹æœ");

// æˆ–è€…å­—ç¬¦ä¸²çš„contains()
String text = "Hello Python";
boolean hasPython = text.contains("Python");
```

**å®ç”¨åœºæ™¯**ï¼š

```python
# éªŒè¯è¾“å…¥
command = input("è¯·è¾“å…¥å‘½ä»¤: ")
if command not in ["start", "stop", "restart"]:
    print("æ— æ•ˆå‘½ä»¤")

# è¿‡æ»¤æ•°æ®
valid_ids = {1, 2, 3, 4, 5}
if user_id in valid_ids:
    process_user(user_id)

# å­—ç¬¦ä¸²æ£€æŸ¥
email = "user@example.com"
if "@" not in email:
    print("é‚®ç®±æ ¼å¼é”™è¯¯")
```

#### 3.6ã€èº«ä»½è¿ç®—ç¬¦ï¼ˆPythonç‹¬æœ‰ï¼‰

ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼ˆä¸æ˜¯å€¼ç›¸ç­‰ï¼Œæ˜¯å¯¹è±¡ç›¸ç­‰ï¼‰ã€‚

```python
# is - åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡
a = [1, 2, 3]
b = a        # bæŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡
c = [1, 2, 3]  # cæ˜¯æ–°çš„åˆ—è¡¨å¯¹è±¡

print(a is b)      # True - æŒ‡å‘åŒä¸€å¯¹è±¡
print(a is c)      # False - ä¸åŒå¯¹è±¡
print(a == c)      # True - ä½†å€¼ç›¸ç­‰

# is not
print(a is not c)  # True
```

**ä½•æ—¶ä½¿ç”¨`is`ï¼Ÿ**

```python
# âœ… æ£€æŸ¥Noneï¼ˆæ¨èç”¨isï¼‰
result = some_function()
if result is None:
    print("æ²¡æœ‰è¿”å›å€¼")

# âœ… æ£€æŸ¥å•ä¾‹å¯¹è±¡
if obj is True:   # æ£€æŸ¥æ˜¯å¦æ˜¯Trueå¯¹è±¡
    pass

# âŒ ä¸è¦ç”¨isæ¯”è¾ƒå€¼
x = 1000
y = 1000
if x is y:  # å¯èƒ½æ˜¯Falseï¼ï¼ˆå°æ•´æ•°æœ‰ç¼“å­˜ï¼Œå¤§æ•´æ•°æ²¡æœ‰ï¼‰
    print("ç›¸ç­‰")

# âœ… åº”è¯¥ç”¨==æ¯”è¾ƒå€¼
if x == y:  # æ­£ç¡®
    print("ç›¸ç­‰")
```

**å°æ•´æ•°ç¼“å­˜æœºåˆ¶**ï¼š

```python
# Pythonç¼“å­˜äº†-5åˆ°256çš„æ•´æ•°
a = 10
b = 10
print(a is b)  # True - æŒ‡å‘åŒä¸€ä¸ªç¼“å­˜å¯¹è±¡

# å¤§æ•´æ•°ä¸ç¼“å­˜
a = 1000
b = 1000
print(a is b)  # Falseï¼ˆé€šå¸¸ï¼Œå–å†³äºå®ç°ï¼‰
print(a == b)  # True - ä½†å€¼ç›¸ç­‰
```

#### 3.7ã€è¿ç®—ç¬¦ä¼˜å…ˆçº§

ä»é«˜åˆ°ä½æ’åˆ—ï¼š

| ä¼˜å…ˆçº§ | è¿ç®—ç¬¦ | è¯´æ˜ |
|-------|--------|------|
| 1 | `**` | å¹‚è¿ç®— |
| 2 | `~`, `+x`, `-x` | æŒ‰ä½å–åã€æ­£å·ã€è´Ÿå· |
| 3 | `*`, `/`, `//`, `%` | ä¹˜ã€é™¤ã€æ•´é™¤ã€å–æ¨¡ |
| 4 | `+`, `-` | åŠ ã€å‡ |
| 5 | `<<`, `>>` | ä½ç§» |
| 6 | `&` | æŒ‰ä½ä¸ |
| 7 | `^` | æŒ‰ä½å¼‚æˆ– |
| 8 | `\|` | æŒ‰ä½æˆ– |
| 9 | `==`, `!=`, `>`, `<`, `>=`, `<=`, `is`, `is not`, `in`, `not in` | æ¯”è¾ƒè¿ç®— |
| 10 | `not` | é€»è¾‘é |
| 11 | `and` | é€»è¾‘ä¸ |
| 12 | `or` | é€»è¾‘æˆ– |

**å®ä¾‹**ï¼š

```python
# å¤æ‚è¡¨è¾¾å¼
result = 2 + 3 * 4 ** 2  # å…ˆå¹‚è¿ç®—(16)ï¼Œå†ä¹˜æ³•(48)ï¼Œæœ€ååŠ æ³•(50)
print(result)  # 50

# å»ºè®®ï¼šå¤æ‚è¡¨è¾¾å¼åŠ æ‹¬å·æé«˜å¯è¯»æ€§
result = 2 + (3 * (4 ** 2))  # æ›´æ¸…æ™°

# é€»è¾‘è¿ç®—
x = 5
result = x > 3 and x < 10 or x == 0  # (x > 3 and x < 10) or (x == 0)
print(result)  # True
```

**ä¸‰å…ƒè¿ç®—ç¬¦**ï¼ˆPythonç‰ˆæœ¬ï¼‰ï¼š

```python
# Pythonçš„ä¸‰å…ƒè¡¨è¾¾å¼
age = 25
status = "æˆå¹´" if age >= 18 else "æœªæˆå¹´"

# å¯¹æ¯”Java
// String status = age >= 18 ? "æˆå¹´" : "æœªæˆå¹´";

# å¯ä»¥åµŒå¥—ï¼ˆä½†ä¸æ¨èï¼Œå½±å“å¯è¯»æ€§ï¼‰
score = 85
grade = "ä¼˜ç§€" if score >= 90 else "è‰¯å¥½" if score >= 80 else "åŠæ ¼" if score >= 60 else "ä¸åŠæ ¼"
```

**æµ·è±¡è¿ç®—ç¬¦ := ï¼ˆPython 3.8+ï¼‰**

åœ¨è¡¨è¾¾å¼ä¸­èµ‹å€¼ï¼š

```python
# ä¼ ç»Ÿå†™æ³•
n = len(some_list)
if n > 10:
    print(f"åˆ—è¡¨å¾ˆé•¿ï¼Œæœ‰{n}ä¸ªå…ƒç´ ")

# ä½¿ç”¨æµ·è±¡è¿ç®—ç¬¦
if (n := len(some_list)) > 10:
    print(f"åˆ—è¡¨å¾ˆé•¿ï¼Œæœ‰{n}ä¸ªå…ƒç´ ")

# åœ¨whileå¾ªç¯ä¸­ç‰¹åˆ«æœ‰ç”¨
while (line := file.readline()) != "":
    process(line)
```

**å°ç»“å¯¹æ¯”**

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| é™¤æ³• | `/`è¿”å›æ•´æ•° | `/`æ€»æ˜¯è¿”å›æµ®ç‚¹æ•° |
| æ•´é™¤ | ç”¨`/` | ä¸“é—¨çš„`//` |
| å¹‚è¿ç®— | `Math.pow()` | `**`è¿ç®—ç¬¦ |
| é€»è¾‘è¿ç®— | `&&`, `\|\|`, `!` | `and`, `or`, `not` |
| æˆå‘˜æ£€æŸ¥ | `contains()` | `in`, `not in` |
| èº«ä»½æ£€æŸ¥ | `==` | `is`, `is not` |
| ä¸‰å…ƒè¿ç®— | `a ? b : c` | `b if a else c` |
| é“¾å¼æ¯”è¾ƒ | ä¸æ”¯æŒ | `a < b < c` |

### 4ã€æ§åˆ¶æµ

Pythonçš„æ§åˆ¶æµè¯­æ³•æ¯”Javaç®€æ´ï¼Œç”¨ç¼©è¿›ä»£æ›¿èŠ±æ‹¬å·ï¼Œå¼ºåˆ¶å†™å‡ºæ›´æ¸…æ™°çš„ä»£ç ç»“æ„ã€‚

#### 4.1ã€if-elif-elseæ¡ä»¶è¯­å¥

**åŸºæœ¬è¯­æ³•**

```python
age = 25

# ç®€å•ifè¯­å¥
if age >= 18:
    print("æˆå¹´äºº")

# if-else
if age >= 18:
    print("æˆå¹´äºº")
else:
    print("æœªæˆå¹´")

# if-elif-elseï¼ˆç›¸å½“äºJavaçš„if-else if-elseï¼‰
if age < 18:
    print("å°‘å¹´")
elif age < 60:
    print("æˆå¹´")
else:
    print("è€å¹´")
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦èŠ±æ‹¬å·
if (age >= 18) {
    System.out.println("æˆå¹´äºº");
} else if (age < 60) {
    System.out.println("æˆå¹´");
} else {
    System.out.println("è€å¹´");
}
```

**Pythonçš„ä¼˜åŠ¿**ï¼š

```python
# é“¾å¼æ¯”è¾ƒ
score = 85
if 90 <= score <= 100:
    grade = "A"
elif 80 <= score < 90:
    grade = "B"
elif 70 <= score < 80:
    grade = "C"
else:
    grade = "D"

# æˆå‘˜è¿ç®—ç¬¦è®©æ¡ä»¶æ›´ç®€æ´
command = "start"
if command in ["start", "run", "begin"]:
    print("å¯åŠ¨ç¨‹åº")
elif command in ["stop", "end", "quit"]:
    print("åœæ­¢ç¨‹åº")
else:
    print("æœªçŸ¥å‘½ä»¤")
```

**åˆ©ç”¨Pythonçš„"çœŸå€¼"ç‰¹æ€§**ï¼š

```python
# âœ… Pythonicå†™æ³•
name = input("è¯·è¾“å…¥å§“å: ")
if name:  # ç©ºå­—ç¬¦ä¸²ä¸ºFalse
    print(f"æ¬¢è¿, {name}")
else:
    print("å§“åä¸èƒ½ä¸ºç©º")

# âœ… æ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©º
users = get_users()
if users:  # ç©ºåˆ—è¡¨ä¸ºFalse
    for user in users:
        print(user)
else:
    print("æ²¡æœ‰ç”¨æˆ·")

# å¯¹æ¯”Java
// if (name != null && !name.isEmpty()) { ... }
// if (users != null && !users.isEmpty()) { ... }
```

#### 4.2ã€whileå¾ªç¯

**åŸºæœ¬è¯­æ³•**

```python
# ç®€å•whileå¾ªç¯
count = 0
while count < 5:
    print(f"ç¬¬{count + 1}æ¬¡å¾ªç¯")
    count += 1  # Pythonæ²¡æœ‰++è¿ç®—ç¬¦

# æ— é™å¾ªç¯
while True:
    user_input = input("è¾“å…¥'quit'é€€å‡º: ")
    if user_input == "quit":
        break
    print(f"ä½ è¾“å…¥äº†: {user_input}")
```

å¯¹æ¯”Javaï¼š
```java
// Java
int count = 0;
while (count < 5) {
    System.out.println("ç¬¬" + (count + 1) + "æ¬¡å¾ªç¯");
    count++;  // Javaæœ‰++è¿ç®—ç¬¦
}
```

**while-elseï¼ˆPythonç‹¬æœ‰ï¼‰**

```python
# whileæ­£å¸¸ç»“æŸæ—¶æ‰§è¡Œelse
search_list = [1, 3, 5, 7, 9]
target = 6

while search_list:
    item = search_list.pop(0)
    if item == target:
        print(f"æ‰¾åˆ°äº†: {target}")
        break
else:
    print(f"æ²¡æ‰¾åˆ°: {target}")  # åªæœ‰whileæ­£å¸¸ç»“æŸæ‰æ‰§è¡Œ

# å¦‚æœç”¨breaké€€å‡ºï¼Œelseä¸ä¼šæ‰§è¡Œ
```

#### 4.3ã€forå¾ªç¯ä¸è¿­ä»£å™¨

è¿™æ˜¯Pythonæœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼

**éå†åºåˆ—**

```python
# éå†åˆ—è¡¨
fruits = ["è‹¹æœ", "é¦™è•‰", "æ©™å­"]
for fruit in fruits:
    print(fruit)

# éå†å­—ç¬¦ä¸²
for char in "Python":
    print(char)

# éå†å­—å…¸
user = {"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}

# éå†é”®
for key in user:
    print(key)

# éå†å€¼
for value in user.values():
    print(value)

# éå†é”®å€¼å¯¹
for key, value in user.items():
    print(f"{key}: {value}")
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦æ›´å¤šä»£ç 
List<String> fruits = Arrays.asList("è‹¹æœ", "é¦™è•‰", "æ©™å­");

// ä¼ ç»Ÿforå¾ªç¯
for (int i = 0; i < fruits.size(); i++) {
    System.out.println(fruits.get(i));
}

// å¢å¼ºforå¾ªç¯
for (String fruit : fruits) {
    System.out.println(fruit);
}
```

**enumerate() - åŒæ—¶è·å–ç´¢å¼•å’Œå€¼**

```python
fruits = ["è‹¹æœ", "é¦™è•‰", "æ©™å­"]

# åŒæ—¶è·å–ç´¢å¼•å’Œå€¼
for index, fruit in enumerate(fruits):
    print(f"{index}: {fruit}")

# ä»æŒ‡å®šç´¢å¼•å¼€å§‹
for index, fruit in enumerate(fruits, start=1):
    print(f"ç¬¬{index}ä¸ª: {fruit}")
```

**zip() - å¹¶è¡Œéå†å¤šä¸ªåºåˆ—**

```python
names = ["å¼ ä¸‰", "æå››", "ç‹äº”"]
ages = [25, 30, 35]
cities = ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·"]

# å¹¶è¡Œéå†
for name, age, city in zip(names, ages, cities):
    print(f"{name}, {age}å², æ¥è‡ª{city}")

# ç»“æœï¼š
# å¼ ä¸‰, 25å², æ¥è‡ªåŒ—äº¬
# æå››, 30å², æ¥è‡ªä¸Šæµ·
# ç‹äº”, 35å², æ¥è‡ªå¹¿å·
```

#### 4.4ã€range()å‡½æ•°

ä¸“é—¨ç”¨äºç”Ÿæˆæ•°å­—åºåˆ—ï¼Œåœ¨forå¾ªç¯ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚

```python
# range(stop) - ä»0å¼€å§‹
for i in range(5):
    print(i)  # 0, 1, 2, 3, 4

# range(start, stop) - æŒ‡å®šå¼€å§‹å’Œç»“æŸ
for i in range(2, 8):
    print(i)  # 2, 3, 4, 5, 6, 7

# range(start, stop, step) - æŒ‡å®šæ­¥é•¿
for i in range(0, 10, 2):
    print(i)  # 0, 2, 4, 6, 8

# åå‘
for i in range(10, 0, -1):
    print(i)  # 10, 9, 8, 7, 6, 5, 4, 3, 2, 1

# ç”Ÿæˆåˆ—è¡¨ï¼ˆä½†é€šå¸¸ä¸éœ€è¦ï¼‰
numbers = list(range(5))  # [0, 1, 2, 3, 4]
```

**å®ç”¨åœºæ™¯**ï¼š

```python
# ä¼ ç»Ÿçš„Cé£æ ¼å¾ªç¯
data = ["a", "b", "c", "d"]
for i in range(len(data)):
    print(f"ç´¢å¼•{i}: {data[i]}")

# ä½†æ›´Pythonicçš„æ–¹å¼æ˜¯ç”¨enumerate
for i, item in enumerate(data):
    print(f"ç´¢å¼•{i}: {item}")

# åˆ›å»ºåµŒå¥—åˆ—è¡¨ï¼ˆäºŒç»´æ•°ç»„ï¼‰
matrix = []
for i in range(3):
    row = []
    for j in range(4):
        row.append(i * 4 + j)
    matrix.append(row)
```

#### 4.5ã€breakã€continueã€pass

**break - è·³å‡ºå¾ªç¯**

```python
# åœ¨forå¾ªç¯ä¸­ä½¿ç”¨
for i in range(10):
    if i == 5:
        break
    print(i)  # 0, 1, 2, 3, 4

# åœ¨whileå¾ªç¯ä¸­ä½¿ç”¨
count = 0
while True:
    if count >= 3:
        break
    print(f"è®¡æ•°: {count}")
    count += 1

# åªè·³å‡ºæœ€å†…å±‚å¾ªç¯
for i in range(3):
    for j in range(3):
        if j == 1:
            break  # åªè·³å‡ºå†…å±‚å¾ªç¯
        print(f"i={i}, j={j}")
```

**continue - è·³è¿‡æœ¬æ¬¡å¾ªç¯**

```python
# è·³è¿‡å¶æ•°
for i in range(10):
    if i % 2 == 0:
        continue
    print(i)  # 1, 3, 5, 7, 9

# å¤„ç†æ–‡ä»¶ï¼Œè·³è¿‡ç©ºè¡Œ
lines = ["ç¬¬ä¸€è¡Œ", "", "ç¬¬ä¸‰è¡Œ", "", "ç¬¬äº”è¡Œ"]
for line in lines:
    if not line:  # ç©ºå­—ç¬¦ä¸²ä¸ºFalse
        continue
    print(f"å¤„ç†: {line}")
```

**pass - å ä½ç¬¦**

```python
# åœ¨å¼€å‘ä¸­ä½œä¸ºå ä½ç¬¦
def future_function():
    pass  # æš‚æ—¶ä¸å®ç°ï¼Œé¿å…è¯­æ³•é”™è¯¯

# æ¡ä»¶åˆ†æ”¯å ä½
score = 85
if score >= 90:
    pass  # æš‚æ—¶ä¸å¤„ç†ä¼˜ç§€æƒ…å†µ
elif score >= 60:
    print("åŠæ ¼")
else:
    print("ä¸åŠæ ¼")

# ç±»å®šä¹‰å ä½
class MyClass:
    pass  # æš‚æ—¶ç©ºçš„ç±»

# å¼‚å¸¸å¤„ç†å ä½
try:
    risky_operation()
except SpecificError:
    pass  # å¿½ç•¥ç‰¹å®šé”™è¯¯
```

#### 4.6ã€å¾ªç¯ä¸­çš„elseå­å¥

Pythonç‹¬æœ‰çš„ç‰¹æ€§ï¼Œå¾ˆå¤šäººä¸çŸ¥é“ä½†å¾ˆæœ‰ç”¨ï¼

**for-else**

```python
# elseåœ¨å¾ªç¯æ­£å¸¸ç»“æŸæ—¶æ‰§è¡Œ
numbers = [2, 4, 6, 8]
for num in numbers:
    if num % 2 != 0:  # æŸ¥æ‰¾å¥‡æ•°
        print(f"æ‰¾åˆ°å¥‡æ•°: {num}")
        break
else:
    print("æ‰€æœ‰æ•°å­—éƒ½æ˜¯å¶æ•°")  # å¾ªç¯æ­£å¸¸ç»“æŸæ‰§è¡Œ

# æœç´¢åœºæ™¯
users = ["å¼ ä¸‰", "æå››", "ç‹äº”"]
target = "èµµå…­"

for user in users:
    if user == target:
        print(f"æ‰¾åˆ°ç”¨æˆ·: {user}")
        break
else:
    print(f"ç”¨æˆ· {target} ä¸å­˜åœ¨")  # æ²¡æ‰¾åˆ°æ—¶æ‰§è¡Œ
```

**while-else**

```python
# å¯†ç éªŒè¯ï¼ˆæœ€å¤š3æ¬¡æœºä¼šï¼‰
attempts = 0
max_attempts = 3

while attempts < max_attempts:
    password = input("è¯·è¾“å…¥å¯†ç : ")
    if password == "123456":
        print("å¯†ç æ­£ç¡®ï¼Œç™»å½•æˆåŠŸï¼")
        break
    attempts += 1
    print(f"å¯†ç é”™è¯¯ï¼Œè¿˜æœ‰{max_attempts - attempts}æ¬¡æœºä¼š")
else:
    print("å¯†ç é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œè´¦æˆ·é”å®šï¼")  # å¾ªç¯æ­£å¸¸ç»“æŸæ‰§è¡Œ
```

#### 4.7ã€åµŒå¥—å¾ªç¯ä¸æ€§èƒ½ä¼˜åŒ–

**åµŒå¥—å¾ªç¯**

```python
# ä¹ä¹ä¹˜æ³•è¡¨
for i in range(1, 10):
    for j in range(1, i + 1):
        print(f"{j}Ã—{i}={i*j}", end="\t")
    print()  # æ¢è¡Œ

# æŸ¥æ‰¾é‡å¤å…ƒç´ 
numbers = [1, 2, 3, 4, 2, 5, 3]
duplicates = []

for i in range(len(numbers)):
    for j in range(i + 1, len(numbers)):
        if numbers[i] == numbers[j] and numbers[i] not in duplicates:
            duplicates.append(numbers[i])

print(f"é‡å¤å…ƒç´ : {duplicates}")
```

**æ€§èƒ½ä¼˜åŒ–æŠ€å·§**

```python
# âŒ ä½æ•ˆï¼šæ¯æ¬¡éƒ½è°ƒç”¨len()
data = list(range(1000))
for i in range(len(data)):
    process(data[i])

# âœ… é«˜æ•ˆï¼šç›´æ¥è¿­ä»£
for item in data:
    process(item)

# âŒ ä½æ•ˆï¼šåœ¨å¾ªç¯ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
for i in range(1000):
    result = expensive_calculation()  # æ¯æ¬¡éƒ½è®¡ç®—
    process(i, result)

# âœ… é«˜æ•ˆï¼šæå‰è®¡ç®—
result = expensive_calculation()  # åªè®¡ç®—ä¸€æ¬¡
for i in range(1000):
    process(i, result)

# âŒ ä½æ•ˆï¼šå­—ç¬¦ä¸²æ‹¼æ¥
result = ""
for i in range(1000):
    result += str(i)

# âœ… é«˜æ•ˆï¼šä½¿ç”¨join
result = "".join(str(i) for i in range(1000))
```

#### 4.8ã€å®ç”¨çš„æ§åˆ¶æµæŠ€å·§

**Pythonicçš„ä»£ç æç¤º**

```python
# æç¤ºï¼šè¿™é‡Œå±•ç¤ºçš„ç®€æ´å†™æ³•å°†åœ¨ç¬¬6ç« "æ•°æ®ç»“æ„"ä¸­è¯¦ç»†è®²è§£
# åŒ…æ‹¬åˆ—è¡¨æ¨å¯¼å¼ã€å­—å…¸æ¨å¯¼å¼ç­‰Pythonç‰¹æœ‰è¯­æ³•

# ä¼ ç»Ÿå¾ªç¯ vs Pythonicå†™æ³•
# ä¼ ç»Ÿæ–¹å¼
squares = []
for x in range(10):
    squares.append(x ** 2)

# Pythonicæ–¹å¼ï¼ˆè§ç¬¬6ç« è¯¦è§£ï¼‰
squares = [x ** 2 for x in range(10)]
```

**å¤šä¸ªæ¡ä»¶çš„ä¼˜é›…å¤„ç†**

```python
# ä½¿ç”¨å…ƒç»„
def get_season(month):
    if month in (12, 1, 2):
        return "å†¬å­£"
    elif month in (3, 4, 5):
        return "æ˜¥å­£"
    elif month in (6, 7, 8):
        return "å¤å­£"
    elif month in (9, 10, 11):
        return "ç§‹å­£"
    else:
        return "æ— æ•ˆæœˆä»½"

# ä½¿ç”¨å­—å…¸ï¼ˆæ›´é«˜æ•ˆï¼‰
SEASON_MAP = {
    1: "å†¬å­£", 2: "å†¬å­£", 3: "æ˜¥å­£", 4: "æ˜¥å­£",
    5: "æ˜¥å­£", 6: "å¤å­£", 7: "å¤å­£", 8: "å¤å­£",
    9: "ç§‹å­£", 10: "ç§‹å­£", 11: "ç§‹å­£", 12: "å†¬å­£"
}

def get_season_fast(month):
    return SEASON_MAP.get(month, "æ— æ•ˆæœˆä»½")
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| ä»£ç å— | èŠ±æ‹¬å·`{}` | ç¼©è¿› |
| else if | `else if` | `elif` |
| å¾ªç¯åæ¸…ç† | finallyå— | `else`å­å¥ |
| éå†å®¹å™¨ | å¢å¼ºforå¾ªç¯ | `for item in container` |
| åŒæ—¶è·å–ç´¢å¼• | æ‰‹åŠ¨è®¡æ•° | `enumerate()` |
| å¹¶è¡Œéå† | å¤æ‚ | `zip()` |
| æ•°å­—åºåˆ— | æ‰‹åŠ¨åˆ›å»º | `range()` |
| å ä½ç¬¦ | ç©ºè¯­å¥`;` | `pass` |

Pythonçš„æ§åˆ¶æµè®¾è®¡å“²å­¦æ˜¯"ç®€æ´å³æ˜¯ç¾"ï¼Œç”¨æ›´å°‘çš„ä»£ç å®ç°æ›´æ¸…æ™°çš„é€»è¾‘ï¼

### 5ã€æ•°æ®ç»“æ„ä¸æ¨å¯¼å¼

Pythonçš„å†…ç½®æ•°æ®ç»“æ„éå¸¸å¼ºå¤§ï¼Œæ¯”Javaçš„é›†åˆæ¡†æ¶æ›´ç®€æ´æ˜“ç”¨ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯Pythonçš„æ¨å¯¼å¼è¯­æ³•ï¼Œå®ƒè®©é›†åˆæ“ä½œå˜å¾—æå…¶ä¼˜é›…ã€‚ç†è§£è¿™äº›æ¦‚å¿µæ˜¯æŒæ¡Pythonçš„å…³é”®ã€‚

#### 5.1ã€åˆ—è¡¨ï¼ˆlistï¼‰

åˆ—è¡¨æ˜¯Pythonæœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œç›¸å½“äºJavaçš„ArrayListï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚

**åŸºæœ¬æ“ä½œ**

```python
# åˆ›å»ºåˆ—è¡¨
fruits = ["è‹¹æœ", "é¦™è•‰", "æ©™å­"]
numbers = [1, 2, 3, 4, 5]
mixed = ["Python", 3.14, True, None]  # å¯ä»¥å­˜å‚¨ä¸åŒç±»å‹

# è®¿é—®å…ƒç´ 
print(fruits[0])     # è‹¹æœ
print(fruits[-1])    # æ©™å­ï¼ˆè´Ÿç´¢å¼•ï¼šä»å³å¾€å·¦ï¼‰

# ä¿®æ”¹å…ƒç´ 
fruits[1] = "è‘¡è„"
print(fruits)        # ['è‹¹æœ', 'è‘¡è„', 'æ©™å­']

# åˆ—è¡¨é•¿åº¦
print(len(fruits))   # 3
```

**åˆ—è¡¨æ“ä½œæ–¹æ³•**

```python
fruits = ["è‹¹æœ", "é¦™è•‰"]

# æ·»åŠ å…ƒç´ 
fruits.append("æ©™å­")                # æœ«å°¾æ·»åŠ 
fruits.insert(1, "è‘¡è„")             # æŒ‡å®šä½ç½®æ’å…¥
fruits.extend(["èŠ’æœ", "è‰è“"])        # æ‰¹é‡æ·»åŠ 
print(fruits)  # ['è‹¹æœ', 'è‘¡è„', 'é¦™è•‰', 'æ©™å­', 'èŠ’æœ', 'è‰è“']

# åˆ é™¤å…ƒç´ 
fruits.remove("é¦™è•‰")                # åˆ é™¤æŒ‡å®šå…ƒç´ 
last_fruit = fruits.pop()           # åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ª
second_fruit = fruits.pop(1)        # åˆ é™¤å¹¶è¿”å›æŒ‡å®šä½ç½®
del fruits[0]                       # ç›´æ¥åˆ é™¤æŒ‡å®šä½ç½®

# æŸ¥æ‰¾å…ƒç´ 
if "è‹¹æœ" in fruits:
    index = fruits.index("è‹¹æœ")     # è¿”å›é¦–æ¬¡å‡ºç°çš„ç´¢å¼•
    count = fruits.count("è‹¹æœ")     # ç»Ÿè®¡å‡ºç°æ¬¡æ•°

# æ’åº
numbers = [3, 1, 4, 1, 5, 9]
numbers.sort()                      # åŸåœ°æ’åº
print(numbers)                      # [1, 1, 3, 4, 5, 9]

sorted_nums = sorted([3, 1, 4])     # è¿”å›æ–°åˆ—è¡¨
numbers.reverse()                   # åŸåœ°åè½¬
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦æ›´å¤šä»£ç 
List<String> fruits = new ArrayList<>();
fruits.add("è‹¹æœ");
fruits.add("é¦™è•‰");
fruits.remove("é¦™è•‰");
Collections.sort(fruits);
```

**åˆ—è¡¨åˆ‡ç‰‡**

```python
numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

# åŸºæœ¬åˆ‡ç‰‡
print(numbers[2:5])     # [2, 3, 4]ï¼ˆä¸åŒ…å«ç´¢å¼•5ï¼‰
print(numbers[:3])      # [0, 1, 2]ï¼ˆå‰3ä¸ªï¼‰
print(numbers[7:])      # [7, 8, 9]ï¼ˆä»ç´¢å¼•7åˆ°æœ«å°¾ï¼‰
print(numbers[:])       # å®Œæ•´å¤åˆ¶

# æ­¥é•¿åˆ‡ç‰‡
print(numbers[::2])     # [0, 2, 4, 6, 8]ï¼ˆæ¯éš”ä¸€ä¸ªï¼‰
print(numbers[1::2])    # [1, 3, 5, 7, 9]ï¼ˆå¥‡æ•°ä½ç½®ï¼‰
print(numbers[::-1])    # [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]ï¼ˆåè½¬ï¼‰

# åˆ‡ç‰‡èµ‹å€¼ï¼ˆå¾ˆå¼ºå¤§ï¼ï¼‰
numbers[2:5] = [20, 30, 40]         # æ›¿æ¢ä¸€æ®µ
numbers[2:2] = [15, 25]             # æ’å…¥
numbers[2:4] = []                   # åˆ é™¤
```

**åˆ—è¡¨æ¨å¯¼å¼ï¼ˆList Comprehensionï¼‰**

è¿™æ˜¯Pythonçš„æ€æ‰‹çº§ç‰¹æ€§ï¼

```python
# ä¼ ç»Ÿæ–¹å¼
squares = []
for x in range(10):
    squares.append(x ** 2)

# åˆ—è¡¨æ¨å¯¼å¼ï¼ˆä¸€è¡Œæå®šï¼‰
squares = [x ** 2 for x in range(10)]

# å¸¦æ¡ä»¶çš„æ¨å¯¼å¼
even_squares = [x ** 2 for x in range(10) if x % 2 == 0]
# [0, 4, 16, 36, 64]

# å¤æ‚å¤„ç†
words = ["hello", "world", "python"]
capitalized = [word.upper() for word in words if len(word) > 4]
# ['HELLO', 'WORLD', 'PYTHON']

# åµŒå¥—æ¨å¯¼å¼ï¼ˆæ…ç”¨ï¼Œå½±å“å¯è¯»æ€§ï¼‰
matrix = [[x * y for x in range(3)] for y in range(3)]
# [[0, 0, 0], [0, 1, 2], [0, 2, 4]]
```

#### 5.2ã€å…ƒç»„ï¼ˆtupleï¼‰

å…ƒç»„æ˜¯ä¸å¯å˜çš„åºåˆ—ï¼Œç›¸å½“äºåªè¯»çš„åˆ—è¡¨ã€‚

**åŸºæœ¬ç‰¹æ€§**

```python
# åˆ›å»ºå…ƒç»„
point = (3, 4)
colors = ("çº¢", "ç»¿", "è“")
single = (42,)        # å•å…ƒç´ å…ƒç»„éœ€è¦é€—å·
empty = ()            # ç©ºå…ƒç»„

# æˆ–è€…çœç•¥æ‹¬å·
point = 3, 4
colors = "çº¢", "ç»¿", "è“"

# è®¿é—®å…ƒç´ ï¼ˆå’Œåˆ—è¡¨ä¸€æ ·ï¼‰
print(point[0])       # 3
print(colors[-1])     # è“

# ä¸èƒ½ä¿®æ”¹
# point[0] = 5        # TypeError
```

**å…ƒç»„è§£åŒ…ï¼ˆTuple Unpackingï¼‰**

```python
point = (3, 4)

# è§£åŒ…èµ‹å€¼
x, y = point
print(f"åæ ‡ï¼š({x}, {y})")

# å‡½æ•°è¿”å›å¤šä¸ªå€¼
def get_name_age():
    return "å¼ ä¸‰", 25

name, age = get_name_age()

# äº¤æ¢å˜é‡ï¼ˆPythonç‹¬æœ‰ï¼‰
a, b = 10, 20
a, b = b, a           # äº¤æ¢ï¼Œæ— éœ€ä¸­é—´å˜é‡

# æ‰©å±•è§£åŒ…ï¼ˆPython 3+ï¼‰
numbers = (1, 2, 3, 4, 5)
first, *middle, last = numbers
print(first)          # 1
print(middle)         # [2, 3, 4]
print(last)           # 5
```

**å…ƒç»„çš„ç”¨é€”**

```python
# 1. å‡½æ•°è¿”å›å¤šä¸ªå€¼
def divmod_custom(a, b):
    return a // b, a % b

quotient, remainder = divmod_custom(10, 3)

# 2. ä½œä¸ºå­—å…¸çš„é”®ï¼ˆå¿…é¡»ä¸å¯å˜ï¼‰
locations = {
    (0, 0): "åŸç‚¹",
    (1, 1): "å¯¹è§’çº¿",
    (3, 4): "æŸä¸ªç‚¹"
}

# 3. é…ç½®å’Œå¸¸é‡
DEFAULT_CONFIG = ("localhost", 8080, "utf-8")
HOST, PORT, ENCODING = DEFAULT_CONFIG
```

##### aã€å‘½åå…ƒç»„ï¼ˆnamedtupleï¼‰

æ™®é€šå…ƒç»„é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚`namedtuple`ï¼ˆå‘½åå…ƒç»„ï¼‰è®©ä½ å¯ä»¥é€šè¿‡åç§°è®¿é—®ï¼ŒåŒæ—¶ä¿æŒå…ƒç»„çš„ä¸å¯å˜æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ã€‚

```python
from collections import namedtuple

# å®šä¹‰å‘½åå…ƒç»„
Point = namedtuple('Point', ['x', 'y'])

# åˆ›å»ºå®ä¾‹
p1 = Point(3, 4)
p2 = Point(x=10, y=20)

# é€šè¿‡åç§°è®¿é—®ï¼ˆæ›´æ¸…æ™°ï¼‰
print(p1.x, p1.y)        # 3 4

# ä¹Ÿæ”¯æŒç´¢å¼•è®¿é—®ï¼ˆå…¼å®¹æ™®é€šå…ƒç»„ï¼‰
print(p1[0], p1[1])      # 3 4

# ä¸å¯å˜
# p1.x = 5               # AttributeError
```

**å®šä¹‰æ–¹å¼å¯¹æ¯”**

```python
# æ–¹å¼1ï¼šåˆ—è¡¨å½¢å¼
Point = namedtuple('Point', ['x', 'y'])

# æ–¹å¼2ï¼šç©ºæ ¼åˆ†éš”å­—ç¬¦ä¸²
Point = namedtuple('Point', 'x y')

# æ–¹å¼3ï¼šé€—å·åˆ†éš”å­—ç¬¦ä¸²
Point = namedtuple('Point', 'x, y')
```

**å®é™…åº”ç”¨**

```python
# 1. è¡¨ç¤ºåæ ‡ç‚¹
Point = namedtuple('Point', ['x', 'y'])
p = Point(3, 4)
print(f"åæ ‡: ({p.x}, {p.y})")

# 2. æ•°æ®åº“æŸ¥è¯¢ç»“æœ
Student = namedtuple('Student', ['name', 'age', 'score'])
students = [
    Student('å¼ ä¸‰', 20, 85),
    Student('æå››', 21, 92),
    Student('ç‹äº”', 19, 78)
]

for s in students:
    print(f"{s.name}: {s.score}åˆ†")

# 3. å‡½æ•°è¿”å›å¤šä¸ªå€¼ï¼ˆæ›´æ¸…æ™°ï¼‰
def get_user_info():
    User = namedtuple('User', ['name', 'age', 'email'])
    return User('å¼ ä¸‰', 25, 'zhang@example.com')

user = get_user_info()
print(user.name)    # å¼ ä¸‰
print(user.email)   # zhang@example.com
```

**å¸¸ç”¨æ–¹æ³•**

```python
Point = namedtuple('Point', ['x', 'y'])
p = Point(3, 4)

# è½¬æ¢ä¸ºå­—å…¸
print(p._asdict())
# {'x': 3, 'y': 4}

# æ›¿æ¢å­—æ®µï¼ˆè¿”å›æ–°å¯¹è±¡ï¼‰
p2 = p._replace(x=10)
print(p2)           # Point(x=10, y=4)
print(p)            # Point(x=3, y=4)ï¼ˆåŸå¯¹è±¡ä¸å˜ï¼‰

# å­—æ®µåç§°
print(p._fields)    # ('x', 'y')

# ä»åºåˆ—åˆ›å»º
data = [5, 6]
p3 = Point._make(data)
print(p3)           # Point(x=5, y=6)
```

**æ‰©å±•å‘½åå…ƒç»„**

```python
# æ·»åŠ é»˜è®¤å€¼ï¼ˆPython 3.7+ï¼‰
Point = namedtuple('Point', ['x', 'y'], defaults=[0, 0])
p1 = Point()         # Point(x=0, y=0)
p2 = Point(3)        # Point(x=3, y=0)
p3 = Point(3, 4)     # Point(x=3, y=4)

# ç»§æ‰¿å¹¶æ·»åŠ æ–¹æ³•
from collections import namedtuple

class Point(namedtuple('Point', ['x', 'y'])):
    """æ‰©å±•çš„ç‚¹ç±»"""
    __slots__ = ()  # èŠ‚çœå†…å­˜

    def distance_from_origin(self):
        """è®¡ç®—åˆ°åŸç‚¹çš„è·ç¦»"""
        return (self.x ** 2 + self.y ** 2) ** 0.5

    def __str__(self):
        return f"({self.x}, {self.y})"

p = Point(3, 4)
print(p.distance_from_origin())  # 5.0
print(p)                         # (3, 4)
```

**å¯¹æ¯”æ™®é€šå…ƒç»„**

```python
# æ™®é€šå…ƒç»„ï¼šå¯è¯»æ€§å·®
person = ("å¼ ä¸‰", 25, "åŒ—äº¬")
print(person[0])    # å¼ ä¸‰ï¼ˆéœ€è¦è®°ä½ç´¢å¼•å«ä¹‰ï¼‰
print(person[1])    # 25

# å‘½åå…ƒç»„ï¼šå¯è¯»æ€§å¼º
Person = namedtuple('Person', ['name', 'age', 'city'])
person = Person("å¼ ä¸‰", 25, "åŒ—äº¬")
print(person.name)  # å¼ ä¸‰ï¼ˆè¯­ä¹‰æ¸…æ™°ï¼‰
print(person.age)   # 25
```

**ä¼˜åŠ¿ä¸é™åˆ¶**

ä¼˜åŠ¿ï¼š
- âœ… å¯è¯»æ€§å¼ºï¼ˆé€šè¿‡åç§°è®¿é—®ï¼‰
- âœ… ä¸å¯å˜ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
- âœ… å†…å­˜æ•ˆç‡é«˜ï¼ˆæ¯”å­—å…¸èŠ‚çœå†…å­˜ï¼‰
- âœ… å¯ä»¥ä½œä¸ºå­—å…¸é”®
- âœ… å…¼å®¹æ™®é€šå…ƒç»„ï¼ˆæ”¯æŒç´¢å¼•å’Œè§£åŒ…ï¼‰

é™åˆ¶ï¼š
- âŒ ä¸å¯å˜ï¼ˆä¸èƒ½ä¿®æ”¹å­—æ®µå€¼ï¼‰
- âŒ ä¸æ”¯æŒé»˜è®¤å€¼ï¼ˆPython 3.7ä¹‹å‰ï¼‰
- âŒ å­—æ®µååœ¨å®šä¹‰åä¸èƒ½ä¿®æ”¹

å¯¹æ¯”Javaï¼š

```java
// Javaéœ€è¦å®šä¹‰å®Œæ•´çš„ç±»
public class Point {
    private final int x;
    private final int y;

    public Point(int x, int y) {
        this.x = x;
        this.y = y;
    }

    public int getX() { return x; }
    public int getY() { return y; }
}

// æˆ–ä½¿ç”¨Java 14+ Recordï¼ˆæ›´æ¥è¿‘namedtupleï¼‰
public record Point(int x, int y) {}
```

**ä½•æ—¶ä½¿ç”¨namedtuple**

- âœ… éœ€è¦è½»é‡çº§çš„ä¸å¯å˜æ•°æ®å®¹å™¨
- âœ… è¡¨ç¤ºå›ºå®šå­—æ®µçš„è®°å½•ï¼ˆå¦‚åæ ‡ã€é…ç½®ï¼‰
- âœ… å‡½æ•°è¿”å›å¤šä¸ªå€¼æ—¶æé«˜å¯è¯»æ€§
- âœ… æ›¿ä»£å­—å…¸ä»¥èŠ‚çœå†…å­˜
- âŒ éœ€è¦å¯å˜æ•°æ®æ—¶ï¼ˆç”¨dataclassæˆ–æ™®é€šç±»ï¼‰
- âŒ éœ€è¦å¤æ‚è¡Œä¸ºæ—¶ï¼ˆç”¨æ™®é€šç±»ï¼‰

#### 5.3ã€å­—å…¸ï¼ˆdictï¼‰

å­—å…¸æ˜¯é”®å€¼å¯¹æ˜ å°„ï¼Œç›¸å½“äºJavaçš„HashMapï¼Œä½†ä½¿ç”¨æ›´ç®€å•ã€‚

**åŸºæœ¬æ“ä½œ**

```python
# åˆ›å»ºå­—å…¸
user = {"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}
empty_dict = {}
scores = dict(math=95, english=87, physics=92)

# è®¿é—®å’Œä¿®æ”¹
print(user["name"])          # å¼ ä¸‰
print(user.get("phone"))     # Noneï¼ˆé”®ä¸å­˜åœ¨æ—¶è¿”å›Noneï¼‰
print(user.get("phone", "æœªè®¾ç½®"))  # æœªè®¾ç½®ï¼ˆæä¾›é»˜è®¤å€¼ï¼‰

user["age"] = 26             # ä¿®æ”¹
user["phone"] = "13800138000" # æ·»åŠ æ–°é”®

# åˆ é™¤
del user["city"]             # åˆ é™¤é”®å€¼å¯¹
phone = user.pop("phone")    # åˆ é™¤å¹¶è¿”å›å€¼
last_item = user.popitem()   # åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªé”®å€¼å¯¹
```

**å­—å…¸æ–¹æ³•**

```python
user = {"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}

# è·å–æ‰€æœ‰é”®ã€å€¼ã€é”®å€¼å¯¹
print(user.keys())           # dict_keys(['name', 'age', 'city'])
print(user.values())         # dict_values(['å¼ ä¸‰', 25, 'åŒ—äº¬'])
print(user.items())          # dict_keys([('name', 'å¼ ä¸‰'), ('age', 25), ('city', 'åŒ—äº¬')])

# éå†å­—å…¸
for key in user:
    print(f"{key}: {user[key]}")

for key, value in user.items():
    print(f"{key}: {value}")

# åˆå¹¶å­—å…¸
defaults = {"theme": "dark", "lang": "zh"}
user.update(defaults)        # åˆå¹¶åˆ°userä¸­

# Python 3.9+ åˆå¹¶è¿ç®—ç¬¦
# config = defaults | user
```

**å­—å…¸æ¨å¯¼å¼**

```python
# ä¼ ç»Ÿæ–¹å¼
squares = {}
for x in range(5):
    squares[x] = x ** 2

# å­—å…¸æ¨å¯¼å¼
squares = {x: x ** 2 for x in range(5)}
# {0: 0, 1: 1, 2: 4, 3: 9, 4: 16}

# å¸¦æ¡ä»¶
even_squares = {x: x ** 2 for x in range(10) if x % 2 == 0}

# å¤„ç†ç°æœ‰æ•°æ®
words = ["apple", "banana", "cherry"]
word_lengths = {word: len(word) for word in words}
# {'apple': 5, 'banana': 6, 'cherry': 6}
```

**æœ‰åºå­—å…¸ç‰¹æ€§ï¼ˆPython 3.7+ï¼‰**

```python
# Python 3.7+å­—å…¸ä¿æŒæ’å…¥é¡ºåº
user = {"name": "å¼ ä¸‰", "age": 25}
user["city"] = "åŒ—äº¬"
print(list(user.keys()))  # ['name', 'age', 'city']ï¼ˆä¿æŒé¡ºåºï¼‰

# åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚éœ€æœ‰åºå­—å…¸ï¼š
from collections import OrderedDict
ordered_dict = OrderedDict([("a", 1), ("b", 2)])
```

#### 5.4ã€é›†åˆï¼ˆsetï¼‰

é›†åˆæ˜¯æ— åºä¸”ä¸é‡å¤çš„å…ƒç´ é›†åˆï¼Œç±»ä¼¼Javaçš„HashSetã€‚

**åŸºæœ¬æ“ä½œ**

```python
# åˆ›å»ºé›†åˆ
fruits = {"è‹¹æœ", "é¦™è•‰", "æ©™å­"}
numbers = set([1, 2, 3, 4, 5])
empty_set = set()            # æ³¨æ„ï¼š{}æ˜¯ç©ºå­—å…¸

# æ·»åŠ å’Œåˆ é™¤å…ƒç´ 
fruits.add("è‘¡è„")
fruits.remove("é¦™è•‰")        # ä¸å­˜åœ¨ä¼šæŠ¥é”™
fruits.discard("èŠ’æœ")       # ä¸å­˜åœ¨ä¸æŠ¥é”™
popped = fruits.pop()        # éšæœºåˆ é™¤å¹¶è¿”å›

# æˆå‘˜æ£€æŸ¥ï¼ˆå¾ˆå¿«ï¼ï¼‰
print("è‹¹æœ" in fruits)      # True
```

**é›†åˆè¿ç®—**

```python
set1 = {1, 2, 3, 4, 5}
set2 = {4, 5, 6, 7, 8}

# å¹¶é›†
print(set1 | set2)          # {1, 2, 3, 4, 5, 6, 7, 8}
print(set1.union(set2))

# äº¤é›†
print(set1 & set2)          # {4, 5}
print(set1.intersection(set2))

# å·®é›†
print(set1 - set2)          # {1, 2, 3}
print(set1.difference(set2))

# å¯¹ç§°å·®é›†ï¼ˆå¼‚æˆ–ï¼‰
print(set1 ^ set2)          # {1, 2, 3, 6, 7, 8}
print(set1.symmetric_difference(set2))

# å­é›†å’Œè¶…é›†
print({1, 2}.issubset(set1))     # True
print(set1.issuperset({1, 2}))   # True
```

**é›†åˆæ¨å¯¼å¼**

```python
# å»é‡å¹¶å¤„ç†
numbers = [1, 2, 2, 3, 3, 4, 5]
unique_squares = {x ** 2 for x in numbers}
# {1, 4, 9, 16, 25}

# å®é™…åº”ç”¨ï¼šå»é‡
emails = ["user1@example.com", "user2@example.com", "user1@example.com"]
unique_emails = set(emails)
```

**frozensetï¼ˆä¸å¯å˜é›†åˆï¼‰**

```python
# åˆ›å»ºä¸å¯å˜é›†åˆ
immutable_set = frozenset([1, 2, 3, 4])

# å¯ä»¥ä½œä¸ºå­—å…¸çš„é”®
cache = {
    frozenset([1, 2]): "ç»“æœ1",
    frozenset([3, 4]): "ç»“æœ2"
}

# ä¸èƒ½ä¿®æ”¹
# immutable_set.add(5)  # AttributeError
```

#### 5.5ã€ä¸Javaé›†åˆæ¡†æ¶å¯¹æ¯”

**å¯¹æ¯”è¡¨**

| Python | Java | ç‰¹ç‚¹ |
|--------|------|------|
| `list` | `ArrayList` | åŠ¨æ€æ•°ç»„ï¼Œå¯å˜ |
| `tuple` | æ— ç›´æ¥å¯¹åº” | ä¸å¯å˜åºåˆ— |
| `dict` | `HashMap` | é”®å€¼æ˜ å°„ï¼ŒPython 3.7+æœ‰åº |
| `set` | `HashSet` | æ— åºä¸é‡å¤é›†åˆ |
| `frozenset` | æ— ç›´æ¥å¯¹åº” | ä¸å¯å˜é›†åˆ |

**è¯­æ³•å¯¹æ¯”**

```java
// Java - åˆ›å»ºå’Œæ“ä½œ
List<String> list = new ArrayList<>();
list.add("item");
String item = list.get(0);

Map<String, Integer> map = new HashMap<>();
map.put("key", 42);
Integer value = map.get("key");

Set<String> set = new HashSet<>();
set.add("item");
boolean exists = set.contains("item");
```

```python
# Python - æ›´ç®€æ´
list = ["item"]
list.append("item2")
item = list[0]

dict = {"key": 42}
dict["key2"] = 43
value = dict["key"]

set = {"item"}
set.add("item2")
exists = "item" in set
```

**å®ç”¨æŠ€å·§**

```python
# åˆ—è¡¨å»é‡å¹¶ä¿æŒé¡ºåº
def unique_list(items):
    seen = set()
    result = []
    for item in items:
        if item not in seen:
            seen.add(item)
            result.append(item)
    return result

# æˆ–è€…ç”¨dictï¼ˆPython 3.7+ï¼‰
def unique_list_dict(items):
    # dict.fromkeys å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°å­—å…¸ï¼Œé”®ä¸ºitemsä¸­çš„å…ƒç´ ï¼Œå€¼ä¸ºNone
    return list(dict.fromkeys(items))

# ç»Ÿè®¡å…ƒç´ é¢‘ç‡
from collections import Counter
words = ["apple", "banana", "apple", "cherry", "banana", "apple"]
frequency = Counter(words)
print(frequency)  # Counter({'apple': 3, 'banana': 2, 'cherry': 1})

# é»˜è®¤å€¼å­—å…¸
from collections import defaultdict
# defaultdict åˆ›å»ºä¸€ä¸ªé»˜è®¤å€¼ä¸ºç©ºåˆ—è¡¨çš„dict
groups = defaultdict(list)
for name, score in [("å¼ ä¸‰", 95), ("æå››", 87), ("å¼ ä¸‰", 92)]:
    groups[name].append(score)
print(dict(groups))  # {'å¼ ä¸‰': [95, 92], 'æå››': [87]}
```

**é€‰æ‹©æŒ‡å—**

- **list**ï¼šéœ€è¦æœ‰åºã€å¯å˜ã€å…è®¸é‡å¤çš„åºåˆ—
- **tuple**ï¼šéœ€è¦ä¸å¯å˜çš„åºåˆ—ï¼Œå¦‚åæ ‡ã€é…ç½®
- **dict**ï¼šéœ€è¦é”®å€¼æ˜ å°„ï¼Œå¦‚é…ç½®ã€ç¼“å­˜ã€ç´¢å¼•
- **set**ï¼šéœ€è¦å»é‡ã€å¿«é€Ÿæˆå‘˜æ£€æŸ¥ã€é›†åˆè¿ç®—
- **frozenset**ï¼šéœ€è¦ä¸å¯å˜çš„é›†åˆï¼Œå¦‚å­—å…¸çš„é”®

Pythonçš„æ•°æ®ç»“æ„è®¾è®¡ç²¾å¦™ï¼ŒæŒæ¡å®ƒä»¬å°±èƒ½å†™å‡ºæ›´Pythonicçš„ä»£ç ï¼

### 6ã€å‡½æ•°å®šä¹‰ä¸ä½¿ç”¨

Pythonçš„å‡½æ•°æ¯”Javaçš„æ–¹æ³•æ›´çµæ´»å¼ºå¤§ï¼Œæ”¯æŒå¤šç§å‚æ•°ä¼ é€’æ–¹å¼ï¼Œè€Œä¸”å‡½æ•°æ˜¯"ä¸€ç­‰å…¬æ°‘"ã€‚

#### 6.1ã€å‡½æ•°å®šä¹‰è¯­æ³•

**åŸºæœ¬è¯­æ³•**

```python
# ç®€å•å‡½æ•°
def greet(name):
    return f"Hello, {name}!"

# å¸¦ç±»å‹æ³¨è§£çš„å‡½æ•°ï¼ˆæ¨èï¼‰
def add(a: int, b: int) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ"""
    return a + b

# æ— è¿”å›å€¼çš„å‡½æ•°
def print_info(name: str, age: int) -> None:
    print(f"å§“å: {name}, å¹´é¾„: {age}")

# æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆDocstringï¼‰
def calculate_area(radius: float) -> float:
    """
    è®¡ç®—åœ†çš„é¢ç§¯

    Args:
        radius: åœ†çš„åŠå¾„

    Returns:
        åœ†çš„é¢ç§¯

    Raises:
        ValueError: å½“åŠå¾„ä¸ºè´Ÿæ•°æ—¶
    """
    if radius < 0:
        raise ValueError("åŠå¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
    return 3.14159 * radius ** 2
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦æ›´å¤šæ ·æ¿ä»£ç 
public class MathUtils {
    /**
     * è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
     */
    public static int add(int a, int b) {
        return a + b;
    }

    public static void printInfo(String name, int age) {
        System.out.println("å§“å: " + name + ", å¹´é¾„: " + age);
    }
}
```

#### 6.2ã€å‚æ•°ä¼ é€’

Pythonçš„å‚æ•°ä¼ é€’æœºåˆ¶éå¸¸çµæ´»ï¼Œæ”¯æŒå¤šç§æ–¹å¼ã€‚

**ä½ç½®å‚æ•°**

```python
def introduce(name, age, city):
    return f"æˆ‘å«{name}ï¼Œ{age}å²ï¼Œæ¥è‡ª{city}"

# æŒ‰ä½ç½®ä¼ é€’
result = introduce("å¼ ä¸‰", 25, "åŒ—äº¬")
```

**å…³é”®å­—å‚æ•°**

```python
# å¯ä»¥æŒ‰ä»»æ„é¡ºåºä¼ é€’
result = introduce(city="åŒ—äº¬", name="å¼ ä¸‰", age=25)

# æ··åˆä½¿ç”¨ï¼ˆä½ç½®å‚æ•°å¿…é¡»åœ¨å‰ï¼‰
result = introduce("å¼ ä¸‰", age=25, city="åŒ—äº¬")
```

**é»˜è®¤å‚æ•°**

```python
def greet(name, greeting="Hello", punctuation="!"):
    return f"{greeting}, {name}{punctuation}"

print(greet("å¼ ä¸‰"))                    # Hello, å¼ ä¸‰!
print(greet("å¼ ä¸‰", "ä½ å¥½"))             # ä½ å¥½, å¼ ä¸‰!
print(greet("å¼ ä¸‰", punctuation="ï¼Ÿ"))   # Hello, å¼ ä¸‰ï¼Ÿ

# æ³¨æ„ï¼šé»˜è®¤å‚æ•°çš„é™·é˜±ã€‚åœ¨ Python ä¸­ï¼Œå‡½æ•°çš„é»˜è®¤å‚æ•°åœ¨å‡½æ•°å®šä¹‰æ—¶ï¼ˆdef æ—¶ï¼‰è¢«åˆ›å»ºä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨æ—¶é‡æ–°åˆ›å»ºã€‚
# [] è¿™ä¸ªåˆ—è¡¨å¯¹è±¡åœ¨å‡½æ•°å®šä¹‰æ—¶å°±åˆ›å»ºäº†ï¼Œæ‰€æœ‰åç»­è°ƒç”¨å…±äº«åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚
def append_to_list(item, target_list=[]):  # âŒ å±é™©ï¼
    target_list.append(item)
    return target_list

# æ­£ç¡®çš„å†™æ³•
def append_to_list(item, target_list=None):  # âœ… æ­£ç¡®
    if target_list is None:
        target_list = []
    target_list.append(item)
    return target_list
```

**å¯å˜å‚æ•°ï¼ˆ*args å’Œ **kwargsï¼‰**

```python
# *args - å¯å˜ä½ç½®å‚æ•°
def sum_all(*numbers):
    """è®¡ç®—æ‰€æœ‰æ•°å­—çš„å’Œ"""
    return sum(numbers)

print(sum_all(1, 2, 3, 4, 5))  # 15
print(sum_all(10, 20))         # 30

# **kwargs - å¯å˜å…³é”®å­—å‚æ•°
def create_user(**kwargs):
    """åˆ›å»ºç”¨æˆ·ä¿¡æ¯"""
    user = {}
    for key, value in kwargs.items():
        user[key] = value
    return user

user = create_user(name="å¼ ä¸‰", age=25, city="åŒ—äº¬", job="ç¨‹åºå‘˜")
print(user)  # {'name': 'å¼ ä¸‰', 'age': 25, 'city': 'åŒ—äº¬', 'job': 'ç¨‹åºå‘˜'}

# æ··åˆä½¿ç”¨
def flexible_function(required, *args, **kwargs):
    print(f"å¿…éœ€å‚æ•°: {required}")
    print(f"ä½ç½®å‚æ•°: {args}")
    print(f"å…³é”®å­—å‚æ•°: {kwargs}")

flexible_function("å¿…é¡»çš„", 1, 2, 3, name="å¼ ä¸‰", age=25)
```

**å‚æ•°è§£åŒ…**

```python
# è§£åŒ…åˆ—è¡¨/å…ƒç»„
def calculate(a, b, c):
    return a + b * c

numbers = [2, 3, 4]
result = calculate(*numbers)  # ç›¸å½“äº calculate(2, 3, 4)

# è§£åŒ…å­—å…¸
def greet(name, age, city):
    return f"{name}, {age}å², æ¥è‡ª{city}"

person = {"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}
message = greet(**person)  # ç›¸å½“äº greet(name="å¼ ä¸‰", age=25, city="åŒ—äº¬")
```

#### 6.3ã€è¿”å›å€¼ä¸å¤šè¿”å›å€¼

**å•ä¸ªè¿”å›å€¼**

```python
def square(x):
    return x ** 2

def get_greeting():
    return "Hello, World!"

# æ²¡æœ‰æ˜ç¡®returnï¼Œè¿”å›None
def print_message(msg):
    print(msg)
    # éšå¼è¿”å› None
```

**å¤šè¿”å›å€¼ï¼ˆå…ƒç»„è§£åŒ…ï¼‰**

```python
def get_name_age():
    return "å¼ ä¸‰", 25  # å®é™…è¿”å›å…ƒç»„

# è§£åŒ…æ¥æ”¶
name, age = get_name_age()

def divmod_custom(a, b):
    return a // b, a % b  # å•†å’Œä½™æ•°

quotient, remainder = divmod_custom(17, 5)
print(f"å•†: {quotient}, ä½™æ•°: {remainder}")  # å•†: 3, ä½™æ•°: 2

# å¤æ‚çš„å¤šè¿”å›å€¼
def analyze_data(data):
    total = sum(data)
    count = len(data)
    average = total / count if count > 0 else 0
    return total, count, average, min(data), max(data)

data = [1, 5, 3, 9, 2]
total, count, avg, min_val, max_val = analyze_data(data)
```

#### 6.4ã€å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘

Pythonä¸­å‡½æ•°æ˜¯å¯¹è±¡ï¼Œå¯ä»¥èµ‹å€¼ã€ä¼ é€’ã€å­˜å‚¨ã€‚

**å‡½æ•°èµ‹å€¼**

```python
def greet(name):
    return f"Hello, {name}!"

# å‡½æ•°èµ‹å€¼ç»™å˜é‡
say_hello = greet
print(say_hello("å¼ ä¸‰"))  # Hello, å¼ ä¸‰!

# å‡½æ•°å­˜å‚¨åœ¨æ•°æ®ç»“æ„ä¸­
operations = {
    "add": lambda x, y: x + y,
    "subtract": lambda x, y: x - y,
    "multiply": lambda x, y: x * y
}

result = operations["add"](5, 3)  # 8
```

**å‡½æ•°ä½œä¸ºå‚æ•°**

```python
def apply_operation(numbers, operation):
    """å¯¹æ•°å­—åˆ—è¡¨åº”ç”¨æ“ä½œ"""
    return [operation(x) for x in numbers]

def square(x):
    return x ** 2

def cube(x):
    return x ** 3

numbers = [1, 2, 3, 4, 5]
squares = apply_operation(numbers, square)   # [1, 4, 9, 16, 25]
cubes = apply_operation(numbers, cube)       # [1, 8, 27, 64, 125]

# ä½¿ç”¨å†…ç½®å‡½æ•°
data = ["hello", "WORLD", "Python"]
uppercase = list(map(str.upper, data))      # ['HELLO', 'WORLD', 'PYTHON']
lengths = list(map(len, data))              # [5, 5, 6]
```

**å‡½æ•°è¿”å›å‡½æ•°**

```python
def create_multiplier(factor):
    """åˆ›å»ºä¸€ä¸ªä¹˜æ³•å‡½æ•°"""
    def multiplier(x):
        return x * factor
    return multiplier

double = create_multiplier(2)
triple = create_multiplier(3)

print(double(5))  # 10
print(triple(4))  # 12

# è£…é¥°å™¨çš„åŸºç¡€
def timer_decorator(func):
    import time
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {end - start:.4f}ç§’")
        return result
    return wrapper

@timer_decorator
def slow_function():
    import time
    time.sleep(1)
    return "å®Œæˆ"
```

#### 6.5ã€lambdaè¡¨è¾¾å¼

lambdaæ˜¯åˆ›å»ºåŒ¿åå‡½æ•°çš„ç®€æ´æ–¹å¼ã€‚

**åŸºæœ¬è¯­æ³•**

```python
# åŸºæœ¬lambda
square = lambda x: x ** 2
print(square(5))  # 25

# å¤šå‚æ•°lambda
add = lambda x, y: x + y
print(add(3, 4))  # 7

# å¯¹æ¯”æ™®é€šå‡½æ•°
def square_func(x):
    return x ** 2

# æ•ˆæœç›¸åŒï¼Œä½†lambdaæ›´ç®€æ´
```

**å®é™…åº”ç”¨**

```python
# æ’åº
students = [("å¼ ä¸‰", 85), ("æå››", 92), ("ç‹äº”", 78)]

# æŒ‰æˆç»©æ’åº
by_score = sorted(students, key=lambda student: student[1])
print(by_score)  # [('ç‹äº”', 78), ('å¼ ä¸‰', 85), ('æå››', 92)]

# è¿‡æ»¤
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
evens = list(filter(lambda x: x % 2 == 0, numbers))
print(evens)  # [2, 4, 6, 8, 10]

# æ˜ å°„
squares = list(map(lambda x: x ** 2, range(5)))
print(squares)  # [0, 1, 4, 9, 16]

# å­—å…¸æ“ä½œ
users = [
    {"name": "å¼ ä¸‰", "age": 25},
    {"name": "æå››", "age": 30},
    {"name": "ç‹äº”", "age": 22}
]

# æŒ‰å¹´é¾„æ’åº
sorted_users = sorted(users, key=lambda user: user["age"])
```

#### 6.6ã€ä½œç”¨åŸŸä¸LEGBè§„åˆ™

Pythonä½¿ç”¨LEGBè§„åˆ™è§£æå˜é‡åã€‚

**LEGBè§„åˆ™**

- **L**ocalï¼ˆå±€éƒ¨ä½œç”¨åŸŸï¼‰
- **E**nclosingï¼ˆåµŒå¥—å‡½æ•°çš„å¤–å±‚ä½œç”¨åŸŸï¼‰
- **G**lobalï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰
- **B**uilt-inï¼ˆå†…ç½®ä½œç”¨åŸŸï¼‰

```python
x = "å…¨å±€å˜é‡"

def outer():
    x = "å¤–å±‚å‡½æ•°å˜é‡"

    def inner():
        x = "å†…å±‚å‡½æ•°å˜é‡"
        print(f"å†…å±‚: {x}")  # å†…å±‚å‡½æ•°å˜é‡

    inner()
    print(f"å¤–å±‚: {x}")      # å¤–å±‚å‡½æ•°å˜é‡

outer()
print(f"å…¨å±€: {x}")          # å…¨å±€å˜é‡
```

**globalå’Œnonlocalå…³é”®å­—**

```python
count = 0  # å…¨å±€å˜é‡

def increment_global():
    # åœ¨å‡½æ•°å†…éƒ¨è¯»å–æˆ–ä¿®æ”¹æ¨¡å—çº§åˆ«ï¼ˆå…¨å±€ï¼‰çš„å˜é‡
    global count
    count += 1

def create_counter():
    count = 0  # å±€éƒ¨å˜é‡

    def increment():
        # åœ¨åµŒå¥—å‡½æ•°ä¸­ä¿®æ”¹å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼ˆä¸æ˜¯å…¨å±€å˜é‡ï¼‰
        nonlocal count
        count += 1
        return count

    return increment

# ä½¿ç”¨
increment_global()
print(count)  # 1

counter = create_counter()
print(counter())  # 1
print(counter())  # 2
```

#### 6.7ã€é—­åŒ…

é—­åŒ…æ˜¯å‡½æ•°å’Œå…¶å‘¨å›´çŠ¶æ€çš„ç»„åˆã€‚

**åŸºæœ¬é—­åŒ…**

```python
def create_adder(x):
    def adder(y):
        return x + y  # æ•è·å¤–å±‚å˜é‡x
    return adder

add_5 = create_adder(5)
add_10 = create_adder(10)

print(add_5(3))   # 8
print(add_10(3))  # 13

# æ£€æŸ¥é—­åŒ…å˜é‡
print(add_5.__closure__)  # (<cell at 0x...: int object at 0x...>,)
```

**å®é™…åº”ç”¨**

```python
# è®¡æ•°å™¨
def create_counter(start=0):
    count = start

    def counter():
        nonlocal count
        count += 1
        return count

    def reset():
        nonlocal count
        count = start

    def get_count():
        return count

    # è¿”å›å¤šä¸ªå‡½æ•°
    counter.reset = reset
    counter.get_count = get_count
    return counter

counter = create_counter(10)
print(counter())         # 11
print(counter())         # 12
print(counter.get_count())  # 12
counter.reset()
print(counter())         # 11

# é…ç½®å·¥å‚
def create_formatter(prefix, suffix):
    def formatter(text):
        return f"{prefix}{text}{suffix}"
    return formatter

html_formatter = create_formatter("<p>", "</p>")
markdown_formatter = create_formatter("**", "**")

print(html_formatter("Hello"))     # <p>Hello</p>
print(markdown_formatter("Bold"))  # **Bold**
```

**è£…é¥°å™¨ç®€ä»‹**

```python
# æç¤ºï¼šè£…é¥°å™¨æ˜¯Pythonçš„é‡è¦ç‰¹æ€§ï¼Œå°†åœ¨ç¬¬8ç« "é«˜çº§ç‰¹æ€§"ä¸­è¯¦ç»†è®²è§£
# è¿™é‡Œç®€è¦å±•ç¤ºè£…é¥°å™¨ä¸é—­åŒ…çš„å…³ç³»

def timer_decorator(func):
    """ç®€å•çš„è®¡æ—¶è£…é¥°å™¨ï¼ˆç¬¬8ç« è¯¦è§£ï¼‰"""
    import time
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {end - start:.4f}ç§’")
        return result
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨
@timer_decorator
def slow_function():
    import time
    time.sleep(1)
    return "å®Œæˆ"
```

**ä¸Javaå¯¹æ¯”**

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| å‡½æ•°å®šä¹‰ | å¿…é¡»åœ¨ç±»ä¸­ | å¯ä»¥ç‹¬ç«‹å­˜åœ¨ |
| æ–¹æ³•é‡è½½ | æ”¯æŒï¼ˆä¸åŒå‚æ•°ï¼‰ | ä¸æ”¯æŒï¼ˆç”¨é»˜è®¤å‚æ•°ï¼‰ |
| å¯å˜å‚æ•° | `...`è¯­æ³• | `*args`, `**kwargs` |
| å‡½æ•°å¯¹è±¡ | éœ€è¦æ¥å£/lambda | å‡½æ•°å³å¯¹è±¡ |
| é—­åŒ… | lambdaè¡¨è¾¾å¼ | å®Œæ•´é—­åŒ…æ”¯æŒ |
| ä½œç”¨åŸŸ | å—çº§ä½œç”¨åŸŸ | å‡½æ•°çº§ä½œç”¨åŸŸ |

Pythonçš„å‡½æ•°ç³»ç»Ÿæ¯”Javaæ›´çµæ´»ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ï¼Œèƒ½å†™å‡ºæ›´ç®€æ´ä¼˜é›…çš„ä»£ç ï¼

### 7ã€æ¨¡å—ä¸åŒ…

Pythonçš„æ¨¡å—ç³»ç»Ÿæ¯”Javaçš„åŒ…ç³»ç»Ÿæ›´ç®€å•ç›´è§‚ï¼Œä¸€ä¸ª`.py`æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ–‡ä»¶å¤¹å°±æ˜¯åŒ…ã€‚

#### 7.1ã€æ¨¡å—å¯¼å…¥æ–¹å¼

**importè¯­å¥**

```python
# å¯¼å…¥æ•´ä¸ªæ¨¡å—
import math
print(math.pi)        # 3.141592653589793
print(math.sqrt(16))  # 4.0

import os
print(os.getcwd())    # è·å–å½“å‰å·¥ä½œç›®å½•

# å¯¼å…¥å¤šä¸ªæ¨¡å—
import sys, json, re

# å¯¼å…¥æ—¶é‡å‘½å
import datetime as dt
now = dt.datetime.now()
```

**from...importè¯­å¥**

```python
# å¯¼å…¥æ¨¡å—ä¸­çš„ç‰¹å®šå‡½æ•°/ç±»
from math import pi, sqrt, sin
print(pi)      # ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å‰ç¼€
print(sqrt(16)) # 4.0

# å¯¼å…¥å¤šä¸ª
from os import getcwd, listdir, path

# å¯¼å…¥æ‰€æœ‰ï¼ˆä¸æ¨èï¼‰
from math import *  # å¯èƒ½é€ æˆå‘½åå†²çª

# å¯¼å…¥æ—¶é‡å‘½å
from datetime import datetime as dt
now = dt.now()
```

**importåˆ«å**

```python
# å¸¸è§çš„åˆ«åçº¦å®š
import numpy as np           # æ•°æ®ç§‘å­¦å¸¸ç”¨
import pandas as pd          # æ•°æ®åˆ†æ
import matplotlib.pyplot as plt  # ç»˜å›¾

# è‡ªå®šä¹‰æ¨¡å—åˆ«å
import my_very_long_module_name as short_name
```

å¯¹æ¯”Javaï¼š
```java
// Javaçš„import
import java.util.List;
import java.util.ArrayList;
import java.util.Map;
import java.util.HashMap;

// é™æ€å¯¼å…¥
import static java.lang.Math.PI;
import static java.lang.Math.sqrt;
```

#### 7.2ã€æ¨¡å—æœç´¢è·¯å¾„

PythonæŒ‰ä»¥ä¸‹é¡ºåºæœç´¢æ¨¡å—ï¼š

```python
import sys

# æŸ¥çœ‹æ¨¡å—æœç´¢è·¯å¾„
for path in sys.path:
    print(path)

# 1. å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•
# 2. PYTHONPATHç¯å¢ƒå˜é‡æŒ‡å®šçš„ç›®å½•
# 3. Pythonæ ‡å‡†åº“ç›®å½•
# 4. site-packagesç›®å½•ï¼ˆç¬¬ä¸‰æ–¹åŒ…ï¼‰

# åŠ¨æ€æ·»åŠ æœç´¢è·¯å¾„
sys.path.append('/path/to/my/modules')
sys.path.insert(0, '/priority/path')  # ä¼˜å…ˆæœç´¢
```

**æŸ¥æ‰¾æ¨¡å—ä½ç½®**

```python
import math
print(math.__file__)  # æ˜¾ç¤ºæ¨¡å—æ–‡ä»¶ä½ç½®

# æˆ–è€…ç”¨inspectæ¨¡å—
import inspect
import requests
print(inspect.getfile(requests))
```

#### 7.3ã€`__name__`å˜é‡ä¸å…¥å£ç‚¹

è¿™æ˜¯Pythonæ¨¡å—ç³»ç»Ÿçš„é‡è¦æ¦‚å¿µã€‚

```python
# my_module.py
def hello():
    print("Hello from my_module!")

def main():
    print("è¿™æ˜¯ä¸»ç¨‹åº")
    hello()

# å…³é”®ä»£ç ï¼šæ¨¡å—çš„å…¥å£ç‚¹
if __name__ == "__main__":
    main()
```

**å·¥ä½œåŸç†**

```python
# å½“ç›´æ¥è¿è¡Œè„šæœ¬æ—¶
# python my_module.py
# __name__ çš„å€¼æ˜¯ "__main__"

# å½“è¢«å…¶ä»–æ¨¡å—å¯¼å…¥æ—¶
# import my_module
# __name__ çš„å€¼æ˜¯ "my_module"

# å®é™…åº”ç”¨
def add(a, b):
    return a + b

def multiply(a, b):
    return a * b

# æµ‹è¯•ä»£ç ï¼Œåªåœ¨ç›´æ¥è¿è¡Œæ—¶æ‰§è¡Œ
if __name__ == "__main__":
    # è¿™é‡Œçš„ä»£ç åªåœ¨ç›´æ¥è¿è¡Œæ—¶æ‰§è¡Œï¼Œå¯¼å…¥æ—¶ä¸æ‰§è¡Œ
    print("æµ‹è¯•æ¨¡å—åŠŸèƒ½...")
    print(f"2 + 3 = {add(2, 3)}")
    print(f"4 * 5 = {multiply(4, 5)}")
```

å¯¹æ¯”Javaï¼š
```java
// Javaçš„mainæ–¹æ³•
public class MyClass {
    public static void add(int a, int b) {
        return a + b;
    }

    public static void main(String[] args) {
        // ç¨‹åºå…¥å£ç‚¹
        System.out.println("2 + 3 = " + add(2, 3));
    }
}
```

#### 7.4ã€åŒ…çš„ç»„ç»‡ç»“æ„

åŒ…å°±æ˜¯åŒ…å«`__init__.py`æ–‡ä»¶çš„ç›®å½•ã€‚

**åŸºæœ¬åŒ…ç»“æ„**

```
mypackage/
    __init__.py      # åŒ…çš„åˆå§‹åŒ–æ–‡ä»¶
    module1.py       # æ¨¡å—1
    module2.py       # æ¨¡å—2
    subpackage/      # å­åŒ…
        __init__.py
        submodule.py
```

**åˆ›å»ºåŒ…**

```python
# mypackage/__init__.py
"""
æˆ‘çš„PythonåŒ…
"""

# åŒ…çº§åˆ«çš„å˜é‡
__version__ = "1.0.0"
__author__ = "å¼ ä¸‰"

# å¯¼å…¥å­æ¨¡å—ï¼Œæ–¹ä¾¿ä½¿ç”¨
from .module1 import function1
from .module2 import Class2

# å®šä¹‰åŒ…çš„å…¬å¼€æ¥å£
__all__ = ["function1", "Class2", "helper_function"]

def helper_function():
    return "è¿™æ˜¯åŒ…çº§åˆ«çš„å‡½æ•°"
```

```python
# mypackage/module1.py
def function1():
    return "æ¥è‡ªæ¨¡å—1çš„å‡½æ•°"

def internal_function():
    return "å†…éƒ¨å‡½æ•°"
```

```python
# mypackage/module2.py
class Class2:
    def method(self):
        return "æ¥è‡ªç±»2çš„æ–¹æ³•"
```

#### 7.5ã€`__init__.py`æ–‡ä»¶çš„ä½œç”¨

`__init__.py`è®©ç›®å½•å˜æˆPythonåŒ…ï¼Œå¹¶æ§åˆ¶åŒ…çš„å¯¼å…¥è¡Œä¸ºã€‚

**åŸºæœ¬ä½œç”¨**

```python
# ç©ºçš„__init__.py
# ä»…ä»…è®©ç›®å½•æˆä¸ºåŒ…

# æˆ–è€…åŒ…å«åˆå§‹åŒ–ä»£ç 
print("æ­£åœ¨åˆå§‹åŒ–mypackage...")

# å¯¼å…¥å­æ¨¡å—
from .database import connect
from .utils import helper

# è®¾ç½®åŒ…çº§åˆ«å˜é‡
VERSION = "2.1.0"
DEBUG = False
```

**æ§åˆ¶å¯¼å…¥**

```python
# mypackage/__init__.py
# åªå¯¼å‡ºç‰¹å®šçš„å‡½æ•°/ç±»
from .core import important_function
from .helpers import utility_class

# æ§åˆ¶ from mypackage import * çš„è¡Œä¸º
__all__ = [
    "important_function",
    "utility_class",
    "VERSION"
]

VERSION = "1.0.0"

# åˆå§‹åŒ–ä»£ç 
def _initialize():
    print("åŒ…åˆå§‹åŒ–å®Œæˆ")

_initialize()
```

**ä½¿ç”¨åŒ…**

```python
# å¯¼å…¥åŒ…
import mypackage
print(mypackage.VERSION)
result = mypackage.function1()

# å¯¼å…¥åŒ…ä¸­çš„æ¨¡å—
from mypackage import module1
result = module1.function1()

# å¯¼å…¥ç‰¹å®šåŠŸèƒ½
from mypackage.module2 import Class2
obj = Class2()
```

#### 7.6ã€ç›¸å¯¹å¯¼å…¥ä¸ç»å¯¹å¯¼å…¥

**ç»å¯¹å¯¼å…¥ï¼ˆæ¨èï¼‰**

```python
# æ€»æ˜¯ä»é¡¶çº§åŒ…å¼€å§‹
from mypackage.subpackage import submodule
from mypackage.module1 import function1
import mypackage.database.models
```

**ç›¸å¯¹å¯¼å…¥**

```python
# åœ¨åŒ…å†…éƒ¨ä½¿ç”¨ç›¸å¯¹å¯¼å…¥
# mypackage/module1.py

# å¯¼å…¥åŒçº§æ¨¡å—
from . import module2          # å½“å‰åŒ…çš„module2
from .module2 import Class2    # å½“å‰åŒ…module2çš„Class2

# å¯¼å…¥ä¸Šçº§åŒ…
from .. import parent_module   # ä¸Šçº§åŒ…çš„æ¨¡å—
from ..utils import helper     # ä¸Šçº§åŒ…utilsçš„helper

# å¯¼å…¥å­åŒ…
from .subpackage import submodule  # å­åŒ…çš„æ¨¡å—
```

**æœ€ä½³å®è·µ**

```python
# âœ… æ¨èï¼šä½¿ç”¨ç»å¯¹å¯¼å…¥
from myproject.database import models
from myproject.utils.helpers import format_date

# âœ… åŒ…å†…ç›¸å¯¹å¯¼å…¥ä¹Ÿå¯ä»¥
from .database import models
from ..utils import helpers

# âŒ é¿å…ï¼šéšå¼ç›¸å¯¹å¯¼å…¥ï¼ˆPython 3å·²ç§»é™¤ï¼‰
# import models  # ä¸æ¸…æ¥šæ¥æº
```

#### 7.7ã€å®é™…é¡¹ç›®ç»“æ„ç¤ºä¾‹

**å…¸å‹çš„Pythoné¡¹ç›®ç»“æ„**

```
myproject/
    README.md
    requirements.txt     # ä¾èµ–åˆ—è¡¨
    # æ³¨æ„ï¼šç°ä»£ Python æ¨èä½¿ç”¨ pyproject.tomlï¼ˆPEP 518/621ï¼‰ä½œä¸ºé¦–é€‰æ‰“åŒ…é…ç½®æ–¹å¼ï¼Œä½† setup.py ä»å¹¿æ³›ä½¿ç”¨ï¼Œå°¤å…¶åœ¨æ—§é¡¹ç›®ä¸­
    setup.py            # å®‰è£…è„šæœ¬
    myproject/          # ä¸»åŒ…
        __init__.py
        main.py         # ç¨‹åºå…¥å£
        config.py       # é…ç½®
        models/         # æ•°æ®æ¨¡å‹
            __init__.py
            user.py
            product.py
        views/          # è§†å›¾å±‚
            __init__.py
            api.py
            web.py
        utils/          # å·¥å…·å‡½æ•°
            __init__.py
            helpers.py
            validators.py
        tests/          # æµ‹è¯•ä»£ç 
            __init__.py
            test_models.py
            test_views.py
```

**é…ç½®æ¨¡å—**

```python
# myproject/config.py
import os

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY', 'dev-secret')
    DATABASE_URL = os.environ.get('DATABASE_URL', 'sqlite:///app.db')
    DEBUG = os.environ.get('DEBUG', 'False').lower() == 'true'

class DevelopmentConfig(Config):
    DEBUG = True

class ProductionConfig(Config):
    DEBUG = False

# æ ¹æ®ç¯å¢ƒé€‰æ‹©é…ç½®
config = {
    'development': DevelopmentConfig,
    'production': ProductionConfig,
    'default': DevelopmentConfig
}
```

**ä¸»ç¨‹åºå…¥å£**

```python
# myproject/main.py
from myproject.config import config
from myproject.models import User
from myproject.utils.helpers import format_date

def main():
    cfg = config['default']()
    if cfg.DEBUG:
        print("è¿è¡Œåœ¨è°ƒè¯•æ¨¡å¼")

    # ä¸šåŠ¡é€»è¾‘
    user = User("å¼ ä¸‰", 25)
    print(f"ç”¨æˆ·: {user.name}, æ³¨å†Œæ—¥æœŸ: {format_date(user.created_at)}")

if __name__ == "__main__":
    main()
```

#### 7.8ã€ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†

**ä½¿ç”¨pipå®‰è£…åŒ…**

```bash
# å®‰è£…å•ä¸ªåŒ…
pip install requests

# å®‰è£…ç‰¹å®šç‰ˆæœ¬
pip install django==4.2.0

# ä»requirements.txtå®‰è£…
pip install -r requirements.txt

# å®‰è£…å¼€å‘ç‰ˆæœ¬
pip install git+https://github.com/user/repo.git
```

**requirements.txtç¤ºä¾‹**

```txt
# ç”Ÿäº§ä¾èµ–
Django>=4.1,<5.0
requests>=2.28.0
psycopg2-binary==2.9.3

# å¼€å‘ä¾èµ–ï¼ˆé€šå¸¸æ”¾åœ¨dev-requirements.txtï¼‰
pytest>=7.0.0
black>=22.0.0
flake8>=5.0.0
```

**è™šæ‹Ÿç¯å¢ƒä¸­çš„åŒ…ç®¡ç†**

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv myproject_env

# æ¿€æ´»ç¯å¢ƒ
# Windows
myproject_env\Scripts\activate
# macOS/Linux
source myproject_env/bin/activate

# å®‰è£…åŒ…
pip install -r requirements.txt

# å¯¼å‡ºå½“å‰ç¯å¢ƒçš„åŒ…åˆ—è¡¨
pip freeze > requirements.txt

# é€€å‡ºç¯å¢ƒ
deactivate
```

**ä¸Javaå¯¹æ¯”**

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| åŸºæœ¬å•ä½ | ç±»ï¼ˆå¿…é¡»åœ¨åŒ…ä¸­ï¼‰ | æ¨¡å—ï¼ˆ.pyæ–‡ä»¶ï¼‰ |
| åŒ…å£°æ˜ | `package com.example` | ç›®å½•+`__init__.py` |
| å¯¼å…¥ | `import com.example.Class` | `from package import module` |
| ä¾èµ–ç®¡ç† | Maven/Gradle | pip+requirements.txt |
| é¡¹ç›®ç»“æ„ | å¼ºåˆ¶ç›®å½•ç»“æ„ | çµæ´»çš„ç›®å½•ç»“æ„ |
| æ¨¡å—æœç´¢ | CLASSPATH | sys.path |

**å®ç”¨æŠ€å·§**

```python
# åŠ¨æ€å¯¼å…¥æ¨¡å—
import importlib

module_name = "math"
math_module = importlib.import_module(module_name)
print(math_module.pi)

# æ£€æŸ¥æ¨¡å—æ˜¯å¦å­˜åœ¨
try:
    import optional_module
    HAS_OPTIONAL = True
except ImportError:
    HAS_OPTIONAL = False

# æ¡ä»¶å¯¼å…¥
if HAS_OPTIONAL:
    from optional_module import feature

# å»¶è¿Ÿå¯¼å…¥ï¼ˆåœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼‰
def process_data():
    import pandas as pd  # åªåœ¨éœ€è¦æ—¶å¯¼å…¥
    return pd.DataFrame()

# è·å–æ¨¡å—ä¿¡æ¯
import inspect
import requests

print(f"æ¨¡å—å: {requests.__name__}")
print(f"æ¨¡å—æ–‡ä»¶: {requests.__file__}")
print(f"æ¨¡å—æ–‡æ¡£: {requests.__doc__}")
```

Pythonçš„æ¨¡å—ç³»ç»Ÿè®¾è®¡ç®€æ´ä¼˜é›…ï¼Œæ¯”Javaçš„åŒ…ç³»ç»Ÿæ›´å®¹æ˜“ç†è§£å’Œä½¿ç”¨ã€‚æŒæ¡æ¨¡å—å’ŒåŒ…çš„æ¦‚å¿µï¼Œèƒ½å¸®ä½ æ›´å¥½åœ°ç»„ç»‡ä»£ç å’Œç®¡ç†é¡¹ç›®ï¼

## ä¸‰ã€é¢å‘å¯¹è±¡ç¼–ç¨‹

### 1ã€ç±»ä¸å¯¹è±¡

Pythonçš„é¢å‘å¯¹è±¡ç¼–ç¨‹æ¯”Javaæ›´çµæ´»ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šä¸¥æ ¼çš„è§„åˆ™ï¼Œä½†åŒæ ·å¼ºå¤§ã€‚

#### 1.1ã€ç±»çš„å®šä¹‰

**åŸºæœ¬è¯­æ³•**

```python
# ç®€å•çš„ç±»å®šä¹‰
class Person:
    """è¿™æ˜¯ä¸€ä¸ªäººç±»"""
    pass  # ç©ºç±»ï¼Œå ä½ç¬¦

# å¸¦å±æ€§å’Œæ–¹æ³•çš„ç±»
class Dog:
    """ç‹—ç±»"""

    # ç±»å±æ€§ï¼ˆæ‰€æœ‰å®ä¾‹å…±äº«ï¼‰
    species = "Canis familiaris"

    def bark(self):
        """å®ä¾‹æ–¹æ³•"""
        return "æ±ªæ±ªæ±ªï¼"

# åˆ›å»ºå¯¹è±¡ï¼ˆå®ä¾‹åŒ–ï¼‰
dog = Dog()
print(dog.species)  # Canis familiaris
print(dog.bark())   # æ±ªæ±ªæ±ªï¼
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦æ›´å¤šæ ·æ¿ä»£ç 
public class Dog {
    // ç±»å±æ€§ï¼ˆé™æ€ï¼‰
    public static final String SPECIES = "Canis familiaris";

    // å®ä¾‹æ–¹æ³•
    public String bark() {
        return "æ±ªæ±ªæ±ªï¼";
    }
}

// å®ä¾‹åŒ–
Dog dog = new Dog();
```

#### 1.2ã€æ„é€ å‡½æ•°ï¼ˆ`__init__`ï¼‰

Pythonä½¿ç”¨`__init__`æ–¹æ³•åˆå§‹åŒ–å¯¹è±¡ï¼Œç±»ä¼¼Javaçš„æ„é€ å‡½æ•°ã€‚

**åŸºæœ¬æ„é€ å‡½æ•°**

```python
class Person:
    def __init__(self, name, age):
        """æ„é€ å‡½æ•°ï¼Œåˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨"""
        self.name = name  # å®ä¾‹å±æ€§
        self.age = age

    def introduce(self):
        return f"æˆ‘å«{self.name}ï¼Œ{self.age}å²"

# åˆ›å»ºå¯¹è±¡
person = Person("å¼ ä¸‰", 25)
print(person.introduce())  # æˆ‘å«å¼ ä¸‰ï¼Œ25å²
```

**å¸¦é»˜è®¤å€¼çš„æ„é€ å‡½æ•°**

```python
class User:
    def __init__(self, username, email, is_active=True, role="user"):
        self.username = username
        self.email = email
        self.is_active = is_active
        self.role = role

    def __repr__(self):
        return f"User(username='{self.username}', email='{self.email}')"

# ä½¿ç”¨é»˜è®¤å€¼
user1 = User("å¼ ä¸‰", "zhangsan@example.com")

# è¦†ç›–é»˜è®¤å€¼
user2 = User("æå››", "lisi@example.com", is_active=False, role="admin")
```

å¯¹æ¯”Javaï¼š
```java
// Javaçš„æ„é€ å‡½æ•°
public class Person {
    private String name;
    private int age;

    // æ„é€ å‡½æ•°
    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    // éœ€è¦æ‰‹åŠ¨å†™getter/setter
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
}
```

#### 1.3ã€å®ä¾‹å±æ€§ä¸ç±»å±æ€§

**å®ä¾‹å±æ€§**

```python
class BankAccount:
    def __init__(self, owner, balance=0):
        self.owner = owner      # å®ä¾‹å±æ€§
        self.balance = balance  # æ¯ä¸ªå®ä¾‹ç‹¬ç«‹

    def deposit(self, amount):
        self.balance += amount
        return self.balance

account1 = BankAccount("å¼ ä¸‰", 1000)
account2 = BankAccount("æå››", 2000)

account1.deposit(500)
print(account1.balance)  # 1500
print(account2.balance)  # 2000ï¼ˆäº’ä¸å½±å“ï¼‰
```

**ç±»å±æ€§**

```python
class BankAccount:
    # ç±»å±æ€§ï¼ˆæ‰€æœ‰å®ä¾‹å…±äº«ï¼‰
    bank_name = "Pythoné“¶è¡Œ"
    interest_rate = 0.03
    account_count = 0

    def __init__(self, owner, balance=0):
        self.owner = owner
        self.balance = balance
        # ä¿®æ”¹ç±»å±æ€§ï¼ˆé€šè¿‡ç±»åï¼‰
        BankAccount.account_count += 1

    @classmethod
    def get_account_count(cls):
        """ç±»æ–¹æ³•ï¼Œè®¿é—®ç±»å±æ€§"""
        return cls.account_count

# è®¿é—®ç±»å±æ€§
print(BankAccount.bank_name)  # Pythoné“¶è¡Œ

# å®ä¾‹ä¹Ÿå¯ä»¥è®¿é—®
account = BankAccount("å¼ ä¸‰", 1000)
print(account.bank_name)      # Pythoné“¶è¡Œ

# åˆ›å»ºå¤šä¸ªå®ä¾‹
account1 = BankAccount("å¼ ä¸‰")
account2 = BankAccount("æå››")
print(BankAccount.get_account_count())  # 2
```

**å®ä¾‹å±æ€§ vs ç±»å±æ€§**

```python
class Example:
    class_var = "ç±»å±æ€§"  # ç±»å±æ€§

    def __init__(self, value):
        self.instance_var = value  # å®ä¾‹å±æ€§

# è®¿é—®ç±»å±æ€§
print(Example.class_var)  # ç±»å±æ€§

# å®ä¾‹è®¿é—®
obj1 = Example("å®ä¾‹1")
obj2 = Example("å®ä¾‹2")

print(obj1.instance_var)  # å®ä¾‹1
print(obj2.instance_var)  # å®ä¾‹2

# ä¿®æ”¹ç±»å±æ€§
Example.class_var = "æ–°çš„ç±»å±æ€§"
print(obj1.class_var)  # æ–°çš„ç±»å±æ€§ï¼ˆæ‰€æœ‰å®ä¾‹éƒ½å˜äº†ï¼‰
print(obj2.class_var)  # æ–°çš„ç±»å±æ€§

# æ³¨æ„ï¼šå®ä¾‹èµ‹å€¼ä¼šåˆ›å»ºåŒåçš„å®ä¾‹å±æ€§ï¼Œä¸ä¼šä¿®æ”¹ç±»å±æ€§
obj1.class_var = "å®ä¾‹å±æ€§"
print(obj1.class_var)        # å®ä¾‹å±æ€§ï¼ˆå®ä¾‹çš„ï¼‰
print(obj2.class_var)        # æ–°çš„ç±»å±æ€§ï¼ˆç±»çš„ï¼‰
print(Example.class_var)     # æ–°çš„ç±»å±æ€§ï¼ˆç±»çš„ï¼‰
```

#### 1.4ã€å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•

**å®ä¾‹æ–¹æ³•**

```python
class Calculator:
    def __init__(self, name):
        self.name = name

    # å®ä¾‹æ–¹æ³•ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯self
    def add(self, a, b):
        return a + b

    def greet(self):
        return f"æˆ‘æ˜¯{self.name}è®¡ç®—å™¨"

calc = Calculator("ç§‘å­¦")
print(calc.add(2, 3))   # 5
print(calc.greet())     # æˆ‘æ˜¯ç§‘å­¦è®¡ç®—å™¨
```

**ç±»æ–¹æ³•**

```python
class Date:
    def __init__(self, year, month, day):
        self.year = year
        self.month = month
        self.day = day

    # ç±»æ–¹æ³•ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯clsï¼ˆç±»æœ¬èº«ï¼‰
    @classmethod
    def from_string(cls, date_string):
        """å·¥å‚æ–¹æ³•ï¼šä»å­—ç¬¦ä¸²åˆ›å»ºæ—¥æœŸ"""
        year, month, day = map(int, date_string.split('-'))
        return cls(year, month, day)  # è¿”å›ç±»çš„å®ä¾‹

    @classmethod
    def today(cls):
        """å·¥å‚æ–¹æ³•ï¼šåˆ›å»ºä»Šå¤©çš„æ—¥æœŸ"""
        import datetime
        now = datetime.date.today()
        return cls(now.year, now.month, now.day)

    # é¢å‘ç”¨æˆ·çš„å¯è¯»å­—ç¬¦ä¸²
    def __str__(self):
        return f"{self.year}-{self.month:02d}-{self.day:02d}"

# ä½¿ç”¨ç±»æ–¹æ³•
date1 = Date.from_string("2024-10-26")
date2 = Date.today()
print(date1)  # 2024-10-26
print(date2)  # å½“å‰æ—¥æœŸ
```

**é™æ€æ–¹æ³•**

```python
class MathUtils:
    # é™æ€æ–¹æ³•ï¼šä¸éœ€è¦selfæˆ–cls
    @staticmethod
    def is_even(number):
        """æ£€æŸ¥æ˜¯å¦æ˜¯å¶æ•°"""
        return number % 2 == 0

    @staticmethod
    def factorial(n):
        """è®¡ç®—é˜¶ä¹˜"""
        if n <= 1:
            return 1
        return n * MathUtils.factorial(n - 1)

# ä½¿ç”¨é™æ€æ–¹æ³•ï¼ˆæ— éœ€åˆ›å»ºå®ä¾‹ï¼‰
print(MathUtils.is_even(4))    # True
print(MathUtils.factorial(5))  # 120

# ä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è°ƒç”¨
utils = MathUtils()
print(utils.is_even(3))        # False
```

**ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”**

| æ–¹æ³•ç±»å‹ | ç¬¬ä¸€ä¸ªå‚æ•° | è£…é¥°å™¨ | è®¿é—®æ–¹å¼ | ç”¨é€” |
|---------|-----------|--------|---------|------|
| å®ä¾‹æ–¹æ³• | `self` | æ—  | å®ä¾‹è°ƒç”¨ | æ“ä½œå®ä¾‹æ•°æ® |
| ç±»æ–¹æ³• | `cls` | `@classmethod` | ç±»/å®ä¾‹è°ƒç”¨ | å·¥å‚æ–¹æ³•ã€æ“ä½œç±»å±æ€§ |
| é™æ€æ–¹æ³• | æ—  | `@staticmethod` | ç±»/å®ä¾‹è°ƒç”¨ | å·¥å…·å‡½æ•°ã€ä¸éœ€è¦è®¿é—®ç±»/å®ä¾‹æ•°æ® |

å¯¹æ¯”Javaï¼š
```java
public class Example {
    private String name;

    // å®ä¾‹æ–¹æ³•
    public void instanceMethod() {
        System.out.println(this.name);
    }

    // é™æ€æ–¹æ³•
    public static void staticMethod() {
        System.out.println("é™æ€æ–¹æ³•");
    }
}
```

#### 1.5ã€ç§æœ‰å±æ€§ä¸æ–¹æ³•

Pythonæ²¡æœ‰çœŸæ­£çš„ç§æœ‰å±æ€§ï¼Œä½¿ç”¨å‘½åçº¦å®šæ¥è¡¨ç¤ºã€‚

**å‘½åçº¦å®š**

```python
class BankAccount:
    def __init__(self, owner, balance):
        self.owner = owner             # å…¬å¼€å±æ€§
        self._balance = balance        # å•ä¸‹åˆ’çº¿ï¼šå—ä¿æŠ¤ï¼ˆçº¦å®šï¼‰
        self.__pin = "1234"            # åŒä¸‹åˆ’çº¿ï¼šç§æœ‰ï¼ˆåç§°æ”¹å†™ï¼‰

    def get_balance(self):
        """å…¬å¼€æ–¹æ³•è®¿é—®ç§æœ‰æ•°æ®"""
        return self._balance

    def _internal_method(self):
        """å—ä¿æŠ¤æ–¹æ³•ï¼ˆçº¦å®šï¼‰"""
        return "å†…éƒ¨ä½¿ç”¨"

    def __private_method(self):
        """ç§æœ‰æ–¹æ³•"""
        return "çœŸæ­£çš„ç§æœ‰"

    def check_pin(self, pin):
        return self.__pin == pin

account = BankAccount("å¼ ä¸‰", 1000)

# å…¬å¼€å±æ€§
print(account.owner)         # å¼ ä¸‰

# å—ä¿æŠ¤å±æ€§ï¼ˆå¯ä»¥è®¿é—®ï¼Œä½†ä¸æ¨èï¼‰
print(account._balance)      # 1000

# ç§æœ‰å±æ€§ï¼ˆåç§°æ”¹å†™ä¸º _BankAccount__pinï¼‰
# print(account.__pin)       # AttributeError
print(account._BankAccount__pin)  # 1234ï¼ˆå¼ºåˆ¶è®¿é—®ï¼Œä¸æ¨èï¼‰

# é€šè¿‡å…¬å¼€æ–¹æ³•è®¿é—®
print(account.get_balance())  # 1000
print(account.check_pin("1234"))  # True
```

**æœ€ä½³å®è·µ**

```python
class User:
    def __init__(self, username, password):
        self.username = username      # å…¬å¼€
        self._email = None            # å—ä¿æŠ¤ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰
        self.__password_hash = self._hash_password(password)  # ç§æœ‰

    def _hash_password(self, password):
        """å—ä¿æŠ¤æ–¹æ³•ï¼šå¯†ç å“ˆå¸Œ"""
        # ç®€åŒ–ç¤ºä¾‹
        return hash(password)

    def verify_password(self, password):
        """å…¬å¼€æ–¹æ³•ï¼šéªŒè¯å¯†ç """
        return self.__password_hash == self._hash_password(password)
```

å¯¹æ¯”Javaï¼š
```java
public class BankAccount {
    public String owner;        // å…¬å¼€
    protected double balance;   // å—ä¿æŠ¤
    private String pin;         // ç§æœ‰

    // ç§æœ‰æ–¹æ³•
    private void privateMethod() {
        // ...
    }
}
```

#### 1.6ã€å±æ€§è®¿é—®å™¨ï¼ˆpropertyè£…é¥°å™¨ï¼‰

ä½¿ç”¨`@property`åˆ›å»ºgetterå’Œsetterï¼Œè®©æ–¹æ³•åƒå±æ€§ä¸€æ ·è®¿é—®ã€‚

**åŸºæœ¬ç”¨æ³•**

```python
class Temperature:
    def __init__(self, celsius):
        self._celsius = celsius

    # getter
    @property
    def celsius(self):
        """æ‘„æ°æ¸©åº¦"""
        return self._celsius

    # setter
    @celsius.setter
    def celsius(self, value):
        if value < -273.15:
            raise ValueError("æ¸©åº¦ä¸èƒ½ä½äºç»å¯¹é›¶åº¦")
        self._celsius = value

    # åªè¯»å±æ€§ï¼ˆåªæœ‰getterï¼‰
    @property
    def fahrenheit(self):
        """åæ°æ¸©åº¦ï¼ˆåªè¯»ï¼‰"""
        return self._celsius * 9/5 + 32

# ä½¿ç”¨
temp = Temperature(25)
print(temp.celsius)      # 25ï¼ˆè°ƒç”¨getterï¼‰
print(temp.fahrenheit)   # 77.0

temp.celsius = 30        # è°ƒç”¨setter
print(temp.celsius)      # 30

# temp.fahrenheit = 100  # AttributeErrorï¼ˆåªè¯»ï¼‰
# temp.celsius = -300    # ValueErrorï¼ˆéªŒè¯å¤±è´¥ï¼‰
```

**å®é™…åº”ç”¨**

```python
class Person:
    def __init__(self, name, age):
        self._name = name
        self._age = age

    @property
    def name(self):
        """å§“åï¼ˆåªè¯»ï¼‰"""
        return self._name

    @property
    def age(self):
        """å¹´é¾„"""
        return self._age

    @age.setter
    def age(self, value):
        if not isinstance(value, int):
            raise TypeError("å¹´é¾„å¿…é¡»æ˜¯æ•´æ•°")
        if value < 0 or value > 150:
            raise ValueError("å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´")
        self._age = value

    @property
    def is_adult(self):
        """æ˜¯å¦æˆå¹´ï¼ˆè®¡ç®—å±æ€§ï¼‰"""
        return self._age >= 18

person = Person("å¼ ä¸‰", 25)
print(person.name)       # å¼ ä¸‰
print(person.age)        # 25
print(person.is_adult)   # True

person.age = 30          # ä½¿ç”¨setter
# person.name = "æå››"   # AttributeErrorï¼ˆåªè¯»ï¼‰
```

**åˆ é™¤å™¨ï¼ˆdeleterï¼‰**

```python
class Resource:
    def __init__(self, name):
        self._name = name
        self._loaded = False

    @property
    def name(self):
        return self._name

    @property
    def data(self):
        if not self._loaded:
            print("åŠ è½½æ•°æ®...")
            self._loaded = True
        return f"æ•°æ®: {self._name}"

    @data.deleter
    def data(self):
        """åˆ é™¤æ•°æ®"""
        print("æ¸…ç†æ•°æ®...")
        self._loaded = False

resource = Resource("æ–‡ä»¶.txt")
print(resource.data)     # åŠ è½½æ•°æ®... æ•°æ®: æ–‡ä»¶.txt
print(resource.data)     # æ•°æ®: æ–‡ä»¶.txtï¼ˆå·²åŠ è½½ï¼‰
del resource.data        # æ¸…ç†æ•°æ®...
print(resource.data)     # åŠ è½½æ•°æ®... æ•°æ®: æ–‡ä»¶.txt
```

å¯¹æ¯”Javaï¼š
```java
public class Temperature {
    private double celsius;

    // getter
    public double getCelsius() {
        return celsius;
    }

    // setter
    public void setCelsius(double value) {
        if (value < -273.15) {
            throw new IllegalArgumentException("æ¸©åº¦ä¸èƒ½ä½äºç»å¯¹é›¶åº¦");
        }
        this.celsius = value;
    }

    // è®¡ç®—å±æ€§
    public double getFahrenheit() {
        return celsius * 9/5 + 32;
    }
}

// ä½¿ç”¨
Temperature temp = new Temperature();
temp.setCelsius(25);          // å¿…é¡»è°ƒç”¨æ–¹æ³•
double c = temp.getCelsius(); // å¿…é¡»è°ƒç”¨æ–¹æ³•
```

**propertyçš„ä¼˜åŠ¿**

```python
# Pythonä½¿ç”¨@propertyï¼Œåƒè®¿é—®å±æ€§ä¸€æ ·
person.age = 30        # è‡ªç„¶çš„è¯­æ³•
temp = person.age

# Javaå¿…é¡»è°ƒç”¨æ–¹æ³•
person.setAge(30);     // æ–¹æ³•è°ƒç”¨
int temp = person.getAge();

# Pythonå¯ä»¥åœ¨ä¸ç ´åæ¥å£çš„æƒ…å†µä¸‹æ·»åŠ é€»è¾‘
class Circle:
    def __init__(self, radius):
        self.radius = radius  # æœ€åˆæ˜¯æ™®é€šå±æ€§

    # åæ¥æ·»åŠ éªŒè¯ï¼Œæ— éœ€ä¿®æ”¹è°ƒç”¨ä»£ç 
    @property
    def radius(self):
        return self._radius

    @radius.setter
    def radius(self, value):
        if value < 0:
            raise ValueError("åŠå¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
        self._radius = value
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| ç±»å®šä¹‰ | `class Name { }` | `class Name:` |
| æ„é€ å‡½æ•° | `public Name() { }` | `def __init__(self):` |
| å®ä¾‹å±æ€§ | `private Type field;` | `self.field = value` |
| ç±»å±æ€§ | `static Type field;` | ç±»çº§åˆ«å®šä¹‰ |
| ç§æœ‰æˆå‘˜ | `private` | `__name`ï¼ˆåç§°æ”¹å†™ï¼‰ |
| å—ä¿æŠ¤æˆå‘˜ | `protected` | `_name`ï¼ˆçº¦å®šï¼‰ |
| getter/setter | æ‰‹åŠ¨ç¼–å†™ | `@property` |
| ç±»æ–¹æ³• | `static` | `@classmethod` |
| é™æ€æ–¹æ³• | `static` | `@staticmethod` |

Pythonçš„ç±»è®¾è®¡æ›´ç®€æ´ï¼Œæ²¡æœ‰Javaé‚£ä¹ˆå¤šè®¿é—®ä¿®é¥°ç¬¦ï¼Œé€šè¿‡çº¦å®šå’Œè£…é¥°å™¨å®ç°ç±»ä¼¼åŠŸèƒ½ï¼

### 2ã€ç»§æ‰¿ä¸å¤šæ€

Pythonçš„ç»§æ‰¿æœºåˆ¶æ¯”Javaæ›´çµæ´»ï¼Œæ”¯æŒå¤šç»§æ‰¿ï¼Œå¹¶æœ‰ç‹¬ç‰¹çš„æ–¹æ³•è§£æé¡ºåºï¼ˆMROï¼‰ã€‚

#### 2.1ã€å•ç»§æ‰¿

**åŸºæœ¬è¯­æ³•**

```python
# çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰
class Animal:
    def __init__(self, name):
        self.name = name

    def speak(self):
        return "å‘å‡ºå£°éŸ³"

    def info(self):
        return f"æˆ‘æ˜¯{self.name}"

# å­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰
class Dog(Animal):
    def __init__(self, name, breed):
        # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        super().__init__(name)
        self.breed = breed

    # é‡å†™çˆ¶ç±»æ–¹æ³•
    def speak(self):
        return "æ±ªæ±ªæ±ªï¼"

    # æ–°å¢æ–¹æ³•
    def fetch(self):
        return f"{self.name}å»æ¡çƒäº†"

# ä½¿ç”¨
dog = Dog("æ—ºè´¢", "é‡‘æ¯›")
print(dog.info())     # æˆ‘æ˜¯æ—ºè´¢ï¼ˆç»§æ‰¿è‡ªAnimalï¼‰
print(dog.speak())    # æ±ªæ±ªæ±ªï¼ï¼ˆé‡å†™äº†ï¼‰
print(dog.fetch())    # æ—ºè´¢å»æ¡çƒäº†ï¼ˆæ–°æ–¹æ³•ï¼‰
```

å¯¹æ¯”Javaï¼š
```java
// Javaçš„ç»§æ‰¿
public class Animal {
    protected String name;

    public Animal(String name) {
        this.name = name;
    }

    public String speak() {
        return "å‘å‡ºå£°éŸ³";
    }
}

public class Dog extends Animal {
    private String breed;

    public Dog(String name, String breed) {
        super(name);  // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        this.breed = breed;
    }

    @Override
    public String speak() {
        return "æ±ªæ±ªæ±ªï¼";
    }
}
```

**isinstance()å’Œissubclass()**

```python
class Animal:
    pass

class Dog(Animal):
    pass

dog = Dog()

# isinstance: æ£€æŸ¥å®ä¾‹ç±»å‹
print(isinstance(dog, Dog))     # True
print(isinstance(dog, Animal))  # Trueï¼ˆå­ç±»å®ä¾‹ä¹Ÿæ˜¯çˆ¶ç±»å®ä¾‹ï¼‰
print(isinstance(dog, object))  # Trueï¼ˆæ‰€æœ‰ç±»éƒ½ç»§æ‰¿è‡ªobjectï¼‰

# issubclass: æ£€æŸ¥ç»§æ‰¿å…³ç³»
print(issubclass(Dog, Animal))   # True
print(issubclass(Animal, Dog))   # False
print(issubclass(Dog, object))   # True
```

#### 2.2ã€å¤šç»§æ‰¿ä¸MROï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰

Pythonæ”¯æŒå¤šç»§æ‰¿ï¼Œä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚

**åŸºæœ¬å¤šç»§æ‰¿**

```python
class Flyable:
    def fly(self):
        return "èƒ½é£"

class Swimmable:
    def swim(self):
        return "èƒ½æ¸¸æ³³"

class Duck(Flyable, Swimmable):
    def quack(self):
        return "å˜å˜å˜"

# ä½¿ç”¨
duck = Duck()
print(duck.fly())      # èƒ½é£
print(duck.swim())     # èƒ½æ¸¸æ³³
print(duck.quack())    # å˜å˜å˜
```

**MROï¼ˆMethod Resolution Orderï¼‰**

å½“å¤šä¸ªçˆ¶ç±»æœ‰åŒåæ–¹æ³•æ—¶ï¼ŒPythonä½¿ç”¨C3çº¿æ€§åŒ–ç®—æ³•ç¡®å®šè°ƒç”¨é¡ºåºã€‚

```python
class A:
    def method(self):
        return "Açš„æ–¹æ³•"

class B(A):
    def method(self):
        return "Bçš„æ–¹æ³•"

class C(A):
    def method(self):
        return "Cçš„æ–¹æ³•"

class D(B, C):
    pass

# æŸ¥çœ‹MRO
print(D.__mro__)
# (<class 'D'>, <class 'B'>, <class 'C'>, <class 'A'>, <class 'object'>)

d = D()
print(d.method())  # Bçš„æ–¹æ³•ï¼ˆæŒ‰MROé¡ºåºï¼šD -> B -> C -> Aï¼‰
```

**è±å½¢ç»§æ‰¿é—®é¢˜**

å…¸å‹çš„è±å½¢ç»§æ‰¿ç»“æ„ï¼š
```
     Person
    /      \
Student   Teacher
    \      /
TeachingAssistant
```

ç¤ºä¾‹ä»£ç ï¼š
```python
class Person:
    def __init__(self, name, **kwargs):
        super().__init__(**kwargs)  # ä¸ºæœªæ¥å¤šç»§æ‰¿ç•™æ¥å£
        self.name = name
        print(f"Person.__init__({name})")

class Student(Person):
    def __init__(self, student_id, **kwargs):
        super().__init__(**kwargs)
        self.student_id = student_id
        print(f"Student.__init__({student_id})")

class Teacher(Person):
    def __init__(self, subject, **kwargs):
        super().__init__(**kwargs)
        self.subject = subject
        print(f"Teacher.__init__({subject})")

class TeachingAssistant(Student, Teacher):
    def __init__(self, name, student_id, subject):
        super().__init__(name=name, student_id=student_id, subject=subject)

# åˆ›å»ºå®ä¾‹
ta = TeachingAssistant("å¼ ä¸‰", "S001", "Python")
print("\nMRO:", TeachingAssistant.__mro__)
print(f"\nta.name={ta.name}, ta.student_id={ta.student_id}, ta.subject={ta.subject}")

# è¾“å‡º
Teacher.__init__(Python)
Student.__init__(S001)
Person.__init__(å¼ ä¸‰)

MRO: (<class '__main__.TeachingAssistant'>, <class '__main__.Student'>, <class '__main__.Teacher'>, <class '__main__.Person'>, <class 'object'>)

ta.name=å¼ ä¸‰, ta.student_id=S001, ta.subject=Python

# æ³¨æ„ï¼šè™½ç„¶ MRO é¡ºåºæ˜¯ Student åœ¨ Teacher å‰ï¼Œä½†å› ä¸º Student.__init__ è°ƒç”¨äº† super()ï¼Œè€Œ super() åœ¨ Student ä¸­æŒ‡å‘ Teacherï¼ˆæ ¹æ® MROï¼‰ï¼Œæ‰€ä»¥å®é™…åˆå§‹åŒ–é¡ºåºæ˜¯ Teacher â†’ Student â†’ Personï¼ˆä»æœ€å³çˆ¶ç±»å‘å·¦å›æº¯ï¼‰ã€‚
```

å¯¹æ¯”Javaï¼š
```java
// Javaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½¿ç”¨æ¥å£æ›¿ä»£
public interface Flyable {
    void fly();
}

public interface Swimmable {
    void swim();
}

public class Duck implements Flyable, Swimmable {
    public void fly() {
        System.out.println("èƒ½é£");
    }

    public void swim() {
        System.out.println("èƒ½æ¸¸æ³³");
    }
}
```

#### 2.3ã€super()å‡½æ•°

`super()`ç”¨äºè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œåœ¨å¤šç»§æ‰¿ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚

**åŸºæœ¬ç”¨æ³•**

```python
class Rectangle:
    def __init__(self, width, height):
        self.width = width
        self.height = height

    def area(self):
        return self.width * self.height

class Square(Rectangle):
    def __init__(self, side):
        # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        super().__init__(side, side)

    def perimeter(self):
        return 4 * self.width

square = Square(5)
print(square.area())       # 25
print(square.perimeter())  # 20
```

**å¤šç»§æ‰¿ä¸­çš„super()**

```python
class Base:
    def __init__(self):
        print("Baseåˆå§‹åŒ–")

class A(Base):
    def __init__(self):
        print("Aåˆå§‹åŒ–å¼€å§‹")
        super().__init__()
        print("Aåˆå§‹åŒ–ç»“æŸ")

class B(Base):
    def __init__(self):
        print("Båˆå§‹åŒ–å¼€å§‹")
        super().__init__()
        print("Båˆå§‹åŒ–ç»“æŸ")

class C(A, B):
    def __init__(self):
        print("Cåˆå§‹åŒ–å¼€å§‹")
        super().__init__()  # æŒ‰MROè°ƒç”¨ï¼šC -> A -> B -> Base
        print("Cåˆå§‹åŒ–ç»“æŸ")

c = C()
# è¾“å‡ºï¼š
# Cåˆå§‹åŒ–å¼€å§‹
# Aåˆå§‹åŒ–å¼€å§‹
# Båˆå§‹åŒ–å¼€å§‹
# Baseåˆå§‹åŒ–
# Båˆå§‹åŒ–ç»“æŸ
# Aåˆå§‹åŒ–ç»“æŸ
# Cåˆå§‹åŒ–ç»“æŸ
```

**æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ–¹æ³•**

```python
class Animal:
    def speak(self):
        return "å‘å‡ºå£°éŸ³"

class Dog(Animal):
    def speak(self):
        # è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        parent_sound = super().speak()
        return f"{parent_sound} -> æ±ªæ±ªæ±ªï¼"

    def speak_like_parent(self):
        # ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨
        return Animal.speak(self)

dog = Dog()
print(dog.speak())              # å‘å‡ºå£°éŸ³ -> æ±ªæ±ªæ±ªï¼
print(dog.speak_like_parent())  # å‘å‡ºå£°éŸ³
```

#### 2.4ã€æ–¹æ³•é‡å†™

å­ç±»å¯ä»¥é‡å†™ï¼ˆè¦†ç›–ï¼‰çˆ¶ç±»çš„æ–¹æ³•ã€‚

**ç®€å•é‡å†™**

```python
class Employee:
    def __init__(self, name, salary):
        self.name = name
        self.salary = salary

    def get_bonus(self):
        return self.salary * 0.1  # åŸºæœ¬å¥–é‡‘10%

class Manager(Employee):
    def __init__(self, name, salary, team_size):
        super().__init__(name, salary)
        self.team_size = team_size

    # é‡å†™get_bonusæ–¹æ³•
    def get_bonus(self):
        base_bonus = super().get_bonus()  # è·å–åŸºæœ¬å¥–é‡‘
        team_bonus = self.team_size * 1000  # å›¢é˜Ÿå¥–é‡‘
        return base_bonus + team_bonus

# ä½¿ç”¨
employee = Employee("å¼ ä¸‰", 10000)
manager = Manager("æå››", 15000, 5)

print(employee.get_bonus())  # 1000.0
print(manager.get_bonus())   # 6500.0ï¼ˆ1500 + 5000ï¼‰
```

**é‡å†™ç‰¹æ®Šæ–¹æ³•**

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __str__(self):
        return f"{self.name}ï¼Œ{self.age}å²"

    def __repr__(self):
        return f"Person('{self.name}', {self.age})"

class Student(Person):
    def __init__(self, name, age, grade):
        super().__init__(name, age)
        self.grade = grade

    # é‡å†™__str__
    def __str__(self):
        parent_str = super().__str__()
        return f"{parent_str}ï¼Œ{self.grade}å¹´çº§"

    # é‡å†™__repr__
    def __repr__(self):
        return f"Student('{self.name}', {self.age}, {self.grade})"

student = Student("å¼ ä¸‰", 18, 12)
print(str(student))   # å¼ ä¸‰ï¼Œ18å²ï¼Œ12å¹´çº§
print(repr(student))  # Student('å¼ ä¸‰', 18, 12)
```

#### 2.5ã€å¤šæ€æ€§å®ç°

Pythonçš„å¤šæ€æ˜¯"é¸­å­ç±»å‹"ï¼ˆDuck Typingï¼‰ï¼šå¦‚æœå¯¹è±¡è¡Œä¸ºåƒé¸­å­ï¼Œå°±å¯ä»¥å½“é¸­å­ç”¨ã€‚

**åŸºäºç»§æ‰¿çš„å¤šæ€**

```python
class Shape:
    def area(self):
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°areaæ–¹æ³•")

    def perimeter(self):
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°perimeteræ–¹æ³•")

class Rectangle(Shape):
    def __init__(self, width, height):
        self.width = width
        self.height = height

    def area(self):
        return self.width * self.height

    def perimeter(self):
        return 2 * (self.width + self.height)

class Circle(Shape):
    def __init__(self, radius):
        self.radius = radius

    def area(self):
        return 3.14159 * self.radius ** 2

    def perimeter(self):
        return 2 * 3.14159 * self.radius

# å¤šæ€å‡½æ•°
def print_shape_info(shape):
    """æ¥å—ä»»ä½•Shapeå­ç±»"""
    print(f"é¢ç§¯: {shape.area():.2f}")
    print(f"å‘¨é•¿: {shape.perimeter():.2f}")

# ä½¿ç”¨
rectangle = Rectangle(5, 3)
circle = Circle(4)

print_shape_info(rectangle)
print_shape_info(circle)
```

**é¸­å­ç±»å‹ï¼ˆDuck Typingï¼‰**

```python
# ä¸éœ€è¦ç»§æ‰¿å…³ç³»ï¼Œåªè¦æœ‰ç›¸åŒçš„æ–¹æ³•å°±è¡Œ
class Dog:
    def speak(self):
        return "æ±ªæ±ªæ±ª"

class Cat:
    def speak(self):
        return "å–µå–µå–µ"

class Duck:
    def speak(self):
        return "å˜å˜å˜"

# å¤šæ€å‡½æ•°ï¼ˆä¸æ£€æŸ¥ç±»å‹ï¼‰
def make_animal_speak(animal):
    """åªè¦æœ‰speakæ–¹æ³•å°±è¡Œ"""
    print(animal.speak())

# ä½¿ç”¨
dog = Dog()
cat = Cat()
duck = Duck()

make_animal_speak(dog)   # æ±ªæ±ªæ±ª
make_animal_speak(cat)   # å–µå–µå–µ
make_animal_speak(duck)  # å˜å˜å˜

# ç”šè‡³å¯ä»¥ä¼ å…¥ä»»ä½•æœ‰speakæ–¹æ³•çš„å¯¹è±¡
class Robot:
    def speak(self):
        return "å“”å“”å“”"

make_animal_speak(Robot())  # å“”å“”å“”
```

å¯¹æ¯”Javaï¼š
```java
// Javaéœ€è¦æ˜ç¡®çš„ç»§æ‰¿æˆ–æ¥å£å…³ç³»
public interface Animal {
    String speak();
}

public class Dog implements Animal {
    public String speak() {
        return "æ±ªæ±ªæ±ª";
    }
}

public void makeAnimalSpeak(Animal animal) {
    // å¿…é¡»æ˜¯Animalç±»å‹
    System.out.println(animal.speak());
}
```

#### 2.6ã€æŠ½è±¡åŸºç±»ï¼ˆABCæ¨¡å—ï¼‰

å¦‚æœæƒ³åœ¨Pythonä¸­å¼ºåˆ¶å­ç±»å®ç°æŸäº›æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æŠ½è±¡åŸºç±»ã€‚

**åŸºæœ¬ç”¨æ³•**

```python
from abc import ABC, abstractmethod

# æŠ½è±¡åŸºç±»
class Animal(ABC):
    def __init__(self, name):
        self.name = name

    @abstractmethod
    def speak(self):
        """å­ç±»å¿…é¡»å®ç°"""
        pass

    @abstractmethod
    def move(self):
        """å­ç±»å¿…é¡»å®ç°"""
        pass

    def info(self):
        """å…·ä½“æ–¹æ³•ï¼Œå­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨"""
        return f"æˆ‘æ˜¯{self.name}"

# å…·ä½“å®ç°
class Dog(Animal):
    def speak(self):
        return "æ±ªæ±ªæ±ª"

    def move(self):
        return "è·‘åŠ¨"

# ä½¿ç”¨
# animal = Animal("åŠ¨ç‰©")  # TypeError: ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»
dog = Dog("æ—ºè´¢")
print(dog.speak())  # æ±ªæ±ªæ±ª
print(dog.move())   # è·‘åŠ¨
print(dog.info())   # æˆ‘æ˜¯æ—ºè´¢
```

**æŠ½è±¡å±æ€§**

```python
from abc import ABC, abstractmethod

class Shape(ABC):
    @property
    @abstractmethod
    def area(self):
        """æŠ½è±¡å±æ€§"""
        pass

    @property
    @abstractmethod
    def perimeter(self):
        """æŠ½è±¡å±æ€§"""
        pass

class Rectangle(Shape):
    def __init__(self, width, height):
        self._width = width
        self._height = height

    @property
    def area(self):
        return self._width * self._height

    @property
    def perimeter(self):
        return 2 * (self._width + self._height)

rect = Rectangle(5, 3)
print(rect.area)       # 15
print(rect.perimeter)  # 16
```

**å®é™…åº”ç”¨**

```python
from abc import ABC, abstractmethod

class DataProcessor(ABC):
    """æ•°æ®å¤„ç†æŠ½è±¡åŸºç±»"""

    @abstractmethod
    def load_data(self, source):
        """åŠ è½½æ•°æ®"""
        pass

    @abstractmethod
    def process_data(self, data):
        """å¤„ç†æ•°æ®"""
        pass

    @abstractmethod
    def save_data(self, data, destination):
        """ä¿å­˜æ•°æ®"""
        pass

    def run(self, source, destination):
        """æ¨¡æ¿æ–¹æ³•ï¼ˆå…·ä½“å®ç°ï¼‰"""
        print("å¼€å§‹å¤„ç†...")
        data = self.load_data(source)
        processed = self.process_data(data)
        self.save_data(processed, destination)
        print("å¤„ç†å®Œæˆ!")

class CSVProcessor(DataProcessor):
    def load_data(self, source):
        print(f"ä»CSVåŠ è½½: {source}")
        return ["æ•°æ®1", "æ•°æ®2", "æ•°æ®3"]

    def process_data(self, data):
        print("å¤„ç†CSVæ•°æ®...")
        return [item.upper() for item in data]

    def save_data(self, data, destination):
        print(f"ä¿å­˜åˆ°CSV: {destination}")
        print(f"æ•°æ®: {data}")

# ä½¿ç”¨
processor = CSVProcessor()
processor.run("input.csv", "output.csv")
```

å¯¹æ¯”Javaï¼š
```java
// Javaçš„æŠ½è±¡ç±»
public abstract class Animal {
    private String name;

    public Animal(String name) {
        this.name = name;
    }

    // æŠ½è±¡æ–¹æ³•
    public abstract String speak();

    // å…·ä½“æ–¹æ³•
    public String info() {
        return "æˆ‘æ˜¯" + name;
    }
}

public class Dog extends Animal {
    public Dog(String name) {
        super(name);
    }

    @Override
    public String speak() {
        return "æ±ªæ±ªæ±ª";
    }
}
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Java | Python |
|-----|------|--------|
| å•ç»§æ‰¿ | `extends` | æ‹¬å·è¯­æ³• `(Parent)` |
| å¤šç»§æ‰¿ | ä¸æ”¯æŒï¼ˆç”¨æ¥å£ï¼‰ | æ”¯æŒå¤šç»§æ‰¿ |
| è°ƒç”¨çˆ¶ç±» | `super.method()` | `super().method()` |
| æ–¹æ³•é‡å†™ | `@Override`æ³¨è§£ | ç›´æ¥é‡å†™ï¼ˆæ— éœ€æ³¨è§£ï¼‰ |
| æŠ½è±¡ç±» | `abstract class` | `ABC`+`@abstractmethod` |
| å¤šæ€ | åŸºäºç±»å‹ | é¸­å­ç±»å‹ |
| MRO | ä¸é€‚ç”¨ | C3çº¿æ€§åŒ–ç®—æ³• |

### 3ã€ç‰¹æ®Šæ–¹æ³•ï¼ˆé­”æœ¯æ–¹æ³•ï¼‰

Pythonçš„ç‰¹æ®Šæ–¹æ³•ï¼ˆä¹Ÿå«é­”æœ¯æ–¹æ³•ï¼‰æ˜¯ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾çš„æ–¹æ³•ï¼Œå®ƒä»¬è®©ä½ çš„ç±»èƒ½å¤Ÿä½¿ç”¨Pythonçš„å†…ç½®è¯­æ³•å’Œè¿ç®—ç¬¦ã€‚è¿™æ˜¯Pythoné¢å‘å¯¹è±¡ç¼–ç¨‹çš„ç²¾é«“ä¹‹ä¸€ã€‚

#### 3.1ã€å¯¹è±¡è¡¨ç¤ºï¼š`__str__`å’Œ`__repr__`

è¿™ä¸¤ä¸ªæ–¹æ³•æ§åˆ¶å¯¹è±¡å¦‚ä½•è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

**åŸºæœ¬åŒºåˆ«**

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __str__(self):
        """ç”¨æˆ·å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆç»™äººçœ‹çš„ï¼‰"""
        return f"{self.name}ï¼Œ{self.age}å²"

    def __repr__(self):
        """å¼€å‘è€…å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆç»™ç¨‹åºå‘˜çœ‹çš„ï¼‰"""
        return f"Person('{self.name}', {self.age})"

person = Person("å¼ ä¸‰", 25)

# __str__: ç»™æœ€ç»ˆç”¨æˆ·çœ‹çš„
print(str(person))   # å¼ ä¸‰ï¼Œ25å²
print(person)        # å¼ ä¸‰ï¼Œ25å²ï¼ˆprintä¼šè°ƒç”¨__str__ï¼‰

# __repr__: ç»™å¼€å‘è€…çœ‹çš„ï¼Œåº”è¯¥æ˜¯åˆæ³•çš„Pythonè¡¨è¾¾å¼
print(repr(person))  # Person('å¼ ä¸‰', 25)
print([person])      # [Person('å¼ ä¸‰', 25)]ï¼ˆå®¹å™¨ä¼šè°ƒç”¨__repr__ï¼‰

# äº¤äº’å¼ç¯å¢ƒä¸­
>>> person
Person('å¼ ä¸‰', 25)  # æ˜¾ç¤º__repr__
```

**æœ€ä½³å®è·µ**

```python
class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __repr__(self):
        """å§‹ç»ˆå®ç°__repr__"""
        return f"Point({self.x}, {self.y})"

    def __str__(self):
        """å¯é€‰å®ç°__str__ï¼Œå¦‚æœä¸å®ç°ä¼šä½¿ç”¨__repr__"""
        return f"({self.x}, {self.y})"

# åªå®ç°__repr__çš„ç±»
class Vector:
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __repr__(self):
        return f"Vector({self.x}, {self.y})"
    # æ²¡æœ‰__str__ï¼Œprintæ—¶ä¼šä½¿ç”¨__repr__

point = Point(3, 4)
vector = Vector(1, 2)

print(point)    # (3, 4) - ä½¿ç”¨__str__
print(vector)   # Vector(1, 2) - ä½¿ç”¨__repr__
print(repr(point))  # Point(3, 4)
```

å¯¹æ¯”Javaï¼š

```java
// Javaä½¿ç”¨toString()
public class Person {
    private String name;
    private int age;

    @Override
    public String toString() {
        return name + "ï¼Œ" + age + "å²";
    }
}

// ä½¿ç”¨
Person person = new Person("å¼ ä¸‰", 25);
System.out.println(person);  // å¼ ä¸‰ï¼Œ25å²
```

#### 3.2ã€æ¯”è¾ƒæ–¹æ³•

Pythonæä¾›äº†ä¸°å¯Œçš„æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½æ–¹æ³•ã€‚

**åŸºæœ¬æ¯”è¾ƒæ–¹æ³•**

```python
class Student:
    def __init__(self, name, score):
        self.name = name
        self.score = score

    def __eq__(self, other):
        """ç›¸ç­‰æ¯”è¾ƒ =="""
        if not isinstance(other, Student):
            return False
        return self.score == other.score

    def __lt__(self, other):
        """å°äºæ¯”è¾ƒ <"""
        if not isinstance(other, Student):
            return NotImplemented
        return self.score < other.score

    def __le__(self, other):
        """å°äºç­‰äº <="""
        return self.score <= other.score

    def __gt__(self, other):
        """å¤§äº >"""
        return self.score > other.score

    def __ge__(self, other):
        """å¤§äºç­‰äº >="""
        return self.score >= other.score

    def __ne__(self, other):
        """ä¸ç­‰äº !="""
        return not self.__eq__(other)

    def __repr__(self):
        return f"Student('{self.name}', {self.score})"

# ä½¿ç”¨
student1 = Student("å¼ ä¸‰", 85)
student2 = Student("æå››", 92)
student3 = Student("ç‹äº”", 85)

print(student1 == student3)  # Trueï¼ˆæˆç»©ç›¸åŒï¼‰
print(student1 < student2)   # True
print(student1 <= student3)  # True
print(student2 > student1)   # True

# å¯ä»¥ç”¨äºæ’åº
students = [student2, student1, student3]
sorted_students = sorted(students)
print(sorted_students)  # [Student('å¼ ä¸‰', 85), Student('ç‹äº”', 85), Student('æå››', 92)]
```

**ä½¿ç”¨functoolsç®€åŒ–**

```python
from functools import total_ordering

@total_ordering
class Student:
    """åªéœ€å®ç°__eq__å’Œä¸€ä¸ªæ¯”è¾ƒæ–¹æ³•ï¼Œè‡ªåŠ¨ç”Ÿæˆå…¶ä»–"""
    def __init__(self, name, score):
        self.name = name
        self.score = score

    def __eq__(self, other):
        if not isinstance(other, Student):
            return NotImplemented
        return self.score == other.score

    def __lt__(self, other):
        if not isinstance(other, Student):
            return NotImplemented
        return self.score < other.score

    def __repr__(self):
        return f"Student('{self.name}', {self.score})"

# è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰æ¯”è¾ƒæ–¹æ³•
student1 = Student("å¼ ä¸‰", 85)
student2 = Student("æå››", 92)

print(student1 <= student2)  # Trueï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
print(student1 >= student2)  # Falseï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

#### 3.3ã€å®¹å™¨æ–¹æ³•

è®©ä½ çš„ç±»åƒåˆ—è¡¨ã€å­—å…¸ä¸€æ ·ä½¿ç”¨ã€‚

**åŸºæœ¬å®¹å™¨åè®®**

```python
class MyList:
    """è‡ªå®šä¹‰åˆ—è¡¨ç±»"""
    def __init__(self, items=None):
        self._items = items or []

    def __len__(self):
        """len()å‡½æ•°è°ƒç”¨"""
        return len(self._items)

    def __getitem__(self, index):
        """ç´¢å¼•è®¿é—® obj[index]"""
        return self._items[index]

    def __setitem__(self, index, value):
        """ç´¢å¼•èµ‹å€¼ obj[index] = value"""
        self._items[index] = value

    def __delitem__(self, index):
        """åˆ é™¤ del obj[index]"""
        del self._items[index]

    def __contains__(self, item):
        """æˆå‘˜æ£€æŸ¥ item in obj"""
        return item in self._items

    def __iter__(self):
        """è¿­ä»£ for item in obj"""
        return iter(self._items)

    def __repr__(self):
        return f"MyList({self._items})"

# ä½¿ç”¨
my_list = MyList([1, 2, 3, 4, 5])

print(len(my_list))        # 5
print(my_list[0])          # 1
my_list[0] = 10
print(my_list[0])          # 10
print(3 in my_list)        # True

for item in my_list:
    print(item, end=" ")   # 10 2 3 4 5

del my_list[0]
print(my_list)             # MyList([2, 3, 4, 5])
```

**å­—å…¸å¼è®¿é—®**

```python
class Configuration:
    """é…ç½®ç±»ï¼Œæ”¯æŒå­—å…¸å¼è®¿é—®"""
    def __init__(self):
        self._config = {}

    def __getitem__(self, key):
        """config['key']"""
        return self._config[key]

    def __setitem__(self, key, value):
        """config['key'] = value"""
        self._config[key] = value

    def __delitem__(self, key):
        """del config['key']"""
        del self._config[key]

    def __contains__(self, key):
        """'key' in config"""
        return key in self._config

    def __len__(self):
        return len(self._config)

    def __repr__(self):
        return f"Configuration({self._config})"

# ä½¿ç”¨
config = Configuration()
config['host'] = 'localhost'
config['port'] = 8080

print(config['host'])      # localhost
print('host' in config)    # True
print(len(config))         # 2
```

**åˆ‡ç‰‡æ”¯æŒ**

```python
class SmartList:
    def __init__(self, items):
        self._items = list(items)

    def __getitem__(self, key):
        """æ”¯æŒç´¢å¼•å’Œåˆ‡ç‰‡"""
        if isinstance(key, slice):
            # åˆ‡ç‰‡æ“ä½œ
            return SmartList(self._items[key])
        else:
            # å•ä¸ªç´¢å¼•
            return self._items[key]

    def __len__(self):
        return len(self._items)

    def __repr__(self):
        return f"SmartList({self._items})"

# ä½¿ç”¨
smart = SmartList([1, 2, 3, 4, 5])
print(smart[0])        # 1
print(smart[1:3])      # SmartList([2, 3])
print(smart[::2])      # SmartList([1, 3, 5])
```

#### 3.4ã€å¯è°ƒç”¨å¯¹è±¡ï¼š`__call__`

è®©å¯¹è±¡å¯ä»¥åƒå‡½æ•°ä¸€æ ·è°ƒç”¨ã€‚

**åŸºæœ¬ç”¨æ³•**

```python
class Multiplier:
    """ä¹˜æ³•å™¨ï¼Œåƒå‡½æ•°ä¸€æ ·ä½¿ç”¨"""
    def __init__(self, factor):
        self.factor = factor

    def __call__(self, x):
        """obj(x) ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•"""
        return x * self.factor

# ä½¿ç”¨
double = Multiplier(2)
triple = Multiplier(3)

print(double(5))    # 10
print(triple(5))    # 15

# æ£€æŸ¥æ˜¯å¦å¯è°ƒç”¨
print(callable(double))  # True
```

**å®é™…åº”ç”¨ï¼šç¼“å­˜è£…é¥°å™¨**

```python
class Memoize:
    """ç¼“å­˜å‡½æ•°ç»“æœ"""
    def __init__(self, func):
        self.func = func
        self.cache = {}

    def __call__(self, *args):
        if args not in self.cache:
            print(f"è®¡ç®— {self.func.__name__}{args}")
            self.cache[args] = self.func(*args)
        else:
            print(f"ä»ç¼“å­˜è·å– {args}")
        return self.cache[args]

@Memoize
def fibonacci(n):
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# ä½¿ç”¨
print(fibonacci(5))
# è®¡ç®— fibonacci(5)
# è®¡ç®— fibonacci(4)
# ...
# 21

print(fibonacci(5))  # ä»ç¼“å­˜è·å– (5)
```

**æœ‰çŠ¶æ€çš„å‡½æ•°**

```python
class Counter:
    """è®¡æ•°å™¨å‡½æ•°"""
    def __init__(self):
        self.count = 0

    def __call__(self):
        self.count += 1
        return self.count

counter = Counter()
print(counter())  # 1
print(counter())  # 2
print(counter())  # 3
print(counter.count)  # 3
```

#### 3.5ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç®€ä»‹

> **æç¤º**ï¼šä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„å®Œæ•´ç”¨æ³•ï¼ˆåŒ…æ‹¬`@contextmanager`è£…é¥°å™¨ã€`ExitStack`ç­‰ï¼‰å°†åœ¨ç¬¬8ç« "é«˜çº§ç‰¹æ€§"ä¸­è¯¦ç»†è®²è§£ã€‚

**åŸºæœ¬æ¦‚å¿µ**

ä¸Šä¸‹æ–‡ç®¡ç†å™¨é€šè¿‡å®ç°`__enter__`å’Œ`__exit__`æ–¹æ³•ï¼Œè®©å¯¹è±¡èƒ½å¤Ÿé…åˆ`with`è¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºã€‚

```python
class SimpleFileManager:
    """ç®€å•æ–‡ä»¶ç®¡ç†å™¨ç¤ºä¾‹"""
    def __init__(self, filename, mode):
        self.filename = filename
        self.mode = mode
        self.file = None

    def __enter__(self):
        print(f"æ‰“å¼€æ–‡ä»¶: {self.filename}")
        self.file = open(self.filename, self.mode)
        return self.file

    def __exit__(self, exc_type, exc_value, traceback):
        if self.file:
            print(f"å…³é—­æ–‡ä»¶: {self.filename}")
            self.file.close()

        # è¿”å›Falseè¡¨ç¤ºä¸æŠ‘åˆ¶å¼‚å¸¸
        return False

# ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æº
with SimpleFileManager('test.txt', 'w') as f:
    f.write('Hello, World!')
# æ–‡ä»¶è‡ªåŠ¨å…³é—­
```

**æ ¸å¿ƒåè®®**
- `__enter__(self)`ï¼šè¿›å…¥`with`å—æ—¶è°ƒç”¨ï¼Œè¿”å›è¦èµ‹å€¼ç»™`as`å˜é‡çš„å¯¹è±¡
- `__exit__(self, exc_type, exc_value, traceback)`ï¼šé€€å‡º`with`å—æ—¶è°ƒç”¨ï¼Œå¤„ç†æ¸…ç†å·¥ä½œ


---

### 4ã€ç‰¹æ®Šæ–¹æ³•æ€»ç»“

ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç”¨çš„ç‰¹æ®Šæ–¹æ³•é€ŸæŸ¥è¡¨ï¼š

| æ–¹æ³• | è§¦å‘æ—¶æœº | ç¤ºä¾‹ |
|-----|----------|------|
| `__str__` | `print(obj)` | å¯¹è±¡çš„å¯è¯»å­—ç¬¦ä¸²è¡¨ç¤º |
| `__repr__` | `repr(obj)` | å¯¹è±¡çš„æ˜ç¡®è¡¨ç¤º |
| `__len__` | `len(obj)` | è¿”å›å¯¹è±¡é•¿åº¦ |
| `__getitem__` | `obj[key]` | ç´¢å¼•è®¿é—® |
| `__setitem__` | `obj[key] = value` | ç´¢å¼•èµ‹å€¼ |
| `__call__` | `obj()` | å¯¹è±¡å¯è°ƒç”¨ |
| `__enter__` | `with obj as f:` | è¿›å…¥ä¸Šä¸‹æ–‡ |
| `__exit__` | é€€å‡ºwithå— | é€€å‡ºä¸Šä¸‹æ–‡ |

å¯¹æ¯”Javaï¼š

```java
// Javaä½¿ç”¨try-with-resources
public class FileManager implements AutoCloseable {
    private String filename;

    public FileManager(String filename) {
        this.filename = filename;
    }

    @Override
    public void close() {
        System.out.println("å…³é—­æ–‡ä»¶: " + filename);
    }
}

// ä½¿ç”¨
try (FileManager fm = new FileManager("test.txt")) {
    // ä½¿ç”¨èµ„æº
} // è‡ªåŠ¨å…³é—­
```

#### 4.1ã€è¿ç®—ç¬¦é‡è½½

è®©è‡ªå®šä¹‰ç±»æ”¯æŒå„ç§è¿ç®—ç¬¦ã€‚

**ç®—æœ¯è¿ç®—ç¬¦**

```python
class Vector:
    """äºŒç»´å‘é‡"""
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __add__(self, other):
        """åŠ æ³• +"""
        return Vector(self.x + other.x, self.y + other.y)

    def __sub__(self, other):
        """å‡æ³• -"""
        return Vector(self.x - other.x, self.y - other.y)

    def __mul__(self, scalar):
        """ä¹˜æ³• *"""
        return Vector(self.x * scalar, self.y * scalar)

    def __truediv__(self, scalar):
        """é™¤æ³• /"""
        return Vector(self.x / scalar, self.y / scalar)

    def __abs__(self):
        """ç»å¯¹å€¼ abs()"""
        return (self.x ** 2 + self.y ** 2) ** 0.5

    def __neg__(self):
        """å–è´Ÿ -obj"""
        return Vector(-self.x, -self.y)

    def __eq__(self, other):
        """ç›¸ç­‰ =="""
        return self.x == other.x and self.y == other.y

    def __repr__(self):
        return f"Vector({self.x}, {self.y})"

# ä½¿ç”¨
v1 = Vector(2, 3)
v2 = Vector(1, 1)

print(v1 + v2)    # Vector(3, 4)
print(v1 - v2)    # Vector(1, 2)
print(v1 * 2)     # Vector(4, 6)
print(v1 / 2)     # Vector(1.0, 1.5)
print(abs(v1))    # 3.605551275463989
print(-v1)        # Vector(-2, -3)
print(v1 == v2)   # False
```

**åå‘è¿ç®—ç¬¦**

```python
class Number:
    def __init__(self, value):
        self.value = value

    def __add__(self, other):
        """obj + other"""
        return Number(self.value + other)

    def __radd__(self, other):
        """other + objï¼ˆåå‘åŠ æ³•ï¼‰"""
        return Number(other + self.value)

    def __mul__(self, other):
        """obj * other"""
        return Number(self.value * other)

    def __rmul__(self, other):
        """other * objï¼ˆåå‘ä¹˜æ³•ï¼‰"""
        return Number(other * self.value)

    def __repr__(self):
        return f"Number({self.value})"

# ä½¿ç”¨
num = Number(5)
print(num + 3)    # Number(8) - è°ƒç”¨__add__
print(3 + num)    # Number(8) - è°ƒç”¨__radd__
print(num * 2)    # Number(10) - è°ƒç”¨__mul__
print(2 * num)    # Number(10) - è°ƒç”¨__rmul__
```

**å¢å¼ºèµ‹å€¼è¿ç®—ç¬¦**

```python
class Counter:
    def __init__(self, value=0):
        self.value = value

    def __iadd__(self, other):
        """+="""
        self.value += other
        return self

    def __isub__(self, other):
        """-="""
        self.value -= other
        return self

    def __imul__(self, other):
        """*="""
        self.value *= other
        return self

    def __repr__(self):
        return f"Counter({self.value})"

# ä½¿ç”¨
counter = Counter(10)
counter += 5
print(counter)    # Counter(15)
counter -= 3
print(counter)    # Counter(12)
counter *= 2
print(counter)    # Counter(24)
```

**å®Œæ•´è¿ç®—ç¬¦åˆ—è¡¨**

| è¿ç®—ç¬¦ | æ–¹æ³• | è¯´æ˜ |
|-------|------|------|
| `+` | `__add__` | åŠ æ³• |
| `-` | `__sub__` | å‡æ³• |
| `*` | `__mul__` | ä¹˜æ³• |
| `/` | `__truediv__` | é™¤æ³• |
| `//` | `__floordiv__` | æ•´é™¤ |
| `%` | `__mod__` | å–æ¨¡ |
| `**` | `__pow__` | å¹‚è¿ç®— |
| `&` | `__and__` | æŒ‰ä½ä¸ |
| `\|` | `__or__` | æŒ‰ä½æˆ– |
| `^` | `__xor__` | æŒ‰ä½å¼‚æˆ– |
| `<<` | `__lshift__` | å·¦ç§» |
| `>>` | `__rshift__` | å³ç§» |
| `-obj` | `__neg__` | å–è´Ÿ |
| `+obj` | `__pos__` | å–æ­£ |
| `~obj` | `__invert__` | æŒ‰ä½å–å |

**å®é™…åº”ç”¨ï¼šè´§å¸ç±»**

```python
class Money:
    """è´§å¸ç±»ï¼Œæ”¯æŒè¿ç®—"""
    def __init__(self, amount, currency="CNY"):
        self.amount = amount
        self.currency = currency

    def __add__(self, other):
        if self.currency != other.currency:
            raise ValueError("ä¸åŒå¸ç§ä¸èƒ½ç›¸åŠ ")
        return Money(self.amount + other.amount, self.currency)

    def __sub__(self, other):
        if self.currency != other.currency:
            raise ValueError("ä¸åŒå¸ç§ä¸èƒ½ç›¸å‡")
        return Money(self.amount - other.amount, self.currency)

    def __mul__(self, factor):
        """ä¹˜ä»¥æ•°å­—"""
        return Money(self.amount * factor, self.currency)

    def __truediv__(self, divisor):
        """é™¤ä»¥æ•°å­—"""
        return Money(self.amount / divisor, self.currency)

    def __eq__(self, other):
        return self.amount == other.amount and self.currency == other.currency

    def __lt__(self, other):
        if self.currency != other.currency:
            raise ValueError("ä¸åŒå¸ç§ä¸èƒ½æ¯”è¾ƒ")
        return self.amount < other.amount

    def __repr__(self):
        return f"{self.currency} {self.amount:.2f}"

# ä½¿ç”¨
price1 = Money(100.50, "CNY")
price2 = Money(50.25, "CNY")

total = price1 + price2
print(total)              # CNY 150.75

discount = price1 * 0.8
print(discount)           # CNY 80.40

print(price1 > price2)    # True
```

#### 4.2ã€å…¶ä»–å¸¸ç”¨ç‰¹æ®Šæ–¹æ³•

**`__hash__`ï¼šå¯å“ˆå¸Œå¯¹è±¡**

```python
class Person:
    def __init__(self, name, id_number):
        self.name = name
        self.id_number = id_number

    def __eq__(self, other):
        if not isinstance(other, Person):
            return False
        return self.id_number == other.id_number

    def __hash__(self):
        """ä½¿å¯¹è±¡å¯ä»¥ä½œä¸ºå­—å…¸é”®å’Œé›†åˆå…ƒç´ """
        return hash(self.id_number)

    def __repr__(self):
        return f"Person('{self.name}', '{self.id_number}')"

# ä½¿ç”¨
person1 = Person("å¼ ä¸‰", "123456")
person2 = Person("å¼ ä¸‰", "123456")
person3 = Person("æå››", "789012")

# å¯ä»¥ä½œä¸ºå­—å…¸é”®
people = {
    person1: "æ•°æ®1",
    person3: "æ•°æ®2"
}

# å¯ä»¥æ”¾å…¥é›†åˆ
person_set = {person1, person2, person3}
print(len(person_set))  # 2ï¼ˆperson1å’Œperson2è¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªï¼‰
```

**`__bool__`ï¼šçœŸå€¼æµ‹è¯•**

```python
class Result:
    def __init__(self, data, error=None):
        self.data = data
        self.error = error

    def __bool__(self):
        """if result: æ—¶è°ƒç”¨"""
        return self.error is None

    def __repr__(self):
        if self.error:
            return f"Result(error={self.error})"
        return f"Result(data={self.data})"

# ä½¿ç”¨
success = Result({"user": "å¼ ä¸‰"})
failure = Result(None, "è¿æ¥å¤±è´¥")

if success:
    print("æˆåŠŸ!")  # è¾“å‡º

if not failure:
    print("å¤±è´¥!")  # è¾“å‡º
```

**`__format__`ï¼šæ ¼å¼åŒ–è¾“å‡º**

```python
class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __format__(self, format_spec):
        """format(obj, spec) æ—¶è°ƒç”¨"""
        if format_spec == 'p':
            return f"({self.x}, {self.y})"
        elif format_spec == 'c':
            return f"{self.x}+{self.y}i"
        else:
            return f"Point({self.x}, {self.y})"

# ä½¿ç”¨
point = Point(3, 4)
print(f"{point}")      # Point(3, 4)
print(f"{point:p}")    # (3, 4)
print(f"{point:c}")    # 3+4i
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ®Šæ–¹æ³• | ç”¨é€” | Javaå¯¹åº” |
|---------|------|----------|
| `__str__` | å­—ç¬¦ä¸²è¡¨ç¤º | `toString()` |
| `__repr__` | å¼€å‘è€…è¡¨ç¤º | æ— ç›´æ¥å¯¹åº” |
| `__eq__` | ç›¸ç­‰æ¯”è¾ƒ | `equals()` |
| `__hash__` | å“ˆå¸Œå€¼ | `hashCode()` |
| `__len__` | é•¿åº¦ | `size()` |
| `__getitem__` | ç´¢å¼•è®¿é—® | `get()` |
| `__call__` | å¯è°ƒç”¨ | å‡½æ•°å¼æ¥å£ |
| `__enter__/__exit__` | ä¸Šä¸‹æ–‡ç®¡ç† | `AutoCloseable` |
| `__add__` | åŠ æ³• | æ— ï¼ˆä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼‰ |

Pythonçš„ç‰¹æ®Šæ–¹æ³•è®©ä½ çš„ç±»èƒ½å¤Ÿæ— ç¼èå…¥Pythonçš„è¯­æ³•ä½“ç³»ï¼Œå†™å‡ºæ›´Pythonicçš„ä»£ç ï¼

### 5ã€Pythonæ•°æ®ç±»

Python 3.7å¼•å…¥çš„`dataclass`è£…é¥°å™¨å¤§å¤§ç®€åŒ–äº†æ•°æ®ç±»çš„å®šä¹‰ï¼Œç±»ä¼¼äºJava 14+çš„recordç±»ã€‚

#### 5.1ã€åŸºæœ¬ç”¨æ³•

**ä¸ä½¿ç”¨dataclassçš„ä¼ ç»Ÿå†™æ³•**

```python
# ä¼ ç»Ÿå†™æ³•ï¼šéœ€è¦å¤§é‡æ ·æ¿ä»£ç 
class Person:
    def __init__(self, name, age, city):
        self.name = name
        self.age = age
        self.city = city

    def __repr__(self):
        return f"Person(name={self.name!r}, age={self.age!r}, city={self.city!r})"

    def __eq__(self, other):
        if not isinstance(other, Person):
            return NotImplemented
        return (self.name, self.age, self.city) == (other.name, other.age, other.city)
```

**ä½¿ç”¨dataclass**

```python
from dataclasses import dataclass

@dataclass
class Person:
    name: str
    age: int
    city: str

# è‡ªåŠ¨ç”Ÿæˆ__init__ã€__repr__ã€__eq__ç­‰æ–¹æ³•
person = Person("å¼ ä¸‰", 25, "åŒ—äº¬")
print(person)  # Person(name='å¼ ä¸‰', age=25, city='åŒ—äº¬')

person2 = Person("å¼ ä¸‰", 25, "åŒ—äº¬")
print(person == person2)  # True
```

å¯¹æ¯”Java Recordï¼š

```java
// Java 14+ Record
public record Person(String name, int age, String city) {}

// ä½¿ç”¨
Person person = new Person("å¼ ä¸‰", 25, "åŒ—äº¬");
System.out.println(person);  // Person[name=å¼ ä¸‰, age=25, city=åŒ—äº¬]
```

#### 5.2ã€å­—æ®µå®šä¹‰ä¸é»˜è®¤å€¼

**é»˜è®¤å€¼**

```python
from dataclasses import dataclass

@dataclass
class User:
    username: str
    email: str
    is_active: bool = True      # é»˜è®¤å€¼
    role: str = "user"
    login_count: int = 0

# ä½¿ç”¨
user1 = User("å¼ ä¸‰", "zhang@example.com")
print(user1)
# User(username='å¼ ä¸‰', email='zhang@example.com', is_active=True, role='user', login_count=0)

user2 = User("æå››", "li@example.com", is_active=False, role="admin")
print(user2)
# User(username='æå››', email='li@example.com', is_active=False, role='admin', login_count=0)
```

**é»˜è®¤å·¥å‚å‡½æ•°**

```python
from dataclasses import dataclass, field
from typing import List
from datetime import datetime

@dataclass
class BlogPost:
    title: str
    content: str
    tags: List[str] = field(default_factory=list)  # ä½¿ç”¨å·¥å‚å‡½æ•°
    created_at: datetime = field(default_factory=datetime.now)
    view_count: int = 0

# ä½¿ç”¨
post1 = BlogPost("Pythonæ•™ç¨‹", "è¿™æ˜¯å†…å®¹")
post2 = BlogPost("Javaæ•™ç¨‹", "å¦ä¸€ä¸ªå†…å®¹", tags=["Java", "ç¼–ç¨‹"])

print(post1.tags)       # []
print(post2.tags)       # ['Java', 'ç¼–ç¨‹']
print(post1.created_at) # å½“å‰æ—¶é—´

# æ³¨æ„ï¼šä¸è¦è¿™æ ·å†™ï¼ˆé”™è¯¯ï¼‰
# tags: List[str] = []  # âŒ æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ªåˆ—è¡¨ï¼
```

**å­—æ®µå…ƒæ•°æ®**

```python
from dataclasses import dataclass, field

@dataclass
class Product:
    name: str
    price: float
    stock: int = field(default=0, metadata={"unit": "ä»¶"})
    description: str = field(default="", repr=False)  # ä¸åœ¨reprä¸­æ˜¾ç¤º
    _internal_id: int = field(default=0, init=False, repr=False)  # ä¸åœ¨__init__ä¸­

# ä½¿ç”¨
product = Product("ç¬”è®°æœ¬ç”µè„‘", 5999.00, 10)
print(product)
# Product(name='ç¬”è®°æœ¬ç”µè„‘', price=5999.0, stock=10)

# è®¿é—®å…ƒæ•°æ®
from dataclasses import fields
for f in fields(Product):
    if f.metadata:
        print(f"{f.name}: {f.metadata}")
# stock: {'unit': 'ä»¶'}
```

#### 5.3ã€è‡ªåŠ¨ç”Ÿæˆçš„ç‰¹æ®Šæ–¹æ³•

**å¯é…ç½®çš„æ–¹æ³•ç”Ÿæˆ**

```python
from dataclasses import dataclass

# å®Œæ•´é…ç½®
@dataclass(
    init=True,        # ç”Ÿæˆ__init__ï¼ˆé»˜è®¤Trueï¼‰
    repr=True,        # ç”Ÿæˆ__repr__ï¼ˆé»˜è®¤Trueï¼‰
    eq=True,          # ç”Ÿæˆ__eq__ï¼ˆé»˜è®¤Trueï¼‰
    order=False,      # ç”Ÿæˆæ¯”è¾ƒæ–¹æ³•__lt__ç­‰ï¼ˆé»˜è®¤Falseï¼‰
    frozen=False,     # ä¸å¯å˜ï¼ˆé»˜è®¤Falseï¼‰
    unsafe_hash=False # ç”Ÿæˆ__hash__ï¼ˆé»˜è®¤Falseï¼‰
)
class Point:
    x: int
    y: int

# ä¸å¯å˜æ•°æ®ç±»
@dataclass(frozen=True)
class ImmutablePoint:
    x: int
    y: int

point = ImmutablePoint(3, 4)
# point.x = 5  # FrozenInstanceError

# å¯æ¯”è¾ƒçš„æ•°æ®ç±»
@dataclass(order=True)
class Student:
    name: str
    score: int

students = [Student("å¼ ä¸‰", 85), Student("æå››", 92), Student("ç‹äº”", 78)]
sorted_students = sorted(students)
print([s.name for s in sorted_students])  # ['å¼ ä¸‰', 'æå››', 'ç‹äº”']
```

**è‡ªå®šä¹‰`__post_init__`**

```python
from dataclasses import dataclass

@dataclass
class Rectangle:
    width: float
    height: float
    area: float = None  # è®¡ç®—å±æ€§

    def __post_init__(self):
        """åœ¨__init__ä¹‹åè‡ªåŠ¨è°ƒç”¨"""
        if self.area is None:
            self.area = self.width * self.height

        # éªŒè¯
        if self.width <= 0 or self.height <= 0:
            raise ValueError("å®½åº¦å’Œé«˜åº¦å¿…é¡»å¤§äº0")

# ä½¿ç”¨
rect = Rectangle(5, 3)
print(rect.area)  # 15.0

# rect = Rectangle(-5, 3)  # ValueError
```

**init-onlyå­—æ®µ**

```python
from dataclasses import dataclass, field, InitVar

@dataclass
class User:
    username: str
    password_hash: str = field(init=False, repr=False)
    password: InitVar[str] = None  # ä»…åœ¨__init__ä¸­ä½¿ç”¨

    def __post_init__(self, password):
        """passwordåªåœ¨åˆå§‹åŒ–æ—¶å­˜åœ¨"""
        if password:
            self.password_hash = hash(password)  # ç®€åŒ–ç¤ºä¾‹

# ä½¿ç”¨
user = User("å¼ ä¸‰", password="secret123")
print(user)  # User(username='å¼ ä¸‰')
# user.password  # AttributeErrorï¼ˆä¸å­˜åœ¨ï¼‰
print(user.password_hash)  # å“ˆå¸Œå€¼
```

#### 5.4ã€ç»§æ‰¿ä¸ç»„åˆ

**æ•°æ®ç±»ç»§æ‰¿**

```python
from dataclasses import dataclass

@dataclass
class Person:
    name: str
    age: int

@dataclass
class Employee(Person):
    employee_id: str
    department: str

# ä½¿ç”¨
emp = Employee("å¼ ä¸‰", 30, "E001", "æŠ€æœ¯éƒ¨")
print(emp)
# Employee(name='å¼ ä¸‰', age=30, employee_id='E001', department='æŠ€æœ¯éƒ¨')
```

**ç»„åˆæ¨¡å¼**

```python
from dataclasses import dataclass
from typing import List

@dataclass
class Address:
    street: str
    city: str
    country: str = "ä¸­å›½"

@dataclass
class Contact:
    email: str
    phone: str

@dataclass
class Company:
    name: str
    address: Address
    contacts: List[Contact]
    employee_count: int = 0

# ä½¿ç”¨
address = Address("ä¸­å…³æ‘å¤§è¡—1å·", "åŒ—äº¬")
contacts = [
    Contact("hr@company.com", "010-12345678"),
    Contact("sales@company.com", "010-87654321")
]

company = Company("ç§‘æŠ€å…¬å¸", address, contacts, 500)
print(company.address.city)  # åŒ—äº¬
print(company.contacts[0].email)  # hr@company.com
```

#### 5.5ã€é«˜çº§ç‰¹æ€§

**å­—æ®µè½¬æ¢**

```python
from dataclasses import dataclass, field, asdict, astuple

@dataclass
class Book:
    title: str
    author: str
    price: float
    tags: list = field(default_factory=list)

book = Book("Pythonç¼–ç¨‹", "ä½œè€…", 59.9, ["ç¼–ç¨‹", "Python"])

# è½¬æ¢ä¸ºå­—å…¸
book_dict = asdict(book)
print(book_dict)
# {'title': 'Pythonç¼–ç¨‹', 'author': 'ä½œè€…', 'price': 59.9, 'tags': ['ç¼–ç¨‹', 'Python']}

# è½¬æ¢ä¸ºå…ƒç»„
book_tuple = astuple(book)
print(book_tuple)
# ('Pythonç¼–ç¨‹', 'ä½œè€…', 59.9, ['ç¼–ç¨‹', 'Python'])
```

**æ›¿æ¢å­—æ®µå€¼**

```python
from dataclasses import dataclass, replace

@dataclass(frozen=True)
class Point:
    x: int
    y: int

point1 = Point(3, 4)
point2 = replace(point1, x=5)  # åˆ›å»ºæ–°å¯¹è±¡

print(point1)  # Point(x=3, y=4)
print(point2)  # Point(x=5, y=4)
```

**å®é™…åº”ç”¨ï¼šé…ç½®ç±»**

```python
from dataclasses import dataclass, field
from typing import Optional
import json

@dataclass
class DatabaseConfig:
    host: str = "localhost"
    port: int = 5432
    database: str = "mydb"
    username: str = "admin"
    password: str = field(default="", repr=False)  # ä¸æ˜¾ç¤ºå¯†ç 
    pool_size: int = 10
    timeout: int = 30
    ssl: bool = False

    def to_json(self) -> str:
        """å¯¼å‡ºä¸ºJSON"""
        from dataclasses import asdict
        return json.dumps(asdict(self), indent=2)

    @classmethod
    def from_json(cls, json_str: str):
        """ä»JSONåˆ›å»º"""
        data = json.loads(json_str)
        return cls(**data)

# ä½¿ç”¨
config = DatabaseConfig(
    host="prod-db.example.com",
    database="production",
    username="prod_user",
    password="secret",
    ssl=True
)

print(config)
# DatabaseConfig(host='prod-db.example.com', port=5432, database='production',
#                username='prod_user', pool_size=10, timeout=30, ssl=True)

# åºåˆ—åŒ–
json_str = config.to_json()
print(json_str)

# ååºåˆ—åŒ–
config2 = DatabaseConfig.from_json(json_str)
```

#### 5.6ã€ä¸æ™®é€šç±»å’Œnamedtupleå¯¹æ¯”

**å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | æ™®é€šç±» | namedtuple | dataclass |
|-----|-------|------------|-----------|
| å®šä¹‰ç®€æ´åº¦ | âŒ å†—é•¿ | âœ… ç®€æ´ | âœ… ç®€æ´ |
| å¯å˜æ€§ | âœ… å¯å˜ | âŒ ä¸å¯å˜ | âœ… å¯é…ç½® |
| ç±»å‹æ³¨è§£ | âŒ æ‰‹åŠ¨ | âŒ æ—  | âœ… å†…ç½® |
| é»˜è®¤å€¼ | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| ç»§æ‰¿ | âœ… æ”¯æŒ | âš ï¸ å¤æ‚ | âœ… æ”¯æŒ |
| æ–¹æ³• | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| æ€§èƒ½ | âœ… å¥½ | âœ… å¥½ | âœ… å¥½ |

**ç¤ºä¾‹å¯¹æ¯”**

```python
# 1. æ™®é€šç±»ï¼ˆæœ€çµæ´»ï¼Œæœ€å†—é•¿ï¼‰
class PersonClass:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __repr__(self):
        return f"Person(name={self.name!r}, age={self.age!r})"

    def __eq__(self, other):
        if not isinstance(other, PersonClass):
            return NotImplemented
        return (self.name, self.age) == (other.name, other.age)

# 2. namedtupleï¼ˆç®€æ´ï¼Œä¸å¯å˜ï¼‰
from collections import namedtuple
PersonTuple = namedtuple('Person', ['name', 'age'])

# 3. dataclassï¼ˆæœ€ä½³å¹³è¡¡ï¼‰
from dataclasses import dataclass

@dataclass
class PersonData:
    name: str
    age: int

# ä½¿ç”¨å¯¹æ¯”
p1 = PersonClass("å¼ ä¸‰", 25)
p2 = PersonTuple("å¼ ä¸‰", 25)
p3 = PersonData("å¼ ä¸‰", 25)

# å¯å˜æ€§
p1.age = 26  # âœ…
# p2.age = 26  # âŒ AttributeError
p3.age = 26  # âœ…

# ç±»å‹æç¤º
# PersonClass: æ— ç±»å‹ä¿¡æ¯
# PersonTuple: æ— ç±»å‹ä¿¡æ¯
# PersonData: å®Œæ•´ç±»å‹æ³¨è§£
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Python dataclass | Java record |
|-----|------------------|-------------|
| å¼•å…¥ç‰ˆæœ¬ | Python 3.7 | Java 14 |
| å¯å˜æ€§ | é»˜è®¤å¯å˜ï¼Œå¯é…ç½® | ä¸å¯å˜ |
| é»˜è®¤å€¼ | æ”¯æŒ | ä¸æ”¯æŒ |
| ç»§æ‰¿ | æ”¯æŒ | ä¸æ”¯æŒï¼ˆå¯å®ç°æ¥å£ï¼‰ |
| ç”Ÿæˆæ–¹æ³• | å¯é…ç½® | è‡ªåŠ¨ç”Ÿæˆå…¨éƒ¨ |
| åºåˆ—åŒ– | éœ€æ‰‹åŠ¨ | è‡ªåŠ¨æ”¯æŒ |

Pythonçš„æ•°æ®ç±»æ¯”Javaçš„recordæ›´çµæ´»ï¼Œä½†ä¸¤è€…éƒ½å¤§å¤§å‡å°‘äº†æ•°æ®æ‰¿è½½ç±»çš„æ ·æ¿ä»£ç ï¼

### 6ã€ç‰¹æ®Šå†…ç½®å˜é‡

Pythonä¸­æœ‰å¤§é‡ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾çš„ç‰¹æ®Šå†…ç½®å˜é‡ï¼Œå®ƒä»¬ç”±è§£é‡Šå™¨è‡ªåŠ¨è®¾ç½®ï¼Œæä¾›äº†ä¸°å¯Œçš„è¿è¡Œæ—¶å…ƒä¿¡æ¯ã€‚ç†è§£è¿™äº›å˜é‡å¯¹äºæ·±å…¥æŒæ¡Pythonè‡³å…³é‡è¦ã€‚

> **åŒºåˆ«**ï¼šç‰¹æ®Šå†…ç½®å˜é‡æ˜¯**å˜é‡**ï¼ˆå­˜å‚¨å€¼ï¼‰ï¼Œé­”æœ¯æ–¹æ³•æ˜¯**æ–¹æ³•**ï¼ˆå®šä¹‰è¡Œä¸ºï¼‰

#### 6.1ã€æ¨¡å—çº§åˆ«çš„ç‰¹æ®Šå˜é‡

**`__name__`ï¼šæ¨¡å—åç§°**

```python
# my_module.py
print(f"æ¨¡å—å: {__name__}")

def main():
    print("æ‰§è¡Œä¸»ç¨‹åº")

if __name__ == "__main__":
    # åªæœ‰ç›´æ¥è¿è¡Œæ—¶æ‰æ‰§è¡Œ
    main()
```

```bash
# ç›´æ¥è¿è¡Œ
$ python my_module.py
# è¾“å‡º: æ¨¡å—å: __main__
#       æ‰§è¡Œä¸»ç¨‹åº

# ä½œä¸ºæ¨¡å—å¯¼å…¥
>>> import my_module
# è¾“å‡º: æ¨¡å—å: my_module
# main()ä¸ä¼šæ‰§è¡Œ
```

å¯¹æ¯”Javaï¼š

```java
// Javaç”¨mainæ–¹æ³•ä½œä¸ºå…¥å£
public class MyClass {
    public static void main(String[] args) {
        System.out.println("æ‰§è¡Œä¸»ç¨‹åº");
    }
}
```

**`__file__`ï¼šæ–‡ä»¶è·¯å¾„**

```python
# utils.py
import os

print(f"æ–‡ä»¶è·¯å¾„: {__file__}")
print(f"ç»å¯¹è·¯å¾„: {os.path.abspath(__file__)}")
print(f"æ‰€åœ¨ç›®å½•: {os.path.dirname(__file__)}")

# è¾“å‡º:
# æ–‡ä»¶è·¯å¾„: /path/to/utils.py
# ç»å¯¹è·¯å¾„: /path/to/utils.py
# æ‰€åœ¨ç›®å½•: /path/to
```

**å®é™…åº”ç”¨**ï¼š

```python
# è¯»å–åŒç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶
import os
import json

# è·å–å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•
CURRENT_DIR = os.path.dirname(os.path.abspath(__file__))
CONFIG_FILE = os.path.join(CURRENT_DIR, 'config.json')

with open(CONFIG_FILE) as f:
    config = json.load(f)
```

**`__doc__`ï¼šæ–‡æ¡£å­—ç¬¦ä¸²**

```python
"""
è¿™æ˜¯æ¨¡å—çš„æ–‡æ¡£å­—ç¬¦ä¸²
ç”¨äºæè¿°æ¨¡å—åŠŸèƒ½
"""

def greet(name):
    """è¿”å›é—®å€™è¯­"""
    return f"Hello, {name}"

class Person:
    """äººç±»"""
    def __init__(self, name):
        """åˆå§‹åŒ–Personå¯¹è±¡"""
        self.name = name

# è®¿é—®æ–‡æ¡£
print(__doc__)           # æ¨¡å—æ–‡æ¡£
print(greet.__doc__)     # å‡½æ•°æ–‡æ¡£
print(Person.__doc__)    # ç±»æ–‡æ¡£
print(Person.__init__.__doc__)  # æ–¹æ³•æ–‡æ¡£
```

**`__package__`ï¼šåŒ…å**

```python
# mypackage/submodule.py
print(f"åŒ…å: {__package__}")        # mypackage
print(f"æ¨¡å—å: {__name__}")         # mypackage.submodule

# ç”¨äºç›¸å¯¹å¯¼å…¥
from . import other_module          # åŒçº§æ¨¡å—
from .. import parent_module        # ä¸Šçº§æ¨¡å—
```

**å…¶ä»–æ¨¡å—çº§å˜é‡**

```python
# æŸ¥çœ‹æ‰€æœ‰æ¨¡å—çº§ç‰¹æ®Šå˜é‡
import sys

print(f"__cached__: {__cached__}")    # .pycæ–‡ä»¶è·¯å¾„
print(f"__spec__: {__spec__}")        # æ¨¡å—è§„èŒƒå¯¹è±¡
print(f"__loader__: {__loader__}")    # æ¨¡å—åŠ è½½å™¨

# __builtins__: å†…ç½®å‡½æ•°å’Œå¼‚å¸¸
print(type(__builtins__))             # <class 'module'>
```

#### 6.2ã€ç±»çº§åˆ«çš„ç‰¹æ®Šå˜é‡

**`__class__`ï¼šå¯¹è±¡çš„ç±»**

```python
class Person:
    def __init__(self, name):
        self.name = name

person = Person("å¼ ä¸‰")

# è·å–ç±»
print(person.__class__)              # <class '__main__.Person'>
print(type(person))                  # <class '__main__.Person'>ï¼ˆç­‰ä»·ï¼‰

# åˆ¤æ–­ç±»å‹
print(person.__class__.__name__)     # Person

# é€šè¿‡ç±»åˆ›å»ºæ–°å®ä¾‹
another = person.__class__("æå››")
print(another.name)                  # æå››
```

**`__dict__`ï¼šå±æ€§å­—å…¸**

```python
class User:
    class_var = "ç±»å˜é‡"

    def __init__(self, username, age):
        self.username = username
        self.age = age

user = User("å¼ ä¸‰", 25)

# å®ä¾‹å±æ€§å­—å…¸
print(user.__dict__)
# {'username': 'å¼ ä¸‰', 'age': 25}

# ç±»å±æ€§å­—å…¸
print(User.__dict__)
# {..., 'class_var': 'ç±»å˜é‡', '__init__': <function>, ...}

# åŠ¨æ€æ·»åŠ å±æ€§
user.__dict__['email'] = 'zhang@example.com'
print(user.email)  # zhang@example.com

# æŸ¥çœ‹æ‰€æœ‰å±æ€§
for key, value in user.__dict__.items():
    print(f"{key}: {value}")
```

å¯¹æ¯”Javaï¼š

```java
// Javaä½¿ç”¨åå°„è®¿é—®å­—æ®µ
import java.lang.reflect.Field;

Field[] fields = user.getClass().getDeclaredFields();
for (Field field : fields) {
    field.setAccessible(true);
    System.out.println(field.getName() + ": " + field.get(user));
}
```

**`__module__`ï¼šç±»æ‰€åœ¨æ¨¡å—**

```python
# mypackage/models.py
class User:
    pass

user = User()
print(user.__class__.__module__)  # mypackage.models
print(User.__module__)            # mypackage.models
```

**`__bases__`ï¼šç›´æ¥çˆ¶ç±»**

```python
class Animal:
    pass

class Mammal(Animal):
    pass

class Dog(Mammal):
    pass

# æŸ¥çœ‹ç›´æ¥çˆ¶ç±»
print(Dog.__bases__)              # (<class '__main__.Mammal'>,)
print(Mammal.__bases__)           # (<class '__main__.Animal'>,)
print(Animal.__bases__)           # (<class 'object'>,)

# å¤šç»§æ‰¿
class Flyable:
    pass

class Bird(Animal, Flyable):
    pass

print(Bird.__bases__)             # (<class '__main__.Animal'>, <class '__main__.Flyable'>)
```

**`__mro__`ï¼šæ–¹æ³•è§£æé¡ºåº**

```python
class A:
    pass

class B(A):
    pass

class C(A):
    pass

class D(B, C):
    pass

# MROï¼ˆC3çº¿æ€§åŒ–ï¼‰
print(D.__mro__)
# (<class '__main__.D'>, <class '__main__.B'>, <class '__main__.C'>,
#  <class '__main__.A'>, <class 'object'>)

# ä¹Ÿå¯ä»¥ç”¨mro()æ–¹æ³•
print(D.mro())
```

**`__qualname__`ï¼šé™å®šåç§°**

```python
class Outer:
    class Inner:
        def method(self):
            pass

print(Outer.__name__)                    # Outer
print(Outer.__qualname__)                # Outer

print(Outer.Inner.__name__)              # Inner
print(Outer.Inner.__qualname__)          # Outer.Inner

print(Outer.Inner.method.__name__)       # method
print(Outer.Inner.method.__qualname__)   # Outer.Inner.method
```

#### 6.3ã€å‡½æ•°çº§åˆ«çš„ç‰¹æ®Šå˜é‡

**å‡½æ•°å±æ€§**

```python
def greet(name: str, age: int = 18) -> str:
    """è¿”å›é—®å€™è¯­"""
    return f"Hello, {name}! You are {age} years old."

# å‡½æ•°åç§°
print(greet.__name__)                    # greet

# æ–‡æ¡£å­—ç¬¦ä¸²
print(greet.__doc__)                     # è¿”å›é—®å€™è¯­

# æ‰€åœ¨æ¨¡å—
print(greet.__module__)                  # __main__

# ç±»å‹æ³¨è§£
print(greet.__annotations__)
# {'name': <class 'str'>, 'age': <class 'int'>, 'return': <class 'str'>}

# é»˜è®¤å‚æ•°å€¼
print(greet.__defaults__)                # (18,)

# ä»£ç å¯¹è±¡
print(greet.__code__)                    # <code object greet at ...>
print(greet.__code__.co_varnames)        # ('name', 'age')
print(greet.__code__.co_argcount)        # 2
```

**é—­åŒ…å˜é‡**

```python
def outer(x):
    y = 10
    def inner(z):
        return x + y + z
    return inner

closure = outer(5)

# é—­åŒ…å˜é‡
print(closure.__closure__)
# (<cell at 0x...: int object at 0x...>, <cell at 0x...: int object at 0x...>)

# æŸ¥çœ‹é—­åŒ…æ•è·çš„å˜é‡
for cell in closure.__closure__:
    print(cell.cell_contents)  # 5, 10
```

#### 6.4ã€å…¶ä»–é‡è¦ç‰¹æ®Šå˜é‡

**`__debug__`ï¼šè°ƒè¯•æ¨¡å¼**

```python
# é»˜è®¤ä¸ºTrue
print(__debug__)  # True

# ä½¿ç”¨-Oä¼˜åŒ–æ¨¡å¼è¿è¡Œæ—¶ä¸ºFalse
# python -O script.py

# ç”¨äºæ¡ä»¶è°ƒè¯•ä»£ç 
if __debug__:
    print("è°ƒè¯•ä¿¡æ¯ï¼šå˜é‡å€¼ä¸º", x)
```

**`__all__`ï¼šå…¬å¼€æ¥å£**

```python
# mymodule.py
__all__ = ['public_func', 'PublicClass']

def public_func():
    """å…¬å¼€å‡½æ•°"""
    pass

def _internal_func():
    """å†…éƒ¨å‡½æ•°"""
    pass

class PublicClass:
    """å…¬å¼€ç±»"""
    pass

class _InternalClass:
    """å†…éƒ¨ç±»"""
    pass
```

```python
# ä½¿ç”¨from import *æ—¶ï¼Œåªå¯¼å…¥__all__ä¸­çš„å†…å®¹
from mymodule import *

public_func()      # âœ… å¯ç”¨
# _internal_func() # âŒ NameError
```

**`__slots__`ï¼šé™åˆ¶å±æ€§**

```python
class Point:
    """é™åˆ¶åªèƒ½æœ‰xå’Œyå±æ€§"""
    __slots__ = ['x', 'y']

    def __init__(self, x, y):
        self.x = x
        self.y = y

point = Point(3, 4)
print(point.x, point.y)  # 3 4

# ä¸èƒ½æ·»åŠ æ–°å±æ€§
# point.z = 5  # AttributeError

# æ²¡æœ‰__dict__ï¼ˆèŠ‚çœå†…å­˜ï¼‰
# print(point.__dict__)  # AttributeError
```

**ä¼˜åŠ¿**ï¼š
- èŠ‚çœå†…å­˜ï¼ˆæ²¡æœ‰`__dict__`ï¼‰
- æ›´å¿«çš„å±æ€§è®¿é—®
- é˜²æ­¢å±æ€§æ‹¼å†™é”™è¯¯

**`__annotations__`ï¼šç±»å‹æ³¨è§£**

```python
class User:
    name: str
    age: int
    email: str = "æœªè®¾ç½®"

    def __init__(self, name: str, age: int):
        self.name = name
        self.age = age

# æŸ¥çœ‹ç±»å‹æ³¨è§£
print(User.__annotations__)
# {'name': <class 'str'>, 'age': <class 'int'>, 'email': <class 'str'>}

# å‡½æ•°çš„ç±»å‹æ³¨è§£
def process(data: list[int]) -> int:
    return sum(data)

print(process.__annotations__)
# {'data': list[int], 'return': <class 'int'>}
```

#### 6.5ã€å®ç”¨å·¥å…·å‡½æ•°

**`dir()`ï¼šåˆ—å‡ºæ‰€æœ‰å±æ€§**

```python
class Person:
    def __init__(self, name):
        self.name = name

    def greet(self):
        pass

person = Person("å¼ ä¸‰")

# åˆ—å‡ºæ‰€æœ‰å±æ€§å’Œæ–¹æ³•
print(dir(person))
# ['__class__', '__delattr__', ..., 'greet', 'name', ...]

# åªåˆ—å‡ºç‰¹æ®Šå˜é‡/æ–¹æ³•
special = [x for x in dir(person) if x.startswith('__') and x.endswith('__')]
print(special)
```

**`vars()`ï¼šè¿”å›`__dict__`**

```python
user = User("å¼ ä¸‰", 25)

# ç­‰åŒäºuser.__dict__
print(vars(user))
# {'name': 'å¼ ä¸‰', 'age': 25}

# ä¿®æ”¹å±æ€§
vars(user)['age'] = 26
print(user.age)  # 26
```

**`getattr()`ã€`setattr()`ã€`hasattr()`**

```python
class Config:
    debug = True
    port = 8080

config = Config()

# è·å–å±æ€§
debug = getattr(config, 'debug')          # True
timeout = getattr(config, 'timeout', 30)  # 30ï¼ˆé»˜è®¤å€¼ï¼‰

# è®¾ç½®å±æ€§
setattr(config, 'host', 'localhost')
print(config.host)  # localhost

# æ£€æŸ¥å±æ€§
print(hasattr(config, 'debug'))    # True
print(hasattr(config, 'timeout'))  # False

# åŠ¨æ€æ“ä½œ
attr_name = 'port'
value = getattr(config, attr_name)
print(value)  # 8080
```

#### 6.6ã€å®é™…åº”ç”¨æ¡ˆä¾‹

**æ¡ˆä¾‹1ï¼šå¯¹è±¡åºåˆ—åŒ–**

```python
class Person:
    def __init__(self, name, age, city):
        self.name = name
        self.age = age
        self.city = city

    def to_dict(self):
        """è½¬æ¢ä¸ºå­—å…¸"""
        return self.__dict__.copy()

    @classmethod
    def from_dict(cls, data):
        """ä»å­—å…¸åˆ›å»ºå¯¹è±¡"""
        return cls(**data)

# ä½¿ç”¨
person = Person("å¼ ä¸‰", 25, "åŒ—äº¬")
data = person.to_dict()
print(data)  # {'name': 'å¼ ä¸‰', 'age': 25, 'city': 'åŒ—äº¬'}

# ååºåˆ—åŒ–
person2 = Person.from_dict(data)
print(person2.name)  # å¼ ä¸‰
```

**æ¡ˆä¾‹2ï¼šæ’ä»¶ç³»ç»Ÿ**

```python
class PluginBase:
    """æ’ä»¶åŸºç±»"""
    pass

class Plugin1(PluginBase):
    pass

class Plugin2(PluginBase):
    pass

# è‡ªåŠ¨å‘ç°æ‰€æœ‰æ’ä»¶
def discover_plugins():
    """è·å–æ‰€æœ‰æ’ä»¶ç±»"""
    plugins = []
    for cls in PluginBase.__subclasses__():
        plugins.append(cls)
    return plugins

print(discover_plugins())
# [<class '__main__.Plugin1'>, <class '__main__.Plugin2'>]
```

**æ¡ˆä¾‹3ï¼šè°ƒè¯•ä¿¡æ¯**

```python
def debug_info(obj):
    """æ‰“å°å¯¹è±¡çš„è°ƒè¯•ä¿¡æ¯"""
    print(f"ç±»å‹: {obj.__class__.__name__}")
    print(f"æ¨¡å—: {obj.__class__.__module__}")
    print(f"MRO: {[c.__name__ for c in obj.__class__.__mro__]}")
    print(f"å±æ€§: {obj.__dict__}")

class User:
    def __init__(self, name):
        self.name = name

user = User("å¼ ä¸‰")
debug_info(user)
# ç±»å‹: User
# æ¨¡å—: __main__
# MRO: ['User', 'object']
# å±æ€§: {'name': 'å¼ ä¸‰'}
```

**å°ç»“å¯¹æ¯”è¡¨**

| å˜é‡ç±»å‹ | Pythonç‰¹æ®Šå˜é‡ | Javaå¯¹åº” |
|---------|---------------|----------|
| æ¨¡å—å | `__name__` | æ— ï¼ˆç”¨mainæ–¹æ³•ï¼‰ |
| æ–‡ä»¶è·¯å¾„ | `__file__` | æ— ç›´æ¥å¯¹åº” |
| ç±»ä¿¡æ¯ | `__class__`, `__bases__` | `getClass()`, `getSuperclass()` |
| å±æ€§å­—å…¸ | `__dict__` | åå°„API |
| MRO | `__mro__` | æ— ï¼ˆå•ç»§æ‰¿ï¼‰ |
| æ–‡æ¡£ | `__doc__` | JavaDocæ³¨é‡Š |
| ç±»å‹æ³¨è§£ | `__annotations__` | ç±»å‹å£°æ˜ |

**è®°å¿†æŠ€å·§**ï¼š

- **æ¨¡å—ç›¸å…³**ï¼š`__name__`ã€`__file__`ã€`__package__`
- **ç±»ç›¸å…³**ï¼š`__class__`ã€`__bases__`ã€`__mro__`ã€`__module__`
- **å±æ€§ç›¸å…³**ï¼š`__dict__`ã€`__slots__`ã€`__annotations__`
- **å…ƒä¿¡æ¯**ï¼š`__doc__`ã€`__qualname__`ã€`__all__`

## å››ã€Pythonè¿›é˜¶ç‰¹æ€§

### 1ã€å¼‚å¸¸å¤„ç†

Pythonçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Javaç±»ä¼¼ï¼Œä½†è¯­æ³•æ›´ç®€æ´ï¼Œå¹¶æä¾›äº†ä¸€äº›ç‹¬ç‰¹çš„ç‰¹æ€§ã€‚

#### 1.1ã€try-exceptåŸºæœ¬è¯­æ³•

**åŸºæœ¬ç”¨æ³•**

```python
# åŸºæœ¬å¼‚å¸¸æ•è·
try:
    number = int(input("è¯·è¾“å…¥æ•°å­—: "))
    result = 10 / number
    print(f"ç»“æœ: {result}")
except ValueError:
    print("è¾“å…¥çš„ä¸æ˜¯æœ‰æ•ˆæ•°å­—")
except ZeroDivisionError:
    print("ä¸èƒ½é™¤ä»¥é›¶")
```

å¯¹æ¯”Javaï¼š

```java
// Javaå¼‚å¸¸å¤„ç†
try {
    int number = Integer.parseInt(scanner.nextLine());
    int result = 10 / number;
    System.out.println("ç»“æœ: " + result);
} catch (NumberFormatException e) {
    System.out.println("è¾“å…¥çš„ä¸æ˜¯æœ‰æ•ˆæ•°å­—");
} catch (ArithmeticException e) {
    System.out.println("ä¸èƒ½é™¤ä»¥é›¶");
}
```

**æ•è·å¤šä¸ªå¼‚å¸¸**

```python
# æ–¹å¼1ï¼šåˆ†åˆ«æ•è·
try:
    data = json.loads(json_string)
except ValueError as e:
    print(f"JSONè§£æé”™è¯¯: {e}")
except KeyError as e:
    print(f"é”®ä¸å­˜åœ¨: {e}")

# æ–¹å¼2ï¼šåˆå¹¶æ•è·ï¼ˆå¼‚å¸¸å¤„ç†é€»è¾‘ç›¸åŒæ—¶ï¼‰
try:
    file = open("data.txt")
    data = process(file)
except (FileNotFoundError, PermissionError) as e:
    print(f"æ–‡ä»¶è®¿é—®é”™è¯¯: {e}")

# æ–¹å¼3ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ï¼‰
try:
    risky_operation()
except Exception as e:
    print(f"å‘ç”Ÿé”™è¯¯: {e}")
```

#### 1.2ã€try-except-else-finally

Pythonçš„å¼‚å¸¸å¤„ç†æä¾›äº†`else`å’Œ`finally`å­å¥ã€‚

**elseå­å¥**

```python
try:
    file = open("data.txt", "r")
    data = file.read()
except FileNotFoundError:
    print("æ–‡ä»¶ä¸å­˜åœ¨")
else:
    # åªæœ‰tryå—æˆåŠŸæ—¶æ‰æ‰§è¡Œ
    print(f"è¯»å–äº†{len(data)}ä¸ªå­—ç¬¦")
    process_data(data)
finally:
    # æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œ
    if 'file' in locals():
        file.close()
        print("æ–‡ä»¶å·²å…³é—­")
```

**å®Œæ•´ç¤ºä¾‹**

```python
def divide(a, b):
    try:
        result = a / b
    except ZeroDivisionError:
        print("é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶")
        return None
    except TypeError:
        print("é”™è¯¯ï¼šå‚æ•°ç±»å‹é”™è¯¯")
        return None
    else:
        print(f"è®¡ç®—æˆåŠŸ: {a} / {b} = {result}")
        return result
    finally:
        print("é™¤æ³•æ“ä½œå®Œæˆ")

# ä½¿ç”¨
divide(10, 2)
# è¾“å‡º:
# è®¡ç®—æˆåŠŸ: 10 / 2 = 5.0
# é™¤æ³•æ“ä½œå®Œæˆ

divide(10, 0)
# è¾“å‡º:
# é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶
# é™¤æ³•æ“ä½œå®Œæˆ
```

å¯¹æ¯”Javaï¼š

```java
// Javaæ²¡æœ‰elseï¼Œä½†æœ‰finally
try {
    result = a / b;
    System.out.println("è®¡ç®—æˆåŠŸ");  // éœ€è¦æ‰‹åŠ¨åˆ¤æ–­
} catch (ArithmeticException e) {
    System.out.println("é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶");
} finally {
    System.out.println("é™¤æ³•æ“ä½œå®Œæˆ");
}
```

#### 1.3ã€å¼‚å¸¸ç±»å‹ä¸ç»§æ‰¿ä½“ç³»

Pythonçš„å¼‚å¸¸éƒ½ç»§æ‰¿è‡ª`BaseException`ã€‚

**å¼‚å¸¸å±‚æ¬¡ç»“æ„**

```
BaseException
â”œâ”€â”€ SystemExit           # ç³»ç»Ÿé€€å‡º
â”œâ”€â”€ KeyboardInterrupt    # ç”¨æˆ·ä¸­æ–­ï¼ˆCtrl+Cï¼‰
â”œâ”€â”€ GeneratorExit        # ç”Ÿæˆå™¨é€€å‡º
â””â”€â”€ Exception            # å¸¸è§„å¼‚å¸¸çš„åŸºç±»
    â”œâ”€â”€ StopIteration
    â”œâ”€â”€ ArithmeticError
    â”‚   â”œâ”€â”€ ZeroDivisionError
    â”‚   â”œâ”€â”€ OverflowError
    â”‚   â””â”€â”€ FloatingPointError
    â”œâ”€â”€ AssertionError
    â”œâ”€â”€ AttributeError
    â”œâ”€â”€ EOFError
    â”œâ”€â”€ ImportError
    â”‚   â””â”€â”€ ModuleNotFoundError
    â”œâ”€â”€ LookupError
    â”‚   â”œâ”€â”€ IndexError
    â”‚   â””â”€â”€ KeyError
    â”œâ”€â”€ MemoryError
    â”œâ”€â”€ NameError
    â”‚   â””â”€â”€ UnboundLocalError
    â”œâ”€â”€ OSError
    â”‚   â”œâ”€â”€ FileNotFoundError
    â”‚   â”œâ”€â”€ PermissionError
    â”‚   â””â”€â”€ TimeoutError
    â”œâ”€â”€ RuntimeError
    â”‚   â”œâ”€â”€ NotImplementedError
    â”‚   â””â”€â”€ RecursionError
    â”œâ”€â”€ TypeError
    â”œâ”€â”€ ValueError
    â”‚   â””â”€â”€ UnicodeError
    â””â”€â”€ Warning
```

**å¸¸è§å¼‚å¸¸**

```python
# ValueErrorï¼šå€¼é”™è¯¯
int("abc")  # ValueError: invalid literal

# TypeErrorï¼šç±»å‹é”™è¯¯
"string" + 123  # TypeError: can only concatenate str

# KeyErrorï¼šå­—å…¸é”®ä¸å­˜åœ¨
{"a": 1}["b"]  # KeyError: 'b'

# IndexErrorï¼šç´¢å¼•è¶Šç•Œ
[1, 2, 3][5]  # IndexError: list index out of range

# AttributeErrorï¼šå±æ€§ä¸å­˜åœ¨
"string".non_existent  # AttributeError: 'str' object has no attribute

# FileNotFoundErrorï¼šæ–‡ä»¶ä¸å­˜åœ¨
open("non_existent.txt")  # FileNotFoundError

# ImportErrorï¼šæ¨¡å—å¯¼å…¥å¤±è´¥
import non_existent_module  # ModuleNotFoundError
```

#### 1.4ã€raiseè¯­å¥

**æŠ›å‡ºå¼‚å¸¸**

```python
def withdraw(amount, balance):
    if amount <= 0:
        raise ValueError("å–æ¬¾é‡‘é¢å¿…é¡»å¤§äº0")

    if amount > balance:
        raise ValueError(f"ä½™é¢ä¸è¶³ï¼šéœ€è¦{amount}ï¼Œå½“å‰{balance}")

    return balance - amount

# ä½¿ç”¨
try:
    new_balance = withdraw(1000, 500)
except ValueError as e:
    print(f"æ“ä½œå¤±è´¥: {e}")
# è¾“å‡º: æ“ä½œå¤±è´¥: ä½™é¢ä¸è¶³ï¼šéœ€è¦1000ï¼Œå½“å‰500
```

**é‡æ–°æŠ›å‡ºå¼‚å¸¸**

```python
def process_data(data):
    try:
        result = risky_operation(data)
    except ValueError as e:
        print(f"è­¦å‘Š: {e}")
        raise  # é‡æ–°æŠ›å‡ºåŸå¼‚å¸¸

# æˆ–è€…æŠ›å‡ºæ–°å¼‚å¸¸
def process_file(filename):
    try:
        # æç¤ºï¼šæ–‡ä»¶æ“ä½œçš„è¯¦ç»†å†…å®¹è¯·è§ç¬¬8ç« "æ–‡ä»¶æ“ä½œä¸I/O"
        with open(filename) as f:
            return f.read()
    except FileNotFoundError:
        raise ValueError(f"é…ç½®æ–‡ä»¶{filename}ä¸å­˜åœ¨")
```

#### 1.5ã€è‡ªå®šä¹‰å¼‚å¸¸

```python
# åŸºæœ¬è‡ªå®šä¹‰å¼‚å¸¸
class ValidationError(Exception):
    """æ•°æ®éªŒè¯é”™è¯¯"""
    pass

# å¸¦é¢å¤–ä¿¡æ¯çš„å¼‚å¸¸
class InsufficientFundsError(Exception):
    """ä½™é¢ä¸è¶³å¼‚å¸¸"""
    def __init__(self, balance, amount):
        self.balance = balance
        self.amount = amount
        self.shortage = amount - balance
        super().__init__(f"ä½™é¢ä¸è¶³ï¼šéœ€è¦{amount}ï¼Œå½“å‰{balance}ï¼Œç¼ºå°‘{self.shortage}")

# ä½¿ç”¨
def withdraw(balance, amount):
    if amount > balance:
        raise InsufficientFundsError(balance, amount)
    return balance - amount

try:
    new_balance = withdraw(100, 150)
except InsufficientFundsError as e:
    print(e)
    print(f"ç¼ºå°‘é‡‘é¢: {e.shortage}")
# è¾“å‡º:
# ä½™é¢ä¸è¶³ï¼šéœ€è¦150ï¼Œå½“å‰100ï¼Œç¼ºå°‘50
# ç¼ºå°‘é‡‘é¢: 50
```

**å¼‚å¸¸åŸºç±»æœ€ä½³å®è·µ**

```python
class AppError(Exception):
    """åº”ç”¨ç¨‹åºåŸºç¡€å¼‚å¸¸"""
    pass

class DatabaseError(AppError):
    """æ•°æ®åº“ç›¸å…³é”™è¯¯"""
    pass

class NetworkError(AppError):
    """ç½‘ç»œç›¸å…³é”™è¯¯"""
    pass

class APIError(AppError):
    """APIè°ƒç”¨é”™è¯¯"""
    def __init__(self, status_code, message):
        self.status_code = status_code
        self.message = message
        super().__init__(f"APIé”™è¯¯ {status_code}: {message}")

# ä½¿ç”¨å±‚æ¬¡åŒ–æ•è·
try:
    call_api()
except APIError as e:
    print(f"APIè°ƒç”¨å¤±è´¥: {e}")
except NetworkError as e:
    print(f"ç½‘ç»œé”™è¯¯: {e}")
except AppError as e:
    print(f"åº”ç”¨é”™è¯¯: {e}")
```

å¯¹æ¯”Javaï¼š

```java
// Javaè‡ªå®šä¹‰å¼‚å¸¸
public class InsufficientFundsException extends Exception {
    private double balance;
    private double amount;

    public InsufficientFundsException(double balance, double amount) {
        super("ä½™é¢ä¸è¶³ï¼šéœ€è¦" + amount + "ï¼Œå½“å‰" + balance);
        this.balance = balance;
        this.amount = amount;
    }

    public double getShortage() {
        return amount - balance;
    }
}
```

#### 1.6ã€å¼‚å¸¸é“¾ï¼ˆException Chainingï¼‰

Python 3æ”¯æŒå¼‚å¸¸é“¾ï¼Œä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯ã€‚

**ä½¿ç”¨`from`å…³é”®å­—**

```python
def parse_config(filename):
    try:
        with open(filename) as f:
            return json.load(f)
    except FileNotFoundError as e:
        raise ValueError(f"é…ç½®æ–‡ä»¶{filename}ä¸å­˜åœ¨") from e
    except json.JSONDecodeError as e:
        raise ValueError(f"é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯") from e

try:
    config = parse_config("config.json")
except ValueError as e:
    print(f"é”™è¯¯: {e}")
    print(f"åŸå› : {e.__cause__}")
    # å¯ä»¥è¿½æº¯åˆ°åŸå§‹å¼‚å¸¸
```

**éšå¼å¼‚å¸¸é“¾**

```python
try:
    try:
        result = 10 / 0
    except ZeroDivisionError:
        # åœ¨å¼‚å¸¸å¤„ç†ä¸­åˆå‘ç”Ÿäº†å¼‚å¸¸
        undefined_variable  # NameError
except NameError as e:
    print(f"å½“å‰å¼‚å¸¸: {e}")
    print(f"ä¹‹å‰çš„å¼‚å¸¸: {e.__context__}")
```

**æŠ‘åˆ¶å¼‚å¸¸é“¾**

```python
try:
    result = 10 / 0
except ZeroDivisionError:
    # ä½¿ç”¨from NoneæŠ‘åˆ¶å¼‚å¸¸é“¾
    raise ValueError("è®¡ç®—é”™è¯¯") from None
```

#### 1.7ã€å®ç”¨å¼‚å¸¸å¤„ç†æ¨¡å¼

**èµ„æºæ¸…ç†**

```python
# âŒ ä¸æ¨è
file = open("data.txt")
try:
    data = file.read()
    process(data)
finally:
    file.close()

# âœ… æ¨èï¼šä½¿ç”¨withè¯­å¥
with open("data.txt") as file:
    data = file.read()
    process(data)
# è‡ªåŠ¨å…³é—­æ–‡ä»¶
```

**å¤šä¸ªèµ„æº**

```python
# ç®¡ç†å¤šä¸ªèµ„æº
with open("input.txt") as infile, open("output.txt", "w") as outfile:
    data = infile.read()
    outfile.write(data.upper())
```

**EAFP vs LBYL**

Pythonæ¨å´‡EAFPï¼ˆEasier to Ask for Forgiveness than Permissionï¼Œè¯·æ±‚åŸè°…æ¯”è¯·æ±‚è®¸å¯æ›´å®¹æ˜“ï¼‰è€ŒéLBYLï¼ˆLook Before You Leapï¼Œå…ˆæ£€æŸ¥å†è¡ŒåŠ¨ï¼‰ã€‚

```python
# LBYLï¼ˆJavaé£æ ¼ï¼‰- ä¸æ¨è
if key in dictionary:
    value = dictionary[key]
else:
    value = default_value

# EAFPï¼ˆPythoné£æ ¼ï¼‰- æ¨è
try:
    value = dictionary[key]
except KeyError:
    value = default_value

# æˆ–è€…ä½¿ç”¨getæ–¹æ³•
value = dictionary.get(key, default_value)
```

**å¼‚å¸¸ä¼ æ’­ä¸æ—¥å¿—**

```python
import logging

def process_user_data(user_id):
    try:
        user = fetch_user(user_id)
        data = transform_data(user)
        save_data(data)
    except DatabaseError as e:
        logging.error(f"æ•°æ®åº“é”™è¯¯å¤„ç†ç”¨æˆ·{user_id}: {e}")
        raise  # é‡æ–°æŠ›å‡ºï¼Œè®©ä¸Šå±‚å¤„ç†
    except ValidationError as e:
        logging.warning(f"éªŒè¯å¤±è´¥ç”¨æˆ·{user_id}: {e}")
        return None  # åæ‰å¼‚å¸¸ï¼Œè¿”å›é»˜è®¤å€¼
    except Exception as e:
        logging.critical(f"æœªçŸ¥é”™è¯¯å¤„ç†ç”¨æˆ·{user_id}: {e}", exc_info=True)
        raise  # è‡´å‘½é”™è¯¯ï¼Œå¿…é¡»æŠ›å‡º
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Python | Java |
|-----|--------|------|
| åŸºæœ¬è¯­æ³• | `try-except` | `try-catch` |
| å¤šå¼‚å¸¸ | `except (E1, E2)` | å¤šä¸ª`catch`å—æˆ–`\|` |
| elseå­å¥ | æ”¯æŒ | ä¸æ”¯æŒ |
| finally | æ”¯æŒ | æ”¯æŒ |
| å¼‚å¸¸é“¾ | `raise ... from` | `Throwable.initCause()` |
| æ£€æŸ¥å¼‚å¸¸ | æ—  | æœ‰ï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰ |
| è‡ªå®šä¹‰å¼‚å¸¸ | ç»§æ‰¿`Exception` | ç»§æ‰¿`Exception` |

Pythonçš„å¼‚å¸¸å¤„ç†æ›´ç®€æ´ï¼Œä½†ç¼ºå°‘Javaçš„æ£€æŸ¥å¼‚å¸¸æœºåˆ¶ã€‚è¿™è®©Pythonæ›´çµæ´»ï¼Œä½†ä¹Ÿéœ€è¦å¼€å‘è€…æ›´è‡ªå¾‹åœ°å¤„ç†å¼‚å¸¸ï¼

### 2ã€æ–‡ä»¶æ“ä½œä¸I/O

Pythonçš„æ–‡ä»¶æ“ä½œæ¯”Javaç®€å•ç›´è§‚å¾—å¤šï¼Œæ— éœ€å¤„ç†ç¹ççš„æµå’Œç¼“å†²åŒºã€‚

> **å‰ç½®çŸ¥è¯†**ï¼šå¼‚å¸¸å¤„ç†å·²åœ¨ç¬¬1ç« "å¼‚å¸¸å¤„ç†"ä¸­ä»‹ç»ï¼Œæœ¬ç« ä¼šå¤§é‡ä½¿ç”¨`with`è¯­å¥ã€‚

#### 2.1ã€æ–‡ä»¶æ‰“å¼€ä¸å…³é—­

**åŸºæœ¬æ“ä½œ**

```python
# æ‰“å¼€æ–‡ä»¶
file = open("data.txt", "r")  # è¯»æ¨¡å¼
content = file.read()
file.close()  # å¿…é¡»æ‰‹åŠ¨å…³é—­

# âœ… æ¨èï¼šä½¿ç”¨withè¯­å¥è‡ªåŠ¨å…³é—­
with open("data.txt", "r") as file:
    content = file.read()
# è‡ªåŠ¨å…³é—­ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¼šå…³é—­
```

**æ–‡ä»¶æ¨¡å¼**

| æ¨¡å¼ | è¯´æ˜ | Javaå¯¹åº” |
|-----|------|---------|
| `'r'` | åªè¯»ï¼ˆé»˜è®¤ï¼‰ | `FileReader` |
| `'w'` | å†™å…¥ï¼ˆè¦†ç›–ï¼‰ | `FileWriter` |
| `'a'` | è¿½åŠ  | `FileWriter(file, true)` |
| `'x'` | ç‹¬å åˆ›å»ºï¼ˆæ–‡ä»¶å·²å­˜åœ¨åˆ™å¤±è´¥ï¼‰ | - |
| `'b'` | äºŒè¿›åˆ¶æ¨¡å¼ | `FileInputStream` |
| `'t'` | æ–‡æœ¬æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ | - |
| `'+'` | è¯»å†™æ¨¡å¼ | `RandomAccessFile` |

**å¸¸ç”¨ç»„åˆ**

```python
# æ–‡æœ¬æ–‡ä»¶
open("file.txt", "r")      # è¯»
open("file.txt", "w")      # å†™ï¼ˆè¦†ç›–ï¼‰
open("file.txt", "a")      # è¿½åŠ 
open("file.txt", "r+")     # è¯»å†™

# äºŒè¿›åˆ¶æ–‡ä»¶
open("image.png", "rb")    # è¯»äºŒè¿›åˆ¶
open("image.png", "wb")    # å†™äºŒè¿›åˆ¶
```

å¯¹æ¯”Javaï¼š

```java
// Javaéœ€è¦æ›´å¤šä»£ç 
try (BufferedReader reader = new BufferedReader(
        new FileReader("data.txt"))) {
    String content = reader.readLine();
} catch (IOException e) {
    e.printStackTrace();
}
```

#### 2.2ã€æ–‡æœ¬æ–‡ä»¶è¯»å†™

**è¯»å–æ–‡ä»¶**

```python
# æ–¹å¼1ï¼šä¸€æ¬¡æ€§è¯»å–å…¨éƒ¨å†…å®¹
with open("data.txt", "r", encoding="utf-8") as f:
    content = f.read()
    print(content)

# æ–¹å¼2ï¼šæŒ‰è¡Œè¯»å–ï¼ˆè¿”å›åˆ—è¡¨ï¼‰
with open("data.txt", "r", encoding="utf-8") as f:
    lines = f.readlines()
    for line in lines:
        print(line.strip())  # å»é™¤æ¢è¡Œç¬¦

# æ–¹å¼3ï¼šé€è¡Œè¿­ä»£ï¼ˆæ¨èï¼Œå†…å­˜å‹å¥½ï¼‰
with open("data.txt", "r", encoding="utf-8") as f:
    for line in f:
        print(line.strip())

# æ–¹å¼4ï¼šè¯»å–æŒ‡å®šå­—èŠ‚æ•°
with open("data.txt", "r") as f:
    chunk = f.read(100)  # è¯»å–å‰100ä¸ªå­—ç¬¦
```

**å†™å…¥æ–‡ä»¶**

```python
# å†™å…¥å­—ç¬¦ä¸²
with open("output.txt", "w", encoding="utf-8") as f:
    f.write("Hello, World!\n")
    f.write("ç¬¬äºŒè¡Œ\n")

# å†™å…¥å¤šè¡Œ
lines = ["ç¬¬ä¸€è¡Œ\n", "ç¬¬äºŒè¡Œ\n", "ç¬¬ä¸‰è¡Œ\n"]
with open("output.txt", "w", encoding="utf-8") as f:
    f.writelines(lines)

# è¿½åŠ å†…å®¹
with open("output.txt", "a", encoding="utf-8") as f:
    f.write("è¿½åŠ çš„å†…å®¹\n")
```

**å®ç”¨ç¤ºä¾‹**

```python
# å¤åˆ¶æ–‡ä»¶
with open("source.txt", "r") as src, open("dest.txt", "w") as dst:
    dst.write(src.read())

# å¤„ç†CSV
with open("data.csv", "r") as f:
    for line in f:
        fields = line.strip().split(",")
        print(fields)

# ç»Ÿè®¡è¡Œæ•°
with open("data.txt", "r") as f:
    line_count = sum(1 for line in f)
    print(f"æ€»è¡Œæ•°: {line_count}")

# æŸ¥æ‰¾å¹¶æ›¿æ¢
with open("input.txt", "r") as f:
    content = f.read()

content = content.replace("old", "new")

with open("output.txt", "w") as f:
    f.write(content)
```

#### 2.3ã€äºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†

**è¯»å†™äºŒè¿›åˆ¶æ–‡ä»¶**

```python
# è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶
with open("image.png", "rb") as f:
    data = f.read()
    print(f"æ–‡ä»¶å¤§å°: {len(data)} å­—èŠ‚")

# å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶
with open("output.bin", "wb") as f:
    f.write(b"\x00\x01\x02\x03")

# å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
with open("source.png", "rb") as src, open("dest.png", "wb") as dst:
    dst.write(src.read())

# åˆ†å—è¯»å–å¤§æ–‡ä»¶ï¼ˆå†…å­˜å‹å¥½ï¼‰
with open("large_file.bin", "rb") as f:
    while chunk := f.read(8192):  # æ¯æ¬¡è¯»8KB
        process(chunk)
```

**ä½¿ç”¨structæ¨¡å—å¤„ç†äºŒè¿›åˆ¶æ•°æ®**

```python
import struct

# å†™å…¥ç»“æ„åŒ–äºŒè¿›åˆ¶æ•°æ®
with open("data.bin", "wb") as f:
    # å†™å…¥ï¼š1ä¸ªæ•´æ•°ï¼Œ1ä¸ªæµ®ç‚¹æ•°ï¼Œ5ä¸ªå­—ç¬¦
    data = struct.pack("if5s", 42, 3.14, b"hello")
    f.write(data)

# è¯»å–ç»“æ„åŒ–äºŒè¿›åˆ¶æ•°æ®
with open("data.bin", "rb") as f:
    data = f.read()
    num, pi, text = struct.unpack("if5s", data)
    print(f"æ•´æ•°: {num}, æµ®ç‚¹: {pi}, æ–‡æœ¬: {text.decode()}")
```

#### 2.4ã€pathlibæ¨¡å—ï¼ˆç°ä»£è·¯å¾„æ“ä½œï¼‰

`pathlib`æ˜¯Python 3.4+æ¨èçš„è·¯å¾„æ“ä½œæ–¹å¼ï¼Œé¢å‘å¯¹è±¡ï¼Œæ¯”`os.path`æ›´ç›´è§‚ã€‚

**åŸºæœ¬ç”¨æ³•**

```python
from pathlib import Path

# åˆ›å»ºPathå¯¹è±¡
file_path = Path("data/file.txt")
absolute_path = Path("/usr/local/bin/python")

# è·å–å½“å‰ç›®å½•
current_dir = Path.cwd()
print(current_dir)

# è·å–ç”¨æˆ·ä¸»ç›®å½•
home_dir = Path.home()
print(home_dir)

# è·¯å¾„æ‹¼æ¥
config_file = Path.home() / "config" / "settings.json"
# ç­‰åŒäºï¼šPath.home().joinpath("config", "settings.json")
```

**è·¯å¾„å±æ€§**

```python
file_path = Path("/home/user/documents/report.pdf")

print(file_path.name)        # report.pdfï¼ˆæ–‡ä»¶åï¼‰
print(file_path.stem)        # reportï¼ˆæ–‡ä»¶åä¸å«æ‰©å±•åï¼‰
print(file_path.suffix)      # .pdfï¼ˆæ‰©å±•åï¼‰
print(file_path.parent)      # /home/user/documentsï¼ˆçˆ¶ç›®å½•ï¼‰
print(file_path.parents[0])  # /home/user/documents
print(file_path.parents[1])  # /home/user
print(file_path.anchor)      # /ï¼ˆæ ¹ç›®å½•ï¼‰
print(file_path.parts)       # ('/', 'home', 'user', 'documents', 'report.pdf')
```

**æ–‡ä»¶ç³»ç»Ÿæ“ä½œ**

```python
from pathlib import Path

file_path = Path("data.txt")

# æ£€æŸ¥å­˜åœ¨æ€§
if file_path.exists():
    print("æ–‡ä»¶å­˜åœ¨")

# æ£€æŸ¥ç±»å‹
if file_path.is_file():
    print("æ˜¯æ–‡ä»¶")
if file_path.is_dir():
    print("æ˜¯ç›®å½•")

# è¯»å†™æ–‡ä»¶
file_path.write_text("Hello, World!", encoding="utf-8")
content = file_path.read_text(encoding="utf-8")

# äºŒè¿›åˆ¶è¯»å†™
file_path.write_bytes(b"\x00\x01\x02")
data = file_path.read_bytes()

# åˆ›å»ºç›®å½•
Path("new_dir").mkdir(exist_ok=True)           # åˆ›å»ºå•å±‚ç›®å½•
Path("parent/child").mkdir(parents=True, exist_ok=True)  # åˆ›å»ºå¤šå±‚

# åˆ é™¤æ–‡ä»¶
file_path.unlink(missing_ok=True)  # Python 3.8+

# éå†ç›®å½•
for item in Path(".").iterdir():
    print(item)

# æ¨¡å¼åŒ¹é…æŸ¥æ‰¾æ–‡ä»¶
for py_file in Path(".").glob("*.py"):
    print(py_file)

for py_file in Path(".").rglob("*.py"):  # é€’å½’æŸ¥æ‰¾
    print(py_file)
```

**å®ç”¨ç¤ºä¾‹**

```python
from pathlib import Path

# æŸ¥æ‰¾é¡¹ç›®ä¸­æ‰€æœ‰Pythonæ–‡ä»¶
project_root = Path(".")
python_files = list(project_root.rglob("*.py"))
print(f"æ‰¾åˆ°{len(python_files)}ä¸ªPythonæ–‡ä»¶")

# ç»Ÿè®¡ä»£ç è¡Œæ•°
total_lines = 0
for py_file in python_files:
    lines = py_file.read_text().count("\n")
    total_lines += lines
print(f"æ€»è¡Œæ•°: {total_lines}")

# å®‰å…¨åœ°å¤„ç†é…ç½®æ–‡ä»¶
config_file = Path.home() / ".myapp" / "config.json"
if not config_file.exists():
    config_file.parent.mkdir(parents=True, exist_ok=True)
    config_file.write_text('{"default": true}')
```

å¯¹æ¯”Javaï¼š

```java
// Javaä½¿ç”¨Pathå’ŒFilesï¼ˆJava 7+ï¼‰
import java.nio.file.*;

Path filePath = Paths.get("/home/user/data.txt");
String content = Files.readString(filePath);
Files.writeString(filePath, "Hello");

// éå†ç›®å½•
try (var stream = Files.list(Paths.get("."))) {
    stream.forEach(System.out::println);
}
```

#### 2.5ã€æ ‡å‡†è¾“å…¥è¾“å‡º

**è¾“å…¥**

```python
# input()ï¼šè¯»å–ä¸€è¡Œè¾“å…¥
name = input("è¯·è¾“å…¥å§“å: ")
print(f"ä½ å¥½, {name}!")

# è¯»å–æ•°å­—
age = int(input("è¯·è¾“å…¥å¹´é¾„: "))

# è¯»å–å¤šä¸ªå€¼
x, y = map(int, input("è¾“å…¥ä¸¤ä¸ªæ•°å­—(ç©ºæ ¼åˆ†éš”): ").split())
```

**è¾“å‡º**

```python
# print()ï¼šæ ‡å‡†è¾“å‡º
print("Hello, World!")

# å¤šä¸ªå‚æ•°
print("å§“å:", name, "å¹´é¾„:", age)

# è‡ªå®šä¹‰åˆ†éš”ç¬¦å’Œç»“æŸç¬¦
print("a", "b", "c", sep="-")      # a-b-c
print("loading", end="...")        # loading...ï¼ˆä¸æ¢è¡Œï¼‰
print(" done!")                    # loading... done!

# å†™å…¥æ–‡ä»¶
with open("output.txt", "w") as f:
    print("å†™å…¥æ–‡ä»¶", file=f)
```

**æ ¼å¼åŒ–è¾“å‡º**

```python
name = "å¼ ä¸‰"
age = 25
score = 95.678

# f-stringï¼ˆæ¨èï¼‰
print(f"å§“å: {name}, å¹´é¾„: {age}, æˆç»©: {score:.2f}")

# formatæ–¹æ³•
print("å§“å: {}, å¹´é¾„: {}, æˆç»©: {:.2f}".format(name, age, score))

# %æ ¼å¼åŒ–ï¼ˆè€å¼ï¼‰
print("å§“å: %s, å¹´é¾„: %d, æˆç»©: %.2f" % (name, age, score))
```

**å°ç»“å¯¹æ¯”è¡¨**

| æ“ä½œ | Python | Java |
|-----|--------|------|
| æ‰“å¼€æ–‡ä»¶ | `open()` | `FileReader`/`BufferedReader` |
| è‡ªåŠ¨å…³é—­ | `with`è¯­å¥ | try-with-resources |
| è¯»å–å…¨éƒ¨ | `read()` | `readAll()`æˆ–å¾ªç¯è¯»å– |
| é€è¡Œè¯»å– | `for line in f` | `BufferedReader.readLine()` |
| è·¯å¾„æ“ä½œ | `pathlib.Path` | `java.nio.file.Path` |
| æ–‡ä»¶å­˜åœ¨ | `path.exists()` | `Files.exists()` |
| åˆ›å»ºç›®å½• | `path.mkdir()` | `Files.createDirectories()` |

Pythonçš„æ–‡ä»¶I/Oæ“ä½œæ¯”Javaç®€æ´ä¼˜é›…å¾—å¤šï¼Œ`pathlib`æ¨¡å—æä¾›äº†ç°ä»£åŒ–çš„è·¯å¾„å¤„ç†æ–¹å¼ï¼

### 3ã€è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨

è¿­ä»£å™¨å’Œç”Ÿæˆå™¨æ˜¯Pythonçš„å¼ºå¤§ç‰¹æ€§ï¼Œèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤§æ•°æ®é›†å’Œå®ç°æƒ°æ€§æ±‚å€¼ã€‚

#### 3.1ã€è¿­ä»£å™¨åè®®

Pythonçš„è¿­ä»£å™¨åŸºäºä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼š`__iter__`å’Œ`__next__`ã€‚

**åŸºæœ¬æ¦‚å¿µ**

```python
# å¯è¿­ä»£å¯¹è±¡ï¼ˆIterableï¼‰ï¼šå®ç°äº†__iter__æ–¹æ³•
numbers = [1, 2, 3, 4, 5]
iterator = iter(numbers)  # è·å–è¿­ä»£å™¨

# è¿­ä»£å™¨ï¼ˆIteratorï¼‰ï¼šå®ç°äº†__iter__å’Œ__next__æ–¹æ³•
print(next(iterator))  # 1
print(next(iterator))  # 2
print(next(iterator))  # 3

# è¿­ä»£å®Œæ¯•åæŠ›å‡ºStopIteration
# next(iterator)  # è¿­ä»£å®Œæ¯•ä¼šæŠ›å‡ºStopIteration
```

**è‡ªå®šä¹‰è¿­ä»£å™¨**

```python
class Countdown:
    """å€’è®¡æ—¶è¿­ä»£å™¨"""
    def __init__(self, start):
        self.current = start

    def __iter__(self):
        return self

    def __next__(self):
        if self.current <= 0:
            raise StopIteration

        self.current -= 1
        return self.current + 1

# ä½¿ç”¨
for num in Countdown(5):
    print(num)  # 5, 4, 3, 2, 1
```

**å®ç”¨è¿­ä»£å™¨ç¤ºä¾‹**

```python
class FileReader:
    """é€è¡Œè¯»å–æ–‡ä»¶çš„è¿­ä»£å™¨"""
    def __init__(self, filename):
        self.file = open(filename, 'r')

    def __iter__(self):
        return self

    def __next__(self):
        line = self.file.readline()
        if not line:
            self.file.close()
            raise StopIteration
        return line.strip()

# ä½¿ç”¨
for line in FileReader("data.txt"):
    print(line)
```

å¯¹æ¯”Javaï¼š

```java
// Javaä½¿ç”¨Iteratoræ¥å£
Iterator<Integer> iterator = numbers.iterator();
while (iterator.hasNext()) {
    System.out.println(iterator.next());
}
```

#### 3.2ã€ç”Ÿæˆå™¨å‡½æ•°ï¼ˆyieldï¼‰

ç”Ÿæˆå™¨æ˜¯åˆ›å»ºè¿­ä»£å™¨çš„æœ€ç®€å•æ–¹å¼ï¼Œä½¿ç”¨`yield`å…³é”®å­—ã€‚

**åŸºæœ¬ç”¨æ³•**

```python
def countdown(n):
    """å€’è®¡æ—¶ç”Ÿæˆå™¨"""
    while n > 0:
        yield n
        n -= 1

# ä½¿ç”¨
for num in countdown(5):
    print(num)  # 5, 4, 3, 2, 1

# ç”Ÿæˆå™¨æ˜¯è¿­ä»£å™¨
gen = countdown(3)
print(next(gen))  # 3
print(next(gen))  # 2
print(next(gen))  # 1
# print(next(gen))  # StopIteration
```

**å·¥ä½œåŸç†**

```python
def simple_generator():
    print("å¼€å§‹")
    yield 1
    print("ç»§ç»­")
    yield 2
    print("ç»“æŸ")
    yield 3

gen = simple_generator()
print("åˆ›å»ºç”Ÿæˆå™¨")
print(next(gen))  # å¼€å§‹ -> 1
print(next(gen))  # ç»§ç»­ -> 2
print(next(gen))  # ç»“æŸ -> 3
```

**å®ç”¨ç¤ºä¾‹**

```python
# 1. æ–æ³¢é‚£å¥‘æ•°åˆ—
def fibonacci(n):
    """ç”Ÿæˆå‰nä¸ªæ–æ³¢é‚£å¥‘æ•°"""
    a, b = 0, 1
    count = 0
    while count < n:
        yield a
        a, b = b, a + b
        count += 1

print(list(fibonacci(10)))
# [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]

# 2. é€è¡Œè¯»å–å¤§æ–‡ä»¶ï¼ˆå†…å­˜å‹å¥½ï¼‰
def read_large_file(file_path):
    """é€è¡Œè¯»å–æ–‡ä»¶"""
    with open(file_path) as f:
        for line in f:
            yield line.strip()

for line in read_large_file("huge_file.txt"):
    process(line)  # ä¸€æ¬¡åªåŠ è½½ä¸€è¡Œåˆ°å†…å­˜

# 3. æ‰¹é‡å¤„ç†æ•°æ®
def batch(items, size):
    """å°†æ•°æ®åˆ†æ‰¹"""
    batch = []
    for item in items:
        batch.append(item)
        if len(batch) == size:
            yield batch
            batch = []
    if batch:  # æœ€åä¸€æ‰¹
        yield batch

# ä½¿ç”¨
data = range(100)
for batch in batch(data, 10):
    print(f"å¤„ç†æ‰¹æ¬¡: {batch}")

# 4. æ— é™åºåˆ—
def infinite_sequence():
    """æ— é™é€’å¢åºåˆ—"""
    num = 0
    while True:
        yield num
        num += 1

gen = infinite_sequence()
print(next(gen))  # 0
print(next(gen))  # 1
print(next(gen))  # 2
```

#### 3.3ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼

ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯åˆ—è¡¨æ¨å¯¼å¼çš„ç”Ÿæˆå™¨ç‰ˆæœ¬ï¼Œä½¿ç”¨åœ†æ‹¬å·ã€‚

> **æ³¨æ„**ï¼šåˆ—è¡¨æ¨å¯¼å¼å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼çš„å®Œæ•´ç”¨æ³•ï¼Œè¯·å‚è€ƒç¬¬5ç« "æ•°æ®ç»“æ„ä¸æ¨å¯¼å¼"ã€‚

**åŸºæœ¬è¯­æ³•**

```python
# åˆ—è¡¨æ¨å¯¼å¼ï¼šç«‹å³è®¡ç®—ï¼Œå ç”¨å†…å­˜
squares_list = [x**2 for x in range(1000000)]

# ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼šæƒ°æ€§è®¡ç®—ï¼ŒèŠ‚çœå†…å­˜
squares_gen = (x**2 for x in range(1000000))

# ä½¿ç”¨
for square in squares_gen:
    if square > 100:
        break
    print(square)
```

**å¯¹æ¯”**

```python
import sys

# åˆ—è¡¨æ¨å¯¼å¼
list_comp = [x for x in range(10000)]
print(f"åˆ—è¡¨å¤§å°: {sys.getsizeof(list_comp)} bytes")  # ~87616 bytes

# ç”Ÿæˆå™¨è¡¨è¾¾å¼
gen_expr = (x for x in range(10000))
print(f"ç”Ÿæˆå™¨å¤§å°: {sys.getsizeof(gen_expr)} bytes")  # ~112 bytes
```

**å®ç”¨ç¤ºä¾‹**

```python
# 1. è¿‡æ»¤å’Œè½¬æ¢
numbers = range(1, 11)
even_squares = (x**2 for x in numbers if x % 2 == 0)
print(list(even_squares))  # [4, 16, 36, 64, 100]

# 2. é“¾å¼å¤„ç†
lines = (line.strip() for line in open("data.txt"))
non_empty = (line for line in lines if line)
uppercase = (line.upper() for line in non_empty)

for line in uppercase:
    print(line)

# 3. ä½œä¸ºå‡½æ•°å‚æ•°
sum_of_squares = sum(x**2 for x in range(10))
print(sum_of_squares)  # 285

max_value = max((x**2 for x in range(10)))
print(max_value)  # 81

# 4. å†…å­˜å‹å¥½çš„æ•°æ®å¤„ç†
total = sum(int(line) for line in open("numbers.txt"))
```

#### 3.4ã€itertoolsæ¨¡å—

`itertools`æä¾›äº†é«˜æ•ˆçš„è¿­ä»£å™¨å·¥å…·ã€‚

**æ— é™è¿­ä»£å™¨**

```python
from itertools import count, cycle, repeat

# countï¼šæ— é™è®¡æ•°
for i in count(10, 2):  # ä»10å¼€å§‹ï¼Œæ­¥é•¿2
    if i > 20:
        break
    print(i)  # 10, 12, 14, 16, 18, 20

# cycleï¼šæ— é™å¾ªç¯
counter = 0
for item in cycle(['A', 'B', 'C']):
    if counter >= 5:
        break
    print(item, end=" ")  # A B C A B
    counter += 1

# repeatï¼šé‡å¤å…ƒç´ 
for item in repeat('Hello', 3):
    print(item)  # Hello(3æ¬¡)
```

**ç»„åˆè¿­ä»£å™¨**

```python
from itertools import chain, zip_longest, product, combinations, permutations

# chainï¼šè¿æ¥å¤šä¸ªè¿­ä»£å™¨
for item in chain([1, 2], [3, 4], [5, 6]):
    print(item, end=" ")  # 1 2 3 4 5 6

# zip_longestï¼šé…å¯¹ï¼ˆè¡¥é½ï¼‰
for pair in zip_longest([1, 2, 3], ['a', 'b'], fillvalue='?'):
    print(pair)  # (1, 'a'), (2, 'b'), (3, '?')

# productï¼šç¬›å¡å°”ç§¯
for pair in product([1, 2], ['a', 'b']):
    print(pair)  # (1, 'a'), (1, 'b'), (2, 'a'), (2, 'b')

# combinationsï¼šç»„åˆ
for combo in combinations([1, 2, 3, 4], 2):
    print(combo)  # (1,2), (1,3), (1,4), (2,3), (2,4), (3,4)

# permutationsï¼šæ’åˆ—
for perm in permutations([1, 2, 3], 2):
    print(perm)  # (1,2), (1,3), (2,1), (2,3), (3,1), (3,2)
```

**è¿‡æ»¤å’Œåˆ†ç»„**

```python
from itertools import filterfalse, dropwhile, takewhile, groupby

# filterfalseï¼šè¿‡æ»¤å‡å€¼
data = [1, 0, 2, 0, 3]
non_zero = filterfalse(lambda x: x == 0, data)
print(list(non_zero))  # [1, 2, 3]

# dropwhileï¼šä¸¢å¼ƒç›´åˆ°æ¡ä»¶ä¸ºå‡
numbers = [1, 3, 5, 6, 7, 8, 9]
result = dropwhile(lambda x: x < 6, numbers)
print(list(result))  # [6, 7, 8, 9]

# takewhileï¼šè·å–ç›´åˆ°æ¡ä»¶ä¸ºå‡
result = takewhile(lambda x: x < 6, numbers)
print(list(result))  # [1, 3, 5]

# groupbyï¼šåˆ†ç»„
data = [('A', 1), ('A', 2), ('B', 3), ('B', 4), ('A', 5)]
for key, group in groupby(data, lambda x: x[0]):
    print(f"{key}: {list(group)}")
# A: [('A', 1), ('A', 2)]
# B: [('B', 3), ('B', 4)]
# A: [('A', 5)]
```

**å®ç”¨ç»„åˆ**

```python
from itertools import islice, tee, accumulate

# isliceï¼šåˆ‡ç‰‡è¿­ä»£å™¨
gen = (x**2 for x in range(100))
first_10 = list(islice(gen, 10))
print(first_10)  # [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]

# teeï¼šå¤åˆ¶è¿­ä»£å™¨
gen1, gen2 = tee(range(5), 2)
print(list(gen1))  # [0, 1, 2, 3, 4]
print(list(gen2))  # [0, 1, 2, 3, 4]

# accumulateï¼šç´¯ç§¯
from operator import mul
numbers = [1, 2, 3, 4, 5]
print(list(accumulate(numbers)))        # [1, 3, 6, 10, 15]ï¼ˆç´¯åŠ ï¼‰
print(list(accumulate(numbers, mul)))   # [1, 2, 6, 24, 120]ï¼ˆç´¯ä¹˜ï¼‰
```

#### 3.5ã€æƒ°æ€§æ±‚å€¼ä¼˜åŠ¿

ç”Ÿæˆå™¨çš„æƒ°æ€§æ±‚å€¼ç‰¹æ€§å¸¦æ¥å·¨å¤§ä¼˜åŠ¿ã€‚

**å†…å­˜æ•ˆç‡**

```python
# âŒ åˆ—è¡¨ï¼šç«‹å³è®¡ç®—ï¼Œå ç”¨å¤§é‡å†…å­˜
def process_data_list():
    data = [expensive_operation(x) for x in range(1000000)]
    return sum(data)

# âœ… ç”Ÿæˆå™¨ï¼šæƒ°æ€§è®¡ç®—ï¼Œå†…å­˜å ç”¨å°
def process_data_generator():
    data = (expensive_operation(x) for x in range(1000000))
    return sum(data)
```

**æ— é™åºåˆ—**

```python
# ç”Ÿæˆå™¨å¯ä»¥è¡¨ç¤ºæ— é™åºåˆ—
def primes():
    """æ— é™ç´ æ•°ç”Ÿæˆå™¨"""
    yield 2
    candidates = count(3, 2)
    while True:
        prime = next(candidates)
        yield prime
        candidates = (x for x in candidates if x % prime != 0)

# å–å‰10ä¸ªç´ æ•°
prime_gen = primes()
first_10_primes = [next(prime_gen) for _ in range(10)]
print(first_10_primes)  # [2, 3, 5, 7, 11, 13, 17, 19, 23, 29]
```

**ç®¡é“å¼å¤„ç†**

```python
# æ•°æ®å¤„ç†ç®¡é“
def read_log(filename):
    """è¯»å–æ—¥å¿—"""
    with open(filename) as f:
        for line in f:
            yield line.strip()

def filter_errors(lines):
    """è¿‡æ»¤é”™è¯¯"""
    for line in lines:
        if 'ERROR' in line:
            yield line

def parse_timestamp(lines):
    """è§£ææ—¶é—´æˆ³"""
    for line in lines:
        # å‡è®¾æ ¼å¼ï¼š[2024-01-01 10:00:00] ERROR: message
        yield line.split(']')[0][1:]

# ç®¡é“ç»„åˆ
lines = read_log("app.log")
errors = filter_errors(lines)
timestamps = parse_timestamp(errors)

# æƒ°æ€§æ‰§è¡Œï¼Œåªåœ¨éœ€è¦æ—¶å¤„ç†
for ts in timestamps:
    print(ts)
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | åˆ—è¡¨ | ç”Ÿæˆå™¨ | Java Stream |
|-----|------|--------|------------|
| æ±‚å€¼æ–¹å¼ | ç«‹å³ | æƒ°æ€§ | æƒ°æ€§ |
| å†…å­˜å ç”¨ | å¤§ | å° | å° |
| å¯é‡å¤ä½¿ç”¨ | âœ… | âŒ | âŒ |
| ç´¢å¼•è®¿é—® | âœ… | âŒ | âŒ |
| é•¿åº¦è·å– | âœ… | âŒ | âŒ |
| æ— é™åºåˆ— | âŒ | âœ… | âœ… |

### 4ã€è£…é¥°å™¨

è£…é¥°å™¨æ˜¯Pythonçš„å¼ºå¤§ç‰¹æ€§ï¼Œå…è®¸åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°/ç±»çš„æƒ…å†µä¸‹å¢å¼ºå…¶åŠŸèƒ½ã€‚è¿™ç±»ä¼¼äºJavaçš„æ³¨è§£+AOPï¼Œä½†æ›´çµæ´»å¼ºå¤§ã€‚

> **å‰ç½®çŸ¥è¯†**ï¼šè£…é¥°å™¨åŸºäºé—­åŒ…æ¦‚å¿µï¼Œé—­åŒ…å·²åœ¨ç¬¬6ç« "å‡½æ•°å®šä¹‰ä¸ä½¿ç”¨"ä¸­ä»‹ç»ã€‚

#### 4.1ã€å‡½æ•°è£…é¥°å™¨åŸºç¡€

**åŸºæœ¬æ¦‚å¿µ**

è£…é¥°å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°å¹¶è¿”å›æ–°å‡½æ•°çš„é«˜é˜¶å‡½æ•°ã€‚

```python
# æœ€ç®€å•çš„è£…é¥°å™¨
def my_decorator(func):
    """è£…é¥°å™¨å‡½æ•°"""
    def wrapper():
        print("å‡½æ•°æ‰§è¡Œå‰")
        func()
        print("å‡½æ•°æ‰§è¡Œå")
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨ï¼ˆæ–¹å¼1ï¼šæ‰‹åŠ¨åŒ…è£…ï¼‰
def say_hello():
    print("Hello!")

say_hello = my_decorator(say_hello)
say_hello()
# è¾“å‡º:
# å‡½æ•°æ‰§è¡Œå‰
# Hello!
# å‡½æ•°æ‰§è¡Œå

# ä½¿ç”¨è£…é¥°å™¨ï¼ˆæ–¹å¼2ï¼š@è¯­æ³•ç³–ï¼‰
@my_decorator
def say_world():
    print("World!")

say_world()
# è¾“å‡º:
# å‡½æ•°æ‰§è¡Œå‰
# World!
# å‡½æ•°æ‰§è¡Œå
```

**å¸¦å‚æ•°çš„å‡½æ•°è£…é¥°**

```python
def my_decorator(func):
    def wrapper(*args, **kwargs):
        """æ¥å—ä»»æ„å‚æ•°"""
        print(f"è°ƒç”¨ {func.__name__}ï¼Œå‚æ•°: {args}, {kwargs}")
        result = func(*args, **kwargs)
        print(f"è¿”å›å€¼: {result}")
        return result
    return wrapper

@my_decorator
def add(a, b):
    return a + b

@my_decorator
def greet(name, greeting="Hello"):
    return f"{greeting}, {name}!"

# ä½¿ç”¨
result = add(3, 5)
# è°ƒç”¨ addï¼Œå‚æ•°: (3, 5), {}
# è¿”å›å€¼: 8

message = greet("å¼ ä¸‰", greeting="ä½ å¥½")
# è°ƒç”¨ greetï¼Œå‚æ•°: ('å¼ ä¸‰',), {'greeting': 'ä½ å¥½'}
# è¿”å›å€¼: ä½ å¥½, å¼ ä¸‰!
```

å¯¹æ¯”Javaï¼š

```java
// Javaéœ€è¦ä½¿ç”¨æ³¨è§£+AOPæˆ–ä»£ç†æ¨¡å¼
@Around("@annotation(LogExecution)")
public Object logExecution(ProceedingJoinPoint joinPoint) throws Throwable {
    System.out.println("æ–¹æ³•æ‰§è¡Œå‰");
    Object result = joinPoint.proceed();
    System.out.println("æ–¹æ³•æ‰§è¡Œå");
    return result;
}

@LogExecution
public void sayHello() {
    System.out.println("Hello!");
}
```

#### 4.2ã€functools.wrapsä¿ç•™å…ƒä¿¡æ¯

è£…é¥°å™¨ä¼šæ”¹å˜å‡½æ•°çš„å…ƒä¿¡æ¯ï¼Œ`functools.wraps`ç”¨äºä¿ç•™åŸå‡½æ•°çš„å…ƒæ•°æ®ã€‚

```python
from functools import wraps

# âŒ ä¸ä½¿ç”¨wraps
def bad_decorator(func):
    def wrapper(*args, **kwargs):
        """è¿™æ˜¯wrapperçš„æ–‡æ¡£"""
        return func(*args, **kwargs)
    return wrapper

@bad_decorator
def my_function():
    """è¿™æ˜¯my_functionçš„æ–‡æ¡£"""
    pass

print(my_function.__name__)  # wrapperï¼ˆé”™è¯¯ï¼ï¼‰
print(my_function.__doc__)   # è¿™æ˜¯wrapperçš„æ–‡æ¡£ï¼ˆé”™è¯¯ï¼ï¼‰

# âœ… ä½¿ç”¨wraps
def good_decorator(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        """è¿™æ˜¯wrapperçš„æ–‡æ¡£"""
        return func(*args, **kwargs)
    return wrapper

@good_decorator
def my_function2():
    """è¿™æ˜¯my_function2çš„æ–‡æ¡£"""
    pass

print(my_function2.__name__)  # my_function2ï¼ˆæ­£ç¡®ï¼ï¼‰
print(my_function2.__doc__)   # è¿™æ˜¯my_function2çš„æ–‡æ¡£ï¼ˆæ­£ç¡®ï¼ï¼‰
```

**æ ‡å‡†è£…é¥°å™¨æ¨¡æ¿**

```python
from functools import wraps

def my_decorator(func):
    """æ ‡å‡†è£…é¥°å™¨æ¨¡æ¿"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        # æ‰§è¡Œå‰çš„é€»è¾‘
        print(f"Before calling {func.__name__}")

        # è°ƒç”¨åŸå‡½æ•°
        result = func(*args, **kwargs)

        # æ‰§è¡Œåçš„é€»è¾‘
        print(f"After calling {func.__name__}")

        return result
    return wrapper
```

#### 4.3ã€å¸¦å‚æ•°çš„è£…é¥°å™¨

è£…é¥°å™¨æœ¬èº«ä¹Ÿå¯ä»¥æ¥å—å‚æ•°ã€‚

```python
from functools import wraps

def repeat(times):
    """é‡å¤æ‰§è¡Œè£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for i in range(times):
                print(f"ç¬¬{i+1}æ¬¡æ‰§è¡Œ:")
                result = func(*args, **kwargs)
            return result
        return wrapper
    return decorator

@repeat(3)
def greet(name):
    print(f"Hello, {name}!")

greet("å¼ ä¸‰")
# è¾“å‡º:
# ç¬¬1æ¬¡æ‰§è¡Œ:
# Hello, å¼ ä¸‰!
# ç¬¬2æ¬¡æ‰§è¡Œ:
# Hello, å¼ ä¸‰!
# ç¬¬3æ¬¡æ‰§è¡Œ:
# Hello, å¼ ä¸‰!
```

**å·¥ä½œåŸç†**

```python
# @repeat(3) ç­‰ä»·äº:
# greet = repeat(3)(greet)

# åˆ†æ­¥ç†è§£:
decorator = repeat(3)      # è°ƒç”¨repeat(3)ï¼Œè¿”å›decoratorå‡½æ•°
greet = decorator(greet)   # è°ƒç”¨decorator(greet)ï¼Œè¿”å›wrapper
```

**å®ç”¨å¸¦å‚æ•°è£…é¥°å™¨ç¤ºä¾‹**

```python
from functools import wraps
import time

def retry(max_attempts=3, delay=1):
    """é‡è¯•è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_attempts):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_attempts - 1:
                        raise e
                    print(f"ç¬¬{attempt + 1}æ¬¡å°è¯•å¤±è´¥ï¼Œ{delay}ç§’åé‡è¯•...")
                    time.sleep(delay)
        return wrapper
    return decorator

@retry(max_attempts=5, delay=2)
def unstable_api_call():
    """ä¸ç¨³å®šçš„APIè°ƒç”¨"""
    import random
    if random.random() < 0.7:
        raise ConnectionError("APIè°ƒç”¨å¤±è´¥")
    return "æˆåŠŸ"

# ä½¿ç”¨
result = unstable_api_call()
```

#### 4.4ã€ç±»è£…é¥°å™¨

ç±»ä¹Ÿå¯ä»¥ä½œä¸ºè£…é¥°å™¨ï¼Œé€šè¿‡å®ç°`__call__`æ–¹æ³•ã€‚

```python
from functools import wraps

class CountCalls:
    """ç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°"""
    def __init__(self, func):
        wraps(func)(self)
        self.func = func
        self.count = 0

    def __call__(self, *args, **kwargs):
        self.count += 1
        print(f"{self.func.__name__} å·²è¢«è°ƒç”¨ {self.count} æ¬¡")
        return self.func(*args, **kwargs)

@CountCalls
def say_hello():
    print("Hello!")

say_hello()  # say_hello å·²è¢«è°ƒç”¨ 1 æ¬¡ -> Hello!
say_hello()  # say_hello å·²è¢«è°ƒç”¨ 2 æ¬¡ -> Hello!
say_hello()  # say_hello å·²è¢«è°ƒç”¨ 3 æ¬¡ -> Hello!

print(say_hello.count)  # 3
```

**å¸¦å‚æ•°çš„ç±»è£…é¥°å™¨**

```python
from functools import wraps

class LogWith:
    """å¸¦æ—¥å¿—çº§åˆ«çš„è£…é¥°å™¨"""
    def __init__(self, level="INFO"):
        self.level = level

    def __call__(self, func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            print(f"[{self.level}] è°ƒç”¨ {func.__name__}")
            result = func(*args, **kwargs)
            print(f"[{self.level}] {func.__name__} è¿”å› {result}")
            return result
        return wrapper

@LogWith(level="DEBUG")
def add(a, b):
    return a + b

result = add(3, 5)
# [DEBUG] è°ƒç”¨ add
# [DEBUG] add è¿”å› 8
```

#### 4.5ã€è£…é¥°å™¨å åŠ 

å¤šä¸ªè£…é¥°å™¨å¯ä»¥å åŠ ä½¿ç”¨ã€‚

```python
def make_bold(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        return "<b>" + func(*args, **kwargs) + "</b>"
    return wrapper

def make_italic(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        return "<i>" + func(*args, **kwargs) + "</i>"
    return wrapper

@make_bold
@make_italic
def say_hello():
    return "Hello!"

print(say_hello())  # <b><i>Hello!</i></b>

# ç­‰ä»·äº:
# say_hello = make_bold(make_italic(say_hello))
# æ‰§è¡Œé¡ºåºï¼šä»ä¸‹åˆ°ä¸Šè£…é¥°ï¼Œä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ
```

**é¡ºåºç†è§£**

```python
def decorator1(func):
    print(f"è£…é¥°å™¨1 è£…é¥° {func.__name__}")
    @wraps(func)
    def wrapper(*args, **kwargs):
        print("è£…é¥°å™¨1: æ‰§è¡Œå‰")
        result = func(*args, **kwargs)
        print("è£…é¥°å™¨1: æ‰§è¡Œå")
        return result
    return wrapper

def decorator2(func):
    print(f"è£…é¥°å™¨2 è£…é¥° {func.__name__}")
    @wraps(func)
    def wrapper(*args, **kwargs):
        print("è£…é¥°å™¨2: æ‰§è¡Œå‰")
        result = func(*args, **kwargs)
        print("è£…é¥°å™¨2: æ‰§è¡Œå")
        return result
    return wrapper

@decorator1
@decorator2
def test():
    print("æ‰§è¡Œtestå‡½æ•°")

# è£…é¥°é˜¶æ®µè¾“å‡º:
# è£…é¥°å™¨2 è£…é¥° test
# è£…é¥°å™¨1 è£…é¥° wrapper

test()
# æ‰§è¡Œé˜¶æ®µè¾“å‡º:
# è£…é¥°å™¨1: æ‰§è¡Œå‰
# è£…é¥°å™¨2: æ‰§è¡Œå‰
# æ‰§è¡Œtestå‡½æ•°
# è£…é¥°å™¨2: æ‰§è¡Œå
# è£…é¥°å™¨1: æ‰§è¡Œå
```

#### 4.6ã€å¸¸ç”¨å†…ç½®è£…é¥°å™¨

Pythonæä¾›äº†ä¸€äº›å¸¸ç”¨çš„å†…ç½®è£…é¥°å™¨ã€‚

**@propertyï¼ˆå±æ€§è£…é¥°å™¨ï¼‰**

> **è¯¦ç»†å†…å®¹**ï¼špropertyè£…é¥°å™¨çš„å®Œæ•´ç”¨æ³•å·²åœ¨ç¬¬3ç« "é¢å‘å¯¹è±¡ç¼–ç¨‹"ä¸­è¯¦ç»†ä»‹ç»ã€‚

```python
class Circle:
    def __init__(self, radius):
        self._radius = radius

    @property
    def radius(self):
        """åŠå¾„ï¼ˆåªè¯»ï¼‰"""
        return self._radius

    @property
    def area(self):
        """é¢ç§¯ï¼ˆè®¡ç®—å±æ€§ï¼‰"""
        return 3.14159 * self._radius ** 2

    @area.setter
    def area(self, value):
        """é€šè¿‡é¢ç§¯åæ¨åŠå¾„"""
        self._radius = (value / 3.14159) ** 0.5

circle = Circle(5)
print(circle.area)    # 78.53975
circle.area = 100
print(circle.radius)  # 5.641895835477563
```

**@staticmethodï¼ˆé™æ€æ–¹æ³•ï¼‰**

```python
class MathUtils:
    @staticmethod
    def add(a, b):
        """é™æ€æ–¹æ³•ï¼Œä¸éœ€è¦è®¿é—®ç±»æˆ–å®ä¾‹"""
        return a + b

    @staticmethod
    def is_even(n):
        return n % 2 == 0

# ä½¿ç”¨
print(MathUtils.add(3, 5))      # 8
print(MathUtils.is_even(4))     # True
```

**@classmethodï¼ˆç±»æ–¹æ³•ï¼‰**

```python
class Date:
    def __init__(self, year, month, day):
        self.year = year
        self.month = month
        self.day = day

    @classmethod
    def from_string(cls, date_string):
        """å·¥å‚æ–¹æ³•ï¼šä»å­—ç¬¦ä¸²åˆ›å»º"""
        year, month, day = map(int, date_string.split('-'))
        return cls(year, month, day)

    @classmethod
    def today(cls):
        """å·¥å‚æ–¹æ³•ï¼šåˆ›å»ºä»Šå¤©çš„æ—¥æœŸ"""
        import datetime
        now = datetime.date.today()
        return cls(now.year, now.month, now.day)

# ä½¿ç”¨
date1 = Date.from_string("2024-10-26")
date2 = Date.today()
```

**@cached_propertyï¼ˆç¼“å­˜å±æ€§ï¼‰**

```python
from functools import cached_property

class DataProcessor:
    def __init__(self, data):
        self.data = data

    @cached_property
    def processed_data(self):
        """è®¡ç®—é‡å¤§çš„å±æ€§ï¼Œåªè®¡ç®—ä¸€æ¬¡"""
        print("å¤„ç†æ•°æ®ä¸­...")
        import time
        time.sleep(2)  # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        return [x * 2 for x in self.data]

processor = DataProcessor([1, 2, 3, 4, 5])
print(processor.processed_data)  # å¤„ç†æ•°æ®ä¸­... [2, 4, 6, 8, 10]
print(processor.processed_data)  # [2, 4, 6, 8, 10]ï¼ˆç›´æ¥è¿”å›ç¼“å­˜ï¼‰
```

#### 4.7ã€è£…é¥°å™¨å®æˆ˜æ¡ˆä¾‹

**æ¡ˆä¾‹1ï¼šæ€§èƒ½è®¡æ—¶å™¨**

```python
from functools import wraps
import time

def timer(func):
    """æµ‹é‡å‡½æ•°æ‰§è¡Œæ—¶é—´"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {end - start:.4f}ç§’")
        return result
    return wrapper

@timer
def slow_function():
    time.sleep(1)
    return "å®Œæˆ"

result = slow_function()
# slow_function æ‰§è¡Œæ—¶é—´: 1.0012ç§’
```

**æ¡ˆä¾‹2ï¼šæƒé™æ£€æŸ¥**

```python
from functools import wraps

def require_auth(func):
    """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        # å‡è®¾æœ‰ä¸€ä¸ªå…¨å±€çš„å½“å‰ç”¨æˆ·å¯¹è±¡
        if not hasattr(wrapper, 'current_user') or not wrapper.current_user:
            raise PermissionError("éœ€è¦ç™»å½•")
        return func(*args, **kwargs)
    return wrapper

def require_role(role):
    """æ£€æŸ¥ç”¨æˆ·è§’è‰²"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            if not hasattr(wrapper, 'current_user'):
                raise PermissionError("éœ€è¦ç™»å½•")
            if wrapper.current_user.get('role') != role:
                raise PermissionError(f"éœ€è¦{role}æƒé™")
            return func(*args, **kwargs)
        return wrapper
    return decorator

@require_auth
def view_profile():
    return "ä¸ªäººèµ„æ–™"

@require_role('admin')
def delete_user(user_id):
    return f"åˆ é™¤ç”¨æˆ· {user_id}"

# è®¾ç½®å½“å‰ç”¨æˆ·
view_profile.current_user = {"username": "å¼ ä¸‰", "role": "user"}
delete_user.current_user = {"username": "ç®¡ç†å‘˜", "role": "admin"}

print(view_profile())      # ä¸ªäººèµ„æ–™
print(delete_user(123))    # åˆ é™¤ç”¨æˆ· 123
```

**æ¡ˆä¾‹3ï¼šç¼“å­˜/è®°å¿†åŒ–**

```python
from functools import wraps

def memoize(func):
    """ç¼“å­˜å‡½æ•°ç»“æœ"""
    cache = {}

    @wraps(func)
    def wrapper(*args):
        if args not in cache:
            print(f"è®¡ç®— {func.__name__}{args}")
            cache[args] = func(*args)
        else:
            print(f"ä»ç¼“å­˜è·å– {args}")
        return cache[args]

    # æ·»åŠ æ¸…é™¤ç¼“å­˜çš„æ–¹æ³•
    wrapper.cache = cache
    wrapper.clear_cache = lambda: cache.clear()

    return wrapper

@memoize
def fibonacci(n):
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print(fibonacci(10))
# è®¡ç®— fibonacci(10)
# è®¡ç®— fibonacci(9)
# ...
# 55

print(fibonacci(10))  # ä»ç¼“å­˜è·å– (10)
print(fibonacci.cache)  # æŸ¥çœ‹ç¼“å­˜å†…å®¹
fibonacci.clear_cache()  # æ¸…é™¤ç¼“å­˜
```

**æ¡ˆä¾‹4ï¼šè¾“å…¥éªŒè¯**

```python
from functools import wraps

def validate_types(**type_hints):
    """éªŒè¯å‡½æ•°å‚æ•°ç±»å‹"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            # è·å–å‡½æ•°ç­¾å
            import inspect
            sig = inspect.signature(func)
            bound = sig.bind(*args, **kwargs)
            bound.apply_defaults()

            # éªŒè¯ç±»å‹
            for param_name, expected_type in type_hints.items():
                if param_name in bound.arguments:
                    value = bound.arguments[param_name]
                    if not isinstance(value, expected_type):
                        raise TypeError(
                            f"{param_name} åº”ä¸º {expected_type.__name__}ï¼Œ"
                            f"å®é™…ä¸º {type(value).__name__}"
                        )

            return func(*args, **kwargs)
        return wrapper
    return decorator

@validate_types(name=str, age=int, salary=float)
def create_employee(name, age, salary):
    return f"{name}, {age}å², è–ªèµ„{salary}"

# æ­£ç¡®è°ƒç”¨
print(create_employee("å¼ ä¸‰", 25, 5000.0))

# é”™è¯¯è°ƒç”¨
try:
    create_employee("æå››", "30", 6000.0)  # ageç±»å‹é”™è¯¯
except TypeError as e:
    print(e)  # age åº”ä¸º intï¼Œå®é™…ä¸º str
```

**æ¡ˆä¾‹5ï¼šæ—¥å¿—è®°å½•**

```python
from functools import wraps
import logging

logging.basicConfig(level=logging.INFO)

def log_calls(log_args=True, log_result=True):
    """è®°å½•å‡½æ•°è°ƒç”¨æ—¥å¿—"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            logger = logging.getLogger(func.__module__)

            # è®°å½•è°ƒç”¨
            if log_args:
                logger.info(f"è°ƒç”¨ {func.__name__}ï¼Œå‚æ•°: {args}, {kwargs}")
            else:
                logger.info(f"è°ƒç”¨ {func.__name__}")

            try:
                result = func(*args, **kwargs)

                # è®°å½•ç»“æœ
                if log_result:
                    logger.info(f"{func.__name__} è¿”å›: {result}")

                return result
            except Exception as e:
                logger.error(f"{func.__name__} æŠ›å‡ºå¼‚å¸¸: {e}")
                raise

        return wrapper
    return decorator

@log_calls(log_args=True, log_result=True)
def divide(a, b):
    return a / b

result = divide(10, 2)
# INFO:__main__:è°ƒç”¨ divideï¼Œå‚æ•°: (10, 2), {}
# INFO:__main__:divide è¿”å›: 5.0

try:
    divide(10, 0)
except ZeroDivisionError:
    pass
# INFO:__main__:è°ƒç”¨ divideï¼Œå‚æ•°: (10, 0), {}
# ERROR:__main__:divide æŠ›å‡ºå¼‚å¸¸: division by zero
```

**æ¡ˆä¾‹6ï¼šå•ä¾‹æ¨¡å¼**

```python
from functools import wraps

def singleton(cls):
    """å•ä¾‹è£…é¥°å™¨"""
    instances = {}

    @wraps(cls)
    def get_instance(*args, **kwargs):
        if cls not in instances:
            instances[cls] = cls(*args, **kwargs)
        return instances[cls]

    return get_instance

@singleton
class DatabaseConnection:
    def __init__(self, host, port):
        self.host = host
        self.port = port
        print(f"è¿æ¥åˆ°æ•°æ®åº“ {host}:{port}")

# ä½¿ç”¨
db1 = DatabaseConnection("localhost", 5432)
# è¿æ¥åˆ°æ•°æ®åº“ localhost:5432

db2 = DatabaseConnection("localhost", 5432)
# ï¼ˆä¸ä¼šæ‰“å°ï¼Œå› ä¸ºè¿”å›çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰

print(db1 is db2)  # True
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Pythonè£…é¥°å™¨ | Javaæ³¨è§£+AOP |
|-----|------------|-------------|
| è¯­æ³• | `@decorator` | `@Annotation` |
| çµæ´»æ€§ | é«˜ï¼ˆè¿è¡Œæ—¶ä¿®æ”¹è¡Œä¸ºï¼‰ | ä¸­ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰ |
| åµŒå¥— | æ”¯æŒå¤šå±‚è£…é¥° | æ”¯æŒ |
| å¸¦å‚æ•° | æ”¯æŒ | æ”¯æŒ |
| ç±»è£…é¥° | æ”¯æŒè£…é¥°ç±» | ä¸»è¦ç”¨äºæ–¹æ³• |
| å†…çœ | å®¹æ˜“ï¼ˆ`__wrapped__`ï¼‰ | éœ€è¦åå°„ |

Pythonçš„è£…é¥°å™¨æ¯”Javaçš„æ³¨è§£æ›´çµæ´»å¼ºå¤§ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹å‡½æ•°/ç±»çš„è¡Œä¸ºï¼Œè€Œä¸”è¯­æ³•æ›´ç®€æ´ï¼

### 5ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨

ä¸Šä¸‹æ–‡ç®¡ç†å™¨è®©èµ„æºç®¡ç†å˜å¾—ä¼˜é›…å®‰å…¨ï¼Œè‡ªåŠ¨å¤„ç†èµ„æºçš„è·å–å’Œé‡Šæ”¾ã€‚è¿™ç±»ä¼¼äºJavaçš„try-with-resourcesï¼Œä½†æ›´çµæ´»ã€‚

#### 5.1ã€withè¯­å¥åŸç†

**åŸºæœ¬æ¦‚å¿µ**

`with`è¯­å¥ç¡®ä¿èµ„æºåœ¨ä½¿ç”¨åè¢«æ­£ç¡®æ¸…ç†ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸ä¹Ÿèƒ½ä¿è¯ã€‚

```python
# ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†
file = open("data.txt", "r")
try:
    content = file.read()
    process(content)
finally:
    file.close()  # å¿…é¡»æ‰‹åŠ¨å…³é—­

# withè¯­å¥ï¼šè‡ªåŠ¨ç®¡ç†
with open("data.txt", "r") as file:
    content = file.read()
    process(content)
# è‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸
```

å¯¹æ¯”Javaï¼š

```java
// Java try-with-resourcesï¼ˆJava 7+ï¼‰
try (BufferedReader reader = new BufferedReader(new FileReader("data.txt"))) {
    String content = reader.readLine();
    process(content);
} // è‡ªåŠ¨å…³é—­èµ„æº
```

**ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®**

ä¸Šä¸‹æ–‡ç®¡ç†å™¨éœ€è¦å®ç°`__enter__`å’Œ`__exit__`æ–¹æ³•ï¼š

```python
class MyContextManager:
    def __enter__(self):
        """è¿›å…¥withå—æ—¶è°ƒç”¨"""
        print("è¿›å…¥ä¸Šä¸‹æ–‡")
        return self  # è¿”å›å€¼èµ‹ç»™asåçš„å˜é‡

    def __exit__(self, exc_type, exc_value, traceback):
        """é€€å‡ºwithå—æ—¶è°ƒç”¨"""
        print("é€€å‡ºä¸Šä¸‹æ–‡")
        if exc_type is not None:
            print(f"å‘ç”Ÿå¼‚å¸¸: {exc_type.__name__}: {exc_value}")
        return False  # Falseè¡¨ç¤ºä¸æŠ‘åˆ¶å¼‚å¸¸

# ä½¿ç”¨
with MyContextManager() as cm:
    print("æ‰§è¡Œä»£ç ")
    # raise ValueError("æµ‹è¯•å¼‚å¸¸")

# è¾“å‡º:
# è¿›å…¥ä¸Šä¸‹æ–‡
# æ‰§è¡Œä»£ç 
# é€€å‡ºä¸Šä¸‹æ–‡
```

**`__exit__`æ–¹æ³•å‚æ•°è¯´æ˜**

```python
def __exit__(self, exc_type, exc_value, traceback):
    """
    exc_type: å¼‚å¸¸ç±»å‹ï¼ˆå¦‚æœæ²¡æœ‰å¼‚å¸¸åˆ™ä¸ºNoneï¼‰
    exc_value: å¼‚å¸¸å®ä¾‹ï¼ˆå¦‚æœæ²¡æœ‰å¼‚å¸¸åˆ™ä¸ºNoneï¼‰
    traceback: å¼‚å¸¸å †æ ˆï¼ˆå¦‚æœæ²¡æœ‰å¼‚å¸¸åˆ™ä¸ºNoneï¼‰

    è¿”å›å€¼:
    - Falseæˆ–None: å¼‚å¸¸ç»§ç»­ä¼ æ’­
    - True: æŠ‘åˆ¶å¼‚å¸¸ï¼ˆå¼‚å¸¸è¢«åæ‰ï¼‰
    """
    pass
```

#### 5.2ã€è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨

**æ–‡ä»¶æ“ä½œç®¡ç†å™¨**

```python
class FileManager:
    """æ–‡ä»¶ç®¡ç†å™¨"""
    def __init__(self, filename, mode):
        self.filename = filename
        self.mode = mode
        self.file = None

    def __enter__(self):
        """æ‰“å¼€æ–‡ä»¶"""
        print(f"æ‰“å¼€æ–‡ä»¶: {self.filename}")
        self.file = open(self.filename, self.mode)
        return self.file

    def __exit__(self, exc_type, exc_value, traceback):
        """å…³é—­æ–‡ä»¶"""
        if self.file:
            print(f"å…³é—­æ–‡ä»¶: {self.filename}")
            self.file.close()
        return False

# ä½¿ç”¨
with FileManager("test.txt", "w") as f:
    f.write("Hello, World!")
# è¾“å‡º:
# æ‰“å¼€æ–‡ä»¶: test.txt
# å…³é—­æ–‡ä»¶: test.txt
```

**æ•°æ®åº“è¿æ¥ç®¡ç†å™¨**

```python
class DatabaseConnection:
    """æ•°æ®åº“è¿æ¥ç®¡ç†å™¨"""
    def __init__(self, host, database):
        self.host = host
        self.database = database
        self.connection = None

    def __enter__(self):
        """å»ºç«‹è¿æ¥"""
        print(f"è¿æ¥æ•°æ®åº“: {self.host}/{self.database}")
        # è¿™é‡Œæ¨¡æ‹Ÿè¿æ¥
        self.connection = f"Connection({self.host}, {self.database})"
        return self.connection

    def __exit__(self, exc_type, exc_value, traceback):
        """å…³é—­è¿æ¥"""
        print("å…³é—­æ•°æ®åº“è¿æ¥")
        self.connection = None

        # å¦‚æœæœ‰å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡
        if exc_type is not None:
            print("å‘ç”Ÿå¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡")
        else:
            print("æäº¤äº‹åŠ¡")

        return False

# ä½¿ç”¨
with DatabaseConnection("localhost", "mydb") as conn:
    print(f"ä½¿ç”¨è¿æ¥: {conn}")
    # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
```

**è®¡æ—¶å™¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨**

```python
import time

class Timer:
    """è®¡æ—¶å™¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    def __init__(self, name="ä»£ç å—"):
        self.name = name
        self.start_time = None

    def __enter__(self):
        self.start_time = time.time()
        return self

    def __exit__(self, exc_type, exc_value, traceback):
        elapsed = time.time() - self.start_time
        print(f"{self.name} æ‰§è¡Œæ—¶é—´: {elapsed:.4f}ç§’")
        return False

# ä½¿ç”¨
with Timer("æ•°æ®å¤„ç†"):
    # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    time.sleep(1)
    result = sum(range(1000000))

# è¾“å‡º: æ•°æ®å¤„ç† æ‰§è¡Œæ—¶é—´: 1.xxxxç§’
```

**å¼‚å¸¸å¤„ç†ä¸Šä¸‹æ–‡ç®¡ç†å™¨**

```python
class IgnoreException:
    """å¿½ç•¥ç‰¹å®šå¼‚å¸¸"""
    def __init__(self, *exceptions):
        self.exceptions = exceptions

    def __enter__(self):
        return self

    def __exit__(self, exc_type, exc_value, traceback):
        # å¦‚æœå¼‚å¸¸ç±»å‹åœ¨æŒ‡å®šåˆ—è¡¨ä¸­ï¼ŒæŠ‘åˆ¶å¼‚å¸¸
        if exc_type is not None and issubclass(exc_type, self.exceptions):
            print(f"å¿½ç•¥å¼‚å¸¸: {exc_type.__name__}: {exc_value}")
            return True  # æŠ‘åˆ¶å¼‚å¸¸
        return False

# ä½¿ç”¨
with IgnoreException(ValueError, KeyError):
    data = {"a": 1}
    value = data["b"]  # KeyErrorï¼Œä½†ä¼šè¢«å¿½ç•¥
    print("ç»§ç»­æ‰§è¡Œ")  # è¿™è¡Œä¸ä¼šæ‰§è¡Œ

print("ç¨‹åºç»§ç»­")  # è¿™è¡Œä¼šæ‰§è¡Œ
# è¾“å‡º:
# å¿½ç•¥å¼‚å¸¸: KeyError: 'b'
# ç¨‹åºç»§ç»­
```

#### 5.3ã€contextlibæ¨¡å—

`contextlib`æ¨¡å—æä¾›äº†åˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ä¾¿æ·å·¥å…·ã€‚

**@contextmanagerè£…é¥°å™¨**

ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°åˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š

```python
from contextlib import contextmanager

@contextmanager
def file_manager(filename, mode):
    """ä½¿ç”¨è£…é¥°å™¨åˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    print(f"æ‰“å¼€æ–‡ä»¶: {filename}")
    file = open(filename, mode)
    try:
        yield file  # yieldå‰æ˜¯__enter__ï¼Œyieldåæ˜¯__exit__
    finally:
        print(f"å…³é—­æ–‡ä»¶: {filename}")
        file.close()

# ä½¿ç”¨
with file_manager("test.txt", "w") as f:
    f.write("Hello!")
```

**å·¥ä½œåŸç†**

```python
@contextmanager
def my_context():
    # __enter__é˜¶æ®µ
    print("è¿›å…¥")
    resource = "èµ„æºå¯¹è±¡"

    try:
        yield resource  # è¿”å›ç»™aså˜é‡
        # withå—æ­£å¸¸ç»“æŸåç»§ç»­æ‰§è¡Œ
        print("æ­£å¸¸é€€å‡º")
    except Exception as e:
        # withå—æŠ›å‡ºå¼‚å¸¸æ—¶æ‰§è¡Œ
        print(f"å¼‚å¸¸é€€å‡º: {e}")
        raise  # é‡æ–°æŠ›å‡ºå¼‚å¸¸
    finally:
        # __exit__é˜¶æ®µï¼Œæ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œ
        print("æ¸…ç†èµ„æº")

# ä½¿ç”¨
with my_context() as res:
    print(f"ä½¿ç”¨: {res}")
```

**å®ç”¨ç¤ºä¾‹**

```python
from contextlib import contextmanager
import time

@contextmanager
def timing(label):
    """è®¡æ—¶ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    start = time.time()
    try:
        yield
    finally:
        end = time.time()
        print(f"{label}: {end - start:.4f}ç§’")

# ä½¿ç”¨
with timing("æ•°æ®åº“æŸ¥è¯¢"):
    time.sleep(0.5)
    # æ‰§è¡ŒæŸ¥è¯¢
```

**ä¸´æ—¶ä¿®æ”¹ç¯å¢ƒ**

```python
from contextlib import contextmanager
import os

@contextmanager
def temporary_env(**env_vars):
    """ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡"""
    old_env = {}

    # ä¿å­˜æ—§å€¼å¹¶è®¾ç½®æ–°å€¼
    for key, value in env_vars.items():
        old_env[key] = os.environ.get(key)
        os.environ[key] = value

    try:
        yield
    finally:
        # æ¢å¤æ—§å€¼
        for key, old_value in old_env.items():
            if old_value is None:
                os.environ.pop(key, None)
            else:
                os.environ[key] = old_value

# ä½¿ç”¨
with temporary_env(DEBUG="true", LOG_LEVEL="debug"):
    print(os.environ.get("DEBUG"))  # true
    # æ‰§è¡Œéœ€è¦ç‰¹å®šç¯å¢ƒçš„ä»£ç 

print(os.environ.get("DEBUG"))  # Noneï¼ˆå·²æ¢å¤ï¼‰
```

**suppressï¼ˆæŠ‘åˆ¶å¼‚å¸¸ï¼‰**

```python
from contextlib import suppress

# ä¼ ç»Ÿå†™æ³•
try:
    os.remove("somefile.txt")
except FileNotFoundError:
    pass

# ä½¿ç”¨suppress
with suppress(FileNotFoundError):
    os.remove("somefile.txt")

# æŠ‘åˆ¶å¤šä¸ªå¼‚å¸¸
with suppress(FileNotFoundError, PermissionError):
    os.remove("protected_file.txt")
```

**closingï¼ˆè‡ªåŠ¨å…³é—­ï¼‰**

```python
from contextlib import closing
from urllib.request import urlopen

# ç¡®ä¿å¯¹è±¡çš„close()æ–¹æ³•è¢«è°ƒç”¨
with closing(urlopen("http://example.com")) as page:
    content = page.read()
# è‡ªåŠ¨è°ƒç”¨page.close()
```

**redirect_stdout/redirect_stderrï¼ˆé‡å®šå‘è¾“å‡ºï¼‰**

```python
from contextlib import redirect_stdout, redirect_stderr
import io

# é‡å®šå‘æ ‡å‡†è¾“å‡º
f = io.StringIO()
with redirect_stdout(f):
    print("è¿™äº›å†…å®¹ä¼šè¢«æ•è·")
    print("ä¸ä¼šæ‰“å°åˆ°æ§åˆ¶å°")

output = f.getvalue()
print(f"æ•è·çš„è¾“å‡º: {output}")

# é‡å®šå‘åˆ°æ–‡ä»¶
with open("output.txt", "w") as f:
    with redirect_stdout(f):
        print("å†™å…¥æ–‡ä»¶")
        help(str.upper)
```

**ExitStackï¼ˆç®¡ç†å¤šä¸ªä¸Šä¸‹æ–‡ï¼‰**

```python
from contextlib import ExitStack

# åŠ¨æ€ç®¡ç†å¤šä¸ªä¸Šä¸‹æ–‡
with ExitStack() as stack:
    # åŠ¨æ€æ·»åŠ ä¸Šä¸‹æ–‡ç®¡ç†å™¨
    files = [
        stack.enter_context(open(f"file{i}.txt", "w"))
        for i in range(5)
    ]

    # ä½¿ç”¨æ‰€æœ‰æ–‡ä»¶
    for i, f in enumerate(files):
        f.write(f"å†…å®¹ {i}\n")
# æ‰€æœ‰æ–‡ä»¶è‡ªåŠ¨å…³é—­

# æ¡ä»¶æ€§æ·»åŠ ä¸Šä¸‹æ–‡
def process_files(filenames, use_backup=False):
    with ExitStack() as stack:
        files = []

        for filename in filenames:
            file = stack.enter_context(open(filename, "r"))
            files.append(file)

            if use_backup:
                backup = stack.enter_context(
                    open(f"{filename}.bak", "w")
                )
                files.append(backup)

        # å¤„ç†æ–‡ä»¶
        for f in files:
            process(f)
```

#### 5.4ã€åµŒå¥—ä¸Šä¸‹æ–‡ç®¡ç†å™¨

**å¤šä¸ªwithè¯­å¥**

```python
# æ–¹å¼1ï¼šåµŒå¥—with
with open("input.txt", "r") as infile:
    with open("output.txt", "w") as outfile:
        data = infile.read()
        outfile.write(data.upper())

# æ–¹å¼2ï¼šå•è¡Œwithï¼ˆPython 2.7+ï¼‰
with open("input.txt", "r") as infile, open("output.txt", "w") as outfile:
    data = infile.read()
    outfile.write(data.upper())
```

**ç»„åˆä½¿ç”¨**

```python
from contextlib import contextmanager
import threading

@contextmanager
def acquire_lock(lock):
    """è·å–é”"""
    print("è·å–é”")
    lock.acquire()
    try:
        yield
    finally:
        print("é‡Šæ”¾é”")
        lock.release()

# ä½¿ç”¨
lock = threading.Lock()
with acquire_lock(lock):
    # ä¸´ç•ŒåŒºä»£ç 
    print("æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ")
```

#### 5.5ã€èµ„æºç®¡ç†æœ€ä½³å®è·µ

**æ¡ˆä¾‹1ï¼šæ•°æ®åº“äº‹åŠ¡ç®¡ç†**

```python
from contextlib import contextmanager

class Database:
    def __init__(self):
        self.connection = None

    @contextmanager
    def transaction(self):
        """äº‹åŠ¡ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
        print("å¼€å§‹äº‹åŠ¡")
        try:
            yield self
            print("æäº¤äº‹åŠ¡")
            # self.connection.commit()
        except Exception as e:
            print(f"å›æ»šäº‹åŠ¡: {e}")
            # self.connection.rollback()
            raise

# ä½¿ç”¨
db = Database()
with db.transaction():
    # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
    pass
```

**æ¡ˆä¾‹2ï¼šä¸´æ—¶ä¿®æ”¹é…ç½®**

```python
from contextlib import contextmanager

class Config:
    debug = False
    log_level = "INFO"

@contextmanager
def temporary_config(**changes):
    """ä¸´æ—¶ä¿®æ”¹é…ç½®"""
    original = {}

    # ä¿å­˜å¹¶ä¿®æ”¹
    for key, value in changes.items():
        original[key] = getattr(Config, key)
        setattr(Config, key, value)

    try:
        yield Config
    finally:
        # æ¢å¤
        for key, value in original.items():
            setattr(Config, key, value)

# ä½¿ç”¨
print(Config.debug)  # False

with temporary_config(debug=True, log_level="DEBUG"):
    print(Config.debug)  # True
    print(Config.log_level)  # DEBUG

print(Config.debug)  # Falseï¼ˆå·²æ¢å¤ï¼‰
```

**æ¡ˆä¾‹3ï¼šæ‰¹é‡æ“ä½œ**

```python
from contextlib import contextmanager

@contextmanager
def batch_operation(batch_size=100):
    """æ‰¹é‡æ“ä½œä¸Šä¸‹æ–‡"""
    items = []

    def add_item(item):
        """æ·»åŠ é¡¹ç›®"""
        items.append(item)
        if len(items) >= batch_size:
            process_batch(items)
            items.clear()

    try:
        yield add_item
    finally:
        # å¤„ç†å‰©ä½™é¡¹ç›®
        if items:
            process_batch(items)

def process_batch(items):
    print(f"å¤„ç†æ‰¹æ¬¡: {len(items)} é¡¹")

# ä½¿ç”¨
with batch_operation(batch_size=3) as add:
    for i in range(10):
        add(f"é¡¹ç›®{i}")
# è¾“å‡º:
# å¤„ç†æ‰¹æ¬¡: 3 é¡¹
# å¤„ç†æ‰¹æ¬¡: 3 é¡¹
# å¤„ç†æ‰¹æ¬¡: 3 é¡¹
# å¤„ç†æ‰¹æ¬¡: 1 é¡¹
```

**æ¡ˆä¾‹4ï¼šæ€§èƒ½åˆ†æ**

```python
from contextlib import contextmanager
import time
import functools

@contextmanager
def profile_section(name):
    """æ€§èƒ½åˆ†æä¸Šä¸‹æ–‡"""
    start_time = time.time()
    start_memory = 0  # ç®€åŒ–ç¤ºä¾‹

    try:
        yield
    finally:
        elapsed = time.time() - start_time
        print(f"{name}:")
        print(f"  æ—¶é—´: {elapsed:.4f}ç§’")

# ä½¿ç”¨
with profile_section("æ•°æ®å¤„ç†"):
    data = [i ** 2 for i in range(1000000)]

with profile_section("æ•°æ®ä¿å­˜"):
    time.sleep(0.1)
```

**æ¡ˆä¾‹5ï¼šèµ„æºæ± ç®¡ç†**

```python
from contextlib import contextmanager
from queue import Queue

class ConnectionPool:
    """è¿æ¥æ± """
    def __init__(self, size=5):
        self.pool = Queue(maxsize=size)
        for i in range(size):
            self.pool.put(f"Connection_{i}")

    @contextmanager
    def get_connection(self):
        """è·å–è¿æ¥"""
        conn = self.pool.get()
        print(f"è·å–è¿æ¥: {conn}")
        try:
            yield conn
        finally:
            print(f"å½’è¿˜è¿æ¥: {conn}")
            self.pool.put(conn)

# ä½¿ç”¨
pool = ConnectionPool(size=2)

with pool.get_connection() as conn1:
    print(f"ä½¿ç”¨ {conn1}")

    with pool.get_connection() as conn2:
        print(f"ä½¿ç”¨ {conn2}")
```

**å°ç»“å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Pythonä¸Šä¸‹æ–‡ç®¡ç†å™¨ | Java try-with-resources |
|-----|------------------|------------------------|
| è¯­æ³• | `with obj as var:` | `try (Type var = ...) {}` |
| åè®® | `__enter__/__exit__` | `AutoCloseable.close()` |
| è‡ªå®šä¹‰ | ç±»æˆ–@contextmanager | å®ç°AutoCloseable |
| åµŒå¥— | æ”¯æŒ | æ”¯æŒ |
| å¼‚å¸¸æŠ‘åˆ¶ | æ”¯æŒï¼ˆ__exit__è¿”å›Trueï¼‰ | ä¸æ”¯æŒ |
| å¤šèµ„æº | `with a, b:` | `try (A a; B b)` |

### 6ã€å‡½æ•°å¼ç¼–ç¨‹

> **è¯´æ˜**ï¼šåˆ—è¡¨æ¨å¯¼å¼å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼å·²åœ¨ç¬¬5ç« "æ•°æ®ç»“æ„ä¸æ¨å¯¼å¼"ä¸­è¯¦ç»†è®²è§£ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚

Pythonè™½ç„¶ä¸æ˜¯çº¯å‡½æ•°å¼è¯­è¨€,ä½†æä¾›äº†ä¸°å¯Œçš„å‡½æ•°å¼ç¼–ç¨‹å·¥å…·ã€‚å¯¹äºç†Ÿæ‚‰Java 8+ Stream APIçš„å¼€å‘è€…æ¥è¯´,Pythonçš„å‡½æ•°å¼ç‰¹æ€§ä¼šæ„Ÿè§‰å¾ˆäº²åˆ‡ã€‚

#### 6.1ã€map()ã€filter()ã€reduce()

è¿™ä¸‰ä¸ªå‡½æ•°æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„åŸºçŸ³ã€‚

```java
// Java Stream APIæ–¹å¼
List<Integer> squares = IntStream.range(0, 10)
    .map(x -> x * x)
    .boxed()
    .collect(Collectors.toList());

List<Integer> evenSquares = IntStream.range(0, 10)
    .filter(x -> x % 2 == 0)
    .map(x -> x * x)
    .boxed()
    .collect(Collectors.toList());

// å¤šé‡å¾ªç¯ - Javaéœ€è¦åµŒå¥—Streamæˆ–flatMap
List<String> pairs = IntStream.rangeClosed(1, 3)
    .boxed()
    .flatMap(x -> Stream.of("a", "b", "c")
        .map(y -> "(" + x + ", " + y + ")"))
    .collect(Collectors.toList());
```

**å­—ç¬¦ä¸²å¤„ç†ç¤ºä¾‹:**

```python
# æå–æ‰€æœ‰å•è¯çš„é¦–å­—æ¯
sentence = "Hello World Python Programming"
initials = [word[0] for word in sentence.split()]
print(initials)  # ['H', 'W', 'P', 'P']

# è¿‡æ»¤å¹¶è½¬æ¢
words = ["apple", "banana", "cherry", "date"]
upper_long_words = [w.upper() for w in words if len(w) > 5]
print(upper_long_words)  # ['BANANA', 'CHERRY']

# åµŒå¥—åˆ—è¡¨å±•å¹³
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
flat = [num for row in matrix for num in row]
print(flat)  # [1, 2, 3, 4, 5, 6, 7, 8, 9]
```

#### 6.2ã€å­—å…¸æ¨å¯¼å¼

å­—å…¸æ¨å¯¼å¼è®©åˆ›å»ºå­—å…¸å˜å¾—æå…¶ç®€å•ã€‚

```python
# åŸºæœ¬å­—å…¸æ¨å¯¼å¼
# æ ¼å¼:{keyè¡¨è¾¾å¼: valueè¡¨è¾¾å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡}
squares_dict = {x: x**2 for x in range(6)}
print(squares_dict)  # {0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25}

# ä»ä¸¤ä¸ªåˆ—è¡¨åˆ›å»ºå­—å…¸
keys = ['name', 'age', 'city']
values = ['Alice', 25, 'Beijing']
person = {k: v for k, v in zip(keys, values)}
print(person)  # {'name': 'Alice', 'age': 25, 'city': 'Beijing'}

# å¸¦æ¡ä»¶çš„å­—å…¸æ¨å¯¼å¼
numbers = [1, 2, 3, 4, 5, 6]
even_squares = {x: x**2 for x in numbers if x % 2 == 0}
print(even_squares)  # {2: 4, 4: 16, 6: 36}

# å­—å…¸é”®å€¼äº’æ¢
original = {'a': 1, 'b': 2, 'c': 3}
swapped = {v: k for k, v in original.items()}
print(swapped)  # {1: 'a', 2: 'b', 3: 'c'}
```

**å®é™…åº”ç”¨åœºæ™¯:**

```python
# ç»Ÿè®¡å­—ç¬¦é¢‘ç‡
text = "hello world"
char_count = {char: text.count(char) for char in set(text) if char != ' '}
print(char_count)  # {'h': 1, 'e': 1, 'l': 3, 'o': 2, 'w': 1, 'r': 1, 'd': 1}

# è¿‡æ»¤å­—å…¸
scores = {'Alice': 85, 'Bob': 92, 'Charlie': 78, 'David': 95}
high_scores = {name: score for name, score in scores.items() if score >= 90}
print(high_scores)  # {'Bob': 92, 'David': 95}

# è½¬æ¢å­—å…¸å€¼
prices_usd = {'apple': 1.5, 'banana': 0.8, 'orange': 2.0}
exchange_rate = 6.5
prices_cny = {item: price * exchange_rate for item, price in prices_usd.items()}
print(prices_cny)  # {'apple': 9.75, 'banana': 5.2, 'orange': 13.0}
```

**Javaå¯¹æ¯”:**

```java
// Javaåˆ›å»ºMap - ç›¸å¯¹ç¹ç
Map<Integer, Integer> squares = IntStream.range(0, 6)
    .boxed()
    .collect(Collectors.toMap(x -> x, x -> x * x));

// è¿‡æ»¤Map
Map<String, Integer> highScores = scores.entrySet().stream()
    .filter(e -> e.getValue() >= 90)
    .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));
```

#### 6.3ã€é›†åˆæ¨å¯¼å¼

é›†åˆæ¨å¯¼å¼ç”¨äºåˆ›å»ºå»é‡çš„ï¿½ï¿½åˆã€‚

```python
# åŸºæœ¬é›†åˆæ¨å¯¼å¼
# æ ¼å¼:{è¡¨è¾¾å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡}
unique_chars = {char.lower() for char in "Hello World"}
print(unique_chars)  # {'h', 'e', 'l', 'o', ' ', 'w', 'r', 'd'}

# å¸¦æ¡ä»¶
numbers = [1, 2, 2, 3, 3, 3, 4, 4, 4, 4]
even_unique = {x for x in numbers if x % 2 == 0}
print(even_unique)  # {2, 4}

# æ•°å­¦è¿ç®—
squares_set = {x**2 for x in range(-5, 6)}
print(squares_set)  # {0, 1, 4, 9, 16, 25} - è‡ªåŠ¨å»é‡

# ä»å­—ç¬¦ä¸²åˆ—è¡¨æå–æ‰€æœ‰å”¯ä¸€å­—ç¬¦
words = ['apple', 'banana', 'cherry']
all_chars = {char for word in words for char in word}
print(all_chars)  # {'a', 'b', 'c', 'e', 'h', 'l', 'n', 'p', 'r', 'y'}
```

**å®é™…åº”ç”¨:**

```python
# æå–é‚®ç®±åŸŸå
emails = ['user1@gmail.com', 'user2@qq.com', 'user3@gmail.com', 'user4@163.com']
domains = {email.split('@')[1] for email in emails}
print(domains)  # {'gmail.com', 'qq.com', '163.com'}

# æŸ¥æ‰¾é‡å¤å…ƒç´ 
numbers = [1, 2, 3, 2, 4, 3, 5]
seen = set()
duplicates = {x for x in numbers if x in seen or seen.add(x)}
print(duplicates)  # {2, 3}
```

#### 6.4ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼

ç”Ÿæˆå™¨è¡¨è¾¾å¼è¯­æ³•ç±»ä¼¼åˆ—è¡¨æ¨å¯¼å¼,ä½†ä½¿ç”¨åœ†æ‹¬å·ã€‚å®ƒä¸ä¼šç«‹å³è®¡ç®—æ‰€æœ‰å€¼,è€Œæ˜¯æŒ‰éœ€ç”Ÿæˆ,éå¸¸èŠ‚çœå†…å­˜ã€‚

```python
# åˆ—è¡¨æ¨å¯¼å¼ vs ç”Ÿæˆå™¨è¡¨è¾¾å¼
import sys

# åˆ—è¡¨æ¨å¯¼å¼ - ç«‹å³åˆ›å»ºæ‰€æœ‰å…ƒç´ 
list_comp = [x**2 for x in range(1000000)]
print(f"åˆ—è¡¨å¤§å°: {sys.getsizeof(list_comp)} å­—èŠ‚")  # çº¦8MB

# ç”Ÿæˆå™¨è¡¨è¾¾å¼ - åªåœ¨éœ€è¦æ—¶ç”Ÿæˆå…ƒç´ 
gen_exp = (x**2 for x in range(1000000))
print(f"ç”Ÿæˆå™¨å¤§å°: {sys.getsizeof(gen_exp)} å­—èŠ‚")  # çº¦200å­—èŠ‚

# ä½¿ç”¨ç”Ÿæˆå™¨
for i, value in enumerate(gen_exp):
    if i >= 5:
        break
    print(value, end=' ')  # 0 1 4 9 16
```

**ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„ä¼˜åŠ¿:**

```python
# 1. å†…å­˜æ•ˆç‡ - å¤„ç†å¤§æ–‡ä»¶
# é”™è¯¯æ–¹å¼ - å¯èƒ½å†…å­˜æº¢å‡º
def read_file_bad(filename):
    return [line.strip() for line in open(filename)]

# æ­£ç¡®æ–¹å¼ - ä½¿ç”¨ç”Ÿæˆå™¨
def read_file_good(filename):
    return (line.strip() for line in open(filename))

# 2. æ— é™åºåˆ—
def fibonacci():
    """æ–æ³¢é‚£å¥‘æ•°åˆ—ç”Ÿæˆå™¨"""
    a, b = 0, 1
    while True:
        yield a
        a, b = b, a + b

# ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿‡æ»¤
fib_gen = fibonacci()
even_fibs = (x for x in fib_gen if x % 2 == 0)

# è·å–å‰5ä¸ªå¶æ•°æ–æ³¢é‚£å¥‘æ•°
result = []
for _ in range(5):
    result.append(next(even_fibs))
print(result)  # [0, 2, 8, 34, 144]

# 3. é“¾å¼å¤„ç†
numbers = range(100)
# æ¯ä¸€æ­¥éƒ½æ˜¯æƒ°æ€§æ±‚å€¼
pipeline = (x for x in numbers if x % 2 == 0)  # è¿‡æ»¤å¶æ•°
pipeline = (x**2 for x in pipeline)             # å¹³æ–¹
pipeline = (x for x in pipeline if x > 100)     # è¿‡æ»¤å¤§äº100çš„
print(list(pipeline)[:5])  # [144, 196, 256, 324, 400]
```

**ä¸Java Streamçš„å¯¹æ¯”:**

```python
# Pythonç”Ÿæˆå™¨è¡¨è¾¾å¼
numbers = range(1000000)
result = sum(x**2 for x in numbers if x % 2 == 0)
print(result)
```

```java
// Java Stream - æ¦‚å¿µç±»ä¼¼
long result = IntStream.range(0, 1000000)
    .filter(x -> x % 2 == 0)
    .mapToLong(x -> (long) x * x)
    .sum();
```

#### 6.5ã€å®æˆ˜æ¡ˆä¾‹

**æ¡ˆä¾‹1:æ•°æ®æ¸…æ´—**

```python
# æ¸…æ´—ç”¨æˆ·è¾“å…¥æ•°æ®
raw_data = [
    "  Alice  ",
    "bob",
    "  CHARLIE",
    "",
    "   ",
    "david  "
]

# æ¸…æ´—:å»ç©ºæ ¼ã€è½¬å°å†™ã€è¿‡æ»¤ç©ºå€¼
cleaned = [name.strip().lower() for name in raw_data if name.strip()]
print(cleaned)  # ['alice', 'bob', 'charlie', 'david']

# ç”Ÿæˆç”¨æˆ·å­—å…¸
users = {
    i: {'id': i, 'name': name, 'email': f"{name}@example.com"}
    for i, name in enumerate(cleaned, 1)
}
print(users)
# {1: {'id': 1, 'name': 'alice', 'email': 'alice@example.com'}, ...}
```

**æ¡ˆä¾‹2:çŸ©é˜µè½¬ç½®**

```python
# ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼è½¬ç½®çŸ©é˜µ
matrix = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
]

# è½¬ç½®
transposed = [[row[i] for row in matrix] for i in range(len(matrix[0]))]
print(transposed)
# [[1, 4, 7],
#  [2, 5, 8],
#  [3, 6, 9]]

# æˆ–è€…ä½¿ç”¨zip(æ›´Pythonic)
transposed2 = [list(col) for col in zip(*matrix)]
print(transposed2)  # åŒä¸Š
```

**æ¡ˆä¾‹3:æ–‡ä»¶æ‰¹å¤„ç†**

```python
import os

# æ‰¹é‡é‡å‘½åæ–‡ä»¶(æ¨¡æ‹Ÿ)
files = ['report_2024.txt', 'data_2024.csv', 'summary_2024.pdf']

# åˆ›å»ºé‡å‘½åæ˜ å°„
rename_map = {
    old: old.replace('2024', '2025')
    for old in files
    if '2024' in old
}
print(rename_map)
# {'report_2024.txt': 'report_2025.txt',
#  'data_2024.csv': 'data_2025.csv',
#  'summary_2024.pdf': 'summary_2025.pdf'}

# å®é™…é‡å‘½å(ç¤ºä¾‹)
# for old, new in rename_map.items():
#     os.rename(old, new)
```

**æ¡ˆä¾‹4:é…ç½®è§£æ**

```python
# è§£æé…ç½®è¡Œ
config_lines = [
    "name=Alice",
    "age=25",
    "# è¿™æ˜¯æ³¨é‡Š",
    "city=Beijing",
    "",
    "email=alice@example.com"
]

# è§£æä¸ºå­—å…¸,è·³è¿‡æ³¨é‡Šå’Œç©ºè¡Œ
config = {
    line.split('=')[0]: line.split('=')[1]
    for line in config_lines
    if line and not line.startswith('#') and '=' in line
}
print(config)
# {'name': 'Alice', 'age': '25', 'city': 'Beijing', 'email': 'alice@example.com'}
```

**æ¡ˆä¾‹5:SQLç»“æœå¤„ç†**

```python
# æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ç»“æœ
db_results = [
    ('Alice', 85, 'Math'),
    ('Bob', 92, 'Math'),
    ('Charlie', 78, 'English'),
    ('David', 95, 'Math'),
    ('Eve', 88, 'English')
]

# è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨
students = [
    {'name': name, 'score': score, 'subject': subject}
    for name, score, subject in db_results
]

# æŒ‰ç§‘ç›®åˆ†ç»„
from collections import defaultdict
by_subject = defaultdict(list)
for student in students:
    by_subject[student['subject']].append(student)

# æˆ–ä½¿ç”¨å­—å…¸æ¨å¯¼å¼è®¡ç®—æ¯ç§‘å¹³å‡åˆ†
avg_scores = {
    subject: sum(s['score'] for s in students if s['subject'] == subject) /
             len([s for s in students if s['subject'] == subject])
    for subject in {s['subject'] for s in students}
}
print(avg_scores)  # {'Math': 90.666..., 'English': 83.0}
```

**æ¡ˆä¾‹6:æ•°æ®èšåˆ**

```python
# ç”µå•†è®¢å•æ•°æ®
orders = [
    {'id': 1, 'user': 'Alice', 'amount': 100, 'status': 'paid'},
    {'id': 2, 'user': 'Bob', 'amount': 200, 'status': 'paid'},
    {'id': 3, 'user': 'Alice', 'amount': 150, 'status': 'pending'},
    {'id': 4, 'user': 'Charlie', 'amount': 300, 'status': 'paid'},
    {'id': 5, 'user': 'Bob', 'amount': 250, 'status': 'cancelled'}
]

# ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„å·²æ”¯ä»˜è®¢å•æ€»é¢
user_totals = {
    user: sum(order['amount'] for order in orders
              if order['user'] == user and order['status'] == 'paid')
    for user in {order['user'] for order in orders}
}
print(user_totals)  # {'Alice': 100, 'Bob': 200, 'Charlie': 300}

# è·å–æ‰€æœ‰å·²æ”¯ä»˜è®¢å•ID
paid_ids = [order['id'] for order in orders if order['status'] == 'paid']
print(paid_ids)  # [1, 2, 4]
```

#### 6.6ã€æ€§èƒ½å¯¹æ¯”

```python
import timeit

# æµ‹è¯•1:åˆ—è¡¨æ¨å¯¼å¼ vs forå¾ªç¯
def using_for_loop():
    result = []
    for x in range(1000):
        if x % 2 == 0:
            result.append(x**2)
    return result

def using_list_comp():
    return [x**2 for x in range(1000) if x % 2 == 0]

time_loop = timeit.timeit(using_for_loop, number=10000)
time_comp = timeit.timeit(using_list_comp, number=10000)

print(f"forå¾ªç¯è€—æ—¶: {time_loop:.4f}ç§’")
print(f"åˆ—è¡¨æ¨å¯¼å¼è€—æ—¶: {time_comp:.4f}ç§’")
print(f"æ€§èƒ½æå‡: {(time_loop/time_comp - 1) * 100:.1f}%")
# åˆ—è¡¨æ¨å¯¼å¼é€šå¸¸å¿«20-30%

# æµ‹è¯•2:ç”Ÿæˆå™¨ vs åˆ—è¡¨(å†…å­˜ä½¿ç”¨)
import sys

list_result = [x**2 for x in range(100000)]
gen_result = (x**2 for x in range(100000))

print(f"åˆ—è¡¨å†…å­˜: {sys.getsizeof(list_result):,} å­—èŠ‚")  # çº¦800KB
print(f"ç”Ÿæˆå™¨å†…å­˜: {sys.getsizeof(gen_result):,} å­—èŠ‚")  # çº¦200å­—èŠ‚
print(f"å†…å­˜èŠ‚çœ: {(1 - sys.getsizeof(gen_result)/sys.getsizeof(list_result)) * 100:.1f}%")
```

#### 6.7ã€æœ€ä½³å®è·µ

**1. å¯è¯»æ€§ä¼˜å…ˆ**

```python
# ä¸æ¨è - è¿‡åº¦å¤æ‚
result = [x**2 for x in range(100) if x % 2 == 0 if x % 3 == 0 if x > 10]

# æ¨è - æ‹†åˆ†é€»è¾‘
result = [
    x**2
    for x in range(100)
    if x % 2 == 0 and x % 3 == 0 and x > 10
]

# æˆ–è€…ä½¿ç”¨æ™®é€šå¾ªç¯
result = []
for x in range(100):
    if x % 2 == 0 and x % 3 == 0 and x > 10:
        result.append(x**2)
```

**2. ä½•æ—¶ä½¿ç”¨ç”Ÿæˆå™¨**

```python
# ä½¿ç”¨åˆ—è¡¨ - éœ€è¦å¤šæ¬¡è®¿é—®
numbers = [x**2 for x in range(100)]
print(sum(numbers))
print(max(numbers))  # å¯ä»¥é‡å¤ä½¿ç”¨

# ä½¿ç”¨ç”Ÿæˆå™¨ - åªéå†ä¸€æ¬¡,æˆ–æ•°æ®é‡å¤§
total = sum(x**2 for x in range(1000000))  # ä¸€æ¬¡æ€§æ¶ˆè´¹,èŠ‚çœå†…å­˜

# å¤„ç†å¤§æ–‡ä»¶ - å¿…é¡»ç”¨ç”Ÿæˆå™¨
lines = (line.strip() for line in open('large_file.txt'))
errors = (line for line in lines if 'ERROR' in line)
```

**3. é¿å…å‰¯ä½œç”¨**

```python
# é”™è¯¯ - æ¨å¯¼å¼ä¸­æœ‰å‰¯ä½œç”¨
counter = 0
result = [counter := counter + 1 for x in range(10)]  # ä¸æ¨è

# æ­£ç¡® - ä½¿ç”¨enumerate
result = [i for i, x in enumerate(range(10))]
```

**å¯¹æ¯”æ€»ç»“:**

| ç‰¹æ€§ | Pythonæ¨å¯¼å¼ | Java Stream API |
|-----|------------|----------------|
| åˆ—è¡¨åˆ›å»º | `[x*2 for x in list]` | `list.stream().map(x -> x*2).collect()` |
| è¿‡æ»¤ | `[x for x in list if x > 0]` | `list.stream().filter(x -> x > 0).collect()` |
| å­—å…¸åˆ›å»º | `{k: v for k, v in pairs}` | `pairs.stream().collect(toMap(...))` |
| å»é‡ | `{x for x in list}` | `list.stream().distinct().collect()` |
| æƒ°æ€§æ±‚å€¼ | ç”Ÿæˆå™¨è¡¨è¾¾å¼ `(x for x in list)` | Streamé»˜è®¤æƒ°æ€§ |
| è¯­æ³•ç®€æ´åº¦ | â­â­â­â­â­ | â­â­â­ |
| å¯è¯»æ€§ | é«˜(ç®€å•åœºæ™¯) | ä¸­ç­‰ |
| æ€§èƒ½ | å¿«(Cä¼˜åŒ–) | å¿«(JITä¼˜åŒ–) |

### 7ã€å‡½æ•°å¼ç¼–ç¨‹

Pythonè™½ç„¶ä¸æ˜¯çº¯å‡½æ•°å¼è¯­è¨€,ä½†æä¾›äº†ä¸°å¯Œçš„å‡½æ•°å¼ç¼–ç¨‹å·¥å…·ã€‚å¯¹äºç†Ÿæ‚‰Java 8+ Stream APIçš„å¼€å‘è€…æ¥è¯´,Pythonçš„å‡½æ•°å¼ç‰¹æ€§ä¼šæ„Ÿè§‰å¾ˆäº²åˆ‡ã€‚

#### 7.1ã€é«˜é˜¶å‡½æ•°

> **è¯´æ˜**ï¼šmap()ã€filter()ã€reduce()å·²åœ¨ç¬¬6ç« "å‡½æ•°å¼ç¼–ç¨‹"ä¸­è¯¦ç»†è®²è§£ï¼Œè¿™é‡Œä»‹ç»å…¶ä»–é«˜é˜¶å‡½æ•°ã€‚

**å‡½æ•°ä½œä¸ºå‚æ•°**
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

# äº”ã€è¿‡æ»¤å¶æ•°
evens = list(filter(lambda x: x % 2 == 0, numbers))
print(evens)  # [2, 4, 6, 8, 10]

# å…­ã€è¿‡æ»¤éç©ºå­—ç¬¦ä¸²
words = ['hello', '', 'world', '  ', 'python']
non_empty = list(filter(lambda s: s.strip(), words))
print(non_empty)  # ['hello', 'world', 'python']

# ä¸ƒã€è¿‡æ»¤Noneå€¼
data = [1, None, 2, None, 3, 4, None]
filtered = list(filter(None, data))  # Noneä½œä¸ºå‡½æ•°,è¿‡æ»¤å‡å€¼
print(filtered)  # [1, 2, 3, 4]

# å…«ã€å®é™…åº”ç”¨:è¿‡æ»¤æœ‰æ•ˆé‚®ç®±
emails = ['user@example.com', 'invalid', 'admin@test.com', 'bad@']
valid = list(filter(lambda e: '@' in e and '.' in e.split('@')[1], emails))
print(valid)  # ['user@example.com', 'admin@test.com']
```

**reduce() - ç´¯ç§¯è®¡ç®—**

```python
from functools import reduce

# reduce(function, iterable[, initializer])
numbers = [1, 2, 3, 4, 5]

# æ±‚å’Œ
total = reduce(lambda x, y: x + y, numbers)
print(total)  # 15

# æ±‚ç§¯
product = reduce(lambda x, y: x * y, numbers)
print(product)  # 120

# æŸ¥æ‰¾æœ€å¤§å€¼
maximum = reduce(lambda x, y: x if x > y else y, numbers)
print(maximum)  # 5

# å¸¦åˆå§‹å€¼
total_with_init = reduce(lambda x, y: x + y, numbers, 100)
print(total_with_init)  # 115

# å®é™…åº”ç”¨:åˆå¹¶å­—å…¸
dicts = [
    {'a': 1, 'b': 2},
    {'c': 3, 'd': 4},
    {'e': 5}
]
merged = reduce(lambda d1, d2: {**d1, **d2}, dicts)
print(merged)  # {'a': 1, 'b': 2, 'c': 3, 'd': 4, 'e': 5}

# æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨
nested = [[1, 2], [3, 4], [5, 6]]
flat = reduce(lambda acc, lst: acc + lst, nested, [])
print(flat)  # [1, 2, 3, 4, 5, 6]
```

**Javaå¯¹æ¯”:**

```java
// Java reduce
int sum = numbers.stream()
    .reduce(0, (a, b) -> a + b);

// æˆ–ä½¿ç”¨æ–¹æ³•å¼•ç”¨
int sum = numbers.stream()
    .reduce(0, Integer::sum);
```

**ä¸‰å‰‘å®¢ç»„åˆä½¿ç”¨:**

```python
# è®¡ç®—1-100ä¸­æ‰€æœ‰å¶æ•°çš„å¹³æ–¹å’Œ
numbers = range(1, 101)
result = reduce(
    lambda x, y: x + y,
    map(lambda x: x**2,
        filter(lambda x: x % 2 == 0, numbers))
)
print(result)  # 171700

# æ›´Pythonicçš„æ–¹å¼(æ¨å¯¼å¼)
result = sum(x**2 for x in range(1, 101) if x % 2 == 0)
print(result)  # 171700
```

#### 1ã€é«˜é˜¶å‡½æ•°

é«˜é˜¶å‡½æ•°æ˜¯æŒ‡æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›å‡½æ•°çš„å‡½æ•°ã€‚

**å‡½æ•°ä½œä¸ºå‚æ•°:**

```python
def apply_operation(numbers, operation):
    """å¯¹åˆ—è¡¨ä¸­æ¯ä¸ªæ•°å­—åº”ç”¨æ“ä½œ"""
    return [operation(x) for x in numbers]

# å®šä¹‰ä¸åŒçš„æ“ä½œ
def square(x):
    return x ** 2

def double(x):
    return x * 2

def negate(x):
    return -x

numbers = [1, 2, 3, 4, 5]
print(apply_operation(numbers, square))   # [1, 4, 9, 16, 25]
print(apply_operation(numbers, double))   # [2, 4, 6, 8, 10]
print(apply_operation(numbers, negate))   # [-1, -2, -3, -4, -5]

# ä½¿ç”¨lambda
print(apply_operation(numbers, lambda x: x**3))  # [1, 8, 27, 64, 125]
```

**å‡½æ•°ä½œä¸ºè¿”å›å€¼:**

```python
def make_multiplier(n):
    """è¿”å›ä¸€ä¸ªä¹˜ä»¥nçš„å‡½æ•°"""
    def multiplier(x):
        return x * n
    return multiplier

times2 = make_multiplier(2)
times10 = make_multiplier(10)

print(times2(5))   # 10
print(times10(5))  # 50

# å®é™…åº”ç”¨:åˆ›å»ºéªŒè¯å™¨
def make_range_validator(min_val, max_val):
    """åˆ›å»ºèŒƒå›´éªŒè¯å‡½æ•°"""
    def validator(value):
        return min_val <= value <= max_val
    return validator

age_validator = make_range_validator(0, 120)
percentage_validator = make_range_validator(0, 100)

print(age_validator(25))    # True
print(age_validator(150))   # False
print(percentage_validator(85))  # True
```

**å†…ç½®é«˜é˜¶å‡½æ•°:**

```python
# sorted() - è‡ªå®šä¹‰æ’åº
students = [
    {'name': 'Alice', 'age': 25, 'score': 85},
    {'name': 'Bob', 'age': 22, 'score': 92},
    {'name': 'Charlie', 'age': 23, 'score': 78}
]

# æŒ‰å¹´é¾„æ’åº
by_age = sorted(students, key=lambda s: s['age'])
print([s['name'] for s in by_age])  # ['Bob', 'Charlie', 'Alice']

# æŒ‰åˆ†æ•°é™åº
by_score = sorted(students, key=lambda s: s['score'], reverse=True)
print([s['name'] for s in by_score])  # ['Bob', 'Alice', 'Charlie']

# å¤šçº§æ’åº:å…ˆæŒ‰åˆ†æ•°é™åº,å†æŒ‰å¹´é¾„å‡åº
multi_sort = sorted(students, key=lambda s: (-s['score'], s['age']))

# max()/min() - è‡ªå®šä¹‰æ¯”è¾ƒ
oldest = max(students, key=lambda s: s['age'])
print(oldest['name'])  # Alice

highest_score = max(students, key=lambda s: s['score'])
print(highest_score['name'])  # Bob
```

#### 2ã€åå‡½æ•°(functools.partial)

åå‡½æ•°ç”¨äºå›ºå®šå‡½æ•°çš„æŸäº›å‚æ•°,åˆ›å»ºæ–°å‡½æ•°ã€‚

```python
from functools import partial

# åŸºæœ¬ç¤ºä¾‹
def power(base, exponent):
    return base ** exponent

# åˆ›å»ºåå‡½æ•° - å›ºå®šexponent=2
square = partial(power, exponent=2)
print(square(5))  # 25
print(square(10))  # 100

# å›ºå®šexponent=3
cube = partial(power, exponent=3)
print(cube(5))  # 125

# å®é™…åº”ç”¨1:æ—¥å¿—è®°å½•
def log_message(message, level='INFO', timestamp=True):
    import datetime
    prefix = f"[{datetime.datetime.now()}] " if timestamp else ""
    print(f"{prefix}{level}: {message}")

# åˆ›å»ºä¸“ç”¨æ—¥å¿—å‡½æ•°
log_error = partial(log_message, level='ERROR')
log_warning = partial(log_message, level='WARNING')
log_debug = partial(log_message, level='DEBUG', timestamp=False)

log_error("Database connection failed")
log_warning("Low memory")
log_debug("Variable value: 42")

# å®é™…åº”ç”¨2:æ•°æ®è½¬æ¢
def convert_value(value, multiplier=1, offset=0, round_digits=2):
    """é€šç”¨æ•°å€¼è½¬æ¢å‡½æ•°"""
    result = value * multiplier + offset
    return round(result, round_digits)

# æ‘„æ°åº¦è½¬åæ°åº¦: F = C * 9/5 + 32
celsius_to_fahrenheit = partial(convert_value, multiplier=9/5, offset=32)
print(celsius_to_fahrenheit(0))    # 32.0
print(celsius_to_fahrenheit(100))  # 212.0

# ç±³è½¬è‹±å°º: feet = meter * 3.28084
meter_to_feet = partial(convert_value, multiplier=3.28084)
print(meter_to_feet(10))  # 32.81

# å®é™…åº”ç”¨3:é…ç½®HTTPè¯·æ±‚
import functools

def make_request(url, method='GET', headers=None, timeout=30):
    """æ¨¡æ‹ŸHTTPè¯·æ±‚"""
    headers = headers or {}
    print(f"{method} {url}")
    print(f"Headers: {headers}")
    print(f"Timeout: {timeout}s")

# APIç‰¹å®šé…ç½®
api_headers = {'Authorization': 'Bearer token123', 'Content-Type': 'application/json'}
api_request = partial(make_request, headers=api_headers, timeout=60)

# ä½¿ç”¨
api_request('https://api.example.com/users')
api_request('https://api.example.com/posts', method='POST')
```

**ä¸Javaå¯¹æ¯”:**

```java
// Javaæ²¡æœ‰ç›´æ¥çš„åå‡½æ•°,éœ€è¦æ‰‹åŠ¨åŒ…è£…
BiFunction<Integer, Integer, Integer> power = (base, exp) -> (int) Math.pow(base, exp);

// åˆ›å»º"åå‡½æ•°"
Function<Integer, Integer> square = base -> power.apply(base, 2);
Function<Integer, Integer> cube = base -> power.apply(base, 3);
```

#### 3ã€å‡½æ•°ç»„åˆ

å‡½æ•°ç»„åˆæ˜¯å°†å¤šä¸ªå‡½æ•°ç»„åˆæˆä¸€ä¸ªæ–°å‡½æ•°ã€‚

```python
# æ‰‹åŠ¨å®ç°å‡½æ•°ç»„åˆ
def compose(*functions):
    """ä»å³åˆ°å·¦ç»„åˆå‡½æ•°"""
    def inner(arg):
        result = arg
        for func in reversed(functions):
            result = func(result)
        return result
    return inner

# å®šä¹‰åŸºç¡€å‡½æ•°
def add_one(x):
    return x + 1

def double(x):
    return x * 2

def square(x):
    return x ** 2

# ç»„åˆå‡½æ•°:(x+1) * 2 ç„¶åå¹³æ–¹
combined = compose(square, double, add_one)
print(combined(3))  # ((3+1)*2)^2 = 64

# æ›´ä¼˜é›…çš„å®ç°
from functools import reduce

def compose2(*functions):
    """ä½¿ç”¨reduceå®ç°å‡½æ•°ç»„åˆ"""
    return reduce(lambda f, g: lambda x: f(g(x)), functions)

combined2 = compose2(square, double, add_one)
print(combined2(3))  # 64

# å®é™…åº”ç”¨:æ•°æ®å¤„ç†ç®¡é“
def remove_spaces(text):
    return text.replace(' ', '')

def to_lowercase(text):
    return text.lower()

def remove_punctuation(text):
    import string
    return text.translate(str.maketrans('', '', string.punctuation))

# ç»„åˆæ–‡æœ¬æ¸…æ´—å‡½æ•°
clean_text = compose(remove_punctuation, to_lowercase, remove_spaces)

text = "Hello, World! Python is AWESOME."
print(clean_text(text))  # heloworldpythonisawesome

# æ›´Pythonicçš„æ–¹å¼:ä½¿ç”¨ç®¡é“
class Pipeline:
    """å‡½æ•°ç®¡é“"""
    def __init__(self, value):
        self.value = value

    def pipe(self, func):
        """åº”ç”¨å‡½æ•°å¹¶è¿”å›æ–°çš„Pipeline"""
        return Pipeline(func(self.value))

    def get(self):
        """è·å–æœ€ç»ˆå€¼"""
        return self.value

# ä½¿ç”¨ç®¡é“
result = (Pipeline("Hello, World!")
         .pipe(str.lower)
         .pipe(lambda s: s.replace(' ', ''))
         .pipe(lambda s: s.replace('!', ''))
         .get())
print(result)  # helloworld
```

**å®æˆ˜:æ•°æ®è½¬æ¢ç®¡é“**

```python
# å¤„ç†ç”¨æˆ·æ•°æ®
users = [
    {'name': '  ALICE  ', 'age': '25', 'email': 'ALICE@EXAMPLE.COM'},
    {'name': 'bob', 'age': '30', 'email': 'bob@example.com  '},
    {'name': '  Charlie  ', 'age': '22', 'email': '  charlie@EXAMPLE.com'}
]

# å®šä¹‰è½¬æ¢å‡½æ•°
def clean_name(user):
    user['name'] = user['name'].strip().capitalize()
    return user

def convert_age(user):
    user['age'] = int(user['age'])
    return user

def normalize_email(user):
    user['email'] = user['email'].strip().lower()
    return user

# ç»„åˆæ‰€æœ‰è½¬æ¢
from functools import reduce

def process_user(user):
    transformations = [clean_name, convert_age, normalize_email]
    return reduce(lambda u, transform: transform(u), transformations, user)

# åº”ç”¨åˆ°æ‰€æœ‰ç”¨æˆ·
processed = list(map(process_user, users))
for user in processed:
    print(user)
# {'name': 'Alice', 'age': 25, 'email': 'alice@example.com'}
# {'name': 'Bob', 'age': 30, 'email': 'bob@example.com'}
# {'name': 'Charlie', 'age': 22, 'email': 'charlie@example.com'}
```

#### 4ã€çº¯å‡½æ•°ä¸å‰¯ä½œç”¨

çº¯å‡½æ•°æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µã€‚

**çº¯å‡½æ•°çš„ç‰¹å¾:**

```python
# çº¯å‡½æ•° - ç›¸åŒè¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒè¾“å‡º,æ— å‰¯ä½œç”¨
def add(a, b):
    return a + b

def multiply(a, b):
    return a * b

# çº¯å‡½æ•° - ä¸ä¿®æ”¹è¾“å…¥
def append_item_pure(lst, item):
    """è¿”å›æ–°åˆ—è¡¨,ä¸ä¿®æ”¹åŸåˆ—è¡¨"""
    return lst + [item]

original = [1, 2, 3]
new_list = append_item_pure(original, 4)
print(original)  # [1, 2, 3] - æœªè¢«ä¿®æ”¹
print(new_list)  # [1, 2, 3, 4]

# éçº¯å‡½æ•° - æœ‰å‰¯ä½œç”¨
def append_item_impure(lst, item):
    """ç›´æ¥ä¿®æ”¹åˆ—è¡¨"""
    lst.append(item)
    return lst

original = [1, 2, 3]
new_list = append_item_impure(original, 4)
print(original)  # [1, 2, 3, 4] - è¢«ä¿®æ”¹äº†!
print(new_list)  # [1, 2, 3, 4]

# éçº¯å‡½æ•° - ä¾èµ–å¤–éƒ¨çŠ¶æ€
counter = 0

def increment_impure():
    global counter
    counter += 1
    return counter

print(increment_impure())  # 1
print(increment_impure())  # 2 - ç›¸åŒè°ƒç”¨,ä¸åŒç»“æœ!

# çº¯å‡½æ•°æ›¿ä»£æ–¹æ¡ˆ
def increment_pure(value):
    return value + 1

counter = 0
counter = increment_pure(counter)  # 1
counter = increment_pure(counter)  # 2
```

**çº¯å‡½æ•°çš„ä¼˜åŠ¿:**

```python
# 1. å¯æµ‹è¯•æ€§
def calculate_total(items, tax_rate):
    """çº¯å‡½æ•° - æ˜“äºæµ‹è¯•"""
    subtotal = sum(item['price'] * item['quantity'] for item in items)
    return subtotal * (1 + tax_rate)

# æµ‹è¯•ç®€å•
items = [
    {'price': 10, 'quantity': 2},
    {'price': 5, 'quantity': 3}
]
assert calculate_total(items, 0.1) == 38.5

# 2. å¯ç»„åˆæ€§
def filter_active(users):
    return [u for u in users if u.get('active', False)]

def sort_by_name(users):
    return sorted(users, key=lambda u: u['name'])

def get_emails(users):
    return [u['email'] for u in users]

# è½»æ¾ç»„åˆ
users = [
    {'name': 'Alice', 'active': True, 'email': 'alice@example.com'},
    {'name': 'Bob', 'active': False, 'email': 'bob@example.com'},
    {'name': 'Charlie', 'active': True, 'email': 'charlie@example.com'}
]

active_emails = get_emails(sort_by_name(filter_active(users)))
print(active_emails)  # ['alice@example.com', 'charlie@example.com']

# 3. å¹¶å‘å®‰å…¨
from concurrent.futures import ThreadPoolExecutor

def square_pure(x):
    """çº¯å‡½æ•° - çº¿ç¨‹å®‰å…¨"""
    return x ** 2

numbers = range(100)
with ThreadPoolExecutor(max_workers=4) as executor:
    results = list(executor.map(square_pure, numbers))
```

**é¿å…å‰¯ä½œç”¨çš„æŠ€å·§:**

```python
# 1. ä½¿ç”¨copyé¿å…ä¿®æ”¹åŸå§‹æ•°æ®
import copy

def update_user_pure(user, **updates):
    """è¿”å›æ›´æ–°åçš„æ–°ç”¨æˆ·å¯¹è±¡"""
    new_user = copy.deepcopy(user)
    new_user.update(updates)
    return new_user

user = {'name': 'Alice', 'age': 25}
updated = update_user_pure(user, age=26)
print(user)     # {'name': 'Alice', 'age': 25}
print(updated)  # {'name': 'Alice', 'age': 26}

# 2. ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„
from collections import namedtuple

User = namedtuple('User', ['name', 'age', 'email'])
user = User('Alice', 25, 'alice@example.com')

# åˆ›å»ºæ–°å¯¹è±¡è€Œä¸æ˜¯ä¿®æ”¹
updated = user._replace(age=26)
print(user)     # User(name='Alice', age=25, ...)
print(updated)  # User(name='Alice', age=26, ...)

# 3. ä½¿ç”¨dataclasses(Python 3.7+)
from dataclasses import dataclass, replace

@dataclass(frozen=True)  # frozen=Trueä½¿å…¶ä¸å¯å˜
class Product:
    name: str
    price: float
    quantity: int

product = Product('Book', 29.99, 10)
# product.price = 19.99  # é”™è¯¯!ä¸å¯ä¿®æ”¹

# ä½¿ç”¨replaceåˆ›å»ºæ–°å¯¹è±¡
discounted = replace(product, price=19.99)
print(product)     # Product(name='Book', price=29.99, quantity=10)
print(discounted)  # Product(name='Book', price=19.99, quantity=10)
```

#### 5ã€å®æˆ˜æ¡ˆä¾‹

**æ¡ˆä¾‹1:å‡½æ•°å¼é£æ ¼çš„æ•°æ®å¤„ç†**

```python
from functools import reduce
from operator import itemgetter

# è®¢å•æ•°æ®
orders = [
    {'id': 1, 'user_id': 101, 'amount': 150.0, 'status': 'completed'},
    {'id': 2, 'user_id': 102, 'amount': 200.0, 'status': 'pending'},
    {'id': 3, 'user_id': 101, 'amount': 80.0, 'status': 'completed'},
    {'id': 4, 'user_id': 103, 'amount': 300.0, 'status': 'completed'},
    {'id': 5, 'user_id': 102, 'amount': 120.0, 'status': 'cancelled'}
]

# éœ€æ±‚:è®¡ç®—æ‰€æœ‰å·²å®Œæˆè®¢å•çš„æ€»é‡‘é¢,å¹¶æŒ‰ç”¨æˆ·åˆ†ç»„

# 1. è¿‡æ»¤å·²å®Œæˆè®¢å•
completed_orders = list(filter(lambda o: o['status'] == 'completed', orders))

# 2. æå–é‡‘é¢
amounts = list(map(itemgetter('amount'), completed_orders))

# 3. è®¡ç®—æ€»é¢
total = reduce(lambda x, y: x + y, amounts, 0)
print(f"å·²å®Œæˆè®¢å•æ€»é¢: ${total}")  # $530.0

# æŒ‰ç”¨æˆ·åˆ†ç»„ç»Ÿè®¡
from collections import defaultdict

def group_by_user(orders):
    grouped = defaultdict(list)
    for order in orders:
        grouped[order['user_id']].append(order)
    return dict(grouped)

user_orders = group_by_user(completed_orders)
user_totals = {
    user_id: reduce(lambda acc, o: acc + o['amount'], orders, 0)
    for user_id, orders in user_orders.items()
}
print(user_totals)  # {101: 230.0, 103: 300.0}
```

**æ¡ˆä¾‹2:å‡½æ•°ç®¡é“å¤„ç†æ–‡æœ¬**

```python
# æ–‡æœ¬åˆ†æç®¡é“
def read_words(text):
    """åˆ†å‰²ä¸ºå•è¯"""
    return text.lower().split()

def remove_short_words(words, min_length=3):
    """ç§»é™¤çŸ­å•è¯"""
    return [w for w in words if len(w) >= min_length]

def remove_punctuation(words):
    """ç§»é™¤æ ‡ç‚¹ç¬¦å·"""
    import string
    translator = str.maketrans('', '', string.punctuation)
    return [w.translate(translator) for w in words]

def count_words(words):
    """ç»Ÿè®¡è¯é¢‘"""
    from collections import Counter
    return Counter(words)

def top_words(counter, n=5):
    """è·å–æœ€å¸¸è§çš„nä¸ªå•è¯"""
    return counter.most_common(n)

# ç»„åˆæ‰€æœ‰æ­¥éª¤
def analyze_text(text, min_length=3, top_n=5):
    return (top_words(
                count_words(
                    remove_punctuation(
                        remove_short_words(
                            read_words(text),
                            min_length
                        )
                    )
                ),
                top_n
            ))

text = """
Python is an amazing programming language. Python is used for web development,
data science, and machine learning. Many developers love Python because Python
is easy to learn and very powerful.
"""

result = analyze_text(text)
for word, count in result:
    print(f"{word}: {count}")
# python: 4
# is: 3
# and: 2
# ...
```

**å¯¹æ¯”æ€»ç»“:**

| ç‰¹æ€§ | Python | Java |
|-----|--------|------|
| map/filter/reduce | å†…ç½®å‡½æ•° | Stream API |
| Lambdaè¡¨è¾¾å¼ | `lambda x: x*2` | `x -> x*2` |
| é«˜é˜¶å‡½æ•° | åŸç”Ÿæ”¯æŒ | æ”¯æŒ(å‡½æ•°å¼æ¥å£) |
| åå‡½æ•° | `functools.partial` | æ‰‹åŠ¨å®ç° |
| å‡½æ•°ç»„åˆ | éœ€æ‰‹åŠ¨å®ç° | éœ€æ‰‹åŠ¨å®ç° |
| ä¸å¯å˜æ€§ | å¯é€‰(tuple, frozenset) | å¯é€‰(final, Collections.unmodifiable) |
| çº¯å‡½æ•° | çº¦å®šä¼˜äºå¼ºåˆ¶ | çº¦å®šä¼˜äºå¼ºåˆ¶ |
| å‡½æ•°å¼åº“ | functools, itertools, operator | java.util.function, Stream API |

### 6ã€ç±»å‹æç¤º(Type Hints)

ä½œä¸ºJavaå¼€å‘è€…,ä½ ä¹ æƒ¯äº†å¼ºç±»å‹ç³»ç»Ÿã€‚Pythonä»3.5ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†ç±»å‹æç¤º,è™½ç„¶ä¸å¼ºåˆ¶æ£€æŸ¥,ä½†èƒ½è®©ä»£ç æ›´æ¸…æ™°ã€IDEæç¤ºæ›´å¥½ã€‚

#### 6.1ã€åŸºæœ¬ç±»å‹æ³¨è§£

```python
# å˜é‡ç±»å‹æ³¨è§£
name: str = "Alice"
age: int = 25
salary: float = 5000.50
is_active: bool = True

# å‡½æ•°å‚æ•°å’Œè¿”å›å€¼æ³¨è§£
def greet(name: str, age: int) -> str:
    return f"Hello {name}, you are {age} years old"

def add(a: int, b: int) -> int:
    return a + b

def get_user_info() -> dict:
    return {"name": "Alice", "age": 25}

# æ— è¿”å›å€¼
def log_message(message: str) -> None:
    print(message)

# Javaå¯¹æ¯”
"""
// Javaå¼ºåˆ¶ç±»å‹
String name = "Alice";
int age = 25;

public String greet(String name, int age) {
    return "Hello " + name;
}
"""
```

#### 6.2ã€å¤åˆç±»å‹æ³¨è§£

```python
from typing import List, Dict, Tuple, Set

# åˆ—è¡¨ç±»å‹
numbers: List[int] = [1, 2, 3, 4]
names: List[str] = ["Alice", "Bob"]

# å­—å…¸ç±»å‹
user: Dict[str, int] = {"age": 25, "score": 90}
config: Dict[str, any] = {"host": "localhost", "port": 8080}

# å…ƒç»„ç±»å‹
point: Tuple[int, int] = (10, 20)
person: Tuple[str, int, bool] = ("Alice", 25, True)

# é›†åˆç±»å‹
unique_ids: Set[int] = {1, 2, 3}

# åµŒå¥—ç±»å‹
users: List[Dict[str, any]] = [
    {"name": "Alice", "age": 25},
    {"name": "Bob", "age": 30}
]

# å®é™…åº”ç”¨
def get_user_scores() -> Dict[str, List[int]]:
    """è¿”å›ç”¨æˆ·å’Œä»–ä»¬çš„åˆ†æ•°åˆ—è¡¨"""
    return {
        "Alice": [85, 90, 88],
        "Bob": [92, 87, 95]
    }

def process_data(items: List[Tuple[str, int]]) -> Dict[str, int]:
    """å¤„ç†æ•°æ®åˆ—è¡¨"""
    return {name: score for name, score in items}
```

#### 6.3ã€Optionalä¸Union

```python
from typing import Optional, Union

# Optional - å¯èƒ½ä¸ºNone
def find_user(user_id: int) -> Optional[dict]:
    """è¿”å›ç”¨æˆ·æˆ–None"""
    if user_id > 0:
        return {"id": user_id, "name": "Alice"}
    return None

# Optional[X] ç­‰ä»·äº Union[X, None]
def get_config(key: str) -> Optional[str]:
    return None

# Union - å¤šç§å¯èƒ½ç±»å‹
def process_value(value: Union[int, str, float]) -> str:
    """å¤„ç†intã€stræˆ–floatç±»å‹"""
    return str(value)

# å®é™…åº”ç”¨
def parse_input(data: Union[str, bytes]) -> str:
    """å¤„ç†å­—ç¬¦ä¸²æˆ–å­—èŠ‚"""
    if isinstance(data, bytes):
        return data.decode('utf-8')
    return data

# Javaå¯¹æ¯”
"""
// Javaä½¿ç”¨æ³›å‹å’Œnull
Optional<User> findUser(int id) {
    if (id > 0) {
        return Optional.of(new User(id));
    }
    return Optional.empty();
}
"""
```

#### 6.4ã€æ³›å‹ç±»å‹

```python
from typing import TypeVar, Generic, List

# å®šä¹‰ç±»å‹å˜é‡
T = TypeVar('T')

# æ³›å‹å‡½æ•°
def first_element(items: List[T]) -> Optional[T]:
    """è¿”å›åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ """
    return items[0] if items else None

# æ³›å‹ç±»
class Stack(Generic[T]):
    """é€šç”¨æ ˆå®ç°"""
    def __init__(self) -> None:
        self._items: List[T] = []

    def push(self, item: T) -> None:
        self._items.append(item)

    def pop(self) -> Optional[T]:
        return self._items.pop() if self._items else None

# ä½¿ç”¨
int_stack: Stack[int] = Stack()
int_stack.push(1)
int_stack.push(2)

str_stack: Stack[str] = Stack()
str_stack.push("hello")
```

#### 6.5ã€typingæ¨¡å—å¸¸ç”¨ç±»å‹

```python
from typing import Callable, Any, Sequence, Mapping, Iterable

# Callable - å¯è°ƒç”¨å¯¹è±¡
def apply_func(func: Callable[[int, int], int], a: int, b: int) -> int:
    return func(a, b)

result = apply_func(lambda x, y: x + y, 3, 5)  # 8

# Any - ä»»æ„ç±»å‹
def process_data(data: Any) -> str:
    return str(data)

# Sequence - åºåˆ—ç±»å‹
def sum_values(numbers: Sequence[int]) -> int:
    return sum(numbers)

sum_values([1, 2, 3])  # List
sum_values((1, 2, 3))  # Tuple

# Mapping - æ˜ å°„ç±»å‹
def print_config(config: Mapping[str, any]) -> None:
    for key, value in config.items():
        print(f"{key}: {value}")

# Iterable - å¯è¿­ä»£å¯¹è±¡
def process_items(items: Iterable[str]) -> List[str]:
    return [item.upper() for item in items]
```

#### 6.6ã€ç±»å‹åˆ«å

```python
from typing import List, Dict, Tuple

# å®šä¹‰ç±»å‹åˆ«å
UserId = int
UserName = str
Score = float

# å¤æ‚ç±»å‹åˆ«å
User = Dict[str, any]
UserList = List[User]
Coordinate = Tuple[float, float]
ScoreBoard = Dict[UserName, List[Score]]

# ä½¿ç”¨ç±»å‹åˆ«å
def get_user(user_id: UserId) -> User:
    return {"id": user_id, "name": "Alice"}

def calculate_average(scores: ScoreBoard) -> Dict[UserName, Score]:
    return {
        name: sum(score_list) / len(score_list)
        for name, score_list in scores.items()
    }
```

#### 6.7ã€mypyé™æ€ç±»å‹æ£€æŸ¥

```python
# å®‰è£…mypy: pip install mypy

# ç¤ºä¾‹ä»£ç  example.py
def add_numbers(a: int, b: int) -> int:
    return a + b

result: str = add_numbers(1, 2)  # ç±»å‹é”™è¯¯!

# è¿è¡Œæ£€æŸ¥
# mypy example.py
# error: Incompatible types in assignment (expression has type "int", variable has type "str")

# é…ç½®mypy: mypy.ini
"""
[mypy]
python_version = 3.9
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
"""

# å®é™…é¡¹ç›®ç¤ºä¾‹
from typing import List, Optional

class UserService:
    """ç”¨æˆ·æœåŠ¡ç±»"""

    def __init__(self, db_connection: any) -> None:
        self.db = db_connection

    def find_user(self, user_id: int) -> Optional[Dict[str, any]]:
        """æŸ¥æ‰¾ç”¨æˆ·"""
        # å®ç°...
        return {"id": user_id, "name": "Alice"}

    def get_all_users(self) -> List[Dict[str, any]]:
        """è·å–æ‰€æœ‰ç”¨æˆ·"""
        return [{"id": 1, "name": "Alice"}]
```

**å¯¹æ¯”æ€»ç»“:**

| ç‰¹æ€§ | Pythonç±»å‹æç¤º | Javaç±»å‹ç³»ç»Ÿ |
|-----|--------------|-------------|
| å¼ºåˆ¶æ€§ | å¯é€‰,è¿è¡Œæ—¶ä¸æ£€æŸ¥ | å¼ºåˆ¶,ç¼–è¯‘æ—¶æ£€æŸ¥ |
| åŸºæœ¬è¯­æ³• | `name: str` | `String name` |
| æ³›å‹ | `List[int]` | `List<Integer>` |
| å¯é€‰ç±»å‹ | `Optional[int]` | `Optional<Integer>` |
| è”åˆç±»å‹ | `Union[int, str]` | ä¸ç›´æ¥æ”¯æŒ |
| ç±»å‹åˆ«å | `UserId = int` | `typedef`(C++)æˆ–æ¥å£ |
| æ£€æŸ¥å·¥å…· | mypy, pyright | javacå†…ç½® |
| IDEæ”¯æŒ | VSCode, PyCharm | IntelliJ IDEA |

### 7ã€åå°„ä¸å†…çœ

Pythonçš„åå°„èƒ½åŠ›æ¯”Javaæ›´å¼ºå¤§ã€‚ä½œä¸ºJavaå¼€å‘è€…,ä½ ä¼šå‘ç°Pythonçš„åå°„APIæ›´ç®€å•ç›´æ¥ã€‚

#### 7.1ã€inspectæ¨¡å—

```python
import inspect

# å®šä¹‰ç¤ºä¾‹ç±»
class User:
    """ç”¨æˆ·ç±»"""
    def __init__(self, name: str, age: int):
        self.name = name
        self.age = age

    def greet(self):
        return f"Hello, I'm {self.name}"

    @staticmethod
    def create_guest():
        return User("Guest", 0)

# æ£€æŸ¥å¯¹è±¡ç±»å‹
print(inspect.isclass(User))          # True
print(inspect.isfunction(User.greet)) # True
print(inspect.ismethod(User().greet)) # True

# è·å–æºä»£ç 
print(inspect.getsource(User))        # æ‰“å°Userç±»çš„æºä»£ç 
print(inspect.getfile(User))          # è·å–æ–‡ä»¶è·¯å¾„

# è·å–å‡½æ•°ç­¾å
def example_func(name: str, age: int = 18) -> str:
    return f"{name}: {age}"

sig = inspect.signature(example_func)
print(sig)  # (name: str, age: int = 18) -> str

for param_name, param in sig.parameters.items():
    print(f"{param_name}: {param.annotation}, default={param.default}")

# è·å–ç±»æˆå‘˜
members = inspect.getmembers(User)
for name, value in members:
    print(f"{name}: {type(value)}")
```

#### 7.2ã€åŠ¨æ€å±æ€§æ“ä½œ

```python
class Config:
    host = "localhost"
    port = 8080

# getattr - è·å–å±æ€§
print(getattr(Config, 'host'))  # localhost
print(getattr(Config, 'timeout', 30))  # 30 (é»˜è®¤å€¼)

# setattr - è®¾ç½®å±æ€§
setattr(Config, 'host', '192.168.1.1')
print(Config.host)  # 192.168.1.1

# hasattr - æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨
print(hasattr(Config, 'host'))    # True
print(hasattr(Config, 'timeout')) # False

# delattr - åˆ é™¤å±æ€§
delattr(Config, 'port')
print(hasattr(Config, 'port'))  # False

# å®é™…åº”ç”¨:åŠ¨æ€é…ç½®åŠ è½½
config_data = {
    'database_host': 'localhost',
    'database_port': 3306,
    'cache_enabled': True
}

class AppConfig:
    pass

for key, value in config_data.items():
    setattr(AppConfig, key, value)

print(AppConfig.database_host)  # localhost
```

#### 7.3ã€åŠ¨æ€å¯¼å…¥æ¨¡å—

```python
import importlib

# åŠ¨æ€å¯¼å…¥æ¨¡å—
math_module = importlib.import_module('math')
print(math_module.sqrt(16))  # 4.0

# åŠ¨æ€å¯¼å…¥å¹¶è·å–å±æ€§
module = importlib.import_module('json')
dumps_func = getattr(module, 'dumps')
print(dumps_func({'name': 'Alice'}))  # {"name": "Alice"}

# __import__() å‡½æ•°
os_module = __import__('os')
print(os_module.getcwd())

# å®é™…åº”ç”¨:æ’ä»¶ç³»ç»Ÿ
def load_plugin(plugin_name: str):
    """åŠ¨æ€åŠ è½½æ’ä»¶"""
    try:
        module = importlib.import_module(f'plugins.{plugin_name}')
        if hasattr(module, 'Plugin'):
            return module.Plugin()
        else:
            raise AttributeError(f"Plugin class not found in {plugin_name}")
    except ImportError as e:
        print(f"Failed to load plugin: {e}")
        return None
```

#### 7.4ã€ç±»å‹æ£€æŸ¥

```python
# type() vs isinstance()
value = [1, 2, 3]
print(type(value))  # <class 'list'>
print(type(value) == list)  # True

# isinstance() - æ¨èä½¿ç”¨,æ”¯æŒç»§æ‰¿
print(isinstance(value, list))  # True
print(isinstance(value, (list, tuple)))  # True - æ£€æŸ¥å¤šä¸ªç±»å‹

# issubclass() - åˆ¤æ–­ç»§æ‰¿å…³ç³»
class Animal:
    pass

class Dog(Animal):
    pass

print(issubclass(Dog, Animal))  # True
print(issubclass(Dog, object))  # True - æ‰€æœ‰ç±»éƒ½ç»§æ‰¿è‡ªobject

# é¸­å­ç±»å‹åº”ç”¨
def process_iterable(obj):
    """å¤„ç†ä»»ä½•å¯è¿­ä»£å¯¹è±¡"""
    if hasattr(obj, '__iter__'):
        for item in obj:
            print(item)
    else:
        print("Not iterable")

process_iterable([1, 2, 3])      # å¤„ç†åˆ—è¡¨
process_iterable("hello")        # å¤„ç†å­—ç¬¦ä¸²
process_iterable(range(5))       # å¤„ç†rangeå¯¹è±¡
```

#### 7.5ã€åŠ¨æ€åˆ›å»ºç±»

```python
# ä½¿ç”¨type()åˆ›å»ºç±»
# type(name, bases, dict)
User = type('User', (object,), {
    'name': 'Alice',
    'greet': lambda self: f"Hello, {self.name}"
})

user = User()
print(user.name)     # Alice
print(user.greet())  # Hello, Alice

# æ›´å¤æ‚çš„ç¤ºä¾‹
def __init__(self, name, age):
    self.name = name
    self.age = age

def get_info(self):
    return f"{self.name}, {self.age} years old"

Person = type('Person', (object,), {
    '__init__': __init__,
    'get_info': get_info
})

p = Person("Bob", 25)
print(p.get_info())  # Bob, 25 years old

# å®é™…åº”ç”¨:ORMæ¨¡å‹åŠ¨æ€ç”Ÿæˆ
def create_model(table_name: str, fields: dict):
    """åŠ¨æ€åˆ›å»ºæ•°æ®åº“æ¨¡å‹"""
    def __init__(self, **kwargs):
        for key, value in kwargs.items():
            setattr(self, key, value)

    def __repr__(self):
        field_strs = [f"{k}={getattr(self, k)}" for k in fields.keys()]
        return f"{table_name}({', '.join(field_strs)})"

    attrs = {
        '__init__': __init__,
        '__repr__': __repr__,
        '_table_name': table_name,
        '_fields': fields
    }

    return type(table_name, (object,), attrs)

# åˆ›å»ºUseræ¨¡å‹
UserModel = create_model('users', {
    'id': 'INTEGER',
    'name': 'VARCHAR(100)',
    'email': 'VARCHAR(100)'
})

user = UserModel(id=1, name='Alice', email='alice@example.com')
print(user)  # users(id=1, name=Alice, email=alice@example.com)
```

#### 7.6ã€å…ƒç±»(Metaclass)åŸºç¡€

```python
# å…ƒç±»æ˜¯åˆ›å»ºç±»çš„ç±»
class Meta(type):
    """è‡ªå®šä¹‰å…ƒç±»"""
    def __new__(mcs, name, bases, attrs):
        # åœ¨ç±»åˆ›å»ºæ—¶æ‰§è¡Œ
        print(f"Creating class: {name}")
        # æ·»åŠ ç±»å±æ€§
        attrs['created_by'] = 'Meta'
        return super().__new__(mcs, name, bases, attrs)

# ä½¿ç”¨å…ƒç±»
class MyClass(metaclass=Meta):
    pass

# è¾“å‡º: Creating class: MyClass
print(MyClass.created_by)  # Meta

# å®é™…åº”ç”¨:è‡ªåŠ¨æ³¨å†Œç±»
_registry = {}

class RegisterMeta(type):
    """è‡ªåŠ¨æ³¨å†Œå…ƒç±»"""
    def __new__(mcs, name, bases, attrs):
        cls = super().__new__(mcs, name, bases, attrs)
        if name != 'Base':  # è·³è¿‡åŸºç±»
            _registry[name] = cls
        return cls

class Base(metaclass=RegisterMeta):
    pass

class PluginA(Base):
    pass

class PluginB(Base):
    pass

print(_registry)  # {'PluginA': <class '__main__.PluginA'>, 'PluginB': <class '__main__.PluginB'>}
```

#### 7.7ã€å®æˆ˜æ¡ˆä¾‹

**æ¡ˆä¾‹1:ç®€æ˜“ä¾èµ–æ³¨å…¥**

```python
class Container:
    """ä¾èµ–æ³¨å…¥å®¹å™¨"""
    def __init__(self):
        self._services = {}

    def register(self, interface, implementation):
        """æ³¨å†ŒæœåŠ¡"""
        self._services[interface] = implementation

    def resolve(self, interface):
        """è§£ææœåŠ¡"""
        implementation = self._services.get(interface)
        if implementation is None:
            raise ValueError(f"Service {interface} not registered")

        # æ£€æŸ¥æ˜¯å¦éœ€è¦ä¾èµ–æ³¨å…¥
        sig = inspect.signature(implementation.__init__)
        dependencies = {}

        for param_name, param in sig.parameters.items():
            if param_name == 'self':
                continue
            if param.annotation != inspect.Parameter.empty:
                dependencies[param_name] = self.resolve(param.annotation)

        return implementation(**dependencies)

# ä½¿ç”¨ç¤ºä¾‹
class Database:
    def query(self, sql):
        return f"Executing: {sql}"

class UserRepository:
    def __init__(self, db: Database):
        self.db = db

    def find_all(self):
        return self.db.query("SELECT * FROM users")

# æ³¨å†ŒæœåŠ¡
container = Container()
container.register(Database, Database)
container.register(UserRepository, UserRepository)

# è§£ææœåŠ¡(è‡ªåŠ¨æ³¨å…¥ä¾èµ–)
repo = container.resolve(UserRepository)
print(repo.find_all())  # Executing: SELECT * FROM users
```

**æ¡ˆä¾‹2:åºåˆ—åŒ–/ååºåˆ—åŒ–**

```python
import json
from typing import get_type_hints

class Serializable:
    """å¯åºåˆ—åŒ–åŸºç±»"""

    def to_dict(self):
        """è½¬æ¢ä¸ºå­—å…¸"""
        result = {}
        for key, value in self.__dict__.items():
            if isinstance(value, Serializable):
                result[key] = value.to_dict()
            else:
                result[key] = value
        return result

    @classmethod
    def from_dict(cls, data: dict):
        """ä»å­—å…¸åˆ›å»ºå¯¹è±¡"""
        hints = get_type_hints(cls.__init__)
        kwargs = {}

        for key, value in data.items():
            if key in hints:
                hint = hints[key]
                # å¦‚æœæ˜¯Serializableå­ç±»,é€’å½’åˆ›å»º
                if isinstance(hint, type) and issubclass(hint, Serializable):
                    kwargs[key] = hint.from_dict(value)
                else:
                    kwargs[key] = value
            else:
                kwargs[key] = value

        return cls(**kwargs)

class Address(Serializable):
    def __init__(self, city: str, street: str):
        self.city = city
        self.street = street

class User(Serializable):
    def __init__(self, name: str, age: int, address: Address):
        self.name = name
        self.age = age
        self.address = address

# ä½¿ç”¨
user = User("Alice", 25, Address("Beijing", "Main St"))
user_dict = user.to_dict()
print(json.dumps(user_dict, indent=2))

# ååºåˆ—åŒ–
restored = User.from_dict(user_dict)
print(f"{restored.name} lives in {restored.address.city}")
```

**å¯¹æ¯”æ€»ç»“:**

| ç‰¹æ€§ | Python | Java |
|-----|--------|------|
| åå°„API | inspect, getattr, setattr | java.lang.reflect |
| è·å–ç±»ä¿¡æ¯ | `inspect.getmembers()` | `Class.getDeclaredMethods()` |
| åŠ¨æ€è°ƒç”¨ | `getattr(obj, 'method')()` | `method.invoke(obj)` |
| åŠ¨æ€åˆ›å»ºç±» | `type(name, bases, dict)` | `Proxy.newProxyInstance()` |
| ç±»å‹æ£€æŸ¥ | `isinstance()`, `issubclass()` | `instanceof`, `isAssignableFrom()` |
| å…ƒç±» | `class Meta(type)` | ä¸æ”¯æŒ(ä½¿ç”¨æ³¨è§£å¤„ç†å™¨) |
| çµæ´»æ€§ | æé«˜ | ä¸­ç­‰ |
| æ€§èƒ½ | è¾ƒæ…¢ | è¾ƒå¿« |

## 8ã€Pythonæ ‡å‡†åº“ç²¾é€‰

Pythonçš„æ ‡å‡†åº“éå¸¸ä¸°å¯Œ,å¼€ç®±å³ç”¨ã€‚ä½œä¸ºJavaå¼€å‘è€…,ä½ ä¼šå‘ç°å¾ˆå¤šåŠŸèƒ½åœ¨Pythonæ ‡å‡†åº“ä¸­å·²ç»å®ç°,æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ã€‚

### 8.1ã€å¸¸ç”¨å†…ç½®æ¨¡å—

#### aã€osä¸sysæ¨¡å—

**osæ¨¡å— - æ“ä½œç³»ç»Ÿäº¤äº’**

```python
import os

# è·å–å½“å‰å·¥ä½œç›®å½•
print(os.getcwd())  # D:\workspace\project

# æ”¹å˜å·¥ä½œç›®å½•
os.chdir('/tmp')

# åˆ—å‡ºç›®å½•å†…å®¹
files = os.listdir('.')
print(files)

# åˆ›å»ºç›®å½•
os.mkdir('new_folder')
os.makedirs('path/to/folder', exist_ok=True)  # é€’å½’åˆ›å»º

# åˆ é™¤æ–‡ä»¶å’Œç›®å½•
os.remove('file.txt')  # åˆ é™¤æ–‡ä»¶
os.rmdir('folder')     # åˆ é™¤ç©ºç›®å½•
import shutil
shutil.rmtree('folder')  # åˆ é™¤éç©ºç›®å½•

# æ–‡ä»¶å’Œç›®å½•åˆ¤æ–­
print(os.path.exists('file.txt'))  # æ˜¯å¦å­˜åœ¨
print(os.path.isfile('file.txt'))  # æ˜¯å¦æ˜¯æ–‡ä»¶
print(os.path.isdir('folder'))     # æ˜¯å¦æ˜¯ç›®å½•

# è·¯å¾„æ“ä½œ
full_path = os.path.join('path', 'to', 'file.txt')  # path/to/file.txt
dirname = os.path.dirname('/path/to/file.txt')      # /path/to
basename = os.path.basename('/path/to/file.txt')    # file.txt
name, ext = os.path.splitext('file.txt')            # ('file', '.txt')

# ç¯å¢ƒå˜é‡
print(os.environ.get('PATH'))
os.environ['MY_VAR'] = 'value'

# æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
os.system('ls -l')  # ä¸æ¨è,ä½¿ç”¨subprocessæ¨¡å—
```

**sysæ¨¡å— - Pythonè§£é‡Šå™¨äº¤äº’**

```python
import sys

# å‘½ä»¤è¡Œå‚æ•°
print(sys.argv)  # ['script.py', 'arg1', 'arg2']

# Pythonç‰ˆæœ¬ä¿¡æ¯
print(sys.version)
print(sys.version_info)  # sys.version_info(major=3, minor=9, ...)

# æ¨¡å—æœç´¢è·¯å¾„
print(sys.path)
sys.path.append('/custom/path')

# é€€å‡ºç¨‹åº
sys.exit(0)  # æ­£å¸¸é€€å‡º
sys.exit(1)  # å¼‚å¸¸é€€å‡º

# æ ‡å‡†è¾“å…¥è¾“å‡º
sys.stdout.write("Hello\n")
line = sys.stdin.readline()

# è·å–å¯¹è±¡å¤§å°
numbers = [1, 2, 3, 4, 5]
print(sys.getsizeof(numbers))  # å­—èŠ‚æ•°
```

**Javaå¯¹æ¯”:**

```java
// Javaè·å–å½“å‰ç›®å½•
String currentDir = System.getProperty("user.dir");

// Javaç¯å¢ƒå˜é‡
String path = System.getenv("PATH");

// Javaå‘½ä»¤è¡Œå‚æ•°
public static void main(String[] args) {
    // argsæ•°ç»„
}
```

#### bã€datetimeæ¨¡å—

```python
from datetime import datetime, date, time, timedelta

# è·å–å½“å‰æ—¶é—´
now = datetime.now()
print(now)  # 2025-01-26 15:30:45.123456

today = date.today()
print(today)  # 2025-01-26

# åˆ›å»ºæ—¥æœŸæ—¶é—´
dt = datetime(2025, 1, 26, 15, 30, 45)
d = date(2025, 1, 26)
t = time(15, 30, 45)

# æ ¼å¼åŒ–è¾“å‡º
print(now.strftime('%Y-%m-%d %H:%M:%S'))  # 2025-01-26 15:30:45
print(now.strftime('%Yå¹´%mæœˆ%dæ—¥'))        # 2025å¹´01æœˆ26æ—¥

# è§£æå­—ç¬¦ä¸²
dt = datetime.strptime('2025-01-26 15:30:45', '%Y-%m-%d %H:%M:%S')

# æ—¥æœŸè¿ç®—
tomorrow = today + timedelta(days=1)
next_week = today + timedelta(weeks=1)
one_hour_later = now + timedelta(hours=1)

# æ—¶é—´å·®
diff = datetime(2025, 12, 31) - now
print(diff.days)  # å‰©ä½™å¤©æ•°
print(diff.total_seconds())  # æ€»ç§’æ•°

# æ—¶é—´æˆ³
timestamp = now.timestamp()  # è½¬ä¸ºæ—¶é—´æˆ³
dt = datetime.fromtimestamp(timestamp)  # ä»æ—¶é—´æˆ³åˆ›å»º

# Javaå¯¹æ¯”
"""
// Java 8+
LocalDateTime now = LocalDateTime.now();
LocalDate today = LocalDate.now();

// æ ¼å¼åŒ–
DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
String formatted = now.format(formatter);

// æ—¥æœŸè¿ç®—
LocalDate tomorrow = today.plusDays(1);
"""
```

#### cã€jsonæ¨¡å—

```python
import json

# Pythonå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²
data = {
    'name': 'Alice',
    'age': 25,
    'skills': ['Python', 'Java'],
    'active': True
}

json_str = json.dumps(data)
print(json_str)  # {"name": "Alice", "age": 25, ...}

# ç¾åŒ–è¾“å‡º
json_str = json.dumps(data, indent=2, ensure_ascii=False)
print(json_str)

# JSONå­—ç¬¦ä¸²è½¬Pythonå¯¹è±¡
data = json.loads(json_str)
print(data['name'])  # Alice

# è¯»å†™JSONæ–‡ä»¶
# å†™å…¥
with open('data.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=2, ensure_ascii=False)

# è¯»å–
with open('data.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# è‡ªå®šä¹‰JSONç¼–ç 
from datetime import datetime

class DateTimeEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, datetime):
            return obj.isoformat()
        return super().default(obj)

data = {'created': datetime.now()}
json_str = json.dumps(data, cls=DateTimeEncoder)

# Javaå¯¹æ¯”
"""
// Javaä½¿ç”¨Jacksonæˆ–Gson
ObjectMapper mapper = new ObjectMapper();
String json = mapper.writeValueAsString(data);
Data data = mapper.readValue(json, Data.class);
"""
```

#### dã€reæ¨¡å—(æ­£åˆ™è¡¨è¾¾å¼)

```python
import re

# åŸºæœ¬åŒ¹é…
text = "My email is alice@example.com"
match = re.search(r'\w+@\w+\.\w+', text)
if match:
    print(match.group())  # alice@example.com

# æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…
text = "Phone: 123-456-7890, Mobile: 098-765-4321"
phones = re.findall(r'\d{3}-\d{3}-\d{4}', text)
print(phones)  # ['123-456-7890', '098-765-4321']

# æ›¿æ¢
text = "Hello World"
result = re.sub(r'World', 'Python', text)
print(result)  # Hello Python

# åˆ†å‰²
text = "apple,banana;orange:grape"
fruits = re.split(r'[,;:]', text)
print(fruits)  # ['apple', 'banana', 'orange', 'grape']

# ç¼–è¯‘æ­£åˆ™(æé«˜æ€§èƒ½)
pattern = re.compile(r'\d+')
numbers = pattern.findall("I have 3 apples and 5 oranges")
print(numbers)  # ['3', '5']

# æ•è·ç»„
text = "Name: Alice, Age: 25"
match = re.search(r'Name: (\w+), Age: (\d+)', text)
if match:
    print(match.group(1))  # Alice
    print(match.group(2))  # 25
    print(match.groups())  # ('Alice', '25')

# å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼
email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
url_pattern = r'^https?://(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b'
phone_pattern = r'^\d{3}-\d{3}-\d{4}$'
```

#### eã€mathä¸randomæ¨¡å—

```python
import math
import random

# mathæ¨¡å—
print(math.pi)      # 3.141592653589793
print(math.e)       # 2.718281828459045

print(math.sqrt(16))    # 4.0
print(math.pow(2, 3))   # 8.0
print(math.ceil(4.3))   # 5
print(math.floor(4.7))  # 4
print(math.fabs(-5))    # 5.0

# ä¸‰è§’å‡½æ•°
print(math.sin(math.pi / 2))  # 1.0
print(math.cos(0))             # 1.0

# randomæ¨¡å—
print(random.random())  # 0.0åˆ°1.0çš„éšæœºæµ®ç‚¹æ•°

# éšæœºæ•´æ•°
print(random.randint(1, 10))  # 1åˆ°10çš„éšæœºæ•´æ•°(åŒ…å«10)
print(random.randrange(1, 10))  # 1åˆ°9çš„éšæœºæ•´æ•°(ä¸å«10)

# éšæœºé€‰æ‹©
colors = ['red', 'green', 'blue']
print(random.choice(colors))  # éšæœºé€‰æ‹©ä¸€ä¸ª

# éšæœºå¤šä¸ª(æœ‰æ”¾å›)
print(random.choices(colors, k=3))  # ['red', 'blue', 'red']

# éšæœºå¤šä¸ª(æ— æ”¾å›)
print(random.sample(colors, k=2))  # ['green', 'red']

# æ‰“ä¹±åˆ—è¡¨
numbers = [1, 2, 3, 4, 5]
random.shuffle(numbers)
print(numbers)  # [3, 1, 5, 2, 4]

# è®¾ç½®éšæœºç§å­(å¯å¤ç°)
random.seed(42)
print(random.random())  # ç›¸åŒç§å­äº§ç”Ÿç›¸åŒåºåˆ—
```

#### fã€collectionsæ¨¡å—

```python
from collections import Counter, defaultdict, deque, namedtuple, OrderedDict

# Counter - è®¡æ•°å™¨
words = ['apple', 'banana', 'apple', 'orange', 'banana', 'apple']
counter = Counter(words)
print(counter)  # Counter({'apple': 3, 'banana': 2, 'orange': 1})
print(counter.most_common(2))  # [('apple', 3), ('banana', 2)]

# defaultdict - é»˜è®¤å€¼å­—å…¸
dd = defaultdict(list)
dd['fruits'].append('apple')  # ä¸éœ€è¦æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨
print(dd)  # defaultdict(<class 'list'>, {'fruits': ['apple']})

# æŒ‰ç±»åˆ«åˆ†ç»„
data = [('fruit', 'apple'), ('veg', 'carrot'), ('fruit', 'banana')]
grouped = defaultdict(list)
for category, item in data:
    grouped[category].append(item)
print(dict(grouped))  # {'fruit': ['apple', 'banana'], 'veg': ['carrot']}

# deque - åŒç«¯é˜Ÿåˆ—
dq = deque([1, 2, 3])
dq.append(4)      # å³ç«¯æ·»åŠ 
dq.appendleft(0)  # å·¦ç«¯æ·»åŠ 
dq.pop()          # å³ç«¯ç§»é™¤
dq.popleft()      # å·¦ç«¯ç§»é™¤
print(dq)  # deque([1, 2, 3])

# é™åˆ¶é•¿åº¦çš„deque(ç”¨ä½œå¾ªç¯ç¼“å†²åŒº)
buffer = deque(maxlen=3)
for i in range(5):
    buffer.append(i)
print(buffer)  # deque([2, 3, 4], maxlen=3)

# namedtuple - å‘½åå…ƒç»„
Point = namedtuple('Point', ['x', 'y'])
p = Point(10, 20)
print(p.x, p.y)  # 10 20
print(p[0], p[1])  # ä¹Ÿå¯ä»¥ç”¨ç´¢å¼•

# OrderedDict - æœ‰åºå­—å…¸(Python 3.7+æ™®é€šdictä¹Ÿä¿åº)
od = OrderedDict()
od['a'] = 1
od['b'] = 2
od['c'] = 3
print(list(od.keys()))  # ['a', 'b', 'c']

# Javaå¯¹æ¯”
"""
// Java Counterç±»ä¼¼
Map<String, Integer> counter = new HashMap<>();
// éœ€è¦æ‰‹åŠ¨è®¡æ•°

// Java deque
Deque<Integer> deque = new ArrayDeque<>();
deque.addFirst(1);
deque.addLast(2);
"""
```

#### gã€pathlibæ¨¡å—

```python
from pathlib import Path

# åˆ›å»ºè·¯å¾„å¯¹è±¡
p = Path('/usr/local/bin')
p = Path.home()  # ç”¨æˆ·ä¸»ç›®å½•
p = Path.cwd()   # å½“å‰å·¥ä½œç›®å½•

# è·¯å¾„æ‹¼æ¥
config_path = Path.home() / '.config' / 'app' / 'settings.json'
print(config_path)  # /home/user/.config/app/settings.json

# è·¯å¾„å±æ€§
p = Path('/path/to/file.txt')
print(p.name)       # file.txt
print(p.stem)       # file
print(p.suffix)     # .txt
print(p.parent)     # /path/to
print(p.parts)      # ('/', 'path', 'to', 'file.txt')

# æ–‡ä»¶æ“ä½œ
p = Path('test.txt')
p.write_text('Hello World', encoding='utf-8')  # å†™å…¥
content = p.read_text(encoding='utf-8')        # è¯»å–
p.unlink()  # åˆ é™¤æ–‡ä»¶

# ç›®å½•æ“ä½œ
dir_path = Path('new_folder')
dir_path.mkdir(exist_ok=True)  # åˆ›å»ºç›®å½•
dir_path.mkdir(parents=True, exist_ok=True)  # é€’å½’åˆ›å»º

# åˆ¤æ–­
p = Path('file.txt')
print(p.exists())   # æ˜¯å¦å­˜åœ¨
print(p.is_file())  # æ˜¯å¦æ˜¯æ–‡ä»¶
print(p.is_dir())   # æ˜¯å¦æ˜¯ç›®å½•

# éå†ç›®å½•
for file in Path('.').iterdir():
    print(file)

# é€’å½’æŸ¥æ‰¾
for py_file in Path('.').rglob('*.py'):
    print(py_file)

# å¯¹æ¯”os.path
"""
# æ—§æ–¹å¼
import os
path = os.path.join(os.path.expanduser('~'), '.config', 'app')

# æ–°æ–¹å¼(pathlib)
path = Path.home() / '.config' / 'app'
"""
```

**æ¨¡å—å¯¹æ¯”æ€»ç»“:**

| åŠŸèƒ½ | Pythonæ¨¡å— | Javaå¯¹åº” |
|-----|-----------|---------|
| æ“ä½œç³»ç»Ÿäº¤äº’ | `os` | `System`, `Runtime` |
| æ–‡ä»¶è·¯å¾„ | `pathlib`, `os.path` | `java.nio.file.Path` |
| æ—¥æœŸæ—¶é—´ | `datetime` | `java.time.*` |
| JSONå¤„ç† | `json` | Jackson, Gson |
| æ­£åˆ™è¡¨è¾¾å¼ | `re` | `java.util.regex.Pattern` |
| éšæœºæ•° | `random` | `java.util.Random` |
| é«˜çº§é›†åˆ | `collections` | `java.util.*` |

### 8.2ã€æ•°æ®å¤„ç†

#### aã€csvæ¨¡å—

```python
import csv

# è¯»å–CSVæ–‡ä»¶
with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.reader(f)
    headers = next(reader)  # è¯»å–è¡¨å¤´
    for row in reader:
        print(row)  # ['Alice', '25', 'Beijing']

# ä½¿ç”¨DictReader(æ¨è)
with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        print(row['name'], row['age'])  # æŒ‰åˆ—åè®¿é—®

# å†™å…¥CSVæ–‡ä»¶
data = [
    ['name', 'age', 'city'],
    ['Alice', 25, 'Beijing'],
    ['Bob', 30, 'Shanghai']
]

with open('output.csv', 'w', encoding='utf-8', newline='') as f:
    writer = csv.writer(f)
    writer.writerows(data)

# ä½¿ç”¨DictWriter
with open('output.csv', 'w', encoding='utf-8', newline='') as f:
    fieldnames = ['name', 'age', 'city']
    writer = csv.DictWriter(f, fieldnames=fieldnames)
    writer.writeheader()
    writer.writerow({'name': 'Alice', 'age': 25, 'city': 'Beijing'})
```

#### bã€XMLå¤„ç†

```python
import xml.etree.ElementTree as ET

# è§£æXML
xml_str = '''
<users>
    <user id="1">
        <name>Alice</name>
        <age>25</age>
    </user>
    <user id="2">
        <name>Bob</name>
        <age>30</age>
    </user>
</users>
'''

root = ET.fromstring(xml_str)

# éå†å…ƒç´ 
for user in root.findall('user'):
    user_id = user.get('id')
    name = user.find('name').text
    age = user.find('age').text
    print(f"ID: {user_id}, Name: {name}, Age: {age}")

# åˆ›å»ºXML
root = ET.Element('users')
user = ET.SubElement(root, 'user', id='1')
ET.SubElement(user, 'name').text = 'Alice'
ET.SubElement(user, 'age').text = '25'

# ä¿å­˜XML
tree = ET.ElementTree(root)
tree.write('users.xml', encoding='utf-8', xml_declaration=True)
```

#### cã€pickleæ¨¡å—(åºåˆ—åŒ–)

```python
import pickle

# Pythonå¯¹è±¡åºåˆ—åŒ–
data = {
    'name': 'Alice',
    'scores': [85, 90, 88],
    'metadata': {'created': '2025-01-26'}
}

# ä¿å­˜åˆ°æ–‡ä»¶
with open('data.pkl', 'wb') as f:
    pickle.dump(data, f)

# ä»æ–‡ä»¶åŠ è½½
with open('data.pkl', 'rb') as f:
    loaded_data = pickle.load(f)
    print(loaded_data)

# åºåˆ—åŒ–ä¸ºå­—èŠ‚ä¸²
bytes_data = pickle.dumps(data)
restored = pickle.loads(bytes_data)
```

#### dã€structæ¨¡å—(äºŒè¿›åˆ¶æ•°æ®)

```python
import struct

# æ‰“åŒ…äºŒè¿›åˆ¶æ•°æ®
# æ ¼å¼: i=int, f=float, s=string
packed = struct.pack('i f 10s', 42, 3.14, b'Hello')
print(packed)  # b'*\x00\x00\x00\xc3\xf5H@Hello\x00\x00\x00\x00\x00'

# è§£åŒ…äºŒè¿›åˆ¶æ•°æ®
unpacked = struct.unpack('i f 10s', packed)
print(unpacked)  # (42, 3.140000104904175, b'Hello\x00\x00\x00\x00\x00')

# å®é™…åº”ç”¨:è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶
with open('data.bin', 'rb') as f:
    data = f.read(struct.calcsize('i f'))
    values = struct.unpack('i f', data)
```

### 8.3ã€ç½‘ç»œç¼–ç¨‹

#### aã€socketæ¨¡å—

```python
import socket

# TCPæœåŠ¡å™¨
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(('localhost', 8080))
server.listen(5)
print("Server listening on port 8080...")

while True:
    client, addr = server.accept()
    print(f"Connection from {addr}")
    data = client.recv(1024)
    client.send(b"Hello from server")
    client.close()

# TCPå®¢æˆ·ç«¯
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect(('localhost', 8080))
client.send(b"Hello server")
response = client.recv(1024)
print(response.decode())
client.close()
```

#### bã€urllibæ¨¡å—

```python
from urllib import request, parse

# GETè¯·æ±‚
response = request.urlopen('https://api.github.com')
html = response.read().decode('utf-8')
print(html)

# POSTè¯·æ±‚
data = parse.urlencode({'key': 'value'}).encode()
req = request.Request('https://httpbin.org/post', data=data)
response = request.urlopen(req)
print(response.read().decode())

# è®¾ç½®è¯·æ±‚å¤´
req = request.Request('https://api.github.com')
req.add_header('User-Agent', 'Python App')
response = request.urlopen(req)
```

#### cã€http.server

```python
# å‘½ä»¤è¡Œå¯åŠ¨ç®€å•HTTPæœåŠ¡å™¨
# python -m http.server 8000

# è‡ªå®šä¹‰HTTPæœåŠ¡å™¨
from http.server import HTTPServer, BaseHTTPRequestHandler

class MyHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        self.wfile.write(b'<h1>Hello World</h1>')

server = HTTPServer(('localhost', 8000), MyHandler)
server.serve_forever()
```

### 8.4ã€å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹

#### aã€threadingæ¨¡å—

```python
import threading
import time

# åˆ›å»ºçº¿ç¨‹
def worker(name):
    print(f"Thread {name} starting")
    time.sleep(2)
    print(f"Thread {name} done")

threads = []
for i in range(5):
    t = threading.Thread(target=worker, args=(i,))
    threads.append(t)
    t.start()

# ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
for t in threads:
    t.join()

# çº¿ç¨‹ç±»
class MyThread(threading.Thread):
    def __init__(self, name):
        super().__init__()
        self.name = name

    def run(self):
        print(f"{self.name} is running")

# çº¿ç¨‹é”
lock = threading.Lock()

def safe_increment():
    global counter
    with lock:
        counter += 1
```

#### bã€multiprocessingæ¨¡å—

```python
from multiprocessing import Process, Pool, Queue

# åˆ›å»ºè¿›ç¨‹
def worker(name):
    print(f"Process {name} starting")

if __name__ == '__main__':
    processes = []
    for i in range(5):
        p = Process(target=worker, args=(i,))
        processes.append(p)
        p.start()

    for p in processes:
        p.join()

# è¿›ç¨‹æ± 
def square(x):
    return x ** 2

if __name__ == '__main__':
    with Pool(processes=4) as pool:
        results = pool.map(square, range(10))
        print(results)
```

#### cã€concurrent.futuresæ¨¡å—

```python
from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor
import time

def task(n):
    time.sleep(1)
    return n ** 2

# çº¿ç¨‹æ± 
with ThreadPoolExecutor(max_workers=5) as executor:
    futures = [executor.submit(task, i) for i in range(10)]
    for future in futures:
        print(future.result())

# è¿›ç¨‹æ± 
with ProcessPoolExecutor(max_workers=4) as executor:
    results = executor.map(task, range(10))
    print(list(results))
```

#### dã€GILè¯¦è§£
GIL(å…¨å±€è§£é‡Šå™¨é”)æ˜¯CPythonçš„å®ç°ç»†èŠ‚:

1. å½±å“:
   - åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒPythonå­—èŠ‚ç 
   - å¤šçº¿ç¨‹æ— æ³•åˆ©ç”¨å¤šæ ¸CPUè¿›è¡ŒCPUå¯†é›†å‹ä»»åŠ¡
   - I/Oå¯†é›†å‹ä»»åŠ¡ä¸å—å½±å“

2. è§£å†³æ–¹æ¡ˆ:
   - CPUå¯†é›†å‹: ä½¿ç”¨multiprocessing
   - I/Oå¯†é›†å‹: ä½¿ç”¨threadingæˆ–asyncio
   - æ··åˆå‹: æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©

Javaå¯¹æ¯”:
- Javaæ²¡æœ‰GIL,å¤šçº¿ç¨‹å¯ä»¥çœŸæ­£å¹¶è¡Œ
- Pythonçš„å¤šçº¿ç¨‹æ›´é€‚åˆI/Oæ“ä½œ
- Pythonçš„å¤šè¿›ç¨‹ç±»ä¼¼Javaçš„å¤šçº¿ç¨‹

### 8.5ã€æ—¥å¿—ä¸è°ƒè¯•

#### aã€loggingæ¨¡å—

```python
import logging

# åŸºæœ¬é…ç½®
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S',
    filename='app.log'
)

# ä½¿ç”¨æ—¥å¿—
logging.debug("Debug message")
logging.info("Info message")
logging.warning("Warning message")
logging.error("Error message")
logging.critical("Critical message")

# åˆ›å»ºlogger
logger = logging.getLogger(__name__)
logger.setLevel(logging.DEBUG)

# æ·»åŠ å¤„ç†å™¨
file_handler = logging.FileHandler('app.log')
console_handler = logging.StreamHandler()

# è®¾ç½®æ ¼å¼
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
file_handler.setFormatter(formatter)
console_handler.setFormatter(formatter)

logger.addHandler(file_handler)
logger.addHandler(console_handler)

# ä½¿ç”¨logger
logger.info("Application started")
```

#### bã€pdbè°ƒè¯•å™¨

```python
import pdb

def buggy_function(x, y):
    result = x + y
    pdb.set_trace()  # è®¾ç½®æ–­ç‚¹
    result = result * 2
    return result

# è°ƒè¯•å‘½ä»¤:
# n - ä¸‹ä¸€è¡Œ
# s - è¿›å…¥å‡½æ•°
# c - ç»§ç»­æ‰§è¡Œ
# p variable - æ‰“å°å˜é‡
# l - æ˜¾ç¤ºå½“å‰ä»£ç 
# q - é€€å‡ºè°ƒè¯•
```

#### cã€tracebackæ¨¡å—

```python
import traceback

try:
    result = 1 / 0
except Exception as e:
    # æ‰“å°å®Œæ•´å †æ ˆ
    traceback.print_exc()

    # è·å–å †æ ˆä¿¡æ¯
    tb_str = traceback.format_exc()
    print(tb_str)

    # è®°å½•åˆ°æ—¥å¿—
    logging.error("Error occurred", exc_info=True)
```

## 9ã€å¼‚æ­¥ç¼–ç¨‹

å¼‚æ­¥ç¼–ç¨‹æ˜¯Pythonçš„é‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†I/Oå¯†é›†å‹ä»»åŠ¡ã€‚å¯¹äºJavaå¼€å‘è€…æ¥è¯´ï¼ŒPythonçš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¯”Javaçš„CompletableFutureæ›´åŠ ç›´è§‚å’Œå¼ºå¤§ã€‚

### 9.1ã€asyncioåŸºç¡€

#### aã€async/awaitè¯­æ³•

Python 3.5å¼•å…¥äº†`async/await`è¯­æ³•ï¼Œè®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ä¸€æ ·ç›´è§‚ã€‚

```python
import asyncio

async def greet(name):
    print(f"å¼€å§‹é—®å€™ {name}")
    await asyncio.sleep(1)  # å¼‚æ­¥ç­‰å¾…1ç§’
    return f"Hello, {name}!"

async def main():
    result = await greet("å¼ ä¸‰")
    print(result)

# è¿è¡Œå¼‚æ­¥ç¨‹åº
asyncio.run(main())
```

å¯¹æ¯”Javaçš„å¼‚æ­¥ç¼–ç¨‹ï¼š
```java
// Javaä½¿ç”¨CompletableFuture
CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
    try {
        Thread.sleep(1000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    return "Hello, å¼ ä¸‰!";
});

future.thenAccept(System.out::println);
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- `async def`ï¼šå®šä¹‰åç¨‹å‡½æ•°
- `await`ï¼šæš‚åœå½“å‰åç¨‹ï¼Œç­‰å¾…å¦ä¸€ä¸ªåç¨‹å®Œæˆ
- `asyncio.run()`ï¼šå¯åŠ¨äº‹ä»¶å¾ªç¯å¹¶è¿è¡Œä¸»åç¨‹

#### bã€åç¨‹æ¦‚å¿µ

åç¨‹ï¼ˆCoroutineï¼‰æ˜¯å¯ä»¥æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„å‡½æ•°ï¼Œæ¯”çº¿ç¨‹æ›´è½»é‡çº§ã€‚

```python
import asyncio
import time

async def task(name, duration):
    print(f"ä»»åŠ¡ {name} å¼€å§‹")
    await asyncio.sleep(duration)
    print(f"ä»»åŠ¡ {name} å®Œæˆ")
    return f"{name} ç»“æœ"

async def main():
    start_time = time.time()

    # é¡ºåºæ‰§è¡Œï¼ˆæ€»æ—¶é—´ = 3ç§’ï¼‰
    result1 = await task("A", 1)
    result2 = await task("B", 2)

    end_time = time.time()
    print(f"é¡ºåºæ‰§è¡Œè€—æ—¶: {end_time - start_time:.2f}ç§’")

asyncio.run(main())
```

**åç¨‹ vs çº¿ç¨‹å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | åç¨‹ | çº¿ç¨‹ |
|-----|------|------|
| åˆ›å»ºæˆæœ¬ | æä½ï¼ˆå‡ KBï¼‰ | è¾ƒé«˜ï¼ˆå‡ MBï¼‰ |
| åˆ‡æ¢æˆæœ¬ | ç”¨æˆ·æ€åˆ‡æ¢ | å†…æ ¸æ€åˆ‡æ¢ |
| æ•°é‡é™åˆ¶ | å¯ä»¥åˆ›å»ºæ•°ä¸‡ä¸ª | é€šå¸¸æ•°ç™¾ä¸ª |
| é€‚ç”¨åœºæ™¯ | I/Oå¯†é›†å‹ | CPUå¯†é›†å‹ |

#### cã€äº‹ä»¶å¾ªç¯

äº‹ä»¶å¾ªç¯æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œåç¨‹ã€‚

```python
import asyncio

async def worker(name):
    print(f"{name} å¼€å§‹å·¥ä½œ")
    await asyncio.sleep(1)
    print(f"{name} å®Œæˆå·¥ä½œ")

async def main():
    # åˆ›å»ºä»»åŠ¡
    task1 = asyncio.create_task(worker("ä»»åŠ¡1"))
    task2 = asyncio.create_task(worker("ä»»åŠ¡2"))

    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    await task1
    await task2
    print("æ‰€æœ‰ä»»åŠ¡å®Œæˆ")

# ä½¿ç”¨asyncio.run()
asyncio.run(main())

# æ‰‹åŠ¨æ§åˆ¶äº‹ä»¶å¾ªç¯ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
loop = asyncio.new_event_loop()
try:
    loop.run_until_complete(main())
finally:
    loop.close()
```

**asyncio.run() vs awaitçš„åŒºåˆ«**ï¼š
- `asyncio.run()`ï¼šå¯åŠ¨æ–°çš„äº‹ä»¶å¾ªç¯ï¼Œé€šå¸¸ç”¨äºç¨‹åºå…¥å£
- `await`ï¼šåœ¨ç°æœ‰äº‹ä»¶å¾ªç¯ä¸­ç­‰å¾…åç¨‹å®Œæˆ

```python
import asyncio

async def nested():
    return "åµŒå¥—åç¨‹ç»“æœ"

async def outer():
    # âœ… æ­£ç¡®ï¼šä½¿ç”¨await
    result = await nested()
    print(result)

    # âŒ é”™è¯¯ï¼šä¸èƒ½åœ¨åç¨‹ä¸­ä½¿ç”¨asyncio.run()
    # asyncio.run(nested())  # RuntimeError: no running event loop

asyncio.run(outer())
```

#### dã€Taskä¸Future

**Task**æ˜¯`Future`çš„å­ç±»ï¼Œç”¨äºåŒ…è£…åç¨‹å¹¶è°ƒåº¦æ‰§è¡Œã€‚

```python
import asyncio

async def background_task(name, delay):
    print(f"åå°ä»»åŠ¡ {name} å¼€å§‹")
    await asyncio.sleep(delay)
    print(f"åå°ä»»åŠ¡ {name} å®Œæˆ")
    return f"{name} çš„ç»“æœ"

async def main():
    # åˆ›å»ºå¤šä¸ªä»»åŠ¡ï¼ˆç«‹å³å¼€å§‹æ‰§è¡Œï¼‰
    tasks = [
        asyncio.create_task(background_task("A", 2)),
        asyncio.create_task(background_task("B", 1)),
        asyncio.create_task(background_task("C", 3))
    ]

    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    results = await asyncio.gather(*tasks)
    print("æ‰€æœ‰ä»»åŠ¡ç»“æœ:", results)

    # å¸¦è¶…æ—¶çš„ç­‰å¾…
    try:
        await asyncio.wait_for(asyncio.create_task(background_task("D", 5)), timeout=3)
    except asyncio.TimeoutError:
        print("ä»»åŠ¡Dè¶…æ—¶")

asyncio.run(main())
```

**Taskçš„é«˜çº§ç”¨æ³•**ï¼š
```python
import asyncio

async def cancellable_task():
    try:
        for i in range(10):
            print(f"å·¥ä½œä¸­... {i}")
            await asyncio.sleep(1)
    except asyncio.CancelledError:
        print("ä»»åŠ¡è¢«å–æ¶ˆ")
        # æ¸…ç†èµ„æº
        await asyncio.sleep(0.5)
        print("æ¸…ç†å®Œæˆ")
        raise

async def main():
    task = asyncio.create_task(cancellable_task())

    # 3ç§’åå–æ¶ˆä»»åŠ¡
    await asyncio.sleep(3)
    task.cancel()

    try:
        await task
    except asyncio.CancelledError:
        print("ä¸»åç¨‹æ•è·åˆ°å–æ¶ˆå¼‚å¸¸")

asyncio.run(main())
```

### 9.2ã€å¼‚æ­¥I/O

#### aã€å¼‚æ­¥æ–‡ä»¶æ“ä½œ

Python 3.4+æä¾›äº†å¼‚æ­¥æ–‡ä»¶æ“ä½œAPIã€‚

```python
import asyncio
import aiofiles  # ç¬¬ä¸‰æ–¹åº“ï¼ŒåŠŸèƒ½æ›´å®Œæ•´

async def read_file_async(filename):
    # ä½¿ç”¨aiofilesï¼ˆæ¨èï¼‰
    async with aiofiles.open(filename, 'r', encoding='utf-8') as f:
        content = await f.read()
        print(f"æ–‡ä»¶å†…å®¹é•¿åº¦: {len(content)}")
        return content

async def write_file_async(filename, content):
    async with aiofiles.open(filename, 'w', encoding='utf-8') as f:
        await f.write(content)
        print(f"å†™å…¥æ–‡ä»¶: {filename}")

async def process_files():
    # å¹¶å‘å¤„ç†å¤šä¸ªæ–‡ä»¶
    files = ['file1.txt', 'file2.txt', 'file3.txt']

    tasks = []
    for filename in files:
        content = f"è¿™æ˜¯ {filename} çš„å†…å®¹\n"
        tasks.append(write_file_async(filename, content))

    await asyncio.gather(*tasks)

    # å¹¶å‘è¯»å–æ–‡ä»¶
    read_tasks = [read_file_async(f) for f in files]
    contents = await asyncio.gather(*read_tasks)

    print(f"è¯»å–äº† {len(contents)} ä¸ªæ–‡ä»¶")

# å®‰è£…aiofiles: pip install aiofiles
# asyncio.run(process_files())
```

å¯¹æ¯”Javaçš„å¼‚æ­¥æ–‡ä»¶æ“ä½œï¼š
```java
// Java NIO.2å¼‚æ­¥æ–‡ä»¶æ“ä½œ
AsynchronousFileChannel channel = AsynchronousFileChannel.open(
    Paths.get("file.txt"), StandardOpenOption.READ);

ByteBuffer buffer = ByteBuffer.allocate(1024);
Future<Integer> readResult = channel.read(buffer, 0);

// å¤„ç†ç»“æœ
while (!readResult.isDone()) {
    // å¯ä»¥åšå…¶ä»–å·¥ä½œ
}
```

#### bã€å¼‚æ­¥ç½‘ç»œè¯·æ±‚

ä½¿ç”¨`aiohttp`åº“è¿›è¡Œå¼‚æ­¥HTTPè¯·æ±‚ã€‚

```python
import asyncio
import aiohttp
import time

async def fetch_url(session, url):
    try:
        async with session.get(url) as response:
            print(f"è·å– {url} - çŠ¶æ€: {response.status}")
            content = await response.text()
            return {
                'url': url,
                'status': response.status,
                'length': len(content),
                'content': content[:100]  # åªè¿”å›å‰100ä¸ªå­—ç¬¦
            }
    except Exception as e:
        print(f"è¯·æ±‚ {url} å¤±è´¥: {e}")
        return {'url': url, 'error': str(e)}

async def fetch_multiple_urls(urls):
    # åˆ›å»ºä¼šè¯ï¼ˆå¤ç”¨è¿æ¥ï¼‰
    async with aiohttp.ClientSession() as session:
        # å¹¶å‘è¯·æ±‚å¤šä¸ªURL
        tasks = [fetch_url(session, url) for url in urls]
        results = await asyncio.gather(*tasks, return_exceptions=True)

        # å¤„ç†ç»“æœ
        success_count = 0
        for result in results:
            if isinstance(result, dict) and 'error' not in result:
                success_count += 1
                print(f"âœ… {result['url']}: {result['status']} ({result['length']} å­—ç¬¦)")
            else:
                print(f"âŒ å¤±è´¥: {result}")

        print(f"æˆåŠŸè¯·æ±‚: {success_count}/{len(urls)}")
        return results

async def main():
    urls = [
        'https://httpbin.org/delay/1',
        'https://httpbin.org/delay/2',
        'https://httpbin.org/status/200',
        'https://httpbin.org/status/404'
    ]

    start_time = time.time()
    await fetch_multiple_urls(urls)
    end_time = time.time()

    print(f"æ€»è€—æ—¶: {end_time - start_time:.2f}ç§’")

# å®‰è£…aiohttp: pip install aiohttp
# asyncio.run(main())
```

**å¼‚æ­¥HTTPå®¢æˆ·ç«¯çš„æœ€ä½³å®è·µ**ï¼š
```python
import asyncio
import aiohttp
from aiohttp import ClientTimeout, ClientSession

class AsyncHttpClient:
    def __init__(self, timeout=30, max_connections=100):
        self.timeout = ClientTimeout(total=timeout)
        self.connector = aiohttp.TCPConnector(limit=max_connections)

    async def __aenter__(self):
        self.session = ClientSession(
            timeout=self.timeout,
            connector=self.connector
        )
        return self

    async def __aexit__(self, exc_type, exc_val, exc_tb):
        await self.session.close()

    async def get(self, url, **kwargs):
        async with self.session.get(url, **kwargs) as response:
            return await response.json()

    async def post(self, url, data=None, json=None, **kwargs):
        async with self.session.post(url, data=data, json=json, **kwargs) as response:
            return await response.json()

async def api_client_example():
    async with AsyncHttpClient() as client:
        # GETè¯·æ±‚
        data = await client.get('https://api.github.com/users/python')
        print(f"Python GitHub followers: {data['followers']}")

        # POSTè¯·æ±‚
        result = await client.post('https://httpbin.org/post', json={'key': 'value'})
        print(f"POSTå“åº”: {result['json']}")

# asyncio.run(api_client_example())
```

### 9.3ã€å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ

#### aã€ä½•æ—¶ä½¿ç”¨å¼‚æ­¥

**é€‚åˆå¼‚æ­¥çš„åœºæ™¯**ï¼š
- I/Oå¯†é›†å‹æ“ä½œï¼ˆç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶è¯»å†™ï¼‰
- éœ€è¦å¹¶å‘å¤„ç†å¤§é‡è¿æ¥
- å®æ—¶æ€§è¦æ±‚é«˜çš„åº”ç”¨
- WebSocketã€èŠå¤©æœåŠ¡å™¨ã€APIç½‘å…³

```python
# âœ… é€‚åˆå¼‚æ­¥ï¼šç½‘ç»œçˆ¬è™«
import asyncio
import aiohttp

async def crawl_urls(urls):
    async with aiohttp.ClientSession() as session:
        tasks = [fetch_url(session, url) for url in urls]
        results = await asyncio.gather(*tasks)
    return results

# âœ… é€‚åˆå¼‚æ­¥ï¼šWebSocketèŠå¤©æœåŠ¡å™¨
async def handle_chat_messages(websocket):
    async for message in websocket:
        await broadcast_to_other_clients(message)

# âŒ ä¸é€‚åˆå¼‚æ­¥ï¼šCPUå¯†é›†å‹è®¡ç®—
async def heavy_computation():
    # è¿™ä¼šé˜»å¡äº‹ä»¶å¾ªç¯
    result = sum(i * i for i in range(10000000))
    return result
```

**ä¸é€‚åˆå¼‚æ­¥çš„åœºæ™¯**ï¼š
- CPUå¯†é›†å‹è®¡ç®—ï¼ˆæ•°å€¼è®¡ç®—ã€å›¾åƒå¤„ç†ï¼‰
- ç®€å•çš„è„šæœ¬ç¨‹åº
- åŒæ­¥ç¬¬ä¸‰æ–¹åº“çš„åŒ…è£…

#### bã€å¼‚æ­¥ä¸å¤šçº¿ç¨‹çš„é€‰æ‹©

**å¼‚æ­¥ vs å¤šçº¿ç¨‹å¯¹æ¯”**ï¼š

| ç»´åº¦ | å¼‚æ­¥ | å¤šçº¿ç¨‹ |
|-----|------|--------|
| å¹¶å‘æ¨¡å‹ | å•çº¿ç¨‹äº‹ä»¶å¾ªç¯ | å¤šçº¿ç¨‹æŠ¢å å¼ |
| å†…å­˜å ç”¨ | ä½ï¼ˆå•çº¿ç¨‹ï¼‰ | é«˜ï¼ˆæ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´ï¼‰ |
| ä¸Šä¸‹æ–‡åˆ‡æ¢ | å¿«ï¼ˆç”¨æˆ·æ€ï¼‰ | æ…¢ï¼ˆå†…æ ¸æ€ï¼‰ |
| ç¼–ç¨‹å¤æ‚åº¦ | é«˜ï¼ˆéœ€è¦å¼‚æ­¥æ€ç»´ï¼‰ | ä¸­ç­‰ |
| è°ƒè¯•éš¾åº¦ | è¾ƒé«˜ | ä¸­ç­‰ |
| é€‚ç”¨åœºæ™¯ | I/Oå¯†é›†å‹ | CPUå¯†é›†å‹æˆ–é˜»å¡æ“ä½œ |

**æ··åˆä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
import asyncio
import concurrent.futures
import time

def cpu_intensive_task(n):
    """CPUå¯†é›†å‹ä»»åŠ¡ - åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ"""
    return sum(i * i for i in range(n))

async def async_io_task():
    """I/Oå¯†é›†å‹ä»»åŠ¡ - å¼‚æ­¥æ‰§è¡Œ"""
    await asyncio.sleep(1)
    return "I/Oä»»åŠ¡å®Œæˆ"

async def mixed_workload():
    start_time = time.time()

    # åˆ›å»ºçº¿ç¨‹æ± æ‰§è¡Œå™¨
    loop = asyncio.get_event_loop()
    with concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:
        # å¹¶å‘æ‰§è¡Œä¸åŒç±»å‹çš„ä»»åŠ¡
        tasks = [
            # CPUå¯†é›†å‹ä»»åŠ¡åœ¨çº¿ç¨‹æ± ä¸­
            loop.run_in_executor(executor, cpu_intensive_task, 1000000),
            loop.run_in_executor(executor, cpu_intensive_task, 2000000),

            # I/Oå¯†é›†å‹ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ
            async_io_task(),
            async_io_task(),
        ]

        results = await asyncio.gather(*tasks)

    end_time = time.time()
    print(f"æ··åˆä»»åŠ¡å®Œæˆï¼Œè€—æ—¶: {end_time - start_time:.2f}ç§’")
    print(f"ç»“æœ: {results}")

asyncio.run(mixed_workload())
```

#### cã€å¸¸è§é™·é˜±

**é™·é˜±1ï¼šåœ¨åç¨‹ä¸­è°ƒç”¨é˜»å¡å‡½æ•°**
```python
import asyncio
import time

# âŒ é”™è¯¯ï¼šé˜»å¡äº‹ä»¶å¾ªç¯
async def bad_example():
    time.sleep(2)  # é˜»å¡2ç§’ï¼Œæ•´ä¸ªäº‹ä»¶å¾ªç¯è¢«é˜»å¡
    return "å®Œæˆ"

# âœ… æ­£ç¡®ï¼šä½¿ç”¨å¼‚æ­¥ç‰ˆæœ¬
async def good_example():
    await asyncio.sleep(2)  # éé˜»å¡ç­‰å¾…
    return "å®Œæˆ"

# âœ… æˆ–è€…åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œé˜»å¡æ“ä½œ
async def blocking_in_thread():
    loop = asyncio.get_event_loop()
    with concurrent.futures.ThreadPoolExecutor() as executor:
        result = await loop.run_in_executor(executor, time.sleep, 2)
    return "å®Œæˆ"
```

**é™·é˜±2ï¼šå¿˜è®°await**
```python
import asyncio

async def forget_await():
    # âŒ é”™è¯¯ï¼šå¿˜è®°awaitï¼Œåç¨‹ä¸ä¼šæ‰§è¡Œ
    asyncio.sleep(1)
    print("è¿™å¯èƒ½ä¸ä¼šæŒ‰é¢„æœŸæ‰§è¡Œ")

async def correct_usage():
    # âœ… æ­£ç¡®ï¼šä½¿ç”¨await
    await asyncio.sleep(1)
    print("1ç§’åæ‰§è¡Œ")
```

**é™·é˜±3ï¼šå¼‚å¸¸å¤„ç†ä¸å½“**
```python
import asyncio

async def task_with_error():
    await asyncio.sleep(0.1)
    raise ValueError("ä»»åŠ¡å¤±è´¥")

async def bad_error_handling():
    # âŒ é”™è¯¯ï¼šå¼‚å¸¸è¢«å¿½ç•¥
    asyncio.create_task(task_with_error())

async def good_error_handling():
    # âœ… æ­£ç¡®ï¼šå¤„ç†å¼‚å¸¸
    task = asyncio.create_task(task_with_error())
    try:
        await task
    except ValueError as e:
        print(f"æ•è·åˆ°å¼‚å¸¸: {e}")

# âœ… ä½¿ç”¨gatherå¤„ç†å¼‚å¸¸
async def gather_with_exceptions():
    tasks = [
        asyncio.create_task(task_with_error()),
        asyncio.create_task(asyncio.sleep(1))
    ]

    results = await asyncio.gather(*tasks, return_exceptions=True)
    for i, result in enumerate(results):
        if isinstance(result, Exception):
            print(f"ä»»åŠ¡ {i} å¤±è´¥: {result}")
        else:
            print(f"ä»»åŠ¡ {i} æˆåŠŸ: {result}")
```

**é™·é˜±4ï¼šè¿‡åº¦ä½¿ç”¨å¼‚æ­¥**
```python
# âŒ è¿‡åº¦è®¾è®¡ï¼šç®€å•çš„åŒæ­¥ä»»åŠ¡ä¸éœ€è¦å¼‚æ­¥
async def over_engineered():
    result = await async_add(2, 3)
    return result

# âœ… ç®€å•ç›´æ¥
def simple():
    return 2 + 3
```

**æœ€ä½³å®è·µæ€»ç»“**ï¼š

1. **ä¿æŒå¼‚æ­¥å‡½æ•°çº¯å‡€**ï¼šå¼‚æ­¥å‡½æ•°ä¸­åªè°ƒç”¨å¼‚æ­¥å‡½æ•°
2. **æ­£ç¡®å¤„ç†å¼‚å¸¸**ï¼šä½¿ç”¨try/exceptåŒ…è£…å¯èƒ½å¤±è´¥çš„æ“ä½œ
3. **é¿å…é˜»å¡æ“ä½œ**ï¼šå°†é˜»å¡æ“ä½œæ”¾åˆ°çº¿ç¨‹æ± ä¸­
4. **åˆç†å¹¶å‘æ•°**ï¼šæ§åˆ¶åŒæ—¶è¿›è¡Œçš„ä»»åŠ¡æ•°é‡
5. **ä½¿ç”¨è¿æ¥æ± **ï¼šå¤ç”¨æ•°æ®åº“å’ŒHTTPè¿æ¥
6. **æ€§èƒ½ç›‘æ§**ï¼šä½¿ç”¨å·¥å…·ç›‘æ§å¼‚æ­¥ç¨‹åºæ€§èƒ½

```python
import asyncio
import aiohttp
from asyncio import Semaphore

async def rate_limited_fetch(session, url, semaphore):
    """å¸¦é€Ÿç‡é™åˆ¶çš„è¯·æ±‚"""
    async with semaphore:  # é™åˆ¶å¹¶å‘æ•°
        async with session.get(url) as response:
            return await response.text()

async def robust_fetch_all(urls, max_concurrent=10):
    """å¥å£®çš„æ‰¹é‡è¯·æ±‚"""
    semaphore = Semaphore(max_concurrent)

    async with aiohttp.ClientSession() as session:
        tasks = [
            rate_limited_fetch(session, url, semaphore)
            for url in urls
        ]

        results = await asyncio.gather(*tasks, return_exceptions=True)

        success_count = sum(1 for r in results if not isinstance(r, Exception))
        print(f"æˆåŠŸ: {success_count}/{len(urls)}")

        return results
```

## 10ã€Pythonç”Ÿæ€ä¸çƒ­é—¨åº“

Pythonæ‹¥æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“ç”Ÿæ€,è¿™æ˜¯å…¶å—æ¬¢è¿çš„é‡è¦åŸå› ã€‚ä½œä¸ºJavaå¼€å‘è€…,ä½ ä¼šå‘ç°Pythonçš„åº“ç”Ÿæ€æ›´åŠ å¼€æ”¾å’Œå¤šæ ·åŒ–ã€‚

### 10.1ã€æ•°æ®ç§‘å­¦

#### aã€- æ•°å€¼è®¡ç®—åŸºç¡€

NumPyæ˜¯Pythonç§‘å­¦è®¡ç®—çš„åŸºç¡€åº“,æä¾›é«˜æ€§èƒ½çš„å¤šç»´æ•°ç»„å¯¹è±¡å’Œç›¸å…³å·¥å…·ã€‚ç±»ä¼¼Javaçš„æ•°å­¦åº“,ä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚

```python
import numpy as np

# åˆ›å»ºæ•°ç»„ - ç±»ä¼¼Javaçš„int[]æ•°ç»„,ä½†åŠŸèƒ½æ›´å¼º
arr = np.array([1, 2, 3, 4, 5])  # ä¸€ç»´æ•°ç»„
matrix = np.array([[1, 2], [3, 4]])  # äºŒç»´æ•°ç»„(çŸ©é˜µ)

# æ•°ç»„è¿ç®— - å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œè¿ç®—,æ— éœ€å¾ªç¯
result = arr * 2  # æ¯ä¸ªå…ƒç´ éƒ½ä¹˜ä»¥2: [2, 4, 6, 8, 10]
# Javaéœ€è¦å¾ªç¯: for(int i=0; i<arr.length; i++) arr[i] *= 2;

# çŸ©é˜µä¹˜æ³• - dotè¡¨ç¤ºç‚¹ç§¯/çŸ©é˜µä¹˜æ³•
dot_product = np.dot(matrix, matrix)
# ç»“æœ: [[7, 10], [15, 22]]
# è®¡ç®—è¿‡ç¨‹: [1*1+2*3, 1*2+2*4; 3*1+4*3, 3*2+4*4]

# å¸¸ç”¨ç»Ÿè®¡å‡½æ•°
print(np.mean(arr))  # å¹³å‡å€¼: (1+2+3+4+5)/5 = 3.0
print(np.sum(arr))   # æ±‚å’Œ: 1+2+3+4+5 = 15
print(np.max(arr))   # æœ€å¤§å€¼: 5
print(np.min(arr))   # æœ€å°å€¼: 1
print(np.std(arr))   # æ ‡å‡†å·®: è¡¡é‡æ•°æ®åˆ†æ•£ç¨‹åº¦

# æ•°ç»„å½¢çŠ¶æ“ä½œ
print(matrix.shape)   # è¾“å‡º: (2, 2) è¡¨ç¤º2è¡Œ2åˆ—
reshaped = arr.reshape(5, 1)  # é‡å¡‘ä¸º5è¡Œ1åˆ—
```

#### bã€- æ•°æ®åˆ†æ

Pandasæ˜¯æ•°æ®åˆ†æçš„æ ¸å¿ƒåº“,æä¾›DataFrameç­‰æ•°æ®ç»“æ„,ç±»ä¼¼äºExcelæˆ–æ•°æ®åº“è¡¨çš„æ“ä½œã€‚

```python
import pandas as pd

# åˆ›å»ºDataFrame - ç±»ä¼¼æ•°æ®åº“è¡¨æˆ–Excelè¡¨æ ¼
df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie'],     # å§“ååˆ—
    'age': [25, 30, 35],                     # å¹´é¾„åˆ—
    'city': ['Beijing', 'Shanghai', 'Guangzhou']  # åŸå¸‚åˆ—
})

# æ•°æ®æŸ¥çœ‹æ“ä½œ
print(df.head())      # æŸ¥çœ‹å‰5è¡Œæ•°æ®(é»˜è®¤5è¡Œ)
print(df.tail(2))     # æŸ¥çœ‹å2è¡Œæ•°æ®
print(df.info())      # æŸ¥çœ‹æ•°æ®ç»“æ„ä¿¡æ¯(åˆ—åã€æ•°æ®ç±»å‹ã€éç©ºå€¼æ•°é‡)
print(df.describe())  # ç»Ÿè®¡æè¿°(countã€meanã€stdã€minã€maxç­‰)

# æ•°æ®ç­›é€‰ - ç±»ä¼¼SQLçš„WHEREå­å¥
filtered = df[df['age'] > 25]  # ç­›é€‰å¹´é¾„å¤§äº25çš„è®°å½•
adults = df[df['age'] >= 30]   # ç­›é€‰å¹´é¾„å¤§äºç­‰äº30çš„è®°å½•

# åˆ—æ“ä½œ
print(df['name'])           # è·å–å•åˆ—
print(df[['name', 'age']])  # è·å–å¤šåˆ—
df['salary'] = [8000, 10000, 12000]  # æ·»åŠ æ–°åˆ—

# æ–‡ä»¶è¯»å†™ - æ”¯æŒå¤šç§æ ¼å¼
df.to_csv('data.csv', index=False)  # ä¿å­˜ä¸ºCSVæ–‡ä»¶,ä¸ä¿å­˜è¡Œç´¢å¼•
df = pd.read_csv('data.csv')         # ä»CSVæ–‡ä»¶è¯»å–æ•°æ®
# ä¹Ÿæ”¯æŒ: read_excel(), read_json(), read_sql() ç­‰
```

#### cã€- æ•°æ®å¯è§†åŒ–

Matplotlibæ˜¯Pythonçš„2Dç»˜å›¾åº“,ç”¨äºåˆ›å»ºå„ç§é™æ€ã€åŠ¨æ€å’Œäº¤äº’å¼å›¾è¡¨ã€‚

```python
import matplotlib.pyplot as plt

# å‡†å¤‡æ•°æ®
x = [1, 2, 3, 4, 5]      # Xè½´æ•°æ®ç‚¹
y = [2, 4, 6, 8, 10]     # Yè½´æ•°æ®ç‚¹

# åˆ›å»ºæŠ˜çº¿å›¾
plt.figure(figsize=(8, 6))  # è®¾ç½®å›¾å½¢å¤§å°(å®½8è‹±å¯¸,é«˜6è‹±å¯¸)
plt.plot(x, y, marker='o', linestyle='-', color='blue')  # ç»˜åˆ¶å¸¦åœ†ç‚¹æ ‡è®°çš„è“è‰²çº¿
plt.xlabel('Xè½´æ ‡ç­¾')        # è®¾ç½®Xè½´æ ‡ç­¾
plt.ylabel('Yè½´æ ‡ç­¾')        # è®¾ç½®Yè½´æ ‡ç­¾
plt.title('ç®€å•æŠ˜çº¿å›¾')      # è®¾ç½®å›¾è¡¨æ ‡é¢˜
plt.grid(True)              # æ˜¾ç¤ºç½‘æ ¼çº¿
plt.show()                  # æ˜¾ç¤ºå›¾è¡¨

# åˆ›å»ºæŸ±çŠ¶å›¾
categories = ['A', 'B', 'C']  # ç±»åˆ«åç§°
values = [10, 20, 15]         # å¯¹åº”çš„å€¼
plt.figure(figsize=(6, 4))
plt.bar(categories, values, color=['red', 'green', 'blue'])  # ä¸åŒé¢œè‰²çš„æŸ±å­
plt.ylabel('æ•°å€¼')
plt.title('æŸ±çŠ¶å›¾ç¤ºä¾‹')
plt.show()

# åˆ›å»ºå­å›¾ - åœ¨ä¸€ä¸ªçª—å£æ˜¾ç¤ºå¤šä¸ªå›¾è¡¨
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 4))  # 1è¡Œ2åˆ—çš„å­å›¾
ax1.plot(x, y)          # ç¬¬ä¸€ä¸ªå­å›¾
ax1.set_title('æŠ˜çº¿å›¾')
ax2.bar(categories, values)  # ç¬¬äºŒä¸ªå­å›¾
ax2.set_title('æŸ±çŠ¶å›¾')
plt.tight_layout()      # è‡ªåŠ¨è°ƒæ•´å­å›¾é—´è·
plt.show()
```

#### dã€- ç§‘å­¦è®¡ç®—

SciPyæ„å»ºåœ¨NumPyä¹‹ä¸Š,æä¾›æ›´å¤šç§‘å­¦è®¡ç®—åŠŸèƒ½,åŒ…æ‹¬ç»Ÿè®¡ã€ä¼˜åŒ–ã€ä¿¡å·å¤„ç†ç­‰ã€‚

```python
from scipy import stats, optimize
import numpy as np

# ç»Ÿè®¡åˆ†æ
data = [1, 2, 3, 4, 5, 3, 4, 2, 3, 4]

# æ­£æ€åˆ†å¸ƒæ‹Ÿåˆ - ä¼°è®¡æ•°æ®çš„æ­£æ€åˆ†å¸ƒå‚æ•°
mean, std = stats.norm.fit(data)  # æ‹Ÿåˆæ­£æ€åˆ†å¸ƒ,å¾—åˆ°å‡å€¼å’Œæ ‡å‡†å·®
print(f"ä¼°è®¡å‡å€¼: {mean:.2f}, ä¼°è®¡æ ‡å‡†å·®: {std:.2f}")

# å‡è®¾æ£€éªŒ - æ£€éªŒæ•°æ®æ˜¯å¦ç¬¦åˆæ­£æ€åˆ†å¸ƒ
statistic, p_value = stats.normaltest(data)  # æ­£æ€æ€§æ£€éªŒ
print(f"æ­£æ€æ£€éªŒpå€¼: {p_value:.4f}")  # på€¼>0.05é€šå¸¸è®¤ä¸ºç¬¦åˆæ­£æ€åˆ†å¸ƒ

# æ•°å€¼ä¼˜åŒ– - å¯»æ‰¾å‡½æ•°çš„æœ€å°å€¼
def objective_function(x):
    """ç›®æ ‡å‡½æ•°: y = xÂ² + 2x + 1"""
    return x**2 + 2*x + 1

# å¯»æ‰¾å‡½æ•°æœ€å°å€¼ç‚¹
result = optimize.minimize(objective_function, x0=0)  # x0=0æ˜¯åˆå§‹çŒœæµ‹å€¼
print(f"æœ€å°å€¼ç‚¹: x = {result.x[0]:.4f}")  # ç†è®ºå€¼åº”è¯¥æ˜¯x=-1
print(f"æœ€å°å€¼: y = {result.fun:.4f}")     # å¯¹åº”çš„å‡½æ•°å€¼

# æ±‚è§£æ–¹ç¨‹ - æ‰¾åˆ°å‡½æ•°çš„é›¶ç‚¹
def equation(x):
    """æ–¹ç¨‹: xÂ² - 4 = 0"""
    return x**2 - 4

# å¯»æ‰¾æ–¹ç¨‹çš„æ ¹
root = optimize.fsolve(equation, 1)[0]  # ä»x=1å¼€å§‹æœç´¢
print(f"æ–¹ç¨‹xÂ²-4=0çš„è§£: x = {root:.4f}")  # åº”è¯¥å¾—åˆ°x=2
```

### 10.2ã€Webå¼€å‘æ¡†æ¶

#### aã€- è½»é‡çº§æ¡†æ¶

Flaskæ˜¯ä¸€ä¸ªè½»é‡çº§çš„Webæ¡†æ¶,ç®€å•çµæ´»,é€‚åˆå°åˆ°ä¸­å‹é¡¹ç›®ã€‚ç±»ä¼¼Spring Bootä½†æ›´ç®€æ´ã€‚

```python
from flask import Flask, request, jsonify

# åˆ›å»ºFlaskåº”ç”¨å®ä¾‹ - ç±»ä¼¼Spring Bootçš„@SpringBootApplication
app = Flask(__name__)

# å®šä¹‰è·¯ç”± - ç±»ä¼¼Springçš„@RequestMapping
@app.route('/')  # å¤„ç†æ ¹è·¯å¾„ "/"
def hello():
    """å¤„ç†GETè¯·æ±‚åˆ°æ ¹è·¯å¾„"""
    return 'Hello World!'  # ç›´æ¥è¿”å›å­—ç¬¦ä¸²

# æ”¯æŒå¤šç§HTTPæ–¹æ³•çš„è·¯ç”±
@app.route('/api/users', methods=['GET', 'POST'])  # æŒ‡å®šæ”¯æŒçš„HTTPæ–¹æ³•
def users():
    """ç”¨æˆ·APIç«¯ç‚¹ - æ ¹æ®è¯·æ±‚æ–¹æ³•æ‰§è¡Œä¸åŒé€»è¾‘"""
    if request.method == 'GET':
        # å¤„ç†GETè¯·æ±‚ - è·å–ç”¨æˆ·åˆ—è¡¨
        return jsonify({'users': []})  # jsonify()å°†å­—å…¸è½¬ä¸ºJSONå“åº”
    elif request.method == 'POST':
        # å¤„ç†POSTè¯·æ±‚ - åˆ›å»ºæ–°ç”¨æˆ·
        user_data = request.get_json()  # è·å–è¯·æ±‚ä½“ä¸­çš„JSONæ•°æ®
        # è¿™é‡Œå¯ä»¥æ·»åŠ ç”¨æˆ·åˆ›å»ºé€»è¾‘
        return jsonify({'status': 'created', 'user': user_data})

# å¸¦å‚æ•°çš„è·¯ç”± - ç±»ä¼¼Springçš„@PathVariable
@app.route('/users/<int:user_id>')  # <int:user_id>è¡¨ç¤ºæ•´æ•°ç±»å‹çš„è·¯å¾„å‚æ•°
def get_user(user_id):
    """æ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·ä¿¡æ¯"""
    return jsonify({'id': user_id, 'name': f'User {user_id}'})

# æŸ¥è¯¢å‚æ•°ç¤ºä¾‹
@app.route('/search')
def search():
    """å¤„ç†æŸ¥è¯¢å‚æ•° - ç±»ä¼¼Springçš„@RequestParam"""
    query = request.args.get('q', '')  # è·å–æŸ¥è¯¢å‚æ•°q,é»˜è®¤ç©ºå­—ç¬¦ä¸²
    page = request.args.get('page', 1, type=int)  # è·å–pageå‚æ•°,é»˜è®¤1,è½¬ä¸ºint
    return jsonify({'query': query, 'page': page})

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)  # debug=Trueå¯ç”¨è°ƒè¯•æ¨¡å¼
    # è®¿é—® http://localhost:5000 æŸ¥çœ‹æ•ˆæœ
```

#### bã€- å…¨æ ˆæ¡†æ¶

Djangoæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Webæ¡†æ¶,å†…ç½®ORMã€ç®¡ç†åå°ã€ç”¨æˆ·è®¤è¯ç­‰,é€‚åˆå¤§å‹é¡¹ç›®ã€‚æ›´ç±»ä¼¼Springå…¨å®¶æ¡¶ã€‚

```python
# Djangoé¡¹ç›®ç»“æ„ç±»ä¼¼Spring Boot:
# myproject/
#   â”œâ”€â”€ manage.py          # é¡¹ç›®ç®¡ç†è„šæœ¬(ç±»ä¼¼mvn spring-boot:run)
#   â”œâ”€â”€ myproject/
#   â”‚   â”œâ”€â”€ settings.py    # é¡¹ç›®é…ç½®(ç±»ä¼¼application.properties)
#   â”‚   â”œâ”€â”€ urls.py        # å…¨å±€URLé…ç½®
#   â”‚   â””â”€â”€ wsgi.py        # WSGIé…ç½®
#   â””â”€â”€ myapp/
#       â”œâ”€â”€ models.py      # æ•°æ®æ¨¡å‹(ç±»ä¼¼JPA Entity)
#       â”œâ”€â”€ views.py       # è§†å›¾å‡½æ•°(ç±»ä¼¼Controller)
#       â”œâ”€â”€ urls.py        # åº”ç”¨URLé…ç½®
#       â””â”€â”€ admin.py       # ç®¡ç†åå°é…ç½®

# models.py - å®šä¹‰æ•°æ®æ¨¡å‹
from django.db import models

class User(models.Model):
    """ç”¨æˆ·æ¨¡å‹ - ç±»ä¼¼JPAçš„@Entity"""
    # Djangoè‡ªåŠ¨åˆ›å»ºidä¸»é”®,æ— éœ€æ‰‹åŠ¨å®šä¹‰
    name = models.CharField(max_length=100)  # VARCHAR(100)å­—æ®µ
    email = models.EmailField()              # EMAILå­—æ®µ,è‡ªåŠ¨éªŒè¯æ ¼å¼
    created_at = models.DateTimeField(auto_now_add=True)  # åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½®
    updated_at = models.DateTimeField(auto_now=True)      # æ›´æ–°æ—¶è‡ªåŠ¨è®¾ç½®
    is_active = models.BooleanField(default=True)         # å¸ƒå°”å­—æ®µ,é»˜è®¤å€¼

    class Meta:
        db_table = 'users'        # æŒ‡å®šè¡¨å
        ordering = ['-created_at'] # é»˜è®¤æŒ‰åˆ›å»ºæ—¶é—´å€’åº

    def __str__(self):
        """å­—ç¬¦ä¸²è¡¨ç¤º - ç±»ä¼¼Javaçš„toString()"""
        return self.name

# views.py - è§†å›¾å‡½æ•°
from django.http import JsonResponse
from django.shortcuts import get_object_or_404  # 404å¤„ç†
from django.views.decorators.csrf import csrf_exempt  # CSRFä¿æŠ¤
import json

def user_list(request):
    """ç”¨æˆ·åˆ—è¡¨API - ç±»ä¼¼Springçš„@GetMapping"""
    if request.method == 'GET':
        users = User.objects.all()  # æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·,ç±»ä¼¼JPAçš„findAll()
        data = {
            'users': list(users.values('id', 'name', 'email'))  # è½¬ä¸ºå­—å…¸åˆ—è¡¨
        }
        return JsonResponse(data)

@csrf_exempt  # ç¦ç”¨CSRFæ£€æŸ¥(ä»…ç”¨äºAPI)
def user_create(request):
    """åˆ›å»ºç”¨æˆ·API - ç±»ä¼¼Springçš„@PostMapping"""
    if request.method == 'POST':
        data = json.loads(request.body)  # è§£æJSONè¯·æ±‚ä½“
        user = User.objects.create(      # åˆ›å»ºå¹¶ä¿å­˜ç”¨æˆ·
            name=data['name'],
            email=data['email']
        )
        return JsonResponse({'id': user.id, 'status': 'created'})

def user_detail(request, user_id):
    """ç”¨æˆ·è¯¦æƒ…API - ç±»ä¼¼Springçš„@PathVariable"""
    user = get_object_or_404(User, id=user_id)  # æŸ¥è¯¢ç”¨æˆ·,ä¸å­˜åœ¨åˆ™è¿”å›404
    return JsonResponse({
        'id': user.id,
        'name': user.name,
        'email': user.email,
        'created_at': user.created_at.isoformat()
    })

# urls.py - URLé…ç½®
from django.urls import path
from . import views

urlpatterns = [
    path('users/', views.user_list, name='user_list'),           # GET /users/
    path('users/create/', views.user_create, name='user_create'), # POST /users/create/
    path('users/<int:user_id>/', views.user_detail, name='user_detail'), # GET /users/1/
]
```

#### cã€- ç°ä»£å¼‚æ­¥æ¡†æ¶

FastAPIæ˜¯ç°ä»£çš„å¼‚æ­¥Webæ¡†æ¶,è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£,æ€§èƒ½ä¼˜å¼‚,ç±»ä¼¼Spring WebFluxã€‚

```python
from fastapi import FastAPI, HTTPException, Query, Path
from pydantic import BaseModel, EmailStr  # æ•°æ®éªŒè¯åº“
from typing import Optional, List
import asyncio

# åˆ›å»ºFastAPIåº”ç”¨
app = FastAPI(
    title="ç”¨æˆ·ç®¡ç†API",           # APIæ–‡æ¡£æ ‡é¢˜
    description="ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ",     # APIæè¿°
    version="1.0.0"              # ç‰ˆæœ¬å·
)

# å®šä¹‰æ•°æ®æ¨¡å‹ - ç±»ä¼¼Springçš„DTO,è‡ªåŠ¨éªŒè¯
class User(BaseModel):
    """ç”¨æˆ·æ•°æ®æ¨¡å‹"""
    name: str                    # å¿…å¡«å­—ç¬¦ä¸²å­—æ®µ
    age: int                     # å¿…å¡«æ•´æ•°å­—æ®µ
    email: EmailStr              # é‚®ç®±æ ¼å¼éªŒè¯
    is_active: bool = True       # å¯é€‰å­—æ®µ,é»˜è®¤True

class UserResponse(BaseModel):
    """ç”¨æˆ·å“åº”æ¨¡å‹"""
    id: int
    name: str
    age: int
    email: str
    is_active: bool

# æ¨¡æ‹Ÿæ•°æ®åº“
fake_db = []
next_id = 1

# æ ¹è·¯å¾„ - å¼‚æ­¥å‡½æ•°
@app.get("/")
async def root():
    """æ ¹è·¯å¾„å¤„ç†å™¨"""
    return {"message": "æ¬¢è¿ä½¿ç”¨ç”¨æˆ·ç®¡ç†API"}

# åˆ›å»ºç”¨æˆ· - è‡ªåŠ¨JSONè§£æå’ŒéªŒè¯
@app.post("/users/", response_model=UserResponse, status_code=201)
async def create_user(user: User):
    """
    åˆ›å»ºæ–°ç”¨æˆ·

    - **name**: ç”¨æˆ·å§“å
    - **age**: ç”¨æˆ·å¹´é¾„
    - **email**: ç”¨æˆ·é‚®ç®±
    - **is_active**: æ˜¯å¦æ¿€æ´»(å¯é€‰)
    """
    global next_id
    user_dict = user.dict()  # è½¬ä¸ºå­—å…¸
    user_dict["id"] = next_id
    fake_db.append(user_dict)
    next_id += 1
    return user_dict

# è·å–ç”¨æˆ·åˆ—è¡¨ - æ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤
@app.get("/users/", response_model=List[UserResponse])
async def get_users(
    skip: int = Query(0, ge=0, description="è·³è¿‡è®°å½•æ•°"),        # æŸ¥è¯¢å‚æ•°,>=0
    limit: int = Query(10, ge=1, le=100, description="è¿”å›è®°å½•æ•°"),  # é™åˆ¶1-100
    active_only: Optional[bool] = Query(None, description="åªè¿”å›æ¿€æ´»ç”¨æˆ·")
):
    """è·å–ç”¨æˆ·åˆ—è¡¨,æ”¯æŒåˆ†é¡µ"""
    users = fake_db[skip:skip + limit]  # æ¨¡æ‹Ÿåˆ†é¡µ
    if active_only is not None:
        users = [u for u in users if u["is_active"] == active_only]
    return users

# è·å–å•ä¸ªç”¨æˆ· - è·¯å¾„å‚æ•°éªŒè¯
@app.get("/users/{user_id}", response_model=UserResponse)
async def get_user(
    user_id: int = Path(..., gt=0, description="ç”¨æˆ·ID,å¿…é¡»å¤§äº0")  # è·¯å¾„å‚æ•°éªŒè¯
):
    """æ ¹æ®IDè·å–ç”¨æˆ·"""
    user = next((u for u in fake_db if u["id"] == user_id), None)
    if not user:
        raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")  # æŠ›å‡ºHTTPå¼‚å¸¸
    return user

# æ›´æ–°ç”¨æˆ· - éƒ¨åˆ†æ›´æ–°
@app.patch("/users/{user_id}", response_model=UserResponse)
async def update_user(
    user_id: int,
    user_update: dict  # æ¥å—ä»»æ„å­—æ®µçš„å­—å…¸
):
    """æ›´æ–°ç”¨æˆ·ä¿¡æ¯"""
    user = next((u for u in fake_db if u["id"] == user_id), None)
    if not user:
        raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")

    # æ›´æ–°å­—æ®µ
    for key, value in user_update.items():
        if key in user:
            user[key] = value

    return user

# åˆ é™¤ç”¨æˆ·
@app.delete("/users/{user_id}")
async def delete_user(user_id: int):
    """åˆ é™¤ç”¨æˆ·"""
    global fake_db
    fake_db = [u for u in fake_db if u["id"] != user_id]
    return {"message": "ç”¨æˆ·å·²åˆ é™¤"}

# å¼‚æ­¥æ“ä½œç¤ºä¾‹
@app.get("/users/{user_id}/async-info")
async def get_user_async_info(user_id: int):
    """æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è·å–"""
    # æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢
    await asyncio.sleep(0.1)  # æ¨¡æ‹ŸI/Oå»¶è¿Ÿ

    # æ¨¡æ‹Ÿå¹¶å‘è°ƒç”¨å¤šä¸ªæœåŠ¡
    tasks = [
        asyncio.create_task(get_user_profile(user_id)),
        asyncio.create_task(get_user_stats(user_id)),
        asyncio.create_task(get_user_preferences(user_id))
    ]

    profile, stats, preferences = await asyncio.gather(*tasks)

    return {
        "profile": profile,
        "stats": stats,
        "preferences": preferences
    }

async def get_user_profile(user_id: int):
    """æ¨¡æ‹Ÿè·å–ç”¨æˆ·èµ„æ–™"""
    await asyncio.sleep(0.05)
    return {"user_id": user_id, "bio": "ç”¨æˆ·ç®€ä»‹"}

async def get_user_stats(user_id: int):
    """æ¨¡æ‹Ÿè·å–ç”¨æˆ·ç»Ÿè®¡"""
    await asyncio.sleep(0.03)
    return {"user_id": user_id, "login_count": 42}

async def get_user_preferences(user_id: int):
    """æ¨¡æ‹Ÿè·å–ç”¨æˆ·åå¥½"""
    await asyncio.sleep(0.02)
    return {"user_id": user_id, "theme": "dark"}

# å¯åŠ¨åº”ç”¨å,è®¿é—®ä»¥ä¸‹URL:
# http://localhost:8000/docs - è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼APIæ–‡æ¡£(Swagger UI)
# http://localhost:8000/redoc - å¦ä¸€ç§é£æ ¼çš„APIæ–‡æ¡£
# è¿™äº›æ–‡æ¡£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„,åŒ…å«æ‰€æœ‰ç«¯ç‚¹ã€å‚æ•°ã€å“åº”æ¨¡å‹ç­‰ä¿¡æ¯

# è¿è¡Œå‘½ä»¤: uvicorn main:app --reload
```

### 10.3ã€ç½‘ç»œè¯·æ±‚

#### aã€- HTTPå®¢æˆ·ç«¯

requestsæ˜¯Pythonæœ€æµè¡Œçš„HTTPåº“,APIç®€æ´æ˜“ç”¨,æ¯”Javaçš„HttpClientæ›´å‹å¥½ã€‚

```python
import requests

# åŸºæœ¬GETè¯·æ±‚ - æ¯”Java HttpClientç®€å•å¾ˆå¤š
response = requests.get('https://api.github.com/users/octocat')
print(f"çŠ¶æ€ç : {response.status_code}")  # HTTPçŠ¶æ€ç ,å¦‚200ã€404ç­‰
print(f"å“åº”å¤´: {response.headers}")     # å“åº”å¤´å­—å…¸
data = response.json()  # è‡ªåŠ¨è§£æJSONå“åº”ä¸ºPythonå­—å…¸
print(f"ç”¨æˆ·å: {data['name']}")  # è®¿é—®JSONæ•°æ®

# å¸¦æŸ¥è¯¢å‚æ•°çš„GETè¯·æ±‚
params = {'q': 'python', 'sort': 'stars', 'order': 'desc'}
response = requests.get('https://api.github.com/search/repositories', params=params)
# å®é™…è¯·æ±‚URL: https://api.github.com/search/repositories?q=python&sort=stars&order=desc

# POSTè¯·æ±‚ - å‘é€JSONæ•°æ®
user_data = {'name': 'Alice', 'email': 'alice@example.com'}
response = requests.post(
    'https://httpbin.org/post',
    json=user_data,  # è‡ªåŠ¨è®¾ç½®Content-Typeä¸ºapplication/json
    timeout=30       # 30ç§’è¶…æ—¶
)
print(response.json())  # æŸ¥çœ‹å“åº”

# POSTè¯·æ±‚ - å‘é€è¡¨å•æ•°æ®
form_data = {'username': 'alice', 'password': 'secret'}
response = requests.post(
    'https://httpbin.org/post',
    data=form_data   # å‘é€è¡¨å•æ•°æ®(application/x-www-form-urlencoded)
)

# è®¾ç½®è¯·æ±‚å¤´ - æ¯”å¦‚APIè®¤è¯
headers = {
    'Authorization': 'Bearer your-token-here',
    'User-Agent': 'MyApp/1.0',
    'Accept': 'application/json'
}
response = requests.get('https://api.example.com/data', headers=headers)

# ä¼šè¯ç®¡ç† - ä¿æŒcookieså’Œè¿æ¥å¤ç”¨
session = requests.Session()
session.headers.update({'Authorization': 'Bearer token123'})  # ä¸ºæ‰€æœ‰è¯·æ±‚è®¾ç½®å¤´

# ç™»å½•(å‡è®¾è¿”å›cookie)
login_response = session.post('https://example.com/login', {
    'username': 'alice',
    'password': 'secret'
})

# åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦cookieå’Œè®¾ç½®çš„å¤´
profile_response = session.get('https://example.com/profile')
data_response = session.get('https://example.com/api/data')

# æ–‡ä»¶ä¸Šä¼ 
files = {'file': open('document.pdf', 'rb')}  # æ‰“å¼€æ–‡ä»¶
response = requests.post('https://httpbin.org/post', files=files)
files['file'].close()  # è®°å¾—å…³é—­æ–‡ä»¶

# æˆ–ä½¿ç”¨withè¯­å¥è‡ªåŠ¨å…³é—­æ–‡ä»¶
with open('document.pdf', 'rb') as f:
    files = {'file': f}
    response = requests.post('https://httpbin.org/post', files=files)

# æ–‡ä»¶ä¸‹è½½
response = requests.get('https://example.com/large-file.zip', stream=True)
with open('downloaded-file.zip', 'wb') as f:
    for chunk in response.iter_content(chunk_size=8192):  # åˆ†å—ä¸‹è½½
        f.write(chunk)

# é”™è¯¯å¤„ç†
try:
    response = requests.get('https://api.example.com/data', timeout=5)
    response.raise_for_status()  # å¦‚æœçŠ¶æ€ç >=400åˆ™æŠ›å‡ºå¼‚å¸¸
    data = response.json()
except requests.exceptions.Timeout:
    print("è¯·æ±‚è¶…æ—¶")
except requests.exceptions.ConnectionError:
    print("è¿æ¥é”™è¯¯")
except requests.exceptions.HTTPError as e:
    print(f"HTTPé”™è¯¯: {e}")
except requests.exceptions.RequestException as e:
    print(f"è¯·æ±‚å¼‚å¸¸: {e}")
```

#### bã€- ORMæ¡†æ¶

SQLAlchemyæ˜¯Pythonæœ€å¼ºå¤§çš„ORMæ¡†æ¶,åŠŸèƒ½ç±»ä¼¼Hibernate,ä½†æ›´çµæ´»ã€‚

```python
from sqlalchemy import create_engine, Column, Integer, String, DateTime, Boolean, ForeignKey
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker, relationship
from datetime import datetime

# åˆ›å»ºåŸºç±» - ç±»ä¼¼JPAçš„@EntityåŸºç±»
Base = declarative_base()

# å®šä¹‰æ•°æ®æ¨¡å‹ - ç±»ä¼¼JPA Entity
class User(Base):
    """ç”¨æˆ·è¡¨æ¨¡å‹"""
    __tablename__ = 'users'  # æŒ‡å®šè¡¨å

    # ä¸»é”® - ç±»ä¼¼JPAçš„@Id @GeneratedValue
    id = Column(Integer, primary_key=True, autoincrement=True)

    # å­—ç¬¦ä¸²å­—æ®µ - ç±»ä¼¼JPAçš„@Column
    name = Column(String(100), nullable=False)  # VARCHAR(100) NOT NULL
    email = Column(String(255), unique=True, nullable=False)  # å”¯ä¸€çº¦æŸ

    # å¸ƒå°”å­—æ®µ
    is_active = Column(Boolean, default=True)  # é»˜è®¤å€¼

    # æ—¶é—´å­—æ®µ
    created_at = Column(DateTime, default=datetime.utcnow)  # åˆ›å»ºæ—¶é—´
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

    # å…³è”å…³ç³» - ä¸€å¯¹å¤š
    posts = relationship("Post", back_populates="author")  # ç”¨æˆ·çš„æ‰€æœ‰æ–‡ç« 

    def __repr__(self):
        """å­—ç¬¦ä¸²è¡¨ç¤º - ç±»ä¼¼Javaçš„toString()"""
        return f"<User(id={self.id}, name='{self.name}', email='{self.email}')>"

class Post(Base):
    """æ–‡ç« è¡¨æ¨¡å‹"""
    __tablename__ = 'posts'

    id = Column(Integer, primary_key=True)
    title = Column(String(200), nullable=False)
    content = Column(String(10000))  # æ–‡ç« å†…å®¹

    # å¤–é”® - ç±»ä¼¼JPAçš„@ManyToOne
    author_id = Column(Integer, ForeignKey('users.id'), nullable=False)

    created_at = Column(DateTime, default=datetime.utcnow)

    # åå‘å…³è” - å¤šå¯¹ä¸€
    author = relationship("User", back_populates="posts")

    def __repr__(self):
        return f"<Post(id={self.id}, title='{self.title}')>"

# åˆ›å»ºæ•°æ®åº“è¿æ¥ - ç±»ä¼¼Springçš„DataSourceé…ç½®
# SQLiteç¤ºä¾‹(æ–‡ä»¶æ•°æ®åº“)
engine = create_engine('sqlite:///blog.db', echo=True)  # echo=Trueæ˜¾ç¤ºSQLæ—¥å¿—

# MySQLç¤ºä¾‹
# engine = create_engine('mysql+pymysql://user:password@localhost/blog_db')

# PostgreSQLç¤ºä¾‹
# engine = create_engine('postgresql://user:password@localhost/blog_db')

# åˆ›å»ºæ‰€æœ‰è¡¨ - ç±»ä¼¼Hibernateçš„ddl-auto=create
Base.metadata.create_all(engine)

# åˆ›å»ºä¼šè¯å·¥å‚ - ç±»ä¼¼Springçš„EntityManagerFactory
SessionLocal = sessionmaker(bind=engine)

# æ•°æ®åº“æ“ä½œç¤ºä¾‹
def create_user_and_posts():
    """åˆ›å»ºç”¨æˆ·å’Œæ–‡ç« çš„ç¤ºä¾‹"""
    # åˆ›å»ºä¼šè¯ - ç±»ä¼¼JPAçš„EntityManager
    session = SessionLocal()

    try:
        # åˆ›å»ºç”¨æˆ· - ç±»ä¼¼JPAçš„persist()
        user = User(
            name='Alice',
            email='alice@example.com',
            is_active=True
        )
        session.add(user)  # æ·»åŠ åˆ°ä¼šè¯
        session.flush()    # ç«‹å³æ‰§è¡ŒINSERT,è·å–IDä½†ä¸æäº¤äº‹åŠ¡

        print(f"åˆ›å»ºç”¨æˆ·,ID: {user.id}")

        # åˆ›å»ºæ–‡ç« 
        post1 = Post(
            title='Pythonå­¦ä¹ ç¬”è®°',
            content='ä»Šå¤©å­¦ä¹ äº†SQLAlchemy...',
            author_id=user.id
        )

        post2 = Post(
            title='Webå¼€å‘ç»éªŒ',
            content='ä½¿ç”¨Flaskå¼€å‘API...',
            author_id=user.id
        )

        session.add_all([post1, post2])  # æ‰¹é‡æ·»åŠ 
        session.commit()  # æäº¤äº‹åŠ¡ - ç±»ä¼¼JPAçš„commit()

        print(f"åˆ›å»ºæ–‡ç« : {post1.title}, {post2.title}")

    except Exception as e:
        session.rollback()  # å›æ»šäº‹åŠ¡ - ç±»ä¼¼JPAçš„rollback()
        print(f"æ“ä½œå¤±è´¥: {e}")
    finally:
        session.close()  # å…³é—­ä¼šè¯ - ç±»ä¼¼JPAçš„close()

def query_examples():
    """æŸ¥è¯¢ç¤ºä¾‹"""
    session = SessionLocal()

    try:
        # æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ· - ç±»ä¼¼JPAçš„findAll()
        all_users = session.query(User).all()
        print(f"æ‰€æœ‰ç”¨æˆ·: {all_users}")

        # æ ¹æ®IDæŸ¥è¯¢ - ç±»ä¼¼JPAçš„findById()
        user = session.query(User).get(1)  # ä¸»é”®æŸ¥è¯¢
        if user:
            print(f"ç”¨æˆ·1: {user.name}")

        # æ¡ä»¶æŸ¥è¯¢ - ç±»ä¼¼JPAçš„findByNameLike()
        active_users = session.query(User).filter(User.is_active == True).all()
        alice = session.query(User).filter(User.name == 'Alice').first()

        # å¤æ‚æ¡ä»¶æŸ¥è¯¢
        from sqlalchemy import and_, or_
        users = session.query(User).filter(
            and_(
                User.is_active == True,
                User.email.like('%@example.com')  # LIKEæ“ä½œ
            )
        ).all()

        # æ’åºå’Œåˆ†é¡µ - ç±»ä¼¼JPAçš„Pageable
        users = session.query(User).order_by(User.created_at.desc()).limit(10).offset(0).all()

        # å…³è”æŸ¥è¯¢ - ç±»ä¼¼JPAçš„JOIN FETCH
        users_with_posts = session.query(User).join(Post).all()  # INNER JOIN

        # å·¦è¿æ¥
        users_left_join = session.query(User).outerjoin(Post).all()  # LEFT JOIN

        # é¢„åŠ è½½å…³è”æ•°æ® - è§£å†³N+1é—®é¢˜
        from sqlalchemy.orm import joinedload
        users = session.query(User).options(joinedload(User.posts)).all()

        for user in users:
            print(f"ç”¨æˆ·: {user.name}")
            for post in user.posts:  # ä¸ä¼šäº§ç”Ÿé¢å¤–æŸ¥è¯¢
                print(f"  æ–‡ç« : {post.title}")

        # èšåˆæŸ¥è¯¢
        from sqlalchemy import func
        user_count = session.query(func.count(User.id)).scalar()  # COUNTæŸ¥è¯¢
        avg_posts = session.query(func.avg(func.count(Post.id))).group_by(Post.author_id).scalar()

        # æ›´æ–°æ“ä½œ - ç±»ä¼¼JPAçš„merge()
        user = session.query(User).filter(User.name == 'Alice').first()
        if user:
            user.email = 'alice.new@example.com'  # ç›´æ¥ä¿®æ”¹å±æ€§
            session.commit()  # æäº¤æ›´æ”¹

        # æ‰¹é‡æ›´æ–°
        session.query(User).filter(User.is_active == False).update({
            User.is_active: True
        })
        session.commit()

        # åˆ é™¤æ“ä½œ
        post_to_delete = session.query(Post).filter(Post.title.like('%æµ‹è¯•%')).first()
        if post_to_delete:
            session.delete(post_to_delete)
            session.commit()

        # æ‰¹é‡åˆ é™¤
        session.query(Post).filter(Post.created_at < datetime(2020, 1, 1)).delete()
        session.commit()

    finally:
        session.close()

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨è‡ªåŠ¨ç®¡ç†ä¼šè¯
from contextlib import contextmanager

@contextmanager
def get_db_session():
    """æ•°æ®åº“ä¼šè¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    session = SessionLocal()
    try:
        yield session
        session.commit()
    except Exception:
        session.rollback()
        raise
    finally:
        session.close()

# ä½¿ç”¨ç¤ºä¾‹
def safe_database_operation():
    """å®‰å…¨çš„æ•°æ®åº“æ“ä½œ"""
    with get_db_session() as session:
        user = User(name='Bob', email='bob@example.com')
        session.add(user)
        # è‡ªåŠ¨æäº¤æˆ–å›æ»š,è‡ªåŠ¨å…³é—­ä¼šè¯

# æ‰§è¡Œç¤ºä¾‹
if __name__ == '__main__':
    create_user_and_posts()
    query_examples()
```

#### cã€æ•°æ®åº“é©±åŠ¨

å„ç§æ•°æ®åº“çš„Pythoné©±åŠ¨ç¨‹åº,ç±»ä¼¼JDBCé©±åŠ¨ã€‚

```python
# MySQL
import pymysql
conn = pymysql.connect(host='localhost', user='root', password='password', database='test')

# PostgreSQL
import psycopg2
conn = psycopg2.connect(host='localhost', database='test', user='postgres', password='password')

# Redis
import redis
r = redis.Redis(host='localhost', port=6379, db=0)
r.set('key', 'value')
print(r.get('key'))
```

### 10.4ã€æµ‹è¯•æ¡†æ¶

#### aã€- æ ‡å‡†åº“

Pythonå†…ç½®çš„æµ‹è¯•æ¡†æ¶,ç±»ä¼¼JUnit,æä¾›åŸºæœ¬çš„æµ‹è¯•åŠŸèƒ½ã€‚

```python
import unittest

class TestCalculator(unittest.TestCase):

    def setUp(self):
        self.calc = Calculator()

    def test_add(self):
        result = self.calc.add(2, 3)
        self.assertEqual(result, 5)

    def test_divide_by_zero(self):
        with self.assertRaises(ZeroDivisionError):
            self.calc.divide(10, 0)

if __name__ == '__main__':
    unittest.main()
```

#### bã€- ä¸»æµæµ‹è¯•æ¡†æ¶

pytestæ˜¯Pythonæœ€æµè¡Œçš„ç¬¬ä¸‰æ–¹æµ‹è¯•æ¡†æ¶,è¯­æ³•æ›´ç®€æ´,åŠŸèƒ½æ›´å¼ºå¤§ã€‚

```python
# å®‰è£…: pip install pytest

def test_add():
    assert add(2, 3) == 5

def test_divide_by_zero():
    with pytest.raises(ZeroDivisionError):
        divide(10, 0)

# å‚æ•°åŒ–æµ‹è¯•
import pytest

@pytest.mark.parametrize("a,b,expected", [
    (2, 3, 5),
    (1, 1, 2),
    (0, 5, 5)
])
def test_add_parametrized(a, b, expected):
    assert add(a, b) == expected

# è¿è¡Œ: pytest test_file.py
```

#### cã€- æ¨¡æ‹Ÿå¯¹è±¡

mockåº“ç”¨äºåˆ›å»ºæ¨¡æ‹Ÿå¯¹è±¡,ä¾¿äºå•å…ƒæµ‹è¯•,ç±»ä¼¼Mockitoã€‚

```python
from unittest.mock import Mock, patch

# Mockå¯¹è±¡
mock_api = Mock()
mock_api.get_user.return_value = {'name': 'Alice', 'id': 1}

# ä½¿ç”¨patchè£…é¥°å™¨
@patch('requests.get')
def test_api_call(mock_get):
    mock_get.return_value.json.return_value = {'status': 'ok'}
    result = api_call()
    assert result['status'] == 'ok'
```

### 10.5ã€å…¶ä»–å®ç”¨åº“

#### aã€- HTMLè§£æ

BeautifulSoupæ˜¯HTML/XMLè§£æåº“,ç”¨äºç½‘é¡µçˆ¬è™«å’Œæ•°æ®æå–,ç±»ä¼¼Jsoupã€‚

```python
from bs4 import BeautifulSoup
import requests

# ç½‘é¡µæŠ“å–
response = requests.get('https://example.com')
soup = BeautifulSoup(response.content, 'html.parser')

# è§£æHTML
title = soup.find('title').text
links = soup.find_all('a')
for link in links:
    print(link.get('href'))
```

#### bã€- å›¾åƒå¤„ç†

Pillowæ˜¯Pythonå›¾åƒå¤„ç†åº“,æ”¯æŒå¤šç§å›¾åƒæ ¼å¼å’ŒåŸºæœ¬çš„å›¾åƒæ“ä½œã€‚

```python
from PIL import Image, ImageFilter

# æ‰“å¼€å›¾åƒ
img = Image.open('photo.jpg')

# åŸºæœ¬æ“ä½œ
resized = img.resize((100, 100))
rotated = img.rotate(45)
filtered = img.filter(ImageFilter.BLUR)

# ä¿å­˜
resized.save('thumbnail.jpg')
```

#### cã€python-dotenv - ç¯å¢ƒå˜é‡ç®¡ç†

python-dotenvç”¨äºä».envæ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡,ä¾¿äºé…ç½®ç®¡ç†ã€‚

```python
# .envæ–‡ä»¶
# DATABASE_URL=postgresql://localhost/mydb
# SECRET_KEY=mysecretkey

from dotenv import load_dotenv
import os

# åŠ è½½.envæ–‡ä»¶
load_dotenv()

# ä½¿ç”¨ç¯å¢ƒå˜é‡
database_url = os.getenv('DATABASE_URL')
secret_key = os.getenv('SECRET_KEY')
```

**ç”Ÿæ€å¯¹æ¯”:**

| é¢†åŸŸ | Pythonåº“ | Javaå¯¹åº” |
|-----|----------|---------|
| Webæ¡†æ¶ | Django, Flask, FastAPI | Spring Boot, Spring MVC |
| ORM | SQLAlchemy | JPA/Hibernate |
| HTTPå®¢æˆ·ç«¯ | requests, httpx | Apache HttpClient, OkHttp |
| æµ‹è¯• | pytest, unittest | JUnit, TestNG |
| JSON | json (å†…ç½®) | Jackson, Gson |
| æ—¥å¿— | logging (å†…ç½®) | Logback, Log4j |
| åŒ…ç®¡ç† | pip, conda | Maven, Gradle |
| æ•°æ®ç§‘å­¦ | NumPy, Pandas | - (éœ€ç¬¬ä¸‰æ–¹åº“) |

## 11ã€ä»£ç è´¨é‡ä¸å·¥ç¨‹å®è·µ

å¯¹äºä»Javaè½¬æ¥çš„å¼€å‘è€…ï¼ŒPythonçš„å·¥ç¨‹å®è·µå¯èƒ½æ˜¾å¾—æ›´åŠ çµæ´»ï¼Œä½†ä¹Ÿéœ€è¦æ›´å¼ºçš„è‡ªå¾‹æ€§ã€‚Javaæœ‰ä¸¥æ ¼çš„ç¼–ç è§„èŒƒå’Œæˆç†Ÿçš„å·¥ç¨‹ä½“ç³»ï¼Œè€ŒPythonåˆ™æä¾›äº†æ›´å¤šé€‰æ‹©ï¼Œéœ€è¦å›¢é˜Ÿå»ºç«‹è‡ªå·±çš„æœ€ä½³å®è·µã€‚

### 11.1ã€ä»£ç è§„èŒƒ

#### aã€PEP 8ç¼–ç è§„èŒƒ

PEP 8æ˜¯Pythonå®˜æ–¹çš„ç¼–ç é£æ ¼æŒ‡å—ï¼Œç›¸å½“äºJavaä¸–ç•Œçš„Google Java Style Guideã€‚

**ç¼©è¿›ä¸ç©ºæ ¼**ï¼š
```python
# âœ… æ­£ç¡®ï¼šä½¿ç”¨4ä¸ªç©ºæ ¼ç¼©è¿›
def calculate_total(items):
    total = 0
    for item in items:
        total += item.price
    return total

# âŒ é”™è¯¯ï¼šä½¿ç”¨Tabç¼©è¿›
def calculate_total(items):
	total = 0
	for item in items:
		total += item.price
	return total

# âœ… æ­£ç¡®ï¼šè¿ç®—ç¬¦ä¸¤ä¾§æœ‰ç©ºæ ¼
result = a + b * c

# âœ… æ­£ç¡®ï¼šå‡½æ•°å‚æ•°é»˜è®¤å€¼ç­‰å·ä¸¤ä¾§æ— ç©ºæ ¼
def create_user(name, age=25, active=True):
    pass

# âŒ é”™è¯¯ï¼šå‚æ•°é»˜è®¤å€¼ç­‰å·ä¸¤ä¾§æœ‰ç©ºæ ¼
def create_user(name, age = 25, active = True):
    pass
```

**è¡Œé•¿åº¦ä¸æ¢è¡Œ**ï¼š
```python
# âœ… æ­£ç¡®ï¼šæ¯è¡Œä¸è¶…è¿‡79å­—ç¬¦
def process_user_data(user_id, user_name, email, phone, address, city, country):
    return user_id

# âœ… æ­£ç¡®ï¼šé•¿è¡Œæ¢è¡Œä½¿ç”¨æ‹¬å·æˆ–åæ–œæ 
long_variable_name = some_function_with_very_long_name(
    parameter1, parameter2, parameter3, parameter4
)

# æˆ–ä½¿ç”¨åæ–œæ 
result = (first_value + second_value + third_value +
          fourth_value + fifth_value)

# âœ… æ­£ç¡®ï¼šäºŒå…ƒè¿ç®—ç¬¦æ¢è¡Œåœ¨æ“ä½œç¬¦å‰
income = (gross_wages
          + taxable_interest
          + (dividends - qualified_dividends)
          - ira_deduction
          - student_loan_interest)
```

**å¯¼å…¥è¯­å¥**ï¼š
```python
# âœ… æ­£ç¡®ï¼šå¯¼å…¥é¡ºåºï¼ˆæ ‡å‡†åº“ -> ç¬¬ä¸‰æ–¹åº“ -> æœ¬åœ°æ¨¡å—ï¼‰
import os
import sys
from datetime import datetime

import requests
import numpy as np

from myproject.utils import helper
from myproject.models import User

# âœ… æ­£ç¡®ï¼šé¿å…ä½¿ç”¨é€šé…ç¬¦å¯¼å…¥
from math import sqrt, sin, cos  # æ¨è
# from math import *  # ä¸æ¨è

# âœ… æ­£ç¡®ï¼šå¤šè¡Œå¯¼å…¥
from collections import (
    defaultdict,
    OrderedDict,
    Counter,
    deque
)
```

å¯¹æ¯”Javaçš„importé£æ ¼ï¼š
```java
// Java: æŒ‰å­—æ¯é¡ºåºï¼Œä½¿ç”¨é€šé…ç¬¦æ˜¯å¸¸è§çš„
import java.util.*;
import java.io.*;
import com.example.models.*;
```

#### bã€å‘½åçº¦å®š

Pythonçš„å‘½åçº¦å®šä¸Javaæœ‰æ˜æ˜¾å·®å¼‚ï¼š

| ç±»å‹ | Pythoné£æ ¼ | Javaé£æ ¼ | ç¤ºä¾‹ |
|-----|-----------|---------|-----|
| å˜é‡/å‡½æ•° | snake_case | camelCase | `user_name`, `get_user_info()` |
| ç±»å | PascalCase | PascalCase | `UserService`, `HttpClient` |
| å¸¸é‡ | UPPER_SNAKE_CASE | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT` |
| ç§æœ‰æˆå‘˜ | _prefix | private | `_internal_method` |
| æ¨¡å—å | lowercase | lowercase | `user_service.py` |

**å…·ä½“ç¤ºä¾‹**ï¼š
```python
# âœ… æ­£ç¡®çš„Pythonå‘½å
class UserService:
    MAX_RETRY_COUNT = 3
    _instance_count = 0

    def __init__(self, db_connection):
        self.db_connection = db_connection
        UserService._instance_count += 1

    def get_user_by_id(self, user_id):
        """æ ¹æ®IDè·å–ç”¨æˆ·ä¿¡æ¯"""
        query = f"SELECT * FROM users WHERE id = {user_id}"
        return self.db_connection.execute(query)

    def _validate_user_data(self, user_data):
        """å†…éƒ¨æ–¹æ³•ï¼šéªŒè¯ç”¨æˆ·æ•°æ®"""
        pass

# âœ… æ­£ç¡®çš„æ¨¡å—çº§å‘½å
def calculate_total_price(items, tax_rate=0.08):
    total = sum(item.price for item in items)
    return total * (1 + tax_rate)

API_BASE_URL = "https://api.example.com"
DEFAULT_TIMEOUT = 30
```

**ç‰¹æ®Šå‘½åçº¦å®š**ï¼š
```python
class DatabaseConnection:
    def __init__(self):
        self._connection = None          # å•ä¸‹åˆ’çº¿ï¼šå—ä¿æŠ¤æˆå‘˜
        self.__password = "secret"       # åŒä¸‹åˆ’çº¿ï¼šåç§°æ”¹å†™ï¼ˆçœŸæ­£ç§æœ‰ï¼‰

    def _internal_query(self, sql):      # å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•
        return self._connection.execute(sql)

    def __init_connection(self):         # åç§°æ”¹å†™åå˜ä¸º _DatabaseConnection__init_connection
        pass

    def connect(self):
        self.__init_connection()         # åªèƒ½åœ¨ç±»å†…éƒ¨è°ƒç”¨

    def __str__(self):                   # é­”æœ¯æ–¹æ³•ï¼šåŒä¸‹åˆ’çº¿å‰å
        return f"DatabaseConnection()"
```

#### cã€æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆDocstringï¼‰

Pythonä½¿ç”¨docstringä»£æ›¿Javaçš„Javadocï¼Œæ ¼å¼æ›´åŠ ç®€æ´ã€‚

**ä¸‰ç§å¸¸ç”¨docstringæ ¼å¼**ï¼š

```python
class Calculator:
    """è®¡ç®—å™¨ç±»ç¤ºä¾‹

    æä¾›åŸºæœ¬çš„æ•°å­¦è¿ç®—åŠŸèƒ½ã€‚

    Attributes:
        precision (int): è®¡ç®—ç²¾åº¦ï¼Œé»˜è®¤ä¸º2ä½å°æ•°
        history (list): è®¡ç®—å†å²è®°å½•
    """

    def __init__(self, precision=2):
        """åˆå§‹åŒ–è®¡ç®—å™¨

        Args:
            precision (int): è®¡ç®—ç²¾åº¦ï¼Œé»˜è®¤ä¸º2ä½å°æ•°

        Example:
            >>> calc = Calculator(4)
            >>> calc.precision
            4
        """
        self.precision = precision
        self.history = []

    def add(self, a, b):
        """åŠ æ³•è¿ç®—

        Args:
            a (float): ç¬¬ä¸€ä¸ªæ•°
            b (float): ç¬¬äºŒä¸ªæ•°

        Returns:
            float: ä¸¤æ•°ä¹‹å’Œ

        Raises:
            TypeError: å½“è¾“å…¥ä¸æ˜¯æ•°å­—æ—¶

        Example:
            >>> calc = Calculator()
            >>> calc.add(1.5, 2.3)
            3.8
        """
        if not isinstance(a, (int, float)) or not isinstance(b, (int, float)):
            raise TypeError("è¾“å…¥å¿…é¡»æ˜¯æ•°å­—")

        result = round(a + b, self.precision)
        self.history.append(f"{a} + {b} = {result}")
        return result
```

**Googleé£æ ¼docstring**ï¼š
```python
def calculate_bmi(weight, height):
    """è®¡ç®—BMIæŒ‡æ•°

    ä½¿ç”¨æ ‡å‡†BMIå…¬å¼ï¼šBMI = ä½“é‡(kg) / èº«é«˜(m)Â²

    Args:
        weight (float): ä½“é‡ï¼Œå•ä½åƒå…‹
        height (float): èº«é«˜ï¼Œå•ä½ç±³

    Returns:
        float: BMIæŒ‡æ•°ï¼Œä¿ç•™ä¸€ä½å°æ•°

    Raises:
        ValueError: å½“ä½“é‡æˆ–èº«é«˜ä¸º0æˆ–è´Ÿæ•°æ—¶

    Example:
        >>> calculate_bmi(70, 1.75)
        22.9
    """
    if weight <= 0 or height <= 0:
        raise ValueError("ä½“é‡å’Œèº«é«˜å¿…é¡»å¤§äº0")

    bmi = weight / (height ** 2)
    return round(bmi, 1)
```

#### dã€æ³¨é‡Šæœ€ä½³å®è·µ

Pythonçš„æ³¨é‡Šé£æ ¼æ¯”Javaæ›´ç®€æ´ï¼Œä½†åŒæ ·é‡è¦ã€‚

**å•è¡Œæ³¨é‡Š**ï¼š
```python
# âœ… å¥½çš„æ³¨é‡Šï¼šè§£é‡Šä¸ºä»€ä¹ˆï¼Œè€Œä¸æ˜¯åšä»€ä¹ˆ
if user.is_active:  # åªå¤„ç†æ´»è·ƒç”¨æˆ·ï¼Œé¿å…å¤„ç†å·²åˆ é™¤ç”¨æˆ·
    send_notification(user)

# âœ… å¥½çš„æ³¨é‡Šï¼šè§£é‡Šå¤æ‚ç®—æ³•
# ä½¿ç”¨æ»‘åŠ¨çª—å£ç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦O(n)
max_sum = max_subarray_sum(numbers)

# âŒ ä¸å¥½çš„æ³¨é‡Šï¼šé‡å¤ä»£ç æœ¬èº«
age = 25  # è®¾ç½®å¹´é¾„ä¸º25
```

**TODOå’ŒFIXME**ï¼š
```python
class UserService:
    def get_user_profile(self, user_id):
        # TODO: æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“
        profile = self.db.get_user_profile(user_id)

        # FIXME: è¿™é‡Œæ²¡æœ‰å¤„ç†ç”¨æˆ·ä¸å­˜åœ¨çš„æƒ…å†µ
        return profile
```

### 11.2ã€ä»£ç æ£€æŸ¥å·¥å…·

Pythonç”Ÿæ€æä¾›äº†ä¸°å¯Œçš„ä»£ç è´¨é‡å·¥å…·ï¼Œç±»ä¼¼äºJavaçš„SonarQubeã€Checkstyleç­‰ã€‚

#### aã€pylint

pylintæ˜¯æœ€å…¨é¢çš„ä»£ç æ£€æŸ¥å·¥å…·ï¼Œç±»ä¼¼äºJavaçš„SpotBugsã€‚

```bash
# å®‰è£…pylint
pip install pylint

# æ£€æŸ¥å•ä¸ªæ–‡ä»¶
pylint mymodule.py

# æ£€æŸ¥æ•´ä¸ªåŒ…
pylint mypackage/

# ç”ŸæˆæŠ¥å‘Š
pylint --output-format=json:report.json mymodule.py
```

**pylinté…ç½®æ–‡ä»¶ `.pylintrc`**ï¼š
```ini
[MASTER]
# æŒ‡å®šåˆå§‹åŒ–æ—¶åŠ è½½çš„æ¨¡å—
load-plugins=pylint_django,pylint_flask

[FORMAT]
# æœ€å¤§è¡Œé•¿åº¦
max-line-length=88
# ç¼©è¿›é£æ ¼
indent-string='    '

[DESIGN]
# æœ€å¤§å…¬å…±æ–¹æ³•æ•°é‡
max-public-methods=20
# æœ€å¤§å±æ€§æ•°é‡
max-attributes=7

[MESSAGES CONTROL]
# ç¦ç”¨çš„æ£€æŸ¥
disable=missing-docstring,
        too-few-public-methods,
        invalid-name

[TYPECHECK]
# å¿½ç•¥æŸäº›ç±»å‹æ£€æŸ¥
ignored-classes=optparse.Values,thread._local_dict
```

**å¸¸è§pylintæ¶ˆæ¯**ï¼š
```python
# C0111: missing-docstring (ç¼ºå°‘æ–‡æ¡£å­—ç¬¦ä¸²)
def calculate(x, y):
    return x + y

# R0201: no-self-use (æ–¹æ³•ä¸­æ²¡æœ‰ä½¿ç”¨self)
class MyClass:
    def utility_method(self):  # åº”è¯¥æ”¹ä¸ºé™æ€æ–¹æ³•
        return 42

# W0612: unused-variable (æœªä½¿ç”¨çš„å˜é‡)
def process_data():
    result, temp = get_result()  # tempæœªä½¿ç”¨
    return result

# E1101: no-member (å¯¹è±¡æ²¡æœ‰è¿™ä¸ªå±æ€§)
class User:
    def __init__(self):
        self.name = "å¼ ä¸‰"

user = User()
print(user.full_name)  # E1101: User has no member 'full_name'
```

#### bã€flake8

flake8æ˜¯å¤šä¸ªå·¥å…·çš„ç»„åˆï¼Œæ›´è½»é‡çº§ï¼Œä¸“æ³¨äºä»£ç é£æ ¼å’Œå¸¸è§é”™è¯¯ã€‚

```bash
# å®‰è£…flake8
pip install flake8

# åŸºæœ¬ä½¿ç”¨
flake8 mymodule.py

# é…ç½®æ–‡ä»¶
flake8 --config=.flake8 mymodule.py

# å¿½ç•¥ç‰¹å®šé”™è¯¯
flake8 --ignore=E501,W503 mymodule.py
```

**é…ç½®æ–‡ä»¶ `.flake8`**ï¼š
```ini
[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude =
    .git,
    __pycache__,
    .venv,
    build,
    dist
per-file-ignores =
    __init__.py:F401
    tests/*:S101
```

**å¸¸è§flake8é”™è¯¯ä»£ç **ï¼š
- `E`ç³»åˆ—ï¼šé”™è¯¯ï¼ˆErrorsï¼‰
- `W`ç³»åˆ—ï¼šè­¦å‘Šï¼ˆWarningsï¼‰
- `F`ç³»åˆ—ï¼šPyFlakesæ£€æŸ¥
- `C`ç³»åˆ—ï¼šå¤æ‚åº¦æ£€æŸ¥ï¼ˆmccabeï¼‰

```python
# E302: æœŸæœ›2ä¸ªç©ºè¡Œ
def func1(): pass
def func2(): pass

# E501: è¡Œå¤ªé•¿
very_long_variable_name = some_function_with_very_long_name(parameter1, parameter2)

# F401: å¯¼å…¥ä½†æœªä½¿ç”¨
import os
import sys  # F401: 'sys' imported but unused

# C901: å‡½æ•°å¤ªå¤æ‚
def complex_function(data):
    if condition1:
        if condition2:
            if condition3:
                # å¤šå±‚åµŒå¥—
                pass
```

#### cã€blackï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰

blackæ˜¯"ä¸å¦¥åçš„ä»£ç æ ¼å¼åŒ–å·¥å…·"ï¼Œç±»ä¼¼äºJavaçš„Google Java Formatã€‚

```bash
# å®‰è£…black
pip install black

# æ ¼å¼åŒ–å•ä¸ªæ–‡ä»¶
black mymodule.py

# æ ¼å¼åŒ–æ•´ä¸ªé¡¹ç›®
black .

# æ£€æŸ¥æ ¼å¼ä½†ä¸ä¿®æ”¹
black --check .

# æ˜¾ç¤ºå·®å¼‚
black --diff mymodule.py
```

**blacké…ç½® `pyproject.toml`**ï¼š
```toml
[tool.black]
line-length = 88
target-version = ['py38', 'py39']
include = '\.pyi?$'
extend-exclude = '''
/(
  # æ’é™¤çš„ç›®å½•
  \.eggs
  | \.git
  | \.venv
  | build
  | dist
)/
'''
```

**blackçš„æ ¼å¼åŒ–ç¤ºä¾‹**ï¼š
```python
# æ ¼å¼åŒ–å‰
def complex_function(a,b,c=10,*args,**kwargs):
    x=a+b+c
    if x>100:
        return "large"
    else:
        return "small"

# blackæ ¼å¼åŒ–å
def complex_function(a, b, c=10, *args, **kwargs):
    x = a + b + c
    if x > 100:
        return "large"
    else:
        return "small"
```

#### dã€isortï¼ˆå¯¼å…¥æ’åºï¼‰

isortä¸“é—¨ç”¨äºæ•´ç†importè¯­å¥ï¼Œç±»ä¼¼äºIDEçš„è‡ªåŠ¨importæ•´ç†åŠŸèƒ½ã€‚

```bash
# å®‰è£…isort
pip install isort

# æ’åºå¯¼å…¥
isort mymodule.py

# æ£€æŸ¥å¯¼å…¥ï¼ˆä¸ä¿®æ”¹ï¼‰
isort --check-only mymodule.py

# é…ç½®æ–‡ä»¶
isort --settings-file .isort.cfg mymodule.py
```

**é…ç½®æ–‡ä»¶ `.isort.cfg`**ï¼š
```ini
[settings]
profile = black
multi_line_output = 3
line_length = 88
known_first_party = myproject
known_third_party = requests, numpy, pandas
sections = FUTURE,STDLIB,THIRDPARTY,FIRSTPARTY,LOCALFOLDER
```

**isortæ•ˆæœç¤ºä¾‹**ï¼š
```python
# æ’åºå‰
import numpy
from myproject.utils import helper
import os
import sys
from collections import defaultdict
import requests

# isortæ’åºå
import os
import sys

from collections import defaultdict

import numpy
import requests

from myproject.utils import helper
```

#### eã€å·¥å…·é›†æˆ

**pre-commité’©å­é…ç½® `.pre-commit-config.yaml`**ï¼š
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/psf/black
    rev: 22.3.0
    hooks:
      - id: black

  - repo: https://github.com/pycqa/isort
    rev: 5.10.1
    hooks:
      - id: isort

  - repo: https://github.com/pycqa/flake8
    rev: 4.0.1
    hooks:
      - id: flake8

  - repo: local
    hooks:
      - id: pylint
        name: pylint
        entry: pylint
        language: system
        types: [python]
```

**å®‰è£…pre-commit**ï¼š
```bash
pip install pre-commit
pre-commit install
```

**IDEé›†æˆé…ç½®**ï¼š
```json
// VSCode settings.json
{
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.organizeImports": true
    }
}
```

### 11.3ã€è™šæ‹Ÿç¯å¢ƒç®¡ç†

Pythonçš„è™šæ‹Ÿç¯å¢ƒç›¸å½“äºJavaçš„Maven/Gradleé¡¹ç›®éš”ç¦»ï¼Œä½†æ›´è½»é‡çº§ã€‚

#### aã€venvå®è·µ

**åˆ›å»ºå’Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ**ï¼š
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv myproject_env

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
myproject_env\Scripts\activate
# macOS/Linux
source myproject_env/bin/activate

# å®‰è£…åŒ…
pip install requests pandas numpy

# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
pip list

# å¯¼å‡ºä¾èµ–
pip freeze > requirements.txt

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```

**é¡¹ç›®ç»“æ„ç¤ºä¾‹**ï¼š
```
myproject/
â”œâ”€â”€ .venv/                 # è™šæ‹Ÿç¯å¢ƒç›®å½•
â”œâ”€â”€ src/
â”‚   â””â”€â”€ mypackage/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ main.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_main.py
â”œâ”€â”€ requirements.txt       # ç”Ÿäº§ä¾èµ–
â”œâ”€â”€ requirements-dev.txt   # å¼€å‘ä¾èµ–
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ pyproject.toml        # é¡¹ç›®é…ç½®
```

**æœ€ä½³å®è·µ**ï¼š
```bash
# 1. æ¯ä¸ªé¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# 2. æ¿€æ´»ç¯å¢ƒåå®‰è£…ä¾èµ–
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate  # Windows

# 3. å‡çº§pip
pip install --upgrade pip

# 4. å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# 5. å¼€å‘ç¯å¢ƒé¢å¤–ä¾èµ–
pip install -r requirements-dev.txt
```

#### bã€requirements.txtç®¡ç†

**requirements.txtç¤ºä¾‹**ï¼š
```txt
# æ ¸å¿ƒä¾èµ–
Django==4.2.0
requests==2.31.0
pandas==2.0.3
numpy==1.24.3

# å®‰å…¨å›ºå®š
cryptography==41.0.1
urllib3==1.26.16

# å…¼å®¹æ€§èŒƒå›´
python-dateutil>=2.8.0,<3.0.0
click>=8.0.0,<9.0.0
```

**requirements-dev.txtç¤ºä¾‹**ï¼š
```txt
# åŒ…å«ç”Ÿäº§ä¾èµ–
-r requirements.txt

# å¼€å‘å·¥å…·
pytest==7.4.0
pytest-cov==4.1.0
black==23.3.0
flake8==6.0.0
mypy==1.4.1

# æ–‡æ¡£ç”Ÿæˆ
sphinx==7.1.2
sphinx-rtd-theme==1.3.0
```

**ç‰ˆæœ¬çº¦æŸç­–ç•¥**ï¼š
```txt
# å›ºå®šç‰ˆæœ¬ï¼ˆç”Ÿäº§æ¨èï¼‰
requests==2.31.0

# å…¼å®¹ç‰ˆæœ¬ï¼ˆå…è®¸å°ç‰ˆæœ¬æ›´æ–°ï¼‰
requests>=2.30.0,<3.0.0

# æœ€å°ç‰ˆæœ¬ï¼ˆä¸æ¨èç”Ÿäº§ä½¿ç”¨ï¼‰
requests>=2.25.0

# ä¸æŒ‡å®šç‰ˆæœ¬ï¼ˆå±é™©ï¼‰
requests
```

**ç”Ÿæˆrequirements.txt**ï¼š
```bash
# ç²¾ç¡®ç‰ˆæœ¬
pip freeze > requirements.txt

# åªåŒ…å«é¡¶çº§åŒ…
pip list --format=freeze > requirements.txt

# ä½¿ç”¨pip-toolsç®¡ç†
pip install pip-tools
pip-compile requirements.in  # ç”Ÿæˆrequirements.txt
```

**requirements.inç¤ºä¾‹**ï¼š
```ini
# requirements.in - åªæŒ‡å®šä¸»è¦ä¾èµ–
django
requests
pandas>=1.5.0
```

#### cã€poetryä¾èµ–ç®¡ç†

Poetryæ˜¯ç°ä»£Pythonä¾èµ–ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äºJavaçš„Maven/Gradleã€‚

**å®‰è£…Poetry**ï¼š
```bash
# å®˜æ–¹æ¨èå®‰è£…æ–¹å¼
curl -sSL https://install.python-poetry.org | python3 -

# æˆ–ä½¿ç”¨pip
pip install poetry
```

**åˆå§‹åŒ–é¡¹ç›®**ï¼š
```bash
# åˆ›å»ºæ–°é¡¹ç›®
poetry new myproject
cd myproject

# åœ¨ç°æœ‰é¡¹ç›®ä¸­åˆå§‹åŒ–
poetry init
```

**pyproject.tomlé…ç½®**ï¼š
```toml
[tool.poetry]
name = "myproject"
version = "0.1.0"
description = "My Python project"
authors = ["Your Name <you@example.com>"]
readme = "README.md"
packages = [{include = "myproject"}]

[tool.poetry.dependencies]
python = "^3.8"
requests = "^2.31.0"
pandas = "^2.0.0"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.0"
black = "^23.3.0"
flake8 = "^6.0.0"
mypy = "^1.4.0"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 88
target-version = ['py38']

[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
```

**Poetryå¸¸ç”¨å‘½ä»¤**ï¼š
```bash
# å®‰è£…ä¾èµ–
poetry install

# åªå®‰è£…ç”Ÿäº§ä¾èµ–
poetry install --only=main

# æ·»åŠ ä¾èµ–
poetry add requests
poetry add --group dev pytest  # æ·»åŠ å¼€å‘ä¾èµ–

# æ›´æ–°ä¾èµ–
poetry update
poetry update requests

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶è¿è¡Œå‘½ä»¤
poetry run python myscript.py
poetry run pytest

# è¿›å…¥è™šæ‹Ÿç¯å¢ƒshell
poetry shell

# æ˜¾ç¤ºä¾èµ–æ ‘
poetry show --tree

# å¯¼å‡ºrequirements.txt
poetry export -f requirements.txt --output requirements.txt

# æ„å»ºåŒ…
poetry build

# å‘å¸ƒåˆ°PyPI
poetry publish
```

**Poetry vs pipå¯¹æ¯”**ï¼š

| ç‰¹æ€§ | pip + requirements.txt | Poetry |
|-----|-----------------------|---------|
| ä¾èµ–è§£æ | åŸºç¡€ | é«˜çº§ï¼ˆè§£å†³å†²çªï¼‰ |
| é”å®šæ–‡ä»¶ | æ‰‹åŠ¨ | è‡ªåŠ¨ï¼ˆpoetry.lockï¼‰ |
| è™šæ‹Ÿç¯å¢ƒ | æ‰‹åŠ¨ç®¡ç† | è‡ªåŠ¨ç®¡ç† |
| ä¾èµ–åˆ†ç»„ | å¤šä¸ªæ–‡ä»¶ | é…ç½®æ–‡ä»¶ä¸­åˆ†ç»„ |
| æ„å»ºå‘å¸ƒ | éœ€è¦é¢å¤–å·¥å…· | å†…ç½®æ”¯æŒ |
| è„šæœ¬ç®¡ç† | æ—  | å†…ç½®æ”¯æŒ |

**ä¼ä¸šçº§Poetryé…ç½®**ï¼š
```toml
# pyproject.toml
[[tool.poetry.source]]
name = "private-pypi"
url = "https://pypi.company.com/simple"
default = false
secondary = true

[tool.poetry.scripts]
myproject-cli = "myproject.cli:main"

[tool.poetry.group.test.dependencies]
pytest = "^7.4.0"
pytest-cov = "^4.1.0"

[tool.poetry.group.docs.dependencies]
sphinx = "^7.1.0"
```

### 11.4ã€å•å…ƒæµ‹è¯•

Pythonçš„æµ‹è¯•ç”Ÿæ€æ¯”Javaçš„JUnitæ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚pytestæ˜¯å½“å‰æœ€æµè¡Œçš„æµ‹è¯•æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œæ’ä»¶ã€‚

#### aã€pyteståŸºç¡€

**å®‰è£…pytest**ï¼š
```bash
pip install pytest
```

**åŸºæœ¬æµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# calculator.py
class Calculator:
    def add(self, a, b):
        return a + b

    def divide(self, a, b):
        if b == 0:
            raise ValueError("é™¤æ•°ä¸èƒ½ä¸º0")
        return a / b

    def is_even(self, number):
        return number % 2 == 0
```

```python
# test_calculator.py
import pytest
from calculator import Calculator

class TestCalculator:
    def setup_method(self):
        """æ¯ä¸ªæµ‹è¯•æ–¹æ³•å‰æ‰§è¡Œ"""
        self.calc = Calculator()

    def test_add_positive_numbers(self):
        result = self.calc.add(2, 3)
        assert result == 5

    def test_add_negative_numbers(self):
        result = self.calc.add(-2, -3)
        assert result == -5

    def test_divide_normal(self):
        result = self.calc.divide(10, 2)
        assert result == 5

    def test_divide_by_zero(self):
        with pytest.raises(ValueError, match="é™¤æ•°ä¸èƒ½ä¸º0"):
            self.calc.divide(10, 0)

    @pytest.mark.parametrize("number,expected", [
        (2, True),
        (3, False),
        (0, True),
        (-4, True),
    ])
    def test_is_even(self, number, expected):
        result = self.calc.is_even(number)
        assert result == expected
```

**è¿è¡Œæµ‹è¯•**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæ–‡ä»¶
pytest test_calculator.py

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
pytest test_calculator.py::TestCalculator::test_add_positive_numbers

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
pytest -v

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥æ—¶åœæ­¢
pytest -x

# æ˜¾ç¤ºè¦†ç›–ç‡
pytest --cov=calculator
```

#### bã€æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰

TDDåœ¨Pythonä¸­æ¯”Javaæ›´ç®€æ´ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…ä¾‹å­æ¥å±•ç¤ºï¼š

**éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªå¯†ç éªŒè¯å™¨**

**1. å…ˆå†™æµ‹è¯•ï¼ˆçº¢ï¼‰**ï¼š
```python
# test_password_validator.py
import pytest
from password_validator import PasswordValidator

class TestPasswordValidator:
    def setup_method(self):
        self.validator = PasswordValidator()

    def test_valid_password(self):
        password = "MySecure123!"
        assert self.validator.validate(password) == True

    def test_too_short_password(self):
        password = "Short1!"
        assert self.validator.validate(password) == False

    def test_missing_uppercase(self):
        password = "mysecure123!"
        assert self.validator.validate(password) == False

    def test_missing_lowercase(self):
        password = "MYSECURE123!"
        assert self.validator.validate(password) == False

    def test_missing_number(self):
        password = "MySecure!"
        assert self.validator.validate(password) == False

    def test_missing_special_char(self):
        password = "MySecure123"
        assert self.validator.validate(password) == False

    def test_get_error_messages(self):
        password = "weak"
        errors = self.validator.get_errors(password)
        assert "å¯†ç é•¿åº¦è‡³å°‘8ä½" in errors
        assert "å¿…é¡»åŒ…å«å¤§å†™å­—æ¯" in errors
        assert "å¿…é¡»åŒ…å«å°å†™å­—æ¯" in errors
        assert "å¿…é¡»åŒ…å«æ•°å­—" in errors
        assert "å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦" in errors
```

**2. è¿è¡Œæµ‹è¯•ï¼ˆå¤±è´¥ï¼‰**ï¼š
```bash
pytest test_password_validator.py
# ä¼šå¤±è´¥ï¼Œå› ä¸ºPasswordValidatorè¿˜ä¸å­˜åœ¨
```

**3. å®ç°æœ€å°ä»£ç ï¼ˆç»¿ï¼‰**ï¼š
```python
# password_validator.py
import re

class PasswordValidator:
    def __init__(self):
        self.min_length = 8

    def validate(self, password):
        """éªŒè¯å¯†ç æ˜¯å¦ç¬¦åˆè¦æ±‚"""
        if len(password) < self.min_length:
            return False
        if not re.search(r'[A-Z]', password):
            return False
        if not re.search(r'[a-z]', password):
            return False
        if not re.search(r'\d', password):
            return False
        if not re.search(r'[!@#$%^&*(),.?":{}|<>]', password):
            return False
        return True

    def get_errors(self, password):
        """è·å–å¯†ç éªŒè¯çš„é”™è¯¯ä¿¡æ¯"""
        errors = []

        if len(password) < self.min_length:
            errors.append("å¯†ç é•¿åº¦è‡³å°‘8ä½")
        if not re.search(r'[A-Z]', password):
            errors.append("å¿…é¡»åŒ…å«å¤§å†™å­—æ¯")
        if not re.search(r'[a-z]', password):
            errors.append("å¿…é¡»åŒ…å«å°å†™å­—æ¯")
        if not re.search(r'\d', password):
            errors.append("å¿…é¡»åŒ…å«æ•°å­—")
        if not re.search(r'[!@#$%^&*(),.?":{}|<>]', password):
            errors.append("å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦")

        return errors
```

**4. è¿è¡Œæµ‹è¯•ï¼ˆé€šè¿‡ï¼‰**ï¼š
```bash
pytest test_password_validator.py
# ç°åœ¨åº”è¯¥å…¨éƒ¨é€šè¿‡
```

**5. é‡æ„ï¼ˆä¼˜åŒ–ï¼‰**ï¼š
```python
# é‡æ„åçš„å¯†ç éªŒè¯å™¨
class PasswordValidator:
    def __init__(self, min_length=8):
        self.min_length = min_length
        self.patterns = {
            'uppercase': r'[A-Z]',
            'lowercase': r'[a-z]',
            'number': r'\d',
            'special': r'[!@#$%^&*(),.?":{}|<>]'
        }
        self.error_messages = {
            'length': f"å¯†ç é•¿åº¦è‡³å°‘{min_length}ä½",
            'uppercase': "å¿…é¡»åŒ…å«å¤§å†™å­—æ¯",
            'lowercase': "å¿…é¡»åŒ…å«å°å†™å­—æ¯",
            'number': "å¿…é¡»åŒ…å«æ•°å­—",
            'special': "å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦"
        }

    def validate(self, password):
        """éªŒè¯å¯†ç æ˜¯å¦ç¬¦åˆè¦æ±‚"""
        return len(self.get_errors(password)) == 0

    def get_errors(self, password):
        """è·å–å¯†ç éªŒè¯çš„é”™è¯¯ä¿¡æ¯"""
        errors = []

        if len(password) < self.min_length:
            errors.append(self.error_messages['length'])

        for name, pattern in self.patterns.items():
            if not re.search(pattern, password):
                errors.append(self.error_messages[name])

        return errors
```

**6. å†æ¬¡è¿è¡Œæµ‹è¯•ï¼ˆç¡®ä¿é‡æ„æ²¡æœ‰ç ´ååŠŸèƒ½ï¼‰**ï¼š
```bash
pytest test_password_validator.py -v
```

#### cã€è¦†ç›–ç‡æµ‹è¯•

**å®‰è£…coverageå·¥å…·**ï¼š
```bash
pip install pytest-cov
```

**è¦†ç›–ç‡æŠ¥å‘Š**ï¼š
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=calculator test_calculator.py

# ç”ŸæˆHTMLæŠ¥å‘Š
pytest --cov=calculator --cov-report=html test_calculator.py

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open htmlcov/index.html

# è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼
pytest --cov=calculator --cov-fail-under=80 test_calculator.py
```

**è¦†ç›–ç‡é…ç½® `.coveragerc`**ï¼š
```ini
[run]
source = src
omit =
    tests/*
    venv/*
    */migrations/*

[report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:

[html]
directory = htmlcov
```

#### dã€mockä½¿ç”¨

mockç”¨äºéš”ç¦»ä¾èµ–ï¼Œç±»ä¼¼äºJavaçš„Mockitoã€‚

**åŸºæœ¬mockä½¿ç”¨**ï¼š
```python
# user_service.py
import requests

class UserService:
    def __init__(self, api_base_url):
        self.api_base_url = api_base_url

    def get_user(self, user_id):
        """ä»APIè·å–ç”¨æˆ·ä¿¡æ¯"""
        response = requests.get(f"{self.api_base_url}/users/{user_id}")
        if response.status_code == 200:
            return response.json()
        return None

    def send_welcome_email(self, user_email):
        """å‘é€æ¬¢è¿é‚®ä»¶"""
        # å‡è®¾è¿™æ˜¯è°ƒç”¨é‚®ä»¶æœåŠ¡
        response = requests.post(
            "https://api.emailservice.com/send",
            json={"to": user_email, "subject": "Welcome!"}
        )
        return response.status_code == 200
```

```python
# test_user_service.py
import pytest
from unittest.mock import Mock, patch
from user_service import UserService

class TestUserService:
    def setup_method(self):
        self.service = UserService("https://api.example.com")

    @patch('user_service.requests.get')
    def test_get_user_success(self, mock_get):
        """æµ‹è¯•æˆåŠŸè·å–ç”¨æˆ·"""
        # æ¨¡æ‹ŸAPIå“åº”
        mock_response = Mock()
        mock_response.status_code = 200
        mock_response.json.return_value = {
            "id": 1,
            "name": "å¼ ä¸‰",
            "email": "zhangsan@example.com"
        }
        mock_get.return_value = mock_response

        # æµ‹è¯•
        user = self.service.get_user(1)

        # éªŒè¯
        assert user is not None
        assert user["name"] == "å¼ ä¸‰"
        mock_get.assert_called_once_with("https://api.example.com/users/1")

    @patch('user_service.requests.get')
    def test_get_user_not_found(self, mock_get):
        """æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨"""
        mock_response = Mock()
        mock_response.status_code = 404
        mock_get.return_value = mock_response

        user = self.service.get_user(999)
        assert user is None

    @patch('user_service.requests.post')
    def test_send_welcome_email(self, mock_post):
        """æµ‹è¯•å‘é€æ¬¢è¿é‚®ä»¶"""
        mock_response = Mock()
        mock_response.status_code = 200
        mock_post.return_value = mock_response

        result = self.service.send_welcome_email("test@example.com")
        assert result is True

        # éªŒè¯è°ƒç”¨å‚æ•°
        mock_post.assert_called_once_with(
            "https://api.emailservice.com/send",
            json={"to": "test@example.com", "subject": "Welcome!"}
        )
```

**é«˜çº§mockæŠ€å·§**ï¼š
```python
# test_advanced_mock.py
from unittest.mock import Mock, patch, MagicMock
import pytest

class TestAdvancedMock:
    def test_mock_side_effect(self):
        """ä½¿ç”¨side_effectæ¨¡æ‹Ÿä¸åŒæƒ…å†µ"""
        mock_func = Mock()
        mock_func.side_effect = [200, 404, 500]  # è¿ç»­è°ƒç”¨çš„ä¸åŒè¿”å›å€¼

        assert mock_func() == 200
        assert mock_func() == 404
        assert mock_func() == 500

    def test_mock_exception(self):
        """æ¨¡æ‹Ÿå¼‚å¸¸"""
        mock_func = Mock()
        mock_func.side_effect = ValueError("APIé”™è¯¯")

        with pytest.raises(ValueError, match="APIé”™è¯¯"):
            mock_func()

    @patch('builtins.open', new_callable=MagicMock)
    def test_file_operations(self, mock_open):
        """æµ‹è¯•æ–‡ä»¶æ“ä½œ"""
        mock_file = MagicMock()
        mock_file.__enter__.return_value = mock_file
        mock_file.read.return_value = "file content"
        mock_open.return_value = mock_file

        # æµ‹è¯•ä»£ç 
        with open("test.txt", "r") as f:
            content = f.read()

        assert content == "file content"
        mock_open.assert_called_once_with("test.txt", "r")

    def test_mock_spec(self):
        """ä½¿ç”¨specæ¨¡æ‹Ÿç‰¹å®šæ¥å£"""
        class DatabaseInterface:
            def get_user(self, user_id): pass
            def save_user(self, user): pass

        mock_db = Mock(spec=DatabaseInterface)

        # æ­£ç¡®çš„æ–¹æ³•è°ƒç”¨
        mock_db.get_user(1)

        # é”™è¯¯çš„æ–¹æ³•è°ƒç”¨ä¼šå¼•å‘å¼‚å¸¸
        # mock_db.delete_user(1)  # ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ¥å£ä¸­æ²¡æœ‰è¿™ä¸ªæ–¹æ³•

        mock_db.get_user.assert_called_once_with(1)
```

**pytest fixtures**ï¼š
```python
# conftest.py
import pytest
from unittest.mock import Mock

@pytest.fixture
def mock_api_client():
    """åˆ›å»ºæ¨¡æ‹ŸAPIå®¢æˆ·ç«¯"""
    client = Mock()
    client.get_user.return_value = {"id": 1, "name": "æµ‹è¯•ç”¨æˆ·"}
    client.create_user.return_value = {"id": 2, "name": "æ–°ç”¨æˆ·"}
    return client

@pytest.fixture
def user_service(mock_api_client):
    """ä½¿ç”¨æ¨¡æ‹ŸAPIå®¢æˆ·ç«¯åˆ›å»ºç”¨æˆ·æœåŠ¡"""
    from user_service import UserService
    return UserService(mock_api_client)

# test_with_fixtures.py
def test_user_service_with_fixture(user_service, mock_api_client):
    """ä½¿ç”¨fixtureçš„æµ‹è¯•"""
    user = user_service.get_user(1)
    assert user["name"] == "æµ‹è¯•ç”¨æˆ·"
    mock_api_client.get_user.assert_called_once_with(1)
```

**å¼‚æ­¥æµ‹è¯•**ï¼š
```python
# test_async.py
import pytest
from unittest.mock import AsyncMock, patch

@pytest.mark.asyncio
async def test_async_function():
    """æµ‹è¯•å¼‚æ­¥å‡½æ•°"""
    async_func = AsyncMock()
    async_func.return_value = "async result"

    result = await async_func()
    assert result == "async result"

@patch('aiohttp.ClientSession.get')
@pytest.mark.asyncio
async def test_async_api_call(self, mock_get):
    """æµ‹è¯•å¼‚æ­¥APIè°ƒç”¨"""
    mock_response = AsyncMock()
    mock_response.status_code = 200
    mock_response.json.return_value = {"data": "test"}
    mock_get.return_value.__aenter__.return_value = mock_response

    async with aiohttp.ClientSession() as session:
        response = await session.get("https://api.example.com/data")
        data = await response.json()

    assert data["data"] == "test"
```

### 11.5ã€æ€§èƒ½ä¼˜åŒ–

Pythonçš„æ€§èƒ½ä¼˜åŒ–ä¸Javaæœ‰å¾ˆå¤§ä¸åŒã€‚Pythonæ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œéœ€è¦é‡‡ç”¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ã€‚

#### aã€timeitæ€§èƒ½æµ‹è¯•

**åŸºæœ¬timeitä½¿ç”¨**ï¼š
```python
import timeit

# æµ‹è¯•å°ä»£ç ç‰‡æ®µçš„æ‰§è¡Œæ—¶é—´
def test_list_comprehension():
    return [x**2 for x in range(1000)]

def test_for_loop():
    result = []
    for x in range(1000):
        result.append(x**2)
    return result

# timeitæµ‹è¯•
list_comp_time = timeit.timeit(test_list_comprehension, number=1000)
for_loop_time = timeit.timeit(test_for_loop, number=1000)

print(f"åˆ—è¡¨æ¨å¯¼å¼: {list_comp_time:.6f}ç§’")
print(f"forå¾ªç¯: {for_loop_time:.6f}ç§’")
print(f"æ€§èƒ½æå‡: {for_loop_time/list_comp_time:.2f}å€")

# ä½¿ç”¨timeit.repeatè¿›è¡Œå¤šæ¬¡æµ‹è¯•
times = timeit.repeat(test_list_comprehension, number=1000, repeat=5)
print(f"å„æ¬¡æ‰§è¡Œæ—¶é—´: {[f'{t:.6f}' for t in times]}")
```

**å‘½ä»¤è¡Œtimeit**ï¼š
```bash
python -m timeit "[x**2 for x in range(1000)]"
python -m timeit -n 1000 "sum(range(100))"
python -m timeit -s "import math" "math.sqrt(144)"
```

**æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹**ï¼š
```python
import timeit

def compare_string_concatenation():
    """æ¯”è¾ƒå­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•çš„æ€§èƒ½"""
    def method1_plus():
        result = ""
        for i in range(1000):
            result += str(i)
        return result

    def method2_join():
        return "".join(str(i) for i in range(1000))

    def method3_f_string():
        parts = [str(i) for i in range(1000)]
        return "".join(parts)

    # æµ‹è¯•
    time1 = timeit.timeit(method1_plus, number=100)
    time2 = timeit.timeit(method2_join, number=100)
    time3 = timeit.timeit(method3_f_string, number=100)

    print(f"å­—ç¬¦ä¸²æ‹¼æ¥ (+): {time1:.6f}ç§’")
    print(f"å­—ç¬¦ä¸²æ‹¼æ¥ (join): {time2:.6f}ç§’")
    print(f"åˆ—è¡¨æ‹¼æ¥ (f-string): {time3:.6f}ç§’")
    print(f"joinæ¯”+å¿« {time1/time2:.2f}å€")

compare_string_concatenation()
```

#### bã€cProfileæ€§èƒ½åˆ†æ

**ä½¿ç”¨cProfile**ï¼š
```python
import cProfile
import pstats
import io

def slow_function():
    """æ¨¡æ‹Ÿæ…¢å‡½æ•°"""
    total = 0
    for i in range(1000000):
        total += i ** 2
    return total

def another_function():
    """å¦ä¸€ä¸ªå‡½æ•°"""
    result = []
    for i in range(100000):
        result.append(i * 2)
    return sum(result)

def main_function():
    """ä¸»å‡½æ•°"""
    result1 = slow_function()
    result2 = another_function()
    return result1 + result2

# åˆ›å»ºProfileå¯¹è±¡
profiler = cProfile.Profile()

# å¼€å§‹åˆ†æ
profiler.enable()

# æ‰§è¡Œä»£ç 
main_function()

# åœæ­¢åˆ†æ
profiler.disable()

# è¾“å‡ºç»“æœ
# æ–¹æ³•1ï¼šç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°
profiler.print_stats(sort='cumulative')

# æ–¹æ³•2ï¼šä¿å­˜åˆ°å­—ç¬¦ä¸²
s = io.StringIO()
ps = pstats.Stats(profiler, stream=s).sort_stats('cumulative')
ps.print_stats()
print(s.getvalue())

# æ–¹æ³•3ï¼šä¿å­˜åˆ°æ–‡ä»¶
profiler.dump_stats('profile_results.prof')
```

**å‘½ä»¤è¡ŒcProfile**ï¼š
```bash
# åˆ†æPythonè„šæœ¬
python -m cProfile -s cumulative myscript.py

# æŒ‰å‡½æ•°åæ’åº
python -m cProfile -s name myscript.py

# ä¿å­˜åˆ†æç»“æœ
python -m cProfile -o profile_output.prof myscript.py

# æŸ¥çœ‹åˆ†æç»“æœ
python -c "import pstats; pstats.Stats('profile_output.prof').sort_stats('cumulative').print_stats(20)"
```

**åˆ†æç»“æœè§£è¯»**ï¼š
```
   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.001    0.001    0.150    0.150 myscript.py:25(main_function)
        1    0.080    0.080    0.080    0.080 myscript.py:15(slow_function)
        1    0.069    0.069    0.069    0.069 myscript.py:20(another_function)
```

- `ncalls`: è°ƒç”¨æ¬¡æ•°
- `tottime`: å‡½æ•°è‡ªèº«æ‰§è¡Œæ—¶é—´ï¼ˆä¸åŒ…æ‹¬å­å‡½æ•°ï¼‰
- `percall`: å¹³å‡æ¯æ¬¡è°ƒç”¨æ—¶é—´
- `cumtime`: ç´¯è®¡æ‰§è¡Œæ—¶é—´ï¼ˆåŒ…æ‹¬å­å‡½æ•°ï¼‰

**é«˜çº§æ€§èƒ½åˆ†æ**ï¼š
```python
import cProfile
import pstats
from functools import wraps

def profile_function(func):
    """æ€§èƒ½åˆ†æè£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        profiler = cProfile.Profile()
        profiler.enable()

        result = func(*args, **kwargs)

        profiler.disable()

        # åˆ›å»ºç»Ÿè®¡å¯¹è±¡
        stats = pstats.Stats(profiler)
        stats.sort_stats('cumulative')
        print(f"\n=== æ€§èƒ½åˆ†æç»“æœ: {func.__name__} ===")
        stats.print_stats(10)  # æ˜¾ç¤ºå‰10ä¸ªæœ€è€—æ—¶çš„å‡½æ•°

        return result
    return wrapper

@profile_function
def fibonacci(n):
    """è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆéä¼˜åŒ–ç‰ˆæœ¬ï¼‰"""
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# ä½¿ç”¨
result = fibonacci(30)
print(f"ç»“æœ: {result}")
```

#### cã€å¸¸è§æ€§èƒ½é™·é˜±

**é™·é˜±1ï¼šå­—ç¬¦ä¸²æ‹¼æ¥**ï¼š
```python
# âŒ ä½æ•ˆï¼šåœ¨å¾ªç¯ä¸­ä½¿ç”¨+æ‹¼æ¥
def inefficient_concatenation(items):
    result = ""
    for item in items:
        result += str(item) + ","  # æ¯æ¬¡éƒ½åˆ›å»ºæ–°å­—ç¬¦ä¸²å¯¹è±¡
    return result

# âœ… é«˜æ•ˆï¼šä½¿ç”¨join
def efficient_concatenation(items):
    return ",".join(str(item) for item in items)

# æ€§èƒ½å¯¹æ¯”
import timeit
items = list(range(10000))
time1 = timeit.timeit(lambda: inefficient_concatenation(items), number=10)
time2 = timeit.timeit(lambda: efficient_concatenation(items), number=10)
print(f"ä½æ•ˆæ–¹æ³•: {time1:.4f}ç§’")
print(f"é«˜æ•ˆæ–¹æ³•: {time2:.4f}ç§’")
```

**é™·é˜±2ï¼šé‡å¤è®¡ç®—**ï¼š
```python
# âŒ ä½æ•ˆï¼šé‡å¤è®¡ç®—
def inefficient_sum(matrix):
    total = 0
    for row in matrix:
        for val in row:
            if len(row) > 0:  # æ¯æ¬¡éƒ½è®¡ç®—é•¿åº¦
                total += val
    return total

# âœ… é«˜æ•ˆï¼šç¼“å­˜è®¡ç®—ç»“æœ
def efficient_sum(matrix):
    total = 0
    for row in matrix:
        row_length = len(row)  # åªè®¡ç®—ä¸€æ¬¡
        if row_length > 0:
            for val in row:
                total += val
    return total
```

**é™·é˜±3ï¼šä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨**ï¼š
```python
# âŒ ä½æ•ˆï¼šé‡å¤è°ƒç”¨å‡½æ•°
def inefficient_processing(items):
    result = []
    for item in items:
        if expensive_check(item):  # å¯èƒ½é‡å¤è®¡ç®—
            result.append(process_item(item))
    return result

# âœ… é«˜æ•ˆï¼šç¼“å­˜ç»“æœ
def efficient_processing(items):
    result = []
    cache = {}
    for item in items:
        cache_key = get_cache_key(item)
        if cache_key not in cache:
            cache[cache_key] = expensive_check(item)

        if cache[cache_key]:
            result.append(process_item(item))
    return result
```

**é™·é˜±4ï¼šå…¨å±€å˜é‡è®¿é—®**ï¼š
```python
# âŒ ä½æ•ˆï¼šåœ¨å¾ªç¯ä¸­è®¿é—®å…¨å±€å˜é‡
CONFIG = {"max_items": 1000, "threshold": 0.5}

def inefficient_filter(items):
    result = []
    for item in items:
        if item.value > CONFIG["threshold"]:  # æ¯æ¬¡éƒ½è®¿é—®å…¨å±€å˜é‡
            result.append(item)
    return result

# âœ… é«˜æ•ˆï¼šç¼“å­˜åˆ°å±€éƒ¨å˜é‡
def efficient_filter(items):
    result = []
    threshold = CONFIG["threshold"]  # ç¼“å­˜åˆ°å±€éƒ¨å˜é‡
    for item in items:
        if item.value > threshold:
            result.append(item)
    return result
```

**é™·é˜±5ï¼šåˆ—è¡¨æŸ¥æ‰¾æ“ä½œ**ï¼š
```python
# âŒ ä½æ•ˆï¼šä½¿ç”¨inæ“ä½œæŸ¥æ‰¾å¤§åˆ—è¡¨
large_list = list(range(100000))
def inefficient_search(items_to_find):
    results = []
    for item in items_to_find:
        if item in large_list:  # O(n)å¤æ‚åº¦
            results.append(item)
    return results

# âœ… é«˜æ•ˆï¼šä½¿ç”¨é›†åˆ
large_set = set(large_list)
def efficient_search(items_to_find):
    results = []
    for item in items_to_find:
        if item in large_set:  # O(1)å¤æ‚åº¦
            results.append(item)
    return results
```

#### dã€ä¼˜åŒ–å»ºè®®

**1. ä½¿ç”¨å†…ç½®å‡½æ•°å’Œæ•°æ®ç»“æ„**ï¼š
```python
import numpy as np

# âœ… ä½¿ç”¨numpyè¿›è¡Œæ•°å€¼è®¡ç®—
def efficient_math_operation(data):
    arr = np.array(data)
    return np.sum(arr ** 2) / len(arr)

# âœ… ä½¿ç”¨å†…ç½®å‡½æ•°
data = [1, 2, 3, 4, 5]
sum_data = sum(data)  # æ¯”å¾ªç¯æ±‚å’Œå¿«
max_data = max(data)  # æ¯”æ‰‹åŠ¨æŸ¥æ‰¾å¿«
sorted_data = sorted(data)  # æ¯”è‡ªå®šä¹‰æ’åºå¿«
```

**2. ç”Ÿæˆå™¨å’Œè¿­ä»£å™¨**ï¼š
```python
# âœ… ä½¿ç”¨ç”Ÿæˆå™¨å¤„ç†å¤§æ•°æ®
def process_large_file(filename):
    with open(filename, 'r') as f:
        for line in f:  # é€è¡Œå¤„ç†ï¼Œä¸åŠ è½½æ•´ä¸ªæ–‡ä»¶
            yield process_line(line)

# âœ… ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼
large_list = range(1000000)
sum_result = sum(x * x for x in large_list)  # å†…å­˜é«˜æ•ˆ
```

**3. å¤šè¿›ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹**ï¼š
```python
import multiprocessing
from concurrent.futures import ProcessPoolExecutor

# âœ… CPUå¯†é›†å‹ä»»åŠ¡ä½¿ç”¨å¤šè¿›ç¨‹
def cpu_intensive_task(data):
    return sum(x ** 2 for x in data)

def parallel_processing(data_chunks):
    with ProcessPoolExecutor() as executor:
        results = list(executor.map(cpu_intensive_task, data_chunks))
    return sum(results)

# âœ… I/Oå¯†é›†å‹ä»»åŠ¡ä½¿ç”¨å¼‚æ­¥
import asyncio
import aiohttp

async def fetch_url(url):
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            return await response.text()

async def fetch_multiple_urls(urls):
    tasks = [fetch_url(url) for url in urls]
    return await asyncio.gather(*tasks)
```

**4. ç¼“å­˜å’Œè®°å¿†åŒ–**ï¼š
```python
from functools import lru_cache
import functools

# âœ… ä½¿ç”¨lru_cache
@lru_cache(maxsize=128)
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# âœ… è‡ªå®šä¹‰ç¼“å­˜
class SimpleCache:
    def __init__(self, maxsize=100):
        self.cache = {}
        self.maxsize = maxsize

    def get(self, key):
        return self.cache.get(key)

    def set(self, key, value):
        if len(self.cache) >= self.maxsize:
            self.cache.clear()
        self.cache[key] = value

cache = SimpleCache()

def expensive_operation(x):
    cached_result = cache.get(x)
    if cached_result is not None:
        return cached_result

    result = complex_calculation(x)
    cache.set(x, result)
    return result
```

**5. ä½¿ç”¨Cæ‰©å±•**ï¼š
```python
# âœ… å¯¹äºæ€§èƒ½å…³é”®éƒ¨åˆ†ï¼Œè€ƒè™‘ä½¿ç”¨Cythonæˆ–Cæ‰©å±•
# æˆ–è€…ä½¿ç”¨å·²æœ‰çš„é«˜æ€§èƒ½åº“å¦‚numpyã€pandasã€scipyç­‰

import numpy as np

# numpyçš„å®ç°æ¯”çº¯Pythonå¿«å¾ˆå¤šå€
def fast_vector_operation(arr1, arr2):
    return np.dot(arr1, arr2)  # ä½¿ç”¨ä¼˜åŒ–çš„BLASåº“
```

**æ€§èƒ½ç›‘æ§å·¥å…·**ï¼š
```python
import time
import tracemalloc
from contextlib import contextmanager

@contextmanager
def performance_monitor():
    """æ€§èƒ½ç›‘æ§ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
    # å¼€å§‹å†…å­˜è·Ÿè¸ª
    tracemalloc.start()
    start_time = time.time()

    try:
        yield
    finally:
        # ç»“æŸè®¡æ—¶
        end_time = time.time()
        current, peak = tracemalloc.get_traced_memory()
        tracemalloc.stop()

        print(f"æ‰§è¡Œæ—¶é—´: {end_time - start_time:.4f}ç§’")
        print(f"å½“å‰å†…å­˜ä½¿ç”¨: {current / 1024 / 1024:.2f} MB")
        print(f"å³°å€¼å†…å­˜ä½¿ç”¨: {peak / 1024 / 1024:.2f} MB")

# ä½¿ç”¨ç¤ºä¾‹
with performance_monitor():
    # æ‰§è¡Œéœ€è¦ç›‘æ§çš„ä»£ç 
    result = some_expensive_operation()
```

## 12ã€æ€»ç»“ä¸å±•æœ›

### 12.1ã€Pythonä¸Javaçš„å„è‡ªä¼˜åŠ¿

#### aã€ğŸ”¸ Pythonçš„æ ¸å¿ƒä¼˜åŠ¿

```python
# 1. ç®€æ´ä¼˜é›…çš„è¯­æ³•
def calculate_total(items):
    return sum(item.price for item in items if item.available)

# 2. åŠ¨æ€ç±»å‹å¸¦æ¥çš„çµæ´»æ€§
data = {"name": "å¼ ä¸‰", "age": 30, "skills": ["Python", "Java"]}
data["email"] = "zhangsan@example.com"  # åŠ¨æ€æ·»åŠ å±æ€§

# 3. å¼ºå¤§çš„æ ‡å‡†åº“å’Œç”Ÿæ€
import pandas as pd
import requests
import numpy as np
import matplotlib.pyplot as plt

# ä¸€è¡Œä»£ç å®Œæˆå¤æ‚æ“ä½œ
df = pd.read_csv('data.csv').groupby('category').sum()
```

**ğŸ“Š Pythonä¼˜åŠ¿å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | Python | Java | é€‚ç”¨åœºæ™¯ |
|------|--------|------|----------|
| **å­¦ä¹ æ›²çº¿** | å¹³ç¼“ï¼Œè¯­æ³•ç®€æ´ | è¾ƒé™¡ï¼Œæ¦‚å¿µå¤æ‚ | å¿«é€Ÿå…¥é—¨ï¼ŒåŸå‹å¼€å‘ |
| **å¼€å‘æ•ˆç‡** | æé«˜ï¼Œä»£ç é‡å°‘ | ä¸­ç­‰ï¼Œéœ€è¦è¾ƒå¤šæ¨¡æ¿ä»£ç  | MVPå¼€å‘ï¼Œæ•°æ®åˆ†æ |
| **ç”Ÿæ€ä¸°å¯Œåº¦** | æ•°æ®ç§‘å­¦ã€AIé¢†åŸŸé¢†å…ˆ | ä¼ä¸šçº§åº”ç”¨ç”Ÿæ€å®Œå–„ | æœºå™¨å­¦ä¹ ï¼ŒWebå¼€å‘ |
| **æ€§èƒ½** | è§£é‡Šæ‰§è¡Œï¼Œç›¸å¯¹è¾ƒæ…¢ | JITç¼–è¯‘ï¼Œæ€§èƒ½ä¼˜ç§€ | å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯ |
| **éƒ¨ç½²** | ç®€å•ï¼Œæ— éœ€ç¼–è¯‘ | å¤æ‚ï¼Œéœ€è¦æ‰“åŒ…éƒ¨ç½² | å¿«é€Ÿè¿­ä»£ï¼Œäº‘åŸç”Ÿ |

#### bã€ğŸ”¸ Javaçš„æ ¸å¿ƒä¼˜åŠ¿

```java
// 1. å¼ºç±»å‹ç³»ç»Ÿï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
public class UserService {
    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) {
        this.userRepository = Objects.requireNonNull(userRepository);
    }

    // ç¼–è¯‘å™¨ä¼šæ£€æŸ¥ç±»å‹é”™è¯¯
    public User findUserById(Long userId) {
        return userRepository.findById(userId)
                .orElseThrow(() -> new UserNotFoundException(userId));
    }
}

// 2. é¢å‘å¯¹è±¡çš„å®Œå¤‡æ”¯æŒ
public abstract class Animal {
    protected String name;

    public abstract void makeSound();

    public void sleep() {
        System.out.println(name + " is sleeping");
    }
}

// 3. æˆç†Ÿçš„ä¼ä¸šçº§ç”Ÿæ€
@Service
@Transactional
public class OrderService {
    @Autowired
    private OrderRepository orderRepository;

    public Order createOrder(OrderRequest request) {
        // ä¼ä¸šçº§äº‹åŠ¡ç®¡ç†
        Order order = new Order(request);
        return orderRepository.save(order);
    }
}
```

**ğŸ¢ Javaåœ¨ä»¥ä¸‹åœºæ™¯ä¸­æ›´å…·ä¼˜åŠ¿ï¼š**

1. **å¤§å‹ä¼ä¸šçº§åº”ç”¨**ï¼šé“¶è¡Œã€ä¿é™©ã€ç”µä¿¡ç­‰æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ
2. **é«˜æ€§èƒ½è¦æ±‚**ï¼šäº¤æ˜“ç³»ç»Ÿã€å®æ—¶æ•°æ®å¤„ç†
3. **å›¢é˜Ÿåä½œå¼€å‘**ï¼šå¼ºç±»å‹çº¦æŸï¼Œä¾¿äºå¤§å‹å›¢é˜Ÿåä½œ
4. **é•¿æœŸç»´æŠ¤é¡¹ç›®**ï¼šç¨³å®šæ€§å¥½ï¼Œå‘åå…¼å®¹æ€§å¼º

### 12.2ã€ç»™Javaå¼€å‘è€…çš„Pythonå­¦ä¹ å¯„è¯­

ç»è¿‡å‰é¢ç³»ç»Ÿå­¦ä¹ ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹Pythonæœ‰äº†å…¨é¢çš„è®¤è¯†ã€‚ä½œä¸ºæœ‰JavaèƒŒæ™¯çš„å¼€å‘è€…ï¼Œä½ åœ¨å­¦ä¹ Pythonæ—¶å…·æœ‰ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼š

** ä½ çš„ä¼˜åŠ¿ï¼š**
1. **æ‰å®çš„ç¼–ç¨‹åŸºç¡€**ï¼šé¢å‘å¯¹è±¡æ€ç»´ã€è®¾è®¡æ¨¡å¼ã€ç®—æ³•æ•°æ®ç»“æ„
2. **å·¥ç¨‹åŒ–ç»éªŒ**ï¼šç‰ˆæœ¬æ§åˆ¶ã€æµ‹è¯•é©±åŠ¨ã€é¡¹ç›®ç®¡ç†
3. **ç³»ç»Ÿè®¾è®¡èƒ½åŠ›**ï¼šæ¶æ„æ€ç»´ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨è€ƒè™‘
4. **é—®é¢˜è§£å†³èƒ½åŠ›**ï¼šè°ƒè¯•æŠ€å·§ã€é”™è¯¯æ’æŸ¥ã€é€»è¾‘æ€ç»´

** å­¦ä¹ å»ºè®®ï¼š**
1. **ä¿æŒå¼€æ”¾å¿ƒæ€**ï¼šæ¥å—Pythonçš„åŠ¨æ€ç‰¹æ€§å’Œç®€æ´å“²å­¦
2. **åŠ¨æ‰‹å®è·µ**ï¼šå¤šå†™ä»£ç ï¼Œå¤šåšé¡¹ç›®ï¼Œåœ¨å®è·µä¸­æŒæ¡ç²¾é«“
3. **å¯¹æ¯”å­¦ä¹ **ï¼šå°†Pythonæ¦‚å¿µä¸Javaå¯¹æ¯”ï¼ŒåŠ æ·±ç†è§£
4. **å‚ä¸ç¤¾åŒº**ï¼šåŠ å…¥Pythonç¤¾åŒºï¼Œä¸å…¶ä»–å¼€å‘è€…äº¤æµç»éªŒ

** æœªæ¥å¯æœŸï¼š**
æŒæ¡Pythonå°†ä¸ºä½ æ‰“å¼€æ–°çš„å¤§é—¨ï¼š
- **æ•°æ®ç§‘å­¦ä¸AI**ï¼šè¿›å…¥äººå·¥æ™ºèƒ½é¢†åŸŸ
- **Webå¼€å‘**ï¼šå¿«é€Ÿæ„å»ºç°ä»£Webåº”ç”¨
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šæå‡å·¥ä½œæ•ˆç‡
- **å…¨æ ˆå¼€å‘**ï¼šå‰åç«¯é€šåƒï¼Œæˆä¸ºå¤åˆå‹äººæ‰

** æœ€åçš„è¯ï¼š**
ç¼–ç¨‹è¯­è¨€åªæ˜¯å·¥å…·ï¼Œè§£å†³é—®é¢˜çš„æ€ç»´å’Œèƒ½åŠ›æ‰æ˜¯æ ¸å¿ƒç«äº‰åŠ›ã€‚Javaç»™äº†ä½ åšå®çš„åŸºç¡€ï¼ŒPythonå°†ç»™ä½ æ’ä¸Šçµæ´»çš„ç¿…è†€ã€‚ä¿æŒå­¦ä¹ çš„çƒ­æƒ…ï¼Œæ‹¥æŠ±æŠ€æœ¯çš„å˜åŒ–ï¼Œä½ å°†åœ¨ç¼–ç¨‹çš„é“è·¯ä¸Šèµ°å¾—æ›´è¿œï¼


**ç¥ä½ å˜å¾—æ›´å¼º!**
