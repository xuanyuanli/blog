---
title: Claude Code 最佳实践（个人版）
date: 2025-08-11 10:00:00
permalink: /pages/claude-code-best-practices/
categories:
  - 架构
  - AI
tags:
  - Claude
  - AI编程
  - 开发工具
author:
  name: 技术博客
  link: https://github.com/
---

# 一、Code 最佳实践指南

Claude Code 是 Anthropic 的官方命令行工具，基本上改变了我写代码的方式。

用了一段时间后，踩了不少坑，也摸索出一些实用技巧，整理一下分享给大家。
<!-- more -->

## 1、📚 先看看官方文档

如果你刚接触 Claude Code，官方文档还是要看一下的：

- **官方文档**：[https://docs.anthropic.com/zh-CN/docs/claude-code/overview](https://docs.anthropic.com/zh-CN/docs/claude-code/overview)
- **GitHub 仓库**：[https://github.com/anthropics/claude-code](https://github.com/anthropics/claude-code)

文档里面安装配置这些基础内容都有，虽然有点长，但建议还是过一遍。

## 2、🚀 几个很实用的功能

### 2.1、CLAUDE.md 文件

CLAUDE.md 这个文件挺重要的，相当于给 Claude 写个说明书，让它了解你的项目：

```markdown
## 项目说明
这是个 React 项目，用了...

## 代码规范
- TypeScript 必须用
- ESLint 规则要遵守
- 组件写函数式的

## 注意事项
- API 调用记得加 try-catch
- 提交前跑一下测试
```

**我的经验**：
- 把项目架构和用了什么技术栈都写清楚
- 代码规范什么的也要写进去
- 有什么坑和限制也记得提一下

懒得手写的话，直接用`/init`命令生成一个模板。

#### 全局配置文件
使用`/memory`命令，选择User memory，可以编辑全局CLAUDE.md文件。

在这里配置全局的规则：
```markdown
* 默认使用中文回答。
* 没有特别说明时，假设需要完整方案。
* 遇到复杂问题，自动开启深度思考，并展示你的推理和思考过程，给出方案，而不要立刻执行。
* 遇到模糊问题，先反问用户。
* 当用户指示执行明显不合理的或违背最佳实践的操作时，给出警告，待用户二次确认后执行。
* 执行临时脚本之后，记得删除它。创建了错误目录或文件，请别忘记删除他们。不要出现`nul`文件（在Windows下有时你会生成它）。如果出现`nul`文件（Windows的保留字），记得删除它。
* properties 文件编码是ISO-8859-1，写入中文需要注意编码问题。
* 对于Java项目，总是使用最新的API（先查询当前java版本），比如HttpClient而非URLConnection。
```

### 2.2、Agent 子代理

子代理这个功能挺有意思，相当于给 Claude 找了几个专家助手，每个助手都有自己擅长的领域。

**怎么用**：
```bash
# 它自己选 - Claude 会根据任务自动找合适的助手
claude> 修复这些失败的测试

# 指定用谁 - 直接说用哪个助手
claude> 用代码审查助手检查一下安全性
```

**创建自定义子代理**：
在 `.claude/agents/` 目录下放个 Markdown 文件就行。

### 2.3、钩子（Hooks）

钩子是 Claude Code 提供的强大功能，可以在特定时机自动执行 shell 命令，让你更好地控制开发流程。

**配置方法**：
```bash
# 使用斜杠命令快速配置
/hooks
```

**钩子类型详解**：

| 钩子类型 | 触发时机 | 典型用途 |
|---------|---------|----------|
| `PreToolUse` | 工具调用前 | 代码格式化、权限检查（可阻止执行） |
| `PostToolUse` | 工具调用后 | 日志记录、文件备份 |
| `UserPromptSubmit` | 处理用户输入前 | 输入验证、预处理 |
| `Notification` | Claude 发送通知时 | 自定义通知方式 |
| `Stop` | Claude 完成响应后 | 自动测试、代码检查 |
| `SubagentStop` | 子代理任务完成后 | 任务跟踪、清理工作 |
| `PreCompact` | 压缩操作前 | 数据备份 |
| `SessionStart` | 会话开始时 | 环境初始化 |

**实用配置示例**：

```bash
# 代码提交前自动格式化
PreToolUse:Edit -> "prettier --write {filepath}"

# 工具调用后记录日志
PostToolUse:* -> "echo '$(date): 执行了工具 {tool}' >> .claude/logs/tool.log"

# 用户输入时检查代码规范
UserPromptSubmit -> "npm run lint"

# 完成任务后运行测试
Stop -> "npm test"
```

### 2.4、自定义斜杠命令

这个功能我经常用，把一些常用操作包装成命令，用起来很方便。

**怎么创建命令**：
项目根目录建个 `.claude/commands/` 文件夹，丢几个 Markdown 文件进去：

`.claude/commands/optimize.md`：
```markdown
# 性能优化

你是性能优化专家，分析代码后给出建议：
- 找出性能瓶颈
- 看看时间复杂度
- 内存使用怎么优化
- 给出具体改进方案
```

**用法**：
```bash
/optimize src/utils/calculator.js    # 优化这个文件
/doc utils/helper.js                 # 给这个文件写文档
/arch src/services/                  # 分析这个目录的架构
```

**我常用的几个命令**：

- `doc.md`: 快速生成文档，API 说明啥的
- `arch.md`: 分析代码架构，看看有哪些地方能改进
- `security.md`: 安全检查，找找有没有漏洞

### 2.5、MCP (Model Context Protocol)

MCP 可以让 Claude 连接外部数据源，比如：

- **文件系统访问**: 读取本地文件
- **数据库连接**: 查询数据库信息
- **API 集成**: 调用外部服务

**配置示例**：
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": [
        "@modelcontextprotocol/server-filesystem", 
        "/path/to/project"  // 换成你的项目路径
      ]
    }
  }
}
```

## 3、💡 一些实用小技巧

### 3.1、快捷键

- **ESC**: 取消输入，不想写了按这个
- **ESC + ESC**: 连按两下，出现历史对话。可上下选择对话，重新编辑并执行
- **Ctrl + L**: 清屏，对话记录还在，只是看着干净点
- **Ctrl + J**: 换行，多行输入时用

### 3.2、命令行选项

#### a、继续上次对话
接着上次的内容继续聊：
```bash
claude -c
```

#### b、查看历史对话
看看之前聊了什么：
```bash
claude -r
```

#### c、随时插话
Claude 在干活的时候，你不用等它完成，随时可以发消息给它。

### 3.3、进阶用法

#### a、同时处理多个任务
开几个终端窗口，可以让 Claude 同时干好几件事：

```bash
# 开几个终端，让 Claude 同时干活
claude "找找性能瓶颈"
claude "检查安全问题"
claude "写 API 文档"
```

#### b、计划模式
按 `Alt + M` 进入计划模式，Claude 会先列个计划再开始干活，适合复杂任务。

#### c、思考模式

虽然 Claude Code 没有专门的思考模式快捷键，但可以通过特定的提示词来触发深度思考：

**方法一：明确要求思考过程**
```
请先分析这个问题，思考一下：
1. 问题的本质是什么
2. 有哪些可能的解决方案
3. 每种方案的优缺点
4. 推荐哪种方案，为什么

然后再开始实现。
```

**方法二：分步骤引导**
```
我遇到个复杂问题，你先别急着写代码，帮我：
- 理解一下需求的核心
- 分析可能的技术难点  
- 设计大致的实现思路
- 确认没问题后再动手
```

**方法三：角色扮演**
```
你现在是个资深架构师，遇到这个问题你会怎么思考？
先告诉我你的分析过程，再给出解决方案。
```

**效果**：这样 Claude 会先进行系统性思考，输出更有逻辑的方案。

#### d、发送图片
你可以直接复制截图或复制图片路径发给Claude Code，他会理解图片内容并回答你的问题。

## 4、🧠 怎么更好地和 Claude Code 协作

看了 [AI战略家](https://mp.weixin.qq.com/s/3nFF3YZpgzlMOGKvjsxt6Q?scene=1) 这篇文章后，我对怎么用好 Claude Code 有了些新想法。

### 4.1、把 Claude 当作思维伙伴

#### a、**别只让它写代码**
我现在用 Claude Code 不只是生成代码，更多是把它当作参谋：

- **全局思考**: 遇到复杂问题，让它先分析整体架构
- **方案对比**: 不确定用哪种方案时，让它列出各种选项的优缺点
- **知识梳理**: 学新技术时，让它帮忙梳理成体系

**举个例子**：
```
我要做个电商系统的订单模块，你从架构师角度帮我看看：
1. 订单处理有哪些坑需要注意
2. 数据库表怎么设计比较合理
3. 高并发怎么处理，数据一致性怎么保证
4. 以后好扩展的话该怎么设计
```

#### b、**分工明确**

我现在的做法是这样分工的：

- **大方向**: 我来定目标，Claude 来分析可行性
- **具体路径**: 我决定怎么做，Claude 帮忙实现
- **繁琐事务**: Claude 去处理重复性工作，我做创造性的部分

#### c、**边用边学**

每次和 Claude 协作都能学到点东西：

- **积累经验**: 好用的做法都写到 CLAUDE.md 里
- **发现问题**: 让它帮忙找代码里的坏味道和重复代码
- **提升技能**: 看它的代码建议，学习新思路

### 4.2、提高效率的小窍门

#### a、**给Claude分配角色**

不同场景让它扮演不同角色，效果会好很多：

**当架构师**：
```
你是个资深架构师，微服务、分布式都很熟。
现在的问题是：[具体问题]
帮我分析一下：
- 问题出在哪
- 有哪些解决方案
- 长远看该怎么做
```

**当老师**：
```
你是个有经验的技术导师，会用简单的话解释复杂的东西。
这段代码我看不太懂：
- 为什么要这么写
- 用了什么设计模式
- 能不能写得更好
```

#### b、**管理好上下文**

让 Claude 更好地理解你的需求：

1. **项目信息**: CLAUDE.md 写详细点
2. **对话记录**: 长对话时偶尔总结一下要点
3. **外部资料**: 用 MCP 连接文档和代码库

### 4.3、AI 时代需要的新技能

我觉得现在做开发，重要的技能已经变了：

**以前重要的** → **现在更重要的**
- 记语法 → 会描述问题
- 背 API → 懂架构设计
- 会调试 → 会和 AI 沟通
- 写文档 → 管理知识库

### 4.4、几个常见的坑

**别这样做**：
- ❌ 完全依赖 Claude，自己不思考
- ❌ 只用来生成简单代码
- ❌ Claude 说啥就是啥，不验证
- ❌ 不给背景信息，让它盲猜

**应该这样**：
- ✅ 各取所长，人机配合
- ✅ 复杂问题让它帮忙分析
- ✅ 它的建议要过脑子
- ✅ 不断改进协作方式

## 5、🛠️ 遇到问题怎么办

### 5.1、网络连不上

**问题**: 国内或者公司网络可能连不上 Claude Code。

**解决**: 配置文件里加上代理：

```json
{
  "env": {
    "HTTP_PROXY": "http://127.0.0.1:10808",  // 你的代理地址
    "NO_PROXY": "localhost,127.0.0.1"        // 不走代理的地址
  }
}
```

### 5.2、MCP 不生效

**问题**: 项目里配置的 MCP 不起作用。

**解决**: 全局配置里加一行：

```json
{
  "enableAllProjectMcpServers": true
}
```

### 5.3、权限不够

**问题**: Claude Code 读不了文件或执行不了命令。

**解决**:
1. 检查文件权限
2. Mac 上去“安全性与隐私”里授权
3. 公司电脑可能有安全策略，要找 IT 部门

### 5.4、速度太慢

**问题**: 项目大了 Claude Code 反应很慢。

**解决**:
用 `.claudeignore` 排除不需要的文件：
```
node_modules/   # 依赖包不用看
dist/          # 打包文件也不用
build/         # 构建文件同样
*.log          # 日志文件没必要
.git/          # git 目录忽略
```

### 5.5、怎么买账号
有国外信用卡的话，直接官网买。

没有的话，淘宝上也有，共享版就够用，一般用不完额度。

## 6、🚀 总结

Claude Code 确实改变了我写代码的方式，节省了很多时间。这些经验对我很有用，希望对你也有帮助。

AI 编程还在发展，未来肯定会更强大。现在学会和 AI 协作，就是在为未来做准备。一起努力吧！

**祝你变得更强！**
