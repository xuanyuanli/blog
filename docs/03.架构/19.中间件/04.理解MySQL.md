---
title: ç†è§£MySQL
date: 2022-08-09 13:48:38
permalink: /pages/cb1b53/
categories: 
  - æ¶æ„
  - ä¸­é—´ä»¶
tags: 
  - MySQL
author: 
  name: è½©è¾•æ
  link: https://github.com/xuanyuanli
---

## ä¸€ã€å¼•è¨€


`MySQL`æ˜¯ä¸€ç§å¼€æºçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆ`RDBMS`ï¼‰ï¼Œæœ€åˆç”±ç‘å…¸`MySQL AB`å…¬å¸å¼€å‘ï¼Œåè¢«ç”²éª¨æ–‡ï¼ˆ`Oracle`ï¼‰å…¬å¸æ”¶è´­ã€‚

ä½œä¸ºä¸€ç§åŸºäº`SQL`ï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œ`MySQL`åœ¨è®¸å¤šåº”ç”¨ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œå¦‚ç½‘ç«™åç«¯ã€ç”µå­å•†åŠ¡ã€æ•°æ®ä»“åº“å’Œä¼ä¸šä¿¡æ¯ç³»ç»Ÿç­‰ã€‚å®ƒä»¥é«˜æ€§èƒ½ã€ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§è‘—ç§°ï¼Œæ˜¯å½“ä»Šæœ€å—æ¬¢è¿çš„å…³ç³»å‹æ•°æ®åº“ä¹‹ä¸€ã€‚

<!-- more -->
éšç€äº’è”ç½‘å’Œå¤§æ•°æ®æ—¶ä»£çš„åˆ°æ¥ï¼Œæ•°æ®ç®¡ç†å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚`MySQL`ä½œä¸ºä¸€ç§é«˜æ•ˆä¸”ç¨³å®šçš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

- **å¼€æº**ï¼š`MySQL`éµå¾ª`GPL`åè®®ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨ï¼Œè¿™ä½¿å¾—è®¸å¤šå¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°å­¦ä¹ å’Œä½¿ç”¨å®ƒï¼Œæ¨åŠ¨äº†å¼€æºç¤¾åŒºçš„å‘å±•ã€‚
- **é«˜æ€§èƒ½**ï¼š`MySQL`é‡‡ç”¨å¤šå±‚æ¶æ„è®¾è®¡ï¼Œå¯ä»¥æ”¯æŒå¤§é‡å¹¶å‘è¿æ¥å’Œé«˜é€Ÿæ•°æ®å¤„ç†ï¼Œæ»¡è¶³ç°ä»£åº”ç”¨çš„æ€§èƒ½è¦æ±‚ã€‚
- **æ˜“ç”¨æ€§**ï¼š`MySQL`æä¾›äº†ä¸°å¯Œçš„å·¥å…·å’Œèµ„æºï¼Œä½¿å¾—æ•°æ®åº“ç®¡ç†å˜å¾—ç®€å•é«˜æ•ˆã€‚åŒæ—¶ï¼Œå®ƒçš„è¯­æ³•ç®€æ´æ˜“æ‡‚ï¼Œä¾¿äºå­¦ä¹ å’Œä½¿ç”¨ã€‚
- **ç¨³å®šæ€§**ï¼šç»è¿‡å¤šå¹´çš„å‘å±•ï¼Œ`MySQL`å·²ç»å…·å¤‡äº†è¶³å¤Ÿçš„ç¨³å®šæ€§ï¼Œå¯ä»¥åº”å¯¹å„ç§å¤æ‚çš„åº”ç”¨åœºæ™¯å’Œç”Ÿäº§ç¯å¢ƒã€‚
- **ç¤¾åŒºæ”¯æŒ**ï¼š`MySQL`æœ‰ä¸€ä¸ªåºå¤§çš„å¼€å‘è€…ç¤¾åŒºï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸°å¯Œçš„èµ„æºã€æ’ä»¶å’Œç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæ–¹ä¾¿ç”¨æˆ·è§£å†³é—®é¢˜å’Œæ‹“å±•åŠŸèƒ½ã€‚

åŸºäºä»¥ä¸Šä¼˜ç‚¹ï¼Œ`MySQL`åœ¨è®¸å¤šé¢†åŸŸéƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œå¦‚ï¼š

- **ç½‘ç«™åç«¯**ï¼šä½œä¸ºç½‘ç«™æ•°æ®å­˜å‚¨å’Œç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ï¼Œ`MySQL`ä¸ºå„ç§è§„æ¨¡çš„ç½‘ç«™æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚
- **ç”µå­å•†åŠ¡**ï¼šç”µå­å•†åŠ¡å¹³å°éœ€è¦å¤„ç†å¤§é‡çš„äº¤æ˜“ã€åº“å­˜å’Œå®¢æˆ·æ•°æ®ï¼Œ`MySQL`å¯ä»¥é«˜æ•ˆåœ°æ”¯æŒè¿™äº›æ“ä½œã€‚
- **æ•°æ®ä»“åº“**ï¼š`MySQL`å¯ä»¥ä½œä¸ºæ•°æ®ä»“åº“ï¼Œå­˜å‚¨å’Œåˆ†æä¼ä¸šçš„å¤§é‡æ•°æ®ï¼Œå¸®åŠ©ä¼ä¸šåšå‡ºæ•°æ®é©±åŠ¨çš„å†³ç­–ã€‚
- **ä¼ä¸šä¿¡æ¯ç³»ç»Ÿ**ï¼šä½œä¸ºä¼ä¸šä¿¡æ¯ç³»ç»Ÿçš„åŸºç¡€è®¾æ–½ï¼Œ`MySQL`å¯ä»¥å¤„ç†å„ç§ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚è´¢åŠ¡ã€äººåŠ›èµ„æºå’Œä¾›åº”é“¾ç®¡ç†ç­‰ã€‚


æœ¬æ–‡æ—¨åœ¨å¸®åŠ©è¯»è€…å…¨é¢äº†è§£`MySQL`ï¼ˆ`8.0.33`ç‰ˆæœ¬ï¼‰çš„åŸºæœ¬æ¦‚å¿µã€åŠŸèƒ½å’Œåº”ç”¨åœºæ™¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä½¿ç”¨è¿™ä¸€å¼ºå¤§çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚

## äºŒã€MySQLåŸºç¡€çŸ¥è¯†

### 1ã€å…³ç³»å‹æ•°æ®åº“ä¸éå…³ç³»å‹æ•°æ®åº“

**å…³ç³»å‹æ•°æ®åº“ï¼ˆRelational Databaseï¼‰**åŸºäºå…³ç³»æ¨¡å‹ï¼Œä½¿ç”¨äºŒç»´è¡¨ç»“æ„ï¼ˆè¡¨ï¼‰æ¥å­˜å‚¨æ•°æ®ã€‚å…³ç³»å‹æ•°æ®åº“çš„ä¸»è¦ç‰¹ç‚¹æ˜¯æ•°æ®é—´çš„å…³ç³»é€šè¿‡è¡¨ä¹‹é—´çš„å…³è”æ¥è¡¨ç¤ºï¼Œæ”¯æŒå¤æ‚çš„`SQL`æŸ¥è¯¢ã€‚å…¸å‹çš„å…³ç³»å‹æ•°æ®åº“æœ‰`MySQL`ã€`Oracle`ã€`SQL Server`ç­‰ã€‚

**éå…³ç³»å‹æ•°æ®åº“ï¼ˆNoSQLï¼ŒNot Only SQLï¼‰**ä¸å®Œå…¨ä¾èµ–å…³ç³»æ¨¡å‹ï¼Œä¸»è¦ç”¨äºè§£å†³å…³ç³»å‹æ•°æ®åº“åœ¨å¤§æ•°æ®å’Œé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ç“¶é¢ˆã€‚éå…³ç³»å‹æ•°æ®åº“çš„ç±»å‹æœ‰ï¼š
- **é”®å€¼å­˜å‚¨**ï¼ˆå¦‚`Redis`ï¼‰
- **æ–‡æ¡£å­˜å‚¨**ï¼ˆå¦‚`MongoDB`ï¼‰
- **åˆ—å¼å­˜å‚¨**ï¼ˆå¦‚`Cassandra`ï¼‰
- **å›¾å½¢æ•°æ®åº“**ï¼ˆå¦‚`Neo4j`ï¼‰ç­‰ã€‚

### 2ã€MySQLä¸å…¶ä»–å…³ç³»å‹æ•°æ®åº“çš„æ¯”è¾ƒ

| æ•°æ®åº“ | ç±»å‹ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|--------|------|------|------|
| `Oracle` | å•†ä¸š | å¼ºå¤§åŠŸèƒ½ã€é«˜æ€§èƒ½ã€ç¨³å®šæ€§ | è®¸å¯è´¹é«˜ã€å¤æ‚åº¦é«˜ |
| `SQL Server` | å•†ä¸š | ä¸å¾®è½¯äº§å“å…¼å®¹ã€ä¼ä¸šçº§åŠŸèƒ½ | Windowså¹³å°ç»‘å®šã€è®¸å¯è´¹ç”¨ |
| `PostgreSQL` | å¼€æº | ä¸°å¯ŒåŠŸèƒ½ã€`SQL`æ ‡å‡†å…¼å®¹ã€æ‰©å±•æ€§å¼º | å­¦ä¹ æ›²çº¿é™¡å³­ã€æ€§èƒ½è°ƒä¼˜å¤æ‚ |
| `MySQL` | å¼€æº | å¼€æºå…è´¹ã€æ˜“ç”¨ã€ç¤¾åŒºèµ„æºä¸°å¯Œ | æŸäº›é«˜çº§åŠŸèƒ½ç›¸å¯¹è¾ƒå°‘ |

**è¯¦ç»†å¯¹æ¯”ï¼š**

- **`Oracle`**ï¼š`Oracle`æ•°æ®åº“æ˜¯ä¸€ç§å•†ä¸šå…³ç³»å‹æ•°æ®åº“ï¼Œå…·æœ‰å¼ºå¤§çš„åŠŸèƒ½ã€é«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä½†æ˜¯ï¼Œ`Oracle`çš„è®¸å¯è´¹è¾ƒé«˜ï¼Œå¯¹äºä¸­å°å‹ä¼ä¸šæ¥è¯´å¯èƒ½æˆæœ¬è¾ƒå¤§ã€‚
- **`SQL Server`**ï¼š`SQL Server`æ˜¯å¾®è½¯æ¨å‡ºçš„å…³ç³»å‹æ•°æ®åº“ï¼Œä¸å…¶å®ƒå¾®è½¯äº§å“æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§ã€‚`SQL Server`åœ¨æ€§èƒ½å’ŒåŠŸèƒ½ä¸Šä¸`Oracle`ç±»ä¼¼ï¼Œä½†è®¸å¯è´¹è¾ƒä½ã€‚
- **`PostgreSQL`**ï¼š`PostgreSQL`æ˜¯ä¸€ç§å¼€æºå…³ç³»å‹æ•°æ®åº“ï¼Œå…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½å’Œé«˜åº¦å¯æ‰©å±•æ€§ã€‚ç›¸è¾ƒäº`MySQL`ï¼Œ`PostgreSQL`æ”¯æŒæ›´å¤šçš„`SQL`æ ‡å‡†å’Œé«˜çº§åŠŸèƒ½ï¼Œå¦‚ç‰©åŒ–è§†å›¾å’Œå­˜å‚¨è¿‡ç¨‹ç­‰ã€‚
- **`MySQL`**ï¼š`MySQL`æ˜¯ä¸€ç§å¼€æºå…³ç³»å‹æ•°æ®åº“ï¼Œå…·æœ‰è¾ƒå¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä¸å…¶ä»–å…³ç³»å‹æ•°æ®åº“ç›¸æ¯”ï¼Œ`MySQL`çš„ä¼˜åŠ¿åœ¨äºå…¶å¼€æºã€å…è´¹ã€æ˜“ç”¨å’Œæœ‰ä¸°å¯Œçš„ç¤¾åŒºèµ„æºã€‚

### 3ã€MySQLçš„æ•°æ®ç±»å‹åŠå¸¸ç”¨åœºæ™¯

`MySQL`æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œè¿™äº›æ•°æ®ç±»å‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

#### 3.1ã€æ•°å€¼ç±»å‹ï¼ˆNumeric Typesï¼‰

| ç±»å‹ | å­—èŠ‚ | æœ‰ç¬¦å·èŒƒå›´ | æ— ç¬¦å·èŒƒå›´ | å¸¸ç”¨åœºæ™¯ |
|------|------|------------|------------|----------|
| `TINYINT` | 1 | -128 ~ 127 | 0 ~ 255 | å¼€å…³çŠ¶æ€ã€çŠ¶æ€ç  |
| `SMALLINT` | 2 | -32,768 ~ 32,767 | 0 ~ 65,535 | å¹´é¾„ã€èº«é«˜ |
| `MEDIUMINT` | 3 | -8,388,608 ~ 8,388,607 | 0 ~ 16,777,215 | IPåœ°å€è½¬æ¢ |
| `INT` | 4 | -2,147,483,648 ~ 2,147,483,647 | 0 ~ 4,294,967,295 | ç”¨æˆ·IDã€è®¢å•å· |
| `BIGINT` | 8 | -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807 | 0 ~ 18,446,744,073,709,551,615 | å…¨çƒå”¯ä¸€ID |

**æµ®ç‚¹æ•°ç±»å‹ï¼š**
- **`FLOAT`**ï¼š4å­—èŠ‚ï¼Œå•ç²¾åº¦æµ®ç‚¹æ•°ï¼ŒèŒƒå›´çº¦ä¸º Â±3.4 Ã— 10^38ï¼Œç²¾åº¦çº¦7ä½å°æ•°ã€‚ç”¨äºå­˜å‚¨ä»·æ ¼ã€æ¸©åº¦ç­‰å¯¹ç²¾åº¦è¦æ±‚ä¸é«˜çš„æ•°æ®ã€‚
- **`DOUBLE`**ï¼š8å­—èŠ‚ï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ï¼ŒèŒƒå›´çº¦ä¸º Â±1.8 Ã— 10^308ï¼Œç²¾åº¦çº¦15ä½å°æ•°ã€‚ç”¨äºå­˜å‚¨ç»çº¬åº¦ã€ç§‘å­¦è®¡ç®—ç»“æœç­‰éœ€è¦æ›´é«˜ç²¾åº¦çš„æ•°æ®ã€‚
- **`DECIMAL`**ï¼šå˜é•¿ï¼ˆ5-17å­—èŠ‚ï¼‰ï¼Œä»»æ„ç²¾åº¦åè¿›åˆ¶æ•°ã€‚ç”¨äºè´¢åŠ¡ã€é‡‘èç­‰éœ€è¦ç²¾ç¡®è®¡ç®—çš„åœºæ™¯ã€‚

**ç¤ºä¾‹ï¼š**
```sql
CREATE TABLE example_numeric (
    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    status TINYINT DEFAULT 0,
    age SMALLINT UNSIGNED,
    price DECIMAL(10,2),
    latitude DOUBLE,
    longitude DOUBLE
);
```

#### 3.2ã€å­—ç¬¦ä¸²ç±»å‹ï¼ˆString Typesï¼‰

**æ–‡æœ¬ç±»å‹ï¼š**

| ç±»å‹ | æœ€å¤§é•¿åº¦ | å­˜å‚¨ç©ºé—´ | å¸¸ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| `CHAR(M)` | 255å­—ç¬¦ | Må­—èŠ‚ï¼ˆå®šé•¿ï¼‰ | å›½å®¶ä»£ç ã€çŠ¶æ€ç  |
| `VARCHAR(M)` | 65,535å­—ç¬¦ | å®é™…é•¿åº¦ + 1-2å­—èŠ‚ | ç”¨æˆ·åã€åœ°å€ã€æ ‡é¢˜ |
| `TINYTEXT` | 255å­—ç¬¦ | å®é™…é•¿åº¦ + 1å­—èŠ‚ | çŸ­æ¶ˆæ¯ã€è¯„è®º |
| `TEXT` | 65,535å­—ç¬¦ | å®é™…é•¿åº¦ + 2å­—èŠ‚ | æ–‡ç« å†…å®¹ã€é‚®ä»¶ |
| `MEDIUMTEXT` | 16,777,215å­—ç¬¦ | å®é™…é•¿åº¦ + 3å­—èŠ‚ | é•¿æ–‡æ¡£ã€æŠ¥å‘Š |
| `LONGTEXT` | 4GB | å®é™…é•¿åº¦ + 4å­—èŠ‚ | é•¿ç¯‡å°è¯´ã€ç”µå­ä¹¦ |

**äºŒè¿›åˆ¶ç±»å‹ï¼š**

| ç±»å‹ | æœ€å¤§é•¿åº¦ | å­˜å‚¨ç©ºé—´ | å¸¸ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| `BINARY(M)` | 255å­—èŠ‚ | Må­—èŠ‚ï¼ˆå®šé•¿ï¼‰ | å®šé•¿äºŒè¿›åˆ¶æ•°æ® |
| `VARBINARY(M)` | 65,535å­—èŠ‚ | å®é™…é•¿åº¦ + 1-2å­—èŠ‚ | å˜é•¿äºŒè¿›åˆ¶æ•°æ® |
| `TINYBLOB` | 255å­—èŠ‚ | å®é™…é•¿åº¦ + 1å­—èŠ‚ | å°å‹æ–‡ä»¶ |
| `BLOB` | 65,535å­—èŠ‚ | å®é™…é•¿åº¦ + 2å­—èŠ‚ | å›¾ç‰‡ã€éŸ³é¢‘ |
| `MEDIUMBLOB` | 16MB | å®é™…é•¿åº¦ + 3å­—èŠ‚ | è§†é¢‘æ–‡ä»¶ |
| `LONGBLOB` | 4GB | å®é™…é•¿åº¦ + 4å­—èŠ‚ | å¤§å‹åª’ä½“æ–‡ä»¶ |

**ç‰¹æ®Šç±»å‹ï¼š**
- **`ENUM`**ï¼šæšä¸¾ç±»å‹ï¼Œç”¨äºå­˜å‚¨é¢„å®šä¹‰å€¼é›†åˆä¸­çš„ä¸€ä¸ªå€¼
- **`SET`**ï¼šé›†åˆç±»å‹ï¼Œç”¨äºå­˜å‚¨é¢„å®šä¹‰å€¼é›†åˆä¸­çš„å¤šä¸ªå€¼

**ç¤ºä¾‹ï¼š**
```sql
CREATE TABLE example_string (
    id INT PRIMARY KEY,
    country_code CHAR(2),
    username VARCHAR(50),
    description TEXT,
    avatar BLOB,
    gender ENUM('M', 'F', 'Other'),
    hobbies SET('reading', 'sports', 'music', 'travel')
);
```

**é‡è¦æç¤ºï¼š**
- `CHAR` vs `VARCHAR`ï¼š`CHAR`é€‚ç”¨äºå®šé•¿æ•°æ®ï¼Œ`VARCHAR`é€‚ç”¨äºå˜é•¿æ•°æ®
- `TEXT` vs `VARCHAR`ï¼šè¶…è¿‡255å­—ç¬¦å»ºè®®ä½¿ç”¨`TEXT`ç±»å‹
- `BLOB`ç±»å‹ä¸å»ºè®®å­˜å‚¨å¤§æ–‡ä»¶ï¼Œå»ºè®®å­˜å‚¨æ–‡ä»¶è·¯å¾„

#### 3.3ã€æ—¥æœŸæ—¶é—´ç±»å‹ï¼ˆDate and Time Typesï¼‰

| ç±»å‹ | æ ¼å¼ | èŒƒå›´ | é›¶å€¼ | å¸¸ç”¨åœºæ™¯ |
|------|------|------|------|----------|
| `DATE` | YYYY-MM-DD | 1000-01-01 ~ 9999-12-31 | 0000-00-00 | å‡ºç”Ÿæ—¥æœŸã€åˆ›å»ºæ—¥æœŸ |
| `TIME` | HH:MM:SS | -838:59:59 ~ 838:59:59 | 00:00:00 | æŒç»­æ—¶é—´ã€è¥ä¸šæ—¶é—´ |
| `YEAR` | YYYY | 1901 ~ 2155 | 0000 | æ¯•ä¸šå¹´ä»½ |
| `DATETIME` | YYYY-MM-DD HH:MM:SS | 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59 | 0000-00-00 00:00:00 | æ—¥ç¨‹å®‰æ’ã€æ—¥å¿—æ—¶é—´ |
| `TIMESTAMP` | YYYY-MM-DD HH:MM:SS | 1970-01-01 00:00:01 ~ 2038-01-19 03:14:07 | 0000-00-00 00:00:00 | è®°å½•ä¿®æ”¹æ—¶é—´ |

**é‡è¦åŒºåˆ«ï¼š**
- **`DATETIME` vs `TIMESTAMP`**ï¼š
  - `DATETIME`ï¼šä¸å—æ—¶åŒºå½±å“ï¼Œå­˜å‚¨ä»€ä¹ˆå€¼å°±æ˜¯ä»€ä¹ˆå€¼
  - `TIMESTAMP`ï¼šå—æ—¶åŒºå½±å“ï¼Œä¼šæ ¹æ®æœåŠ¡å™¨æ—¶åŒºè‡ªåŠ¨è½¬æ¢
  - `TIMESTAMP`ï¼šæ”¯æŒè‡ªåŠ¨æ›´æ–°ï¼ˆ`ON UPDATE CURRENT_TIMESTAMP`ï¼‰

**ç¤ºä¾‹ï¼š**
```sql
CREATE TABLE example_datetime (
    id INT PRIMARY KEY,
    birthday DATE,
    work_time TIME,
    graduation_year YEAR,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- æ’å…¥ç¤ºä¾‹æ•°æ®
INSERT INTO example_datetime (birthday, work_time, graduation_year) 
VALUES ('1990-05-15', '08:30:00', 2012);
```

#### 3.4ã€JSONç±»å‹ï¼ˆMySQL 5.7+ï¼‰

**`JSON`**ï¼šç”¨äºå­˜å‚¨`JSON`æ ¼å¼çš„æ•°æ®ï¼Œå¦‚`JSON`å¯¹è±¡å’Œ`JSON`æ•°ç»„ã€‚é€‚ç”¨äºåŠç»“æ„åŒ–æ•°æ®ï¼Œå¦‚ç”¨æˆ·é…ç½®ã€è®¾å¤‡ä¿¡æ¯ã€å•†å“å±æ€§ç­‰ã€‚

**JSONè·¯å¾„è¡¨è¾¾å¼ï¼š**
- `$`ï¼šæ ¹å…ƒç´ 
- `$.field`ï¼šè®¿é—®å¯¹è±¡å­—æ®µ
- `$[index]`ï¼šè®¿é—®æ•°ç»„å…ƒç´ 
- `$[*]`ï¼šè®¿é—®æ‰€æœ‰æ•°ç»„å…ƒç´ 
- `$**.field`ï¼šé€’å½’æœç´¢å­—æ®µ

**JSONæ“ä½œç¬¦ï¼š**
- `->` ï¼šæå–JSONå€¼ï¼ˆä¿æŒJSONæ ¼å¼ï¼‰
- `->>` ï¼šæå–JSONå€¼å¹¶è½¬ä¸ºå­—ç¬¦ä¸²
- `JSON_EXTRACT()`ï¼šæå–JSONå€¼
- `JSON_SET()`ï¼šè®¾ç½®JSONå€¼
- `JSON_INSERT()`ï¼šæ’å…¥JSONå€¼
- `JSON_REPLACE()`ï¼šæ›¿æ¢JSONå€¼

**ç¤ºä¾‹ï¼š**
```sql
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    attributes JSON
);

-- æ’å…¥JSONæ•°æ®
INSERT INTO products VALUES 
(1, 'iPhone 14', '{"color": "blue", "storage": "128GB", "features": ["5G", "Face ID"]}'),
(2, 'MacBook Pro', '{"color": "silver", "memory": "16GB", "screen": 14}');

-- æŸ¥è¯¢JSONæ•°æ®
SELECT id, name, 
       attributes->'$.color' AS color,
       attributes->>'$.storage' AS storage,
       JSON_EXTRACT(attributes, '$.features[0]') AS first_feature
FROM products;

-- æ›´æ–°JSONæ•°æ®
UPDATE products 
SET attributes = JSON_SET(attributes, '$.price', 999) 
WHERE id = 1;
```

**JSONæ•°æ®ç±»å‹ï¼š**
- `NULL`ã€`BOOLEAN`ã€`INTEGER`ã€`DOUBLE`ã€`STRING`
- `ARRAY`ã€`OBJECT`ã€`DATE`ã€`TIME`ã€`DATETIME`ç­‰

#### 3.5ã€å…¶ä»–é‡è¦ç±»å‹

**UUIDç±»å‹ï¼ˆMySQL 8.0+ï¼‰ï¼š**
- **`UUID`**ï¼š128ä½å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å”¯ä¸€æ ‡è¯†

**ä½ç±»å‹ï¼š**
- **`BIT(M)`**ï¼šå­˜å‚¨1-64ä½çš„ä½æ•°æ®ï¼Œç”¨äºæ ‡å¿—ä½ã€æƒé™æ§åˆ¶ç­‰

**ç©ºé—´æ•°æ®ç±»å‹ï¼š**

| ç±»å‹ | æè¿° | ç”¨é€” |
|------|------|------|
| `GEOMETRY` | é€šç”¨å‡ ä½•ç±»å‹ | å­˜å‚¨å„ç§å‡ ä½•å½¢çŠ¶ |
| `POINT` | ç‚¹ | å­˜å‚¨åæ ‡ä½ç½® |
| `LINESTRING` | çº¿ | å­˜å‚¨è·¯å¾„ã€è¾¹ç•Œ |
| `POLYGON` | å¤šè¾¹å½¢ | å­˜å‚¨åŒºåŸŸã€èŒƒå›´ |
| `MULTIPOINT` | å¤šç‚¹é›†åˆ | å­˜å‚¨å¤šä¸ªä½ç½®ç‚¹ |
| `MULTILINESTRING` | å¤šçº¿é›†åˆ | å­˜å‚¨å¤æ‚è·¯å¾„ |
| `MULTIPOLYGON` | å¤šå¤šè¾¹å½¢é›†åˆ | å­˜å‚¨å¤æ‚åŒºåŸŸ |

**ç¤ºä¾‹ï¼š**
```sql
-- UUIDä½¿ç”¨ç¤ºä¾‹
CREATE TABLE users (
    id BINARY(16) PRIMARY KEY,  -- å­˜å‚¨UUID
    username VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ’å…¥UUID
INSERT INTO users (id, username) 
VALUES (UUID_TO_BIN(UUID()), 'john_doe');

-- æŸ¥è¯¢UUID
SELECT BIN_TO_UUID(id) as user_id, username 
FROM users;

-- ç©ºé—´æ•°æ®ç¤ºä¾‹
CREATE TABLE locations (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    position POINT
);

-- æ’å…¥åœ°ç†ä½ç½®
INSERT INTO locations (id, name, position) 
VALUES (1, 'åŒ—äº¬', POINT(116.4074, 39.9042));

-- æŸ¥è¯¢åœ°ç†ä½ç½®
SELECT name, ST_X(position) as longitude, ST_Y(position) as latitude 
FROM locations;
```

### 4ã€MySQLå­—ç¬¦é›†

å­—ç¬¦é›†å®šä¹‰äº†å¯ä»¥åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨çš„å­—ç¬¦å’Œç¼–ç è§„åˆ™ã€‚æ­£ç¡®é€‰æ‹©å­—ç¬¦é›†å¯¹äºæ•°æ®çš„å­˜å‚¨å’Œæ˜¾ç¤ºè‡³å…³é‡è¦ã€‚

#### 4.1ã€å¸¸è§å­—ç¬¦é›†å¯¹æ¯”

| å­—ç¬¦é›† | å­—èŠ‚é•¿åº¦ | æ”¯æŒå­—ç¬¦ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|--------|----------|----------|------|------|
| `latin1` | 1 | è¥¿æ¬§å­—ç¬¦ | å­˜å‚¨ç©ºé—´å°ã€é€Ÿåº¦å¿« | ä¸æ”¯æŒä¸­æ–‡ç­‰å¤šè¯­è¨€ |
| `gbk` | 1-2 | ä¸­æ–‡ç®€ç¹ä½“ | æ”¯æŒä¸­æ–‡ | ä¸æ”¯æŒå…¶ä»–è¯­è¨€å­—ç¬¦ |
| `utf8` | 1-3 | å¤§éƒ¨åˆ†Unicode | å…¼å®¹æ€§å¥½ | ä¸æ”¯æŒ4å­—èŠ‚å­—ç¬¦ï¼ˆå¦‚emojiï¼‰ |
| `utf8mb4` | 1-4 | å®Œæ•´Unicode | æ”¯æŒæ‰€æœ‰å­—ç¬¦ | å ç”¨ç©ºé—´ç¨å¤§ |

#### 4.2ã€utf8 vs utf8mb4 é‡è¦åŒºåˆ«

> **âš ï¸ é‡è¦ï¼š** `MySQL`ä¸­çœŸæ­£çš„`Unicode`å­—ç¬¦é›†æ˜¯`utf8mb4`ï¼Œè€Œä¸æ˜¯`utf8`ï¼

**åŒºåˆ«å¯¹æ¯”ï¼š**

| ç‰¹æ€§ | `utf8` | `utf8mb4` |
|------|--------|-----------|
| æœ€å¤§å­—èŠ‚æ•° | 3å­—èŠ‚ | 4å­—èŠ‚ |
| emojiæ”¯æŒ | âŒ | âœ… |
| æ ‡å‡†å…¼å®¹ | éƒ¨åˆ†å…¼å®¹ | å®Œå…¨å…¼å®¹ |
| å­˜å‚¨ç©ºé—´ | è¾ƒå° | ç¨å¤§ |
| æ¨èä½¿ç”¨ | âŒ | âœ… |

**ç¤ºä¾‹ï¼š**
```sql
-- åˆ›å»ºä¸åŒå­—ç¬¦é›†çš„è¡¨
CREATE TABLE utf8_test (
    content TEXT CHARACTER SET utf8
);

CREATE TABLE utf8mb4_test (
    content TEXT CHARACTER SET utf8mb4
);

-- æµ‹è¯•emojiå­˜å‚¨
INSERT INTO utf8_test VALUES ('Hello ğŸ˜€');      -- æŠ¥é”™ï¼
INSERT INTO utf8mb4_test VALUES ('Hello ğŸ˜€');   -- æˆåŠŸï¼
```

#### 4.3ã€å­—ç¬¦é›†è®¾ç½®å±‚çº§

`MySQL`æ”¯æŒåœ¨å¤šä¸ªå±‚çº§è®¾ç½®å­—ç¬¦é›†ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. **åˆ—çº§åˆ«** > 2. **è¡¨çº§åˆ«** > 3. **æ•°æ®åº“çº§åˆ«** > 4. **æœåŠ¡å™¨çº§åˆ«**

```sql
-- æœåŠ¡å™¨çº§åˆ«ï¼ˆmy.cnfé…ç½®æ–‡ä»¶ï¼‰
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci

-- æ•°æ®åº“çº§åˆ«
CREATE DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- è¡¨çº§åˆ«
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50)
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ—çº§åˆ«
CREATE TABLE mixed_charset (
    id INT PRIMARY KEY,
    name_cn VARCHAR(50) CHARACTER SET utf8mb4,
    name_en VARCHAR(50) CHARACTER SET latin1
);
```

#### 4.4ã€å­—ç¬¦é›†æ£€æŸ¥å’Œä¿®æ”¹

```sql
-- æŸ¥çœ‹ç³»ç»Ÿå­—ç¬¦é›†è®¾ç½®
SHOW VARIABLES LIKE 'character%';
SHOW VARIABLES LIKE 'collation%';

-- æŸ¥çœ‹æ•°æ®åº“å­—ç¬¦é›†
SELECT SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME
FROM information_schema.SCHEMATA;

-- æŸ¥çœ‹è¡¨å­—ç¬¦é›†
SELECT TABLE_SCHEMA, TABLE_NAME, TABLE_COLLATION
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'your_database';

-- ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†
ALTER DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- ä¿®æ”¹è¡¨å­—ç¬¦é›†
ALTER TABLE users CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 4.5ã€æœ€ä½³å®è·µ

1. **æ–°é¡¹ç›®æ¨è**ï¼šç»Ÿä¸€ä½¿ç”¨`utf8mb4`å­—ç¬¦é›†
2. **æ’åºè§„åˆ™æ¨è**ï¼š`utf8mb4_unicode_ci`ï¼ˆæ›´å‡†ç¡®ï¼‰æˆ–`utf8mb4_general_ci`ï¼ˆæ›´å¿«ï¼‰
3. **è¿æ¥å­—ç¬¦é›†**ï¼šç¡®ä¿å®¢æˆ·ç«¯è¿æ¥ä½¿ç”¨æ­£ç¡®å­—ç¬¦é›†
4. **æ•°æ®è¿ç§»**ï¼šä»å…¶ä»–å­—ç¬¦é›†è¿ç§»æ—¶æ³¨æ„æ•°æ®å…¼å®¹æ€§

```sql
-- è®¾ç½®è¿æ¥å­—ç¬¦é›†
SET NAMES utf8mb4;

-- æˆ–åœ¨è¿æ¥URLä¸­æŒ‡å®š
jdbc:mysql://localhost:3306/mydb?characterEncoding=utf8mb4&useUnicode=true
```

### 5ã€MySQLçš„å­˜å‚¨å¼•æ“

MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œæ¯ç§å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ã€‚å¸¸è§çš„å­˜å‚¨å¼•æ“æœ‰ï¼š

1. InnoDBï¼šInnoDBæ˜¯MySQLä¸­æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“ï¼Œå®ƒæ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”å®šå’Œå¤–é”®çº¦æŸç­‰ç‰¹æ€§ï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨ACIDå…¼å®¹çš„å­˜å‚¨å¼•æ“ã€‚InnoDBå¼•æ“åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶æ€§èƒ½è¡¨ç°è¾ƒå¥½ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„OLTPåº”ç”¨åœºæ™¯ã€‚

2. MyISAMï¼šMyISAMæ˜¯MySQLä¸­æœ€æ—©çš„å­˜å‚¨å¼•æ“ä¹‹ä¸€ï¼Œå®ƒä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”å®šï¼Œä½†å…·æœ‰è¾ƒé«˜çš„è¯»å–æ€§èƒ½å’Œè¾ƒä½çš„å­˜å‚¨ç©ºé—´å¼€é”€ã€‚MyISAMå¼•æ“é€‚ç”¨äºåªè¯»æˆ–è¯»å†™æ¯”ä¾‹è¾ƒå°çš„åº”ç”¨åœºæ™¯ã€‚

3. MEMORYï¼šMEMORYå­˜å‚¨å¼•æ“ä¹Ÿç§°ä¸ºHEAPå­˜å‚¨å¼•æ“ï¼Œå®ƒå°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæä¾›äº†éå¸¸å¿«é€Ÿçš„æ•°æ®è®¿é—®é€Ÿåº¦ï¼Œä½†æ˜¯æ•°æ®çš„æŒä¹…æ€§è¾ƒå·®ã€‚MEMORYå­˜å‚¨å¼•æ“é€‚ç”¨äºå¯¹é€Ÿåº¦æœ‰ä¸¥æ ¼è¦æ±‚çš„ä¸´æ—¶è¡¨æˆ–ç¼“å­˜è¡¨ç­‰åœºæ™¯ã€‚

4. CSVï¼šCSVå­˜å‚¨å¼•æ“å°†æ•°æ®å­˜å‚¨åœ¨CSVï¼ˆé€—å·åˆ†éš”å€¼ï¼‰æ ¼å¼çš„æ–‡ä»¶ä¸­ï¼Œé€‚ç”¨äºéœ€è¦å¯¼å‡ºå’Œå¯¼å…¥æ•°æ®çš„åœºæ™¯ã€‚

5. ARCHIVEï¼šARCHIVEå­˜å‚¨å¼•æ“å°†æ•°æ®å­˜å‚¨åœ¨é«˜åº¦å‹ç¼©çš„æ ¼å¼ä¸­ï¼Œæä¾›äº†è¾ƒé«˜çš„å­˜å‚¨ç©ºé—´æ•ˆç‡å’Œè¾ƒå¿«çš„æ•°æ®å‹ç¼©å’Œè§£å‹ç¼©é€Ÿåº¦ï¼Œä½†æ˜¯è¯»å†™æ€§èƒ½è¾ƒä½ã€‚ARCHIVEå­˜å‚¨å¼•æ“é€‚ç”¨äºå¤§æ•°æ®å­˜æ¡£å’Œå¤‡ä»½ç­‰åœºæ™¯ã€‚

é™¤äº†ä»¥ä¸Šå¸¸ç”¨çš„å­˜å‚¨å¼•æ“å¤–ï¼ŒMySQLè¿˜æ”¯æŒå…¶ä»–å­˜å‚¨å¼•æ“ï¼Œå¦‚NDB Clusterå­˜å‚¨å¼•æ“ã€Blackholeå­˜å‚¨å¼•æ“ç­‰ã€‚é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“æ˜¯ä¼˜åŒ–MySQLæ€§èƒ½å’Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„å…³é”®ä¸€æ­¥ã€‚

### 6ã€MySQLåŸºæœ¬æ¶æ„
åœ¨å­˜å‚¨å¼•æ“ä¹‹ä¸Šï¼ŒMySQLæœ‰Serverå±‚ï¼Œå®ƒåŒ…æ‹¬ä»¥ä¸‹ç»„ä»¶ï¼š

#### 6.1ã€è¿æ¥å™¨

è¿æ¥å™¨ï¼ˆConnection Managerï¼‰æ˜¯MySQLçš„å…¥å£ï¼Œè´Ÿè´£å»ºç«‹å’Œç»´æŠ¤ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥ã€‚è¿æ¥å™¨æ”¯æŒå¤šç§åè®®ï¼ŒåŒ…æ‹¬TCP/IPã€UnixåŸŸå¥—æ¥å­—ï¼ˆUnix Domain Socketï¼‰ç­‰ï¼Œå®ƒè¿˜æ”¯æŒSSL/TLSåŠ å¯†è¿æ¥å’Œå…¶ä»–é«˜çº§ç‰¹æ€§ã€‚è¿æ¥å™¨æ˜¯MySQLä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œç›´æ¥å½±å“MySQLçš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œç¨³å®šæ€§ã€‚

è¿æ¥å™¨çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

1. å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚ã€‚å®¢æˆ·ç«¯é€šè¿‡è¿æ¥å™¨å‘MySQLæœåŠ¡å™¨å‘é€è¿æ¥è¯·æ±‚ã€‚è¿æ¥è¯·æ±‚åŒ…æ‹¬ç”¨æˆ·åã€å¯†ç å’Œç›®æ ‡æ•°æ®åº“ç­‰ä¿¡æ¯ã€‚

2. è¿æ¥å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚MySQLæœåŠ¡å™¨æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚åï¼Œè¿æ¥å™¨ä¼šå¯¹å®¢æˆ·ç«¯çš„èº«ä»½è¿›è¡ŒéªŒè¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åå’Œå¯†ç ç­‰ä¿¡æ¯ã€‚å¦‚æœèº«ä»½éªŒè¯å¤±è´¥ï¼Œåˆ™è¿æ¥å™¨ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¹¶å…³é—­è¿æ¥ã€‚

3. è¿æ¥å™¨è¿›è¡Œæˆæƒã€‚å¦‚æœèº«ä»½éªŒè¯é€šè¿‡ï¼Œåˆ™è¿æ¥å™¨ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œæˆæƒï¼Œä»¥ç¡®å®šå®¢æˆ·ç«¯å¯ä»¥è®¿é—®çš„æ•°æ®åº“å’Œæ•°æ®è¡¨ç­‰èµ„æºã€‚

4. å»ºç«‹é€šä¿¡ç®¡é“ã€‚è¿æ¥å™¨ä¼šå»ºç«‹ä¸€ä¸ªé€šä¿¡ç®¡é“ï¼Œè´Ÿè´£å®¢æˆ·ç«¯å’ŒMySQLæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚é€šä¿¡ç®¡é“å¯ä»¥ä½¿ç”¨å¤šç§åè®®ï¼ŒåŒ…æ‹¬TCP/IPã€UnixåŸŸå¥—æ¥å­—ç­‰ã€‚

5. å¤„ç†SQLè¯­å¥ã€‚å®¢æˆ·ç«¯é€šè¿‡è¿æ¥å™¨å‘é€SQLè¯­å¥åˆ°MySQLæœåŠ¡å™¨ï¼Œè¿æ¥å™¨ä¼šå¯¹SQLè¯­å¥è¿›è¡Œè§£æå’Œä¼˜åŒ–ï¼Œå¹¶å°†æ‰§è¡Œè®¡åˆ’å‘é€ç»™å­˜å‚¨å¼•æ“ã€‚

6. è·å–æ‰§è¡Œç»“æœã€‚å­˜å‚¨å¼•æ“æ‰§è¡ŒSQLè¯­å¥ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™è¿æ¥å™¨ã€‚è¿æ¥å™¨å°†ç»“æœä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå¹¶å…³é—­è¿æ¥ã€‚

é™¤äº†ä»¥ä¸ŠåŸºæœ¬æµç¨‹ï¼Œè¿æ¥å™¨è¿˜å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. è¿æ¥æ± ã€‚è¿æ¥å™¨ç»´æŠ¤ä¸€ä¸ªè¿æ¥æ± ï¼Œç”¨äºé‡å¤ä½¿ç”¨å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œä»è€Œé¿å…é¢‘ç¹å»ºç«‹å’Œå…³é—­è¿æ¥çš„å¼€é”€ã€‚è¿æ¥æ± è¿˜å¯ä»¥é™åˆ¶åŒæ—¶è¿æ¥çš„æ•°é‡ï¼Œä»è€Œæ§åˆ¶MySQLçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚

2. çº¿ç¨‹å®‰å…¨ã€‚è¿æ¥å™¨æ˜¯å¤šçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œæé«˜MySQLçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚

3. å®‰å…¨æ€§ã€‚è¿æ¥å™¨æ”¯æŒå¤šç§èº«ä»½éªŒè¯æœºåˆ¶ï¼ŒåŒ…æ‹¬åŸºäºå¯†ç çš„èº«ä»½éªŒè¯å’ŒåŸºäºè¯ä¹¦çš„èº«ä»½éªŒè¯ç­‰ï¼Œä»è€Œç¡®ä¿åªæœ‰åˆæ³•çš„å®¢æˆ·ç«¯æ‰èƒ½è¿æ¥MySQLæœåŠ¡å™¨ã€‚

è¿æ¥å™¨æ˜¯MySQLä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå†³å®šäº†MySQLçš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œç¨³å®šæ€§ã€‚ä¼˜åŒ–è¿æ¥å™¨çš„æ€§èƒ½å’Œå¯é æ€§æ˜¯æé«˜MySQLæ•´ä½“æ€§èƒ½å’Œå¯é æ€§çš„å…³é”®ä¸€æ­¥ã€‚

#### 6.2ã€æŸ¥è¯¢ç¼“å­˜

æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery Cacheï¼‰ç”¨äºç¼“å­˜å·²ç»æ‰§è¡Œè¿‡çš„SELECTè¯­å¥å’Œç»“æœé›†ã€‚å¦‚æœä¸€ä¸ªSELECTè¯­å¥å’Œç»“æœé›†å·²ç»è¢«ç¼“å­˜ï¼Œé‚£ä¹ˆMySQLä¼šç›´æ¥è¿”å›ç»“æœï¼Œè€Œä¸éœ€è¦æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä»è€Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚æŸ¥è¯¢ç¼“å­˜å¯ä»¥å‡å°‘æ•°æ®åº“çš„è´Ÿè½½ï¼Œæé«˜å“åº”é€Ÿåº¦ï¼Œå¹¶é™ä½äº†æŸ¥è¯¢çš„CPUå’ŒI/Oå¼€é”€ã€‚

æŸ¥è¯¢ç¼“å­˜çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

1. å®¢æˆ·ç«¯å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚å®¢æˆ·ç«¯é€šè¿‡è¿æ¥å™¨å‘MySQLæœåŠ¡å™¨å‘é€SELECTæŸ¥è¯¢è¯·æ±‚ã€‚

2. æŸ¥è¯¢ç¼“å­˜æŸ¥æ‰¾ã€‚MySQLæœåŠ¡å™¨æ¥æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆæŸ¥æ‰¾æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„ç»“æœé›†ã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜ä¸­å­˜åœ¨ç›¸åº”çš„ç»“æœé›†ï¼Œåˆ™MySQLç›´æ¥è¿”å›ç»“æœé›†ç»™å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚

3. æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜ä¸­ä¸å­˜åœ¨ç›¸åº”çš„ç»“æœé›†ï¼Œåˆ™MySQLæœåŠ¡å™¨ä¼šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå¹¶å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åŒæ—¶ï¼ŒMySQLè¿˜å°†æŸ¥è¯¢ç»“æœå†™å…¥æŸ¥è¯¢ç¼“å­˜ï¼Œä»¥ä¾¿ä¸‹æ¬¡æŸ¥è¯¢æ—¶å¯ä»¥ç›´æ¥è¿”å›ç»“æœã€‚

æŸ¥è¯¢ç¼“å­˜çš„ä½¿ç”¨éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. æŸ¥è¯¢ç¼“å­˜å¯¹äºåªè¯»å‹çš„åº”ç”¨æ€§èƒ½æå‡æ¯”è¾ƒæ˜æ˜¾ï¼Œå¯¹äºæœ‰å†™å…¥æ“ä½œçš„åº”ç”¨ï¼Œç”±äºå†™å…¥æ“ä½œä¼šä½¿æŸ¥è¯¢ç¼“å­˜å¤±æ•ˆï¼Œæ‰€ä»¥æŸ¥è¯¢ç¼“å­˜çš„æ•ˆæœå¹¶ä¸æ˜¾è‘—ã€‚

2. æŸ¥è¯¢ç¼“å­˜éœ€è¦å ç”¨å¤§é‡çš„å†…å­˜ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„æ•ˆæœä¼šé€æ¸é™ä½ï¼Œç”šè‡³ä¼šå¯¹MySQLçš„æ€§èƒ½é€ æˆè´Ÿé¢å½±å“ã€‚

3. åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­ï¼ŒæŸ¥è¯¢ç¼“å­˜è¢«åºŸå¼ƒï¼Œå¹¶åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­åˆ é™¤ã€‚è¿™æ˜¯å› ä¸ºæŸ¥è¯¢ç¼“å­˜å¯èƒ½å¯¼è‡´æ•°æ®åº“çš„æ€§èƒ½ä¸‹é™ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘å’ŒåŠ¨æ€æ•°æ®çš„æƒ…å†µä¸‹ï¼Œè€Œä¸”æŸ¥è¯¢ç¼“å­˜è¿˜ä¼šå ç”¨å¤§é‡çš„å†…å­˜ã€‚

æŸ¥è¯¢ç¼“å­˜æ˜¯MySQLä¸­ä¸€ä¸ªé‡è¦çš„æ€§èƒ½ä¼˜åŒ–ç»„ä»¶ï¼Œå®ƒå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œé™ä½æ•°æ®åº“çš„è´Ÿè½½ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜æ—¶éœ€è¦æ³¨æ„å…¶é™åˆ¶å’Œé€‚ç”¨åœºæ™¯ï¼Œä»¥å……åˆ†å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚

#### 6.3ã€åˆ†æå™¨

æŸ¥è¯¢åˆ†æå™¨ï¼ˆQuery Analyzerï¼‰è´Ÿè´£å¯¹SQLè¯­å¥è¿›è¡Œè§£æå’Œä¼˜åŒ–ï¼Œå°†SQLè¯­å¥è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„è®¡åˆ’ã€‚MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šæ ¹æ®ç´¢å¼•ã€è¡¨ç»Ÿè®¡ä¿¡æ¯å’ŒæŸ¥è¯¢ç±»å‹ç­‰å› ç´ ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œä»¥æé«˜æŸ¥è¯¢çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚

æŸ¥è¯¢åˆ†æå™¨çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

1. è§£æSQLè¯­å¥ã€‚æŸ¥è¯¢åˆ†æå™¨é¦–å…ˆå¯¹SQLè¯­å¥è¿›è¡Œè§£æï¼Œå°†å…¶åˆ†è§£æˆå¤šä¸ªè¯­å¥å—ï¼ŒåŒ…æ‹¬SELECTè¯­å¥ã€FROMå­å¥ã€WHEREå­å¥ç­‰ã€‚

2. ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨æ ¹æ®ç´¢å¼•ã€è¡¨ç»Ÿè®¡ä¿¡æ¯å’ŒæŸ¥è¯¢ç±»å‹ç­‰å› ç´ ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚æ‰§è¡Œè®¡åˆ’æ˜¯ä¸€ç»„æ“ä½œåºåˆ—ï¼Œç”¨äºæ‰§è¡ŒSQLæŸ¥è¯¢å¹¶ç”Ÿæˆç»“æœé›†ã€‚æ‰§è¡Œè®¡åˆ’åŒ…æ‹¬è®¿é—®æ–¹æ³•ã€è¡¨è¿æ¥é¡ºåºã€è¿‡æ»¤æ¡ä»¶ã€æ’åºæ–¹å¼ç­‰ã€‚

3. æ‰§è¡ŒæŸ¥è¯¢ã€‚MySQLæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œå¹¶ç”Ÿæˆç»“æœé›†ã€‚

æŸ¥è¯¢åˆ†æå™¨è¿˜å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. è¯­æ³•åˆ†æã€‚æŸ¥è¯¢åˆ†æå™¨å¯ä»¥è¯†åˆ«å’Œåˆ†æSQLè¯­å¥çš„è¯­æ³•ç»“æ„ï¼Œä»è€Œæ£€æµ‹å’ŒæŠ¥å‘Šé”™è¯¯çš„è¯­æ³•ã€‚

2. è¯­ä¹‰åˆ†æã€‚æŸ¥è¯¢åˆ†æå™¨å¯ä»¥åˆ†æSQLè¯­å¥çš„è¯­ä¹‰ï¼Œæ£€æµ‹å’ŒæŠ¥å‘Šä¸åˆç†çš„æŸ¥è¯¢å’Œé”™è¯¯çš„æŸ¥è¯¢æ“ä½œã€‚

3. ä¼˜åŒ–æŸ¥è¯¢ã€‚æŸ¥è¯¢åˆ†æå™¨å¯ä»¥ä¼˜åŒ–SQLæŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½å’Œæ•ˆç‡ã€‚MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå°½å¯èƒ½åˆ©ç”¨ç´¢å¼•å’Œå…¶ä»–ä¼˜åŒ–æŠ€æœ¯ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚

4. å¸¸é‡è¡¨è¾¾å¼è®¡ç®—ã€‚æŸ¥è¯¢åˆ†æå™¨å¯ä»¥è®¡ç®—SQLæŸ¥è¯¢ä¸­çš„å¸¸é‡è¡¨è¾¾å¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¸¸é‡ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚

æŸ¥è¯¢åˆ†æå™¨æ˜¯MySQLä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¯ä»¥ä¼˜åŒ–SQLæŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½å’Œæ•ˆç‡ã€‚äº†è§£æŸ¥è¯¢åˆ†æå™¨çš„å·¥ä½œåŸç†å’Œç‰¹ç‚¹ï¼Œå¯¹äºä¼˜åŒ–MySQLçš„æ€§èƒ½å’Œè§£å†³æŸ¥è¯¢é—®é¢˜éå¸¸é‡è¦ã€‚

#### 6.4ã€ä¼˜åŒ–å™¨

æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ˆQuery Optimizerï¼‰ä¼˜åŒ–SQLæŸ¥è¯¢ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œæ•ˆç‡ã€‚MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥æ ¹æ®ç´¢å¼•ã€è¡¨ç»Ÿè®¡ä¿¡æ¯å’ŒæŸ¥è¯¢ç±»å‹ç­‰å› ç´ ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’å¯ä»¥ä½¿æŸ¥è¯¢æ›´å¿«ã€æ›´é«˜æ•ˆåœ°æ‰§è¡Œï¼Œä»è€Œæé«˜MySQLçš„æ•´ä½“æ€§èƒ½ã€‚

æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

1. è§£æSQLè¯­å¥ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨é¦–å…ˆå¯¹SQLè¯­å¥è¿›è¡Œè§£æï¼Œå°†å…¶åˆ†è§£æˆå¤šä¸ªè¯­å¥å—ï¼ŒåŒ…æ‹¬SELECTè¯­å¥ã€FROMå­å¥ã€WHEREå­å¥ç­‰ã€‚

2. åˆ†ææŸ¥è¯¢ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨åˆ†ææŸ¥è¯¢ï¼ŒåŒ…æ‹¬è¡¨çš„é€‰æ‹©ã€è¿æ¥ç±»å‹ã€è¿‡æ»¤æ¡ä»¶ã€æ’åºæ–¹å¼ç­‰ï¼Œä»¥ç”Ÿæˆä¸€ä¸ªå¯èƒ½çš„æ‰§è¡Œè®¡åˆ’ã€‚

3. ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šæ ¹æ®ç´¢å¼•ã€è¡¨ç»Ÿè®¡ä¿¡æ¯å’ŒæŸ¥è¯¢ç±»å‹ç­‰å› ç´ ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚æ‰§è¡Œè®¡åˆ’æ˜¯ä¸€ç»„æ“ä½œåºåˆ—ï¼Œç”¨äºæ‰§è¡ŒSQLæŸ¥è¯¢å¹¶ç”Ÿæˆç»“æœé›†ã€‚æ‰§è¡Œè®¡åˆ’åŒ…æ‹¬è®¿é—®æ–¹æ³•ã€è¡¨è¿æ¥é¡ºåºã€è¿‡æ»¤æ¡ä»¶ã€æ’åºæ–¹å¼ç­‰ã€‚

4. æ‰§è¡ŒæŸ¥è¯¢ã€‚MySQLæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œå¹¶ç”Ÿæˆç»“æœé›†ã€‚

MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨è¿˜å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. é€‰æ‹©æœ€ä¼˜ç´¢å¼•ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶å’Œç´¢å¼•çš„é€‰æ‹©æ€§ï¼Œé€‰æ‹©æœ€ä¼˜çš„ç´¢å¼•ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œæ•ˆç‡ã€‚

2. é¢„æµ‹è¡Œæ•°ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥é¢„æµ‹æŸ¥è¯¢è¯­å¥è¿”å›çš„è¡Œæ•°ï¼Œä»è€Œå¸®åŠ©MySQLä¼˜åŒ–æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚

3. ç¡®å®šè¡¨è¿æ¥é¡ºåºã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥ç¡®å®šè¡¨è¿æ¥é¡ºåºï¼Œä»¥å‡å°‘æŸ¥è¯¢çš„I/Oæ“ä½œï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚

4. ä¼˜åŒ–å¸¸é‡è¡¨è¾¾å¼ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥ä¼˜åŒ–SQLæŸ¥è¯¢ä¸­çš„å¸¸é‡è¡¨è¾¾å¼ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚

æŸ¥è¯¢ä¼˜åŒ–å™¨æ˜¯MySQLä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¯ä»¥ä¼˜åŒ–SQLæŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½å’Œæ•ˆç‡ã€‚

#### 6.5ã€æ‰§è¡Œå™¨

æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰å®ƒè´Ÿè´£æ‰§è¡ŒSQLè¯­å¥å¹¶è¿”å›ç»“æœé›†ã€‚æ‰§è¡Œå™¨çš„ä¸»è¦å·¥ä½œæ˜¯ç®¡ç†æŸ¥è¯¢ç¼“å­˜ã€è¯»å–æ•°æ®ã€æ’åºã€åˆ†ç»„ã€èšåˆã€è®¡ç®—è¡¨è¾¾å¼ç­‰ï¼Œä»¥ç”Ÿæˆç»“æœé›†å¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

æ‰§è¡Œå™¨çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. å®¢æˆ·ç«¯å‘é€SQLæŸ¥è¯¢è¯·æ±‚ã€‚å®¢æˆ·ç«¯é€šè¿‡è¿æ¥å™¨å‘MySQLæœåŠ¡å™¨å‘é€SQLæŸ¥è¯¢è¯·æ±‚ã€‚

2. æŸ¥è¯¢ç¼“å­˜æŸ¥æ‰¾ã€‚MySQLæœåŠ¡å™¨æ¥æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆæŸ¥æ‰¾æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„ç»“æœé›†ã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜ä¸­å­˜åœ¨ç›¸åº”çš„ç»“æœé›†ï¼Œåˆ™MySQLç›´æ¥è¿”å›ç»“æœé›†ç»™å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚

3. æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜ä¸­ä¸å­˜åœ¨ç›¸åº”çš„ç»“æœé›†ï¼Œåˆ™MySQLæœåŠ¡å™¨ä¼šæ ¹æ®æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå¹¶å°†ç»“æœé›†è¿”å›ç»™æ‰§è¡Œå™¨ã€‚

4. å¤„ç†ç»“æœé›†ã€‚æ‰§è¡Œå™¨å¯¹ç»“æœé›†è¿›è¡Œæ’åºã€åˆ†ç»„ã€èšåˆã€è®¡ç®—è¡¨è¾¾å¼ç­‰æ“ä½œï¼Œå¹¶å°†æœ€ç»ˆç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

æ‰§è¡Œå™¨è¿˜å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. ç®¡ç†äº‹åŠ¡ã€‚æ‰§è¡Œå™¨è´Ÿè´£ç®¡ç†MySQLçš„äº‹åŠ¡ï¼ŒåŒ…æ‹¬äº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šç­‰æ“ä½œã€‚

2. é”ç®¡ç†ã€‚æ‰§è¡Œå™¨è´Ÿè´£ç®¡ç†MySQLçš„é”æœºåˆ¶ï¼ŒåŒ…æ‹¬è¡Œçº§é”å’Œè¡¨çº§é”ç­‰ï¼Œä»¥ä¿è¯å¹¶å‘æ€§å’Œä¸€è‡´æ€§ã€‚

3. èµ„æºç®¡ç†ã€‚æ‰§è¡Œå™¨è´Ÿè´£ç®¡ç†MySQLçš„èµ„æºï¼ŒåŒ…æ‹¬ç¼“å­˜ã€è¿æ¥æ± å’Œçº¿ç¨‹æ± ç­‰ï¼Œä»¥æé«˜MySQLçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚

æ‰§è¡Œå™¨æ˜¯`MySQL`ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒç›´æ¥å½±å“`MySQL`çš„æŸ¥è¯¢æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä¼˜åŒ–æ‰§è¡Œå™¨çš„æ€§èƒ½å’Œå¯é æ€§æ˜¯æé«˜`MySQL`æ•´ä½“æ€§èƒ½å’Œå¯é æ€§çš„å…³é”®ä¸€æ­¥ã€‚

## ä¸‰ã€MySQL 8.0 é‡è¦æ–°ç‰¹æ€§

`MySQL 8.0`æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘ç‰ˆæœ¬ï¼Œå¼•å…¥äº†è®¸å¤šé‡è¦çš„æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œæ˜¾è‘—æå‡äº†æ€§èƒ½ã€å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ã€‚

### 1ã€çª—å£å‡½æ•°ï¼ˆWindow Functionsï¼‰

çª—å£å‡½æ•°å…è®¸åœ¨ä¸ä½¿ç”¨`GROUP BY`çš„æƒ…å†µä¸‹è¿›è¡Œèšåˆè®¡ç®—ï¼Œæå¤§ç®€åŒ–äº†å¤æ‚æŸ¥è¯¢ã€‚

**è¯­æ³•ï¼š**
```sql
function_name() OVER (
    [PARTITION BY column1, column2, ...]
    [ORDER BY column3, column4, ...]
    [ROWS/RANGE BETWEEN ... AND ...]
)
```

**å¸¸ç”¨çª—å£å‡½æ•°ï¼š**

| å‡½æ•°ç±»å‹ | å‡½æ•°å | è¯´æ˜ |
|----------|--------|------|
| æ’åå‡½æ•° | `ROW_NUMBER()` | è¿ç»­æ’å |
| | `RANK()` | è·³è·ƒæ’å |
| | `DENSE_RANK()` | å¯†é›†æ’å |
| èšåˆå‡½æ•° | `SUM() OVER()` | ç´¯è®¡æ±‚å’Œ |
| | `AVG() OVER()` | ç§»åŠ¨å¹³å‡ |
| | `COUNT() OVER()` | ç´¯è®¡è®¡æ•° |
| åç§»å‡½æ•° | `LAG()` | è·å–å‰é¢çš„å€¼ |
| | `LEAD()` | è·å–åé¢çš„å€¼ |
| | `FIRST_VALUE()` | ç¬¬ä¸€ä¸ªå€¼ |
| | `LAST_VALUE()` | æœ€åä¸€ä¸ªå€¼ |

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```sql
-- é”€å”®æ’ååˆ†æ
SELECT 
    employee_id,
    sales_amount,
    -- æ•´ä½“æ’å
    ROW_NUMBER() OVER (ORDER BY sales_amount DESC) as overall_rank,
    -- éƒ¨é—¨å†…æ’å
    RANK() OVER (PARTITION BY department_id ORDER BY sales_amount DESC) as dept_rank,
    -- ç´¯è®¡é”€å”®é¢
    SUM(sales_amount) OVER (ORDER BY sales_date ROWS UNBOUNDED PRECEDING) as cumulative_sales,
    -- ç§»åŠ¨å¹³å‡ï¼ˆè¿‘3ä¸ªæœˆï¼‰
    AVG(sales_amount) OVER (ORDER BY sales_date ROWS 2 PRECEDING) as moving_avg,
    -- åŒæ¯”å¢é•¿
    LAG(sales_amount, 12) OVER (PARTITION BY employee_id ORDER BY sales_date) as last_year_sales
FROM sales_data;
```

### 2ã€CTEï¼ˆå…¬å…±è¡¨è¡¨è¾¾å¼ï¼‰

`CTE`æä¾›äº†æ›´æ¸…æ™°çš„æŸ¥è¯¢ç»“æ„ï¼Œæ”¯æŒé€’å½’æŸ¥è¯¢ï¼Œæ›¿ä»£å¤æ‚çš„å­æŸ¥è¯¢ã€‚

**åŸºç¡€è¯­æ³•ï¼š**
```sql
WITH cte_name AS (
    SELECT ...
)
SELECT ... FROM cte_name;
```

**é€’å½’CTEç¤ºä¾‹ï¼š**
```sql
-- ç»„ç»‡æ¶æ„å±‚çº§æŸ¥è¯¢
WITH RECURSIVE org_hierarchy AS (
    -- é”šç‚¹ï¼šé¡¶çº§ç®¡ç†è€…
    SELECT employee_id, name, manager_id, 1 as level
    FROM employees 
    WHERE manager_id IS NULL
    
    UNION ALL
    
    -- é€’å½’ï¼šä¸‹å±å‘˜å·¥
    SELECT e.employee_id, e.name, e.manager_id, oh.level + 1
    FROM employees e
    INNER JOIN org_hierarchy oh ON e.manager_id = oh.employee_id
)
SELECT * FROM org_hierarchy ORDER BY level, employee_id;

-- å¤æ‚æ•°æ®åˆ†æCTE
WITH 
monthly_sales AS (
    SELECT 
        DATE_FORMAT(order_date, '%Y-%m') as month,
        SUM(amount) as total_sales
    FROM orders 
    WHERE order_date >= '2023-01-01'
    GROUP BY DATE_FORMAT(order_date, '%Y-%m')
),
sales_growth AS (
    SELECT 
        month,
        total_sales,
        LAG(total_sales) OVER (ORDER BY month) as prev_month_sales,
        (total_sales - LAG(total_sales) OVER (ORDER BY month)) / 
        LAG(total_sales) OVER (ORDER BY month) * 100 as growth_rate
    FROM monthly_sales
)
SELECT * FROM sales_growth WHERE growth_rate > 10;
```

### 3ã€éšè—ç´¢å¼•ï¼ˆInvisible Indexesï¼‰

éšè—ç´¢å¼•å…è®¸åœ¨ä¸åˆ é™¤ç´¢å¼•çš„æƒ…å†µä¸‹æµ‹è¯•ç´¢å¼•çš„å½±å“ï¼Œä¾¿äºç´¢å¼•ä¼˜åŒ–ã€‚

```sql
-- åˆ›å»ºéšè—ç´¢å¼•
CREATE INDEX idx_customer_email ON customers(email) INVISIBLE;

-- ç°æœ‰ç´¢å¼•è®¾ä¸ºéšè—
ALTER TABLE customers ALTER INDEX idx_customer_name INVISIBLE;

-- æ˜¾ç¤ºç´¢å¼•
ALTER TABLE customers ALTER INDEX idx_customer_name VISIBLE;

-- æŸ¥çœ‹ç´¢å¼•çŠ¶æ€
SELECT 
    INDEX_NAME, 
    IS_VISIBLE 
FROM information_schema.statistics 
WHERE TABLE_NAME = 'customers';

-- ä¼˜åŒ–å™¨å¿½ç•¥éšè—ç´¢å¼•ï¼Œé™¤éå¼ºåˆ¶ä½¿ç”¨
SELECT * FROM customers USE INDEX (idx_customer_email) WHERE email = 'john@example.com';
```

### 4ã€é™åºç´¢å¼•

çœŸæ­£çš„é™åºç´¢å¼•æ”¯æŒï¼Œæå‡`ORDER BY DESC`æŸ¥è¯¢æ€§èƒ½ã€‚

```sql
-- åˆ›å»ºé™åºç´¢å¼•
CREATE INDEX idx_order_date_desc ON orders(order_date DESC);

-- æ··åˆå‡é™åºç´¢å¼•
CREATE INDEX idx_complex ON orders(customer_id ASC, order_date DESC, amount ASC);

-- æ€§èƒ½å¯¹æ¯”
EXPLAIN SELECT * FROM orders ORDER BY order_date DESC LIMIT 10;
```

### 5ã€åŸå­DDLæ“ä½œ

`DDL`æ“ä½œç°åœ¨æ˜¯åŸå­çš„ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œæé«˜äº†æ•°æ®ä¸€è‡´æ€§ã€‚

```sql
-- åŸå­æ€§é‡å‘½åæ“ä½œ
RENAME TABLE 
    old_table1 TO new_table1,
    old_table2 TO new_table2,
    old_table3 TO new_table3;

-- å¤±è´¥æ—¶æ‰€æœ‰æ“ä½œéƒ½ä¼šå›æ»š
DROP TABLE table1, table2, table3;  -- å¦‚æœä»»ä¸€è¡¨ä¸å­˜åœ¨ï¼Œæ‰€æœ‰åˆ é™¤éƒ½ä¼šå›æ»š
```

### 6ã€JSONå¢å¼ºåŠŸèƒ½

æ›´å¼ºå¤§çš„`JSON`å¤„ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬èšåˆå‡½æ•°å’Œè¡¨å‡½æ•°ã€‚

```sql
-- JSONèšåˆå‡½æ•°
SELECT 
    department,
    JSON_ARRAYAGG(employee_name) as employees,
    JSON_OBJECTAGG(employee_id, salary) as salary_map
FROM employees 
GROUP BY department;

-- JSONè¡¨å‡½æ•°
SELECT * 
FROM JSON_TABLE(
    '[{"name": "John", "age": 30}, {"name": "Jane", "age": 25}]',
    '$[*]' COLUMNS (
        name VARCHAR(50) PATH '$.name',
        age INT PATH '$.age'
    )
) as jt;

-- JSONåˆå¹¶å’Œæ›´æ–°
UPDATE products 
SET attributes = JSON_MERGE_PATCH(
    attributes, 
    '{"updated_at": "2023-01-01", "version": 2}'
) 
WHERE id = 1;
```

### 7ã€æ€§èƒ½æå‡

**å¤šå€¼ç´¢å¼•ï¼š**
```sql
-- ä¸ºJSONæ•°ç»„åˆ›å»ºå¤šå€¼ç´¢å¼•
CREATE INDEX idx_tags ON articles((CAST(tags AS CHAR(255) ARRAY)));

-- æŸ¥è¯¢æ•°ç»„å…ƒç´ 
SELECT * FROM articles WHERE 'mysql' MEMBER OF(tags);
```

**ç›´æ–¹å›¾ç»Ÿè®¡ï¼š**
```sql
-- åˆ›å»ºç›´æ–¹å›¾æå‡æŸ¥è¯¢ä¼˜åŒ–
ANALYZE TABLE orders UPDATE HISTOGRAM ON order_date, amount WITH 100 BUCKETS;

-- æŸ¥çœ‹ç›´æ–¹å›¾ä¿¡æ¯
SELECT * FROM information_schema.column_statistics;
```

### 8ã€å®‰å…¨å¢å¼º

**é»˜è®¤èº«ä»½éªŒè¯ï¼š**
```sql
-- æ–°çš„èº«ä»½éªŒè¯æ’ä»¶ï¼ˆé»˜è®¤ï¼‰
CREATE USER 'newuser'@'localhost' IDENTIFIED WITH caching_sha2_password BY 'password';

-- è§’è‰²ç®¡ç†
CREATE ROLE 'app_read', 'app_write';
GRANT SELECT ON mydb.* TO 'app_read';
GRANT INSERT, UPDATE ON mydb.* TO 'app_write';
GRANT 'app_read', 'app_write' TO 'appuser'@'localhost';
```

**é‡è¦æ³¨æ„äº‹é¡¹ï¼š**
- `MySQL 8.0`ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜
- é»˜è®¤å­—ç¬¦é›†æ”¹ä¸º`utf8mb4`
- æ€§èƒ½æ¨¡å¼é»˜è®¤å¯ç”¨
- äºŒè¿›åˆ¶æ—¥å¿—é»˜è®¤å¯ç”¨
- æœ€ä½æ”¯æŒç‰ˆæœ¬è¦æ±‚è¾ƒé«˜

### 9ã€å®‰è£…ä¸é…ç½®MySQL

#### 9.1ã€å®‰è£…è¦æ±‚

æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶é…ç½®é€‰æ‹©åˆé€‚çš„MySQLç‰ˆæœ¬ã€‚ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³å®‰è£…MySQLçš„æœ€ä½è¦æ±‚ï¼Œå¦‚å†…å­˜ã€ç£ç›˜ç©ºé—´å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ç­‰ã€‚

#### 9.2ã€ç¯å¢ƒå˜é‡é…ç½®

å®‰è£…å®Œæˆåï¼Œéœ€è¦å°†MySQLçš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥ä¾¿åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥ä½¿ç”¨`mysql`å‘½ä»¤ã€‚

#### 9.3ã€éªŒè¯å®‰è£…

åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥`mysql --version`ï¼Œå¦‚æœæ˜¾ç¤ºå‡ºMySQLçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨`mysql -u root -p`å‘½ä»¤ç™»å½•åˆ°MySQLæ•°æ®åº“ï¼Œå¹¶è¿›è¡Œè¿›ä¸€æ­¥çš„é…ç½®å’Œä½¿ç”¨ã€‚

## å››ã€SQLåŸºç¡€

### 1ã€SQLè¯­è¨€çš„æ¦‚å¿µä¸åˆ†ç±»

`SQL`ï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ŒStructured Query Languageï¼‰æ˜¯ç”¨äºç®¡ç†å…³ç³»å‹æ•°æ®åº“çš„ä¸€ç§æ ‡å‡†ç¼–ç¨‹è¯­è¨€ã€‚å®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„æ•°æ®åº“æ“ä½œæŒ‡ä»¤ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚

æ ¹æ®åŠŸèƒ½å’Œç”¨é€”ï¼Œ`SQL`å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç§ç±»å‹ï¼š

#### 1.1ã€DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰

**`DDL`ï¼ˆData Definition Languageï¼‰**ä¸»è¦ç”¨äºå®šä¹‰å’Œç®¡ç†æ•°æ®åº“å¯¹è±¡ï¼ˆå¦‚æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€ç´¢å¼•ç­‰ï¼‰çš„ç»“æ„ã€‚

| è¯­å¥ | åŠŸèƒ½ | è¯­æ³•ç¤ºä¾‹ |
|------|------|----------|
| `CREATE` | åˆ›å»ºæ•°æ®åº“å¯¹è±¡ | `CREATE TABLE users (...)` |
| `ALTER` | ä¿®æ”¹å¯¹è±¡ç»“æ„ | `ALTER TABLE users ADD COLUMN email VARCHAR(100)` |
| `DROP` | åˆ é™¤æ•°æ®åº“å¯¹è±¡ | `DROP TABLE users` |
| `TRUNCATE` | æ¸…ç©ºè¡¨æ•°æ®ä½†ä¿ç•™ç»“æ„ | `TRUNCATE TABLE users` |

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE ecommerce CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºè¡¨
CREATE TABLE customers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_created_at (created_at)
);

-- ä¿®æ”¹è¡¨ç»“æ„
ALTER TABLE customers 
ADD COLUMN address TEXT,
ADD COLUMN status ENUM('active', 'inactive') DEFAULT 'active';

-- æ·»åŠ å¤–é”®çº¦æŸ
ALTER TABLE orders 
ADD CONSTRAINT fk_customer_id 
FOREIGN KEY (customer_id) REFERENCES customers(id);
```

#### 1.2ã€DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰

**`DML`ï¼ˆData Manipulation Languageï¼‰**ä¸»è¦ç”¨äºå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚

| è¯­å¥ | åŠŸèƒ½ | ç‰¹ç‚¹ |
|------|------|------|
| `SELECT` | æŸ¥è¯¢æ•°æ® | æœ€å¸¸ç”¨çš„SQLè¯­å¥ |
| `INSERT` | æ’å…¥æ•°æ® | æ”¯æŒå•è¡Œå’Œæ‰¹é‡æ’å…¥ |
| `UPDATE` | æ›´æ–°æ•°æ® | å¯é…åˆWHEREæ¡ä»¶ |
| `DELETE` | åˆ é™¤æ•°æ® | å¯é…åˆWHEREæ¡ä»¶ |

#### 1.3ã€DCLï¼ˆæ•°æ®æ§åˆ¶è¯­è¨€ï¼‰

**`DCL`ï¼ˆData Control Languageï¼‰**ä¸»è¦ç”¨äºæ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™å’Œæ•°æ®å®‰å…¨æ€§ã€‚

| è¯­å¥ | åŠŸèƒ½ | ç¤ºä¾‹ |
|------|------|------|
| `GRANT` | æˆäºˆæƒé™ | `GRANT SELECT ON mydb.* TO 'user'@'localhost'` |
| `REVOKE` | æ’¤é”€æƒé™ | `REVOKE INSERT ON mydb.users FROM 'user'@'localhost'` |

#### 1.4ã€TCLï¼ˆäº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼‰

**`TCL`ï¼ˆTransaction Control Languageï¼‰**ç”¨äºç®¡ç†æ•°æ®åº“äº‹åŠ¡ã€‚

| è¯­å¥ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `BEGIN` / `START TRANSACTION` | å¼€å§‹äº‹åŠ¡ | æ ‡è®°äº‹åŠ¡å¼€å§‹ |
| `COMMIT` | æäº¤äº‹åŠ¡ | æ°¸ä¹…ä¿å­˜æ›´æ”¹ |
| `ROLLBACK` | å›æ»šäº‹åŠ¡ | æ’¤é”€æœªæäº¤çš„æ›´æ”¹ |
| `SAVEPOINT` | è®¾ç½®ä¿å­˜ç‚¹ | éƒ¨åˆ†å›æ»šçš„æ ‡è®°ç‚¹ |

### 2ã€SQLè¯­å¥çš„åŸºæœ¬ç»“æ„ä¸ä¹¦å†™è§„èŒƒ

`SQL`è¯­å¥é€šå¸¸ç”±å…³é”®å­—ã€è¡¨è¾¾å¼å’Œå­å¥ç»„æˆã€‚å…³é”®å­—æ˜¯`SQL`è¯­è¨€çš„ä¿ç•™å­—ï¼Œå¦‚`SELECT`ã€`FROM`ã€`WHERE`ç­‰ã€‚

#### 2.1ã€SQLåŸºæœ¬ç»“æ„

**æŸ¥è¯¢è¯­å¥ç»“æ„ï¼š**
```sql
SELECT column_list          -- é€‰æ‹©åˆ—
FROM table_name             -- æŒ‡å®šè¡¨
[WHERE condition]           -- è¿‡æ»¤æ¡ä»¶
[GROUP BY column]           -- åˆ†ç»„
[HAVING condition]          -- åˆ†ç»„åç­›é€‰
[ORDER BY column]           -- æ’åº
[LIMIT offset, count]       -- é™åˆ¶ç»“æœæ•°é‡
```

**æ‰§è¡Œé¡ºåºï¼š**
1. `FROM` - ç¡®å®šæ•°æ®æ¥æº
2. `WHERE` - è¡Œçº§è¿‡æ»¤
3. `GROUP BY` - åˆ†ç»„
4. `HAVING` - åˆ†ç»„çº§è¿‡æ»¤
5. `SELECT` - é€‰æ‹©åˆ—
6. `ORDER BY` - æ’åº
7. `LIMIT` - é™åˆ¶ç»“æœ

#### 2.2ã€ä¹¦å†™è§„èŒƒæœ€ä½³å®è·µ

| è§„èŒƒ | æ¨èåšæ³• | ç¤ºä¾‹ |
|------|----------|------|
| **å…³é”®å­—** | ä½¿ç”¨å¤§å†™ | `SELECT`, `FROM`, `WHERE` |
| **æ ‡è¯†ç¬¦** | ä½¿ç”¨å°å†™+ä¸‹åˆ’çº¿ | `user_name`, `order_date` |
| **ç¼©è¿›** | ä½¿ç”¨2-4ä¸ªç©ºæ ¼ | è§ä¸‹æ–¹ç¤ºä¾‹ |
| **æ¢è¡Œ** | æ¯ä¸ªä¸»è¦å­å¥ä¸€è¡Œ | è§ä¸‹æ–¹ç¤ºä¾‹ |
| **æ³¨é‡Š** | ä½¿ç”¨`--`æˆ–`/* */` | `-- æŸ¥è¯¢æ´»è·ƒç”¨æˆ·` |

**æ ‡å‡†æ ¼å¼ç¤ºä¾‹ï¼š**
```sql
-- æŸ¥è¯¢æœ€è¿‘30å¤©æ´»è·ƒç”¨æˆ·çš„è®¢å•ç»Ÿè®¡
SELECT 
    u.user_id,
    u.username,
    COUNT(o.order_id) AS total_orders,
    SUM(o.amount) AS total_amount,
    AVG(o.amount) AS avg_order_amount
FROM users u
INNER JOIN orders o ON u.user_id = o.user_id
WHERE o.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
    AND u.status = 'active'
GROUP BY u.user_id, u.username
HAVING COUNT(o.order_id) >= 5
ORDER BY total_amount DESC, total_orders DESC
LIMIT 20;
```

### 3ã€æ•°æ®åº“ã€è¡¨çš„åˆ›å»ºä¸åˆ é™¤

åœ¨`MySQL`ä¸­ï¼Œä½¿ç”¨`DDL`è¯­å¥æ¥åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“ç»“æ„ã€‚ä»¥ä¸‹æ˜¯å¸¸è§æ“ä½œçš„è¯¦ç»†ç¤ºä¾‹ï¼š

#### 3.1ã€æ•°æ®åº“æ“ä½œ

**åˆ›å»ºæ•°æ®åº“ï¼š**
```sql
-- åŸºæœ¬åˆ›å»º
CREATE DATABASE ecommerce;

-- æŒ‡å®šå­—ç¬¦é›†å’Œæ’åºè§„åˆ™
CREATE DATABASE ecommerce 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- æ¡ä»¶åˆ›å»ºï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
CREATE DATABASE IF NOT EXISTS ecommerce 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

**æŸ¥çœ‹å’Œé€‰æ‹©æ•°æ®åº“ï¼š**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“
SHOW DATABASES;

-- é€‰æ‹©ä½¿ç”¨æ•°æ®åº“
USE ecommerce;

-- æ˜¾ç¤ºå½“å‰æ•°æ®åº“
SELECT DATABASE();
```

**åˆ é™¤æ•°æ®åº“ï¼š**
```sql
-- åˆ é™¤æ•°æ®åº“ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰
DROP DATABASE ecommerce;

-- æ¡ä»¶åˆ é™¤
DROP DATABASE IF EXISTS ecommerce;
```

#### 3.2ã€è¡¨æ“ä½œè¯¦è§£

**åˆ›å»ºè¡¨çš„å®Œæ•´è¯­æ³•ï¼š**
```sql
CREATE TABLE [IF NOT EXISTS] table_name (
    column1 data_type [column_constraints],
    column2 data_type [column_constraints],
    ...
    [table_constraints]
) [table_options];
```

**å®é™…ä¸šåŠ¡è¡¨ç¤ºä¾‹ï¼š**
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT 'é‚®ç®±',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    birth_date DATE COMMENT 'å‡ºç”Ÿæ—¥æœŸ',
    gender ENUM('M', 'F', 'Other') COMMENT 'æ€§åˆ«',
    status ENUM('active', 'inactive', 'banned') DEFAULT 'active' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    -- ç´¢å¼•
    INDEX idx_email (email),
    INDEX idx_phone (phone),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_unicode_ci 
  COMMENT='ç”¨æˆ·è¡¨';

-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    order_number VARCHAR(50) NOT NULL UNIQUE,
    total_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    order_status ENUM('pending', 'paid', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending',
    payment_method ENUM('credit_card', 'debit_card', 'paypal', 'bank_transfer') NOT NULL,
    shipping_address TEXT NOT NULL,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE ON UPDATE CASCADE,
    
    -- ç´¢å¼•
    INDEX idx_user_id (user_id),
    INDEX idx_order_status (order_status),
    INDEX idx_order_date (order_date),
    INDEX idx_order_number (order_number)
) ENGINE=InnoDB COMMENT='è®¢å•è¡¨';
```

**è¡¨ä¿®æ”¹æ“ä½œï¼š**
```sql
-- æ·»åŠ åˆ—
ALTER TABLE users ADD COLUMN last_login TIMESTAMP NULL COMMENT 'æœ€åç™»å½•æ—¶é—´';

-- ä¿®æ”¹åˆ—
ALTER TABLE users MODIFY COLUMN phone VARCHAR(30) COMMENT 'æ‰‹æœºå·ç ';

-- é‡å‘½ååˆ—
ALTER TABLE users CHANGE COLUMN birth_date birthday DATE COMMENT 'ç”Ÿæ—¥';

-- åˆ é™¤åˆ—
ALTER TABLE users DROP COLUMN last_login;

-- æ·»åŠ ç´¢å¼•
ALTER TABLE users ADD INDEX idx_birthday (birthday);

-- åˆ é™¤ç´¢å¼•
ALTER TABLE users DROP INDEX idx_birthday;

-- æ·»åŠ å¤–é”®
ALTER TABLE orders ADD CONSTRAINT fk_user_orders 
FOREIGN KEY (user_id) REFERENCES users(user_id);
```

**åˆ é™¤è¡¨ï¼š**
```sql
-- åˆ é™¤è¡¨ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰
DROP TABLE orders;

-- æ¡ä»¶åˆ é™¤
DROP TABLE IF EXISTS orders;

-- æ¸…ç©ºè¡¨æ•°æ®ä½†ä¿ç•™ç»“æ„
TRUNCATE TABLE orders;  -- é‡ç½®AUTO_INCREMENT
DELETE FROM orders;     -- ä¸é‡ç½®AUTO_INCREMENT
```

**æŸ¥çœ‹è¡¨ä¿¡æ¯ï¼š**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰è¡¨
SHOW TABLES;

-- æŸ¥çœ‹è¡¨ç»“æ„
DESC users;
DESCRIBE users;
SHOW COLUMNS FROM users;

-- æŸ¥çœ‹åˆ›å»ºè¡¨çš„SQL
SHOW CREATE TABLE users;

-- æŸ¥çœ‹è¡¨çŠ¶æ€
SHOW TABLE STATUS LIKE 'users';
```

### 4ã€æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆCRUDï¼‰

ä½¿ç”¨`DML`è¯­å¥è¿›è¡Œæ•°æ®æ“ä½œæ˜¯æ•°æ®åº“ä½¿ç”¨çš„æ ¸å¿ƒã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„`CRUD`æ“ä½œç¤ºä¾‹ï¼š

#### 4.1ã€æŸ¥è¯¢æ•°æ®ï¼ˆREADï¼‰

**åŸºç¡€æŸ¥è¯¢è¯­æ³•ï¼š**
```sql
SELECT column_list
FROM table_name
[WHERE condition]
[GROUP BY column]
[HAVING condition]  
[ORDER BY column [ASC|DESC]]
[LIMIT offset, count];
```

**å®é™…æŸ¥è¯¢ç¤ºä¾‹ï¼š**
```sql
-- åŸºç¡€æŸ¥è¯¢
SELECT user_id, username, email FROM users;

-- æ¡ä»¶æŸ¥è¯¢
SELECT * FROM users 
WHERE status = 'active' 
    AND created_at >= '2023-01-01';

-- æ¨¡ç³ŠæŸ¥è¯¢
SELECT * FROM users 
WHERE username LIKE 'john%' 
    OR email LIKE '%@gmail.com';

-- èŒƒå›´æŸ¥è¯¢
SELECT * FROM orders 
WHERE total_amount BETWEEN 100 AND 1000
    AND order_date IN ('2023-01-01', '2023-01-02');

-- ç©ºå€¼æŸ¥è¯¢
SELECT * FROM users WHERE phone IS NOT NULL;

-- æ’åºæŸ¥è¯¢
SELECT * FROM orders 
ORDER BY order_date DESC, total_amount ASC;

-- é™åˆ¶ç»“æœ
SELECT * FROM users 
ORDER BY created_at DESC 
LIMIT 10;  -- æœ€æ–°çš„10ä¸ªç”¨æˆ·

-- åˆ†é¡µæŸ¥è¯¢
SELECT * FROM users 
ORDER BY user_id 
LIMIT 20, 10;  -- è·³è¿‡20æ¡ï¼Œå–10æ¡ï¼ˆç¬¬3é¡µï¼‰
```

**èšåˆæŸ¥è¯¢ï¼š**
```sql
-- ç»Ÿè®¡æŸ¥è¯¢
SELECT 
    COUNT(*) AS total_users,
    COUNT(DISTINCT email) AS unique_emails,
    AVG(TIMESTAMPDIFF(YEAR, birth_date, CURDATE())) AS avg_age
FROM users 
WHERE status = 'active';

-- åˆ†ç»„ç»Ÿè®¡
SELECT 
    DATE(created_at) AS register_date,
    COUNT(*) AS daily_registrations
FROM users 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DATE(created_at)
ORDER BY register_date;

-- åˆ†ç»„ç­›é€‰
SELECT 
    user_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent
FROM orders 
GROUP BY user_id 
HAVING COUNT(*) >= 5 AND SUM(total_amount) > 1000;
```

**å¤šè¡¨æŸ¥è¯¢ï¼š**
```sql
-- å†…è¿æ¥
SELECT 
    u.username,
    o.order_number,
    o.total_amount,
    o.order_date
FROM users u
INNER JOIN orders o ON u.user_id = o.user_id
WHERE u.status = 'active';

-- å·¦è¿æ¥ï¼ˆåŒ…å«æ²¡æœ‰è®¢å•çš„ç”¨æˆ·ï¼‰
SELECT 
    u.username,
    COUNT(o.order_id) AS order_count,
    COALESCE(SUM(o.total_amount), 0) AS total_spent
FROM users u
LEFT JOIN orders o ON u.user_id = o.user_id
GROUP BY u.user_id, u.username;

-- å­æŸ¥è¯¢
SELECT * FROM users 
WHERE user_id IN (
    SELECT DISTINCT user_id 
    FROM orders 
    WHERE total_amount > 500
);
```

#### 4.2ã€æ’å…¥æ•°æ®ï¼ˆCREATEï¼‰

**æ’å…¥è¯­æ³•ï¼š**
```sql
-- å•è¡Œæ’å…¥
INSERT INTO table_name (column1, column2, ...) 
VALUES (value1, value2, ...);

-- å¤šè¡Œæ’å…¥
INSERT INTO table_name (column1, column2, ...) 
VALUES 
    (value1a, value2a, ...),
    (value1b, value2b, ...),
    (value1c, value2c, ...);
```

**å®é™…æ’å…¥ç¤ºä¾‹ï¼š**
```sql
-- æ’å…¥æ–°ç”¨æˆ·
INSERT INTO users (username, email, password_hash, phone, gender) 
VALUES ('john_doe', 'john@example.com', SHA2('password123', 256), '13800138000', 'M');

-- æ‰¹é‡æ’å…¥ç”¨æˆ·
INSERT INTO users (username, email, password_hash, status) 
VALUES 
    ('alice', 'alice@example.com', SHA2('pass1', 256), 'active'),
    ('bob', 'bob@example.com', SHA2('pass2', 256), 'active'),
    ('charlie', 'charlie@example.com', SHA2('pass3', 256), 'inactive');

-- æ’å…¥è®¢å•
INSERT INTO orders (user_id, order_number, total_amount, payment_method, shipping_address) 
VALUES (
    1, 
    CONCAT('ORD', DATE_FORMAT(NOW(), '%Y%m%d'), LPAD(LAST_INSERT_ID(), 6, '0')),
    299.99,
    'credit_card',
    'åŒ—äº¬å¸‚æœé˜³åŒºæŸæŸè¡—é“123å·'
);

-- å¿½ç•¥é‡å¤æ•°æ®
INSERT IGNORE INTO users (username, email, password_hash) 
VALUES ('existing_user', 'existing@example.com', 'hash');

-- æ›´æ–°é‡å¤æ•°æ®
INSERT INTO users (username, email, password_hash) 
VALUES ('john_doe', 'newemail@example.com', 'newhash')
ON DUPLICATE KEY UPDATE 
    email = VALUES(email),
    updated_at = CURRENT_TIMESTAMP;
```

#### 4.3ã€æ›´æ–°æ•°æ®ï¼ˆUPDATEï¼‰

**æ›´æ–°è¯­æ³•ï¼š**
```sql
UPDATE table_name 
SET column1 = value1, column2 = value2, ...
[WHERE condition]
[ORDER BY column]
[LIMIT count];
```

**å®é™…æ›´æ–°ç¤ºä¾‹ï¼š**
```sql
-- æ›´æ–°å•ä¸ªç”¨æˆ·ä¿¡æ¯
UPDATE users 
SET 
    email = 'newemail@example.com',
    phone = '13900139000',
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 1;

-- æ‰¹é‡æ›´æ–°ç”¨æˆ·çŠ¶æ€
UPDATE users 
SET status = 'inactive'
WHERE last_login < DATE_SUB(NOW(), INTERVAL 6 MONTH);

-- åŸºäºè®¡ç®—çš„æ›´æ–°
UPDATE orders 
SET total_amount = total_amount * 1.1  -- æ¶¨ä»·10%
WHERE order_status = 'pending' 
    AND order_date >= '2023-01-01';

-- å¤šè¡¨æ›´æ–°
UPDATE users u
INNER JOIN (
    SELECT user_id, COUNT(*) as order_count 
    FROM orders 
    GROUP BY user_id
) o ON u.user_id = o.user_id
SET u.user_level = CASE 
    WHEN o.order_count >= 10 THEN 'VIP'
    WHEN o.order_count >= 5 THEN 'Gold'
    ELSE 'Regular'
END;

-- å®‰å…¨æ›´æ–°ï¼ˆé™åˆ¶æ›´æ–°æ•°é‡ï¼‰
UPDATE users 
SET status = 'verified'
WHERE email_verified = 1
ORDER BY created_at
LIMIT 100;
```

#### 4.4ã€åˆ é™¤æ•°æ®ï¼ˆDELETEï¼‰

**åˆ é™¤è¯­æ³•ï¼š**
```sql
DELETE FROM table_name 
[WHERE condition]
[ORDER BY column]
[LIMIT count];
```

**å®é™…åˆ é™¤ç¤ºä¾‹ï¼š**
```sql
-- åˆ é™¤æŒ‡å®šç”¨æˆ·
DELETE FROM users WHERE user_id = 123;

-- æ¡ä»¶åˆ é™¤
DELETE FROM users 
WHERE status = 'banned' 
    AND created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- æ‰¹é‡åˆ é™¤ï¼ˆé™åˆ¶æ•°é‡ï¼Œé¿å…é•¿æ—¶é—´é”è¡¨ï¼‰
DELETE FROM logs 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY)
ORDER BY created_at 
LIMIT 1000;

-- å¤šè¡¨åˆ é™¤
DELETE u, p 
FROM users u
LEFT JOIN profiles p ON u.user_id = p.user_id
WHERE u.status = 'deleted';

-- å®‰å…¨åˆ é™¤ç¡®è®¤
-- å…ˆæŸ¥çœ‹è¦åˆ é™¤çš„æ•°æ®
SELECT COUNT(*) FROM orders WHERE order_status = 'cancelled' AND order_date < '2022-01-01';
-- ç¡®è®¤åå†åˆ é™¤
DELETE FROM orders WHERE order_status = 'cancelled' AND order_date < '2022-01-01';
```

#### 4.5ã€äº‹åŠ¡æ“ä½œç¤ºä¾‹

```sql
-- è½¬è´¦æ“ä½œç¤ºä¾‹
START TRANSACTION;

-- æ£€æŸ¥ä½™é¢
SELECT balance FROM accounts WHERE account_id = 1 FOR UPDATE;

-- å¦‚æœä½™é¢å……è¶³ï¼Œæ‰§è¡Œè½¬è´¦
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;

-- è®°å½•è½¬è´¦æ—¥å¿—
INSERT INTO transfer_logs (from_account, to_account, amount, transfer_time) 
VALUES (1, 2, 100, NOW());

-- æäº¤äº‹åŠ¡
COMMIT;

-- å¦‚æœå‡ºé”™åˆ™å›æ»š
-- ROLLBACK;
```

**CRUDæ“ä½œæœ€ä½³å®è·µï¼š**
1. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šåˆç†ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ
2. **æ‰¹é‡æ“ä½œ**ï¼šå¤§é‡æ•°æ®æ“ä½œæ—¶ä½¿ç”¨æ‰¹é‡å¤„ç†
3. **äº‹åŠ¡æ§åˆ¶**ï¼šé‡è¦æ“ä½œä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
4. **å®‰å…¨é˜²æŠ¤**ï¼šå§‹ç»ˆä½¿ç”¨`WHERE`æ¡ä»¶ï¼Œé¿å…è¯¯æ“ä½œ
5. **æ€§èƒ½ç›‘æ§**ï¼šä½¿ç”¨`EXPLAIN`åˆ†ææŸ¥è¯¢æ€§èƒ½

## äº”ã€å‡½æ•°

### 1ã€å­—ç¬¦ä¸²å‡½æ•°

åœ¨å¤„ç†æ–‡æœ¬æ•°æ®æ—¶ï¼Œå­—ç¬¦ä¸²å‡½æ•°å…·æœ‰æ˜¾è‘—çš„ä½œç”¨ã€‚MySQL æä¾›äº†ä¼—å¤šçš„å†…ç½®å­—ç¬¦ä¸²å‡½æ•°ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å‡½æ•°åŠå…¶ç®€è¿°ï¼š

#### 1.1ã€æ•°æ®è½¬æ¢å‡½æ•°

- `ASCII(string)`: è¿”å›å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ ASCII ç å€¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT ASCII('A');` è¿”å›ç»“æœä¸º `65`.

- `BIN(number)`: å°†æ•´æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT BIN(10);` è¿”å›ç»“æœä¸º `1010`.

- `CAST(string AS type)`: å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºç‰¹å®šçš„æ•°æ®ç±»å‹ã€‚
  - ç¤ºä¾‹ï¼š`SELECT CAST('42.42' AS DECIMAL);` è¿”å›ç»“æœä¸º `42.42`.

- `CHAR(number, ...)`: å°†å¤šä¸ª ASCII ç è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT CHAR(65, 66, 67);` è¿”å›ç»“æœä¸º `ABC`.

- `CONVERT(string, type)`: å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šçš„å­—ç¬¦é›†ã€‚
  - ç¤ºä¾‹ï¼š`SELECT CONVERT('hello', BINARY);` è¿”å›ç»“æœä¸ºäºŒè¿›åˆ¶æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚

- `FROM_BASE64(string)`: å°† Base64 ç¼–ç çš„å­—ç¬¦ä¸²è§£ç ä¸ºåŸå§‹å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT FROM_BASE64('SGVsbG8gV29ybGQh');` è¿”å›ç»“æœä¸º `Hello World!`.

- `HEX(number)`: å°†æ•°å€¼è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT HEX(3055);` è¿”å›ç»“æœä¸º `BEF`.

- `OCT(number)`: å°†æ•°å€¼è½¬æ¢ä¸ºå…«è¿›åˆ¶å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT OCT(42);` è¿”å›ç»“æœä¸º `52`.

- `UNHEX(string)`: å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºåŸå§‹å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT UNHEX('48656C6C6F');` è¿”å›ç»“æœä¸º `Hello`.

#### 1.2ã€å­—ç¬¦ä¸²æ“ä½œå‡½æ•°

- `BIT_LENGTH(string)`: è¿”å›å­—ç¬¦ä¸²çš„ä½æ•°ã€‚
  - ç¤ºä¾‹ï¼š`SELECT BIT_LENGTH('hello');` è¿”å›ç»“æœä¸º `40`.

- `CHAR_LENGTH(string) / CHARACTER_LENGTH(string)`: è¿”å›å­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ã€‚
  - ç¤ºä¾‹ï¼š`SELECT CHAR_LENGTH('apple');` è¿”å›ç»“æœä¸º `5`.

- `CONCAT(string1, string2, ...)`: è¿æ¥å¤šä¸ªå­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT CONCAT('Hello ', 'World');` è¿”å›ç»“æœä¸º `Hello World`.

- `CONCAT_WS(separator, string1, string2, ...)`: ä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦è¿æ¥å¤šä¸ªå­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT CONCAT_WS(', ', 'apple', 'banana', 'cherry');` è¿”å›ç»“æœä¸º `apple, banana, cherry`.

- `INSERT(string, start, length, new_string)`: åœ¨å­—ç¬¦ä¸²çš„ç‰¹å®šä½ç½®æ’å…¥æ–°å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT INSERT('MySQL', 2, 0, 'SQL ');` è¿”å›ç»“æœä¸º `MSQLySQL SQL`.

- `LCASE(string) / LOWER(string)`: å°†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚
  - ç¤ºä¾‹ï¼š`SELECT LCASE('Hello');` è¿”å›ç»“æœä¸º `hello`.

- `LEFT(string, length)`: è¿”å›å­—ç¬¦ä¸²å·¦ä¾§çš„ç‰¹å®šé•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT LEFT('MySQL', 3);` è¿”å›ç»“æœä¸º `MyS`.

- `LENGTH(string)`: è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚
  - ç¤ºä¾‹ï¼š`SELECT LENGTH('MySQL');` è¿”å›ç»“æœä¸º `5`.

- `LPAD(string, length, pad_string)`: åœ¨å­—ç¬¦ä¸²å·¦ä¾§å¡«å……æŒ‡å®šå­—ç¬¦ä»¥è¾¾åˆ°ç‰¹å®šé•¿åº¦ã€‚
  - ç¤ºä¾‹ï¼š`SELECT LPAD('hello', 10, 'X');` è¿”å›ç»“æœä¸º `XXXXXhello`.

- `LTRIM(string)`: å»é™¤å­—ç¬¦ä¸²å·¦ä¾§çš„ç©ºæ ¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT LTRIM('   MySQL   ');` è¿”å›ç»“æœä¸º `MySQL   `.

- `MID(string, start, length)`: è¿”å›å­—ç¬¦ä¸²çš„ç‰¹å®šéƒ¨åˆ†ã€‚
  - ç¤ºä¾‹ï¼š`SELECT MID('MySQL', 2, 3);` è¿”å›ç»“æœä¸º `ySQ`.

- `REPEAT(string, count)`: é‡å¤å­—ç¬¦ä¸²æŒ‡å®šçš„æ¬¡æ•°ã€‚
  - ç¤ºä¾‹ï¼š`SELECT REPEAT('MySQL', 2);` è¿”å›ç»“æœä¸º `MySQLMySQL`.

- `REPLACE(string, search_string, replacement_string)`: æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå­—ç¬¦ã€‚
  - ç¤ºä¾‹ï¼š`SELECT REPLACE('Hello World', 'World', 'Universe');` è¿”å›ç»“æœä¸º `Hello Universe`.

- `REVERSE(string)`: åè½¬å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT REVERSE('MySQL');` è¿”å›ç»“æœä¸º `LQSyM`.

- `RIGHT(string, length)`: è¿”å›å­—ç¬¦ä¸²å³ä¾§çš„ç‰¹å®šé•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT RIGHT('MySQL', 3);` è¿”å›ç»“æœä¸º `QL`.

- `RPAD(string, length, pad_string)`: åœ¨å­—ç¬¦ä¸²å³ä¾§å¡«å……æŒ‡å®šå­—ç¬¦ä»¥è¾¾åˆ°ç‰¹å®šé•¿åº¦ã€‚
  - ç¤ºä¾‹ï¼š`SELECT RPAD('hello', 10, 'X');` è¿”å›ç»“æœä¸º `helloXXXXX`.

- `RTRIM(string)`: å»é™¤å­—ç¬¦ä¸²å³ä¾§çš„ç©ºæ ¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT RTRIM('   MySQL   ');` è¿”å›ç»“æœä¸º `   MySQL`.

- `SPACE(length)`: è¿”å›æŒ‡å®šé•¿åº¦çš„ç©ºæ ¼å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT SPACE(5);` è¿”å›ç»“æœä¸º `     `.

- `SUBSTRING(string, start, length)`: ä»å­—ç¬¦ä¸²ä¸­æå–å­å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT SUBSTRING('MySQL', 2, 3);` è¿”å›ç»“æœä¸º `ySQ`.

- `SUBSTRING_INDEX(string, delimiter, count)`: è¿”å›åˆ†éš”ç¬¦åˆ†éš”çš„å­—ç¬¦ä¸²çš„æŸä¸ªéƒ¨åˆ†ã€‚
  - ç¤ºä¾‹ï¼š`SELECT SUBSTRING_INDEX('a,b,c,d', ',', 2);` è¿”å›ç»“æœä¸º `a,b`.

- `TRIM(string)`: å»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œæœ«å°¾çš„ç©ºæ ¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT TRIM('   MySQL   ');` è¿”å›ç»“æœä¸º `MySQL`.

- `UCASE(string)`: å°†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ã€‚
  - ç¤ºä¾‹ï¼š`SELECT UCASE('hello');` è¿”å›ç»“æœä¸º `HELLO`.

#### 1.3ã€å…¶ä»–å­—ç¬¦ä¸²å‡½æ•°

- `ELT(index, string1, string2, ...)`: è¿”å›å­—ç¬¦ä¸²åˆ—è¡¨ä¸­æŒ‡å®šç´¢å¼•çš„å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT ELT(2, 'apple', 'banana', 'cherry');` è¿”å›ç»“æœä¸º `banana`.

- `EXPORT_SET(bits, on, off, separator, width)`: å°†äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºç”±ç‰¹å®šå­—ç¬¦ä¸²è¡¨ç¤ºçš„å€¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT EXPORT_SET(5, 'Y', 'N', ',', 8);` è¿”å›ç»“æœä¸º `N,N,Y,N,N,N,N,N`.

- `FIELD(string, string1, string2, ...)`: è¿”å›å­—ç¬¦ä¸²åœ¨æŒ‡å®šå­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚
  - ç¤ºä¾‹ï¼š`SELECT FIELD('apple', 'orange', 'banana', 'apple');` è¿”å›ç»“æœä¸º `3`.

- `FIND_IN_SET(string, string_list)`: è¿”å›å­—ç¬¦ä¸²åœ¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚
  - ç¤ºä¾‹ï¼š`SELECT FIND_IN_SET('apple', 'orange,banana,apple,grape');` è¿”å›ç»“æœä¸º `3`.

- `FORMAT(number, decimals)`: å°†æ•°å€¼æ ¼å¼åŒ–ä¸ºç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT FORMAT(12345.6789, 2);` è¿”å›ç»“æœä¸º `12,345.68`.

- `INSTR(string, substring) / LOCATE(substring, string, start) / POSITION(substring IN string)`: è¿”å›å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚
  - ç¤ºä¾‹ï¼š`SELECT INSTR('hello world', 'world');` è¿”å›ç»“æœä¸º `7`.

- `LOAD_FILE(filename)`: å°†æ–‡ä»¶å†…å®¹è¯»å…¥å­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT LOAD_FILE('/path/to/file.txt');` è¿”å›æ–‡ä»¶å†…å®¹çš„å­—ç¬¦ä¸²å½¢å¼ã€‚

- `MAKE_SET(bits, string1, string2, ...)`: å°†äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºç”±ç‰¹å®šå­—ç¬¦ä¸²è¡¨ç¤ºçš„é›†åˆã€‚
  - ç¤ºä¾‹ï¼š`SELECT MAKE_SET(1 | 4, 'apple', 'banana', 'cherry', 'date');` è¿”å›ç»“æœä¸º `apple,cherry`.

- `ORD(char)`: è¿”å›å­—ç¬¦çš„ ASCII ç å€¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT ORD('A');` è¿”å›ç»“æœä¸º `65`.

- `QUOTE(string)`: ä¸ºå­—ç¬¦ä¸²æ·»åŠ å¼•å·ã€‚
  - ç¤ºä¾‹ï¼š`SELECT QUOTE('It\'s a sunny day');` è¿”å›ç»“æœä¸º `'It\'s a sunny day'`.

- `SOUNDEX(string)`: è¿”å›å­—ç¬¦ä¸²çš„ SOUNDEX ç¼–ç ã€‚
  - ç¤ºä¾‹ï¼š`SELECT SOUNDEX('MySQL');` è¿”å›ç»“æœä¸º `M240`.

- `STRCMP(string1, string2)`: æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å¤§å°å…³ç³»ã€‚
  - ç¤ºä¾‹ï¼š`SELECT STRCMP('apple', 'banana');` è¿”å›ç»“æœä¸º `-1`.

è¿™äº›å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥ç”¨äºå­—ç¬¦ä¸²çš„æ“ä½œã€è½¬æ¢ã€åŒ¹é…ç­‰æ“ä½œï¼Œèƒ½å¤Ÿæ»¡è¶³ MySQL ä¸­å¤§éƒ¨åˆ†çš„å­—ç¬¦ä¸²å¤„ç†éœ€æ±‚ã€‚

### 2ã€æ•°å€¼å‡½æ•°

æ•°å€¼å‡½æ•°ä¸»è¦ç”¨äºå¤„ç†å„ç§æ•°å€¼æ•°æ®ï¼Œä¾‹å¦‚æ•´æ•°å’Œæµ®ç‚¹æ•°ã€‚MySQLæä¾›äº†è®¸å¤šå†…ç½®çš„æ•°å€¼å‡½æ•°ï¼š

#### 2.1ã€åŸºæœ¬æ•°å­¦å‡½æ•°

- `ABS(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ã€‚
   - ç¤ºä¾‹ï¼š`SELECT ABS(-10);` è¿”å›ç»“æœä¸º `10`.

- `CEIL(number) / CEILING(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„å‘ä¸Šå–æ•´å€¼ã€‚
   - ç¤ºä¾‹ï¼š`SELECT CEIL(3.14);` è¿”å›ç»“æœä¸º `4`.

- `FLOOR(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„å‘ä¸‹å–æ•´å€¼ã€‚
   - ç¤ºä¾‹ï¼š`SELECT FLOOR(3.9);` è¿”å›ç»“æœä¸º `3`.

- `MOD(number, divisor)`: è¿”å›ä¸¤ä¸ªæ•°å€¼ç›¸é™¤çš„ä½™æ•°.
   - ç¤ºä¾‹ï¼š`SELECT MOD(10, 3);` è¿”å›ç»“æœä¸º `1`.

- `PI()`: è¿”å›åœ†å‘¨ç‡Ï€çš„å€¼.
   - ç¤ºä¾‹ï¼š`SELECT PI();` è¿”å›ç»“æœä¸º `3.141592653589793`.

- `POW(number, exponent) / POWER(number, exponent)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„æŒ‡å®šå¹‚æ¬¡æ–¹.
   - ç¤ºä¾‹ï¼š`SELECT POW(2, 3);` è¿”å›ç»“æœä¸º `8`.

- `ROUND(number, decimals)`: å°†ä¸€ä¸ªæ•°å€¼å››èˆäº”å…¥åˆ°æŒ‡å®šçš„å°æ•°ä½æ•°.
   - ç¤ºä¾‹ï¼š`SELECT ROUND(3.14159, 2);` è¿”å›ç»“æœä¸º `3.14`.

- `SIGN(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„ç¬¦å·ï¼ˆ1ã€0æˆ–-1ï¼‰.
   - ç¤ºä¾‹ï¼š`SELECT SIGN(-10);` è¿”å›ç»“æœä¸º `-1`.

- `SQRT(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„å¹³æ–¹æ ¹.
   - ç¤ºä¾‹ï¼š`SELECT SQRT(25);` è¿”å›ç»“æœä¸º `5`.

- `TRUNCATE(number, decimals)`: å°†ä¸€ä¸ªæ•°å€¼æˆªæ–­åˆ°æŒ‡å®šçš„å°æ•°ä½æ•°.
   - ç¤ºä¾‹ï¼š`SELECT TRUNCATE(3.14159, 2);` è¿”å›ç»“æœä¸º `3.14`.

#### 2.2ã€ä¸‰è§’å‡½æ•°

- `ACOS(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„åä½™å¼¦å€¼.
   - ç¤ºä¾‹ï¼š`SELECT ACOS(0.5);` è¿”å›ç»“æœä¸º `1.0471975511965979`.

- `ASIN(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„åæ­£å¼¦å€¼.
   - ç¤ºä¾‹ï¼š`SELECT ASIN(0.5);` è¿”å›ç»“æœä¸º `0.5235987755982989`.

- `ATAN(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„åæ­£åˆ‡å€¼.
   - ç¤ºä¾‹ï¼š`SELECT ATAN(1);` è¿”å›ç»“æœä¸º `0.7853981633974483`.

- `ATAN2(y, x)`: è¿”å›y/xçš„åæ­£åˆ‡å€¼.
   - ç¤ºä¾‹ï¼š`SELECT ATAN2(1, 1);` è¿”å›ç»“æœä¸º `0.7853981633974483`.

- `COS(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„ä½™å¼¦å€¼.
   - ç¤ºä¾‹ï¼š`SELECT COS(0);` è¿”å›ç»“æœä¸º `1`.

- `COT(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„ä½™åˆ‡å€¼.
   - ç¤ºä¾‹ï¼š`SELECT COT(1);` è¿”å›ç»“æœä¸º `0.6420926159343306`.

- `SIN(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„æ­£å¼¦å€¼.
   - ç¤ºä¾‹ï¼š`SELECT SIN(0);` è¿”å›ç»“æœä¸º `0`.

- `TAN(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„æ­£åˆ‡å€¼.
   - ç¤ºä¾‹ï¼š`SELECT TAN(0);` è¿”å›ç»“æœä¸º `0`.

#### 2.3ã€å¯¹æ•°å’ŒæŒ‡æ•°å‡½æ•°

- `EXP(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„æŒ‡æ•°å€¼.
   - ç¤ºä¾‹ï¼š`SELECT EXP(1);` è¿”å›ç»“æœä¸º `2.718281828459045`.

- `LN(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„è‡ªç„¶å¯¹æ•°.
   - ç¤ºä¾‹ï¼š`SELECT LN(10);` è¿”å›ç»“æœä¸º `2.302585092994046`.

- `LOG(number, base)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„æŒ‡å®šåº•æ•°çš„å¯¹æ•°.
   - ç¤ºä¾‹ï¼š`SELECT LOG(1000, 10);` è¿”å›ç»“æœä¸º `3`.

- `LOG10(number)`: è¿”å›ä¸€ä¸ªæ•°å€¼çš„ä»¥10ä¸ºåº•æ•°çš„å¯¹æ•°.
   - ç¤ºä¾‹ï¼š`SELECT LOG10(100);` è¿”å›ç»“æœä¸º `2`.

#### 2.4ã€è§’åº¦å’Œå¼§åº¦è½¬æ¢

- `DEGREES(number)`: å°†å¼§åº¦è½¬æ¢ä¸ºè§’åº¦.
   - ç¤ºä¾‹ï¼š`SELECT DEGREES(1.57);` è¿”å›ç»“æœä¸º `89.95437383553924`.

- `RADIANS(number)`: å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦.
   - ç¤ºä¾‹ï¼š`SELECT RADIANS(90);` è¿”å›ç»“æœä¸º `1.5707963267948966`.

#### 2.5ã€éšæœºæ•°ç”Ÿæˆ

- `RAND()`: è¿”å›ä¸€ä¸ª0~1ä¹‹é—´çš„éšæœºæ•°.
   - ç¤ºä¾‹ï¼š`SELECT RAND();` è¿”å›ä¸€ä¸ªä»‹äº 0 å’Œ 1 ä¹‹é—´çš„éšæœºæ•°ã€‚

è¿™äº›æ•°å€¼å‡½æ•°å¯ä»¥ç”¨äºæ•°å€¼çš„è®¡ç®—ã€è½¬æ¢ç­‰æ“ä½œï¼Œèƒ½å¤Ÿæ»¡è¶³MySQLä¸­å¤§éƒ¨åˆ†çš„æ•°å€¼å¤„ç†éœ€æ±‚ã€‚

### 3ã€æ—¥æœŸå’Œæ—¶é—´å‡½æ•°

å¤„ç†æ—¥æœŸå’Œæ—¶é—´æ•°æ®æ—¶ï¼Œæ—¥æœŸå’Œæ—¶é—´å‡½æ•°éå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ—¥æœŸå’Œæ—¶é—´å‡½æ•°ï¼š

#### 3.1ã€æ—¥æœŸ/æ—¶é—´å¢å‡å‡½æ•°

- `ADDDATE(date, INTERVAL value unit) / DATE_ADD(date, INTERVAL value unit)`: å°†æ—¥æœŸåŠ ä¸ŠæŒ‡å®šçš„æ—¶é—´é—´éš”.
  - ç¤ºä¾‹ï¼š`SELECT ADDDATE('2024-11-01', INTERVAL 3 DAY);` è¿”å›ç»“æœä¸º `2024-11-04`.

- `ADDTIME(time1, time2)`: å°†ä¸¤ä¸ªæ—¶é—´ç›¸åŠ .
  - ç¤ºä¾‹ï¼š`SELECT ADDTIME('10:00:00', '02:30:00');` è¿”å›ç»“æœä¸º `12:30:00`.

- `DATE_SUB(date, INTERVAL value unit) / SUBDATE(date, INTERVAL value unit)`: å°†æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”.
  - ç¤ºä¾‹ï¼š`SELECT DATE_SUB('2024-11-10', INTERVAL 1 WEEK);` è¿”å›ç»“æœä¸º `2024-11-03`.

- `SUBTIME(time1, time2)`: å°†ä¸€ä¸ªæ—¶é—´å€¼å‡å»å¦ä¸€ä¸ªæ—¶é—´å€¼.
  - ç¤ºä¾‹ï¼š`SELECT SUBTIME('14:30:00', '02:15:00');` è¿”å›ç»“æœä¸º `12:15:00`.

#### 3.2ã€æ—¥æœŸ/æ—¶é—´è·å–å‡½æ•°

- `CURDATE() / CURRENT_DATE()`: è¿”å›å½“å‰æ—¥æœŸ.
  - ç¤ºä¾‹ï¼š`SELECT CURDATE();` è¿”å›å½“å‰æ—¥æœŸ `2024-11-06`.

- `CURRENT_TIME() / CURTIME()`: è¿”å›å½“å‰æ—¶é—´.
  - ç¤ºä¾‹ï¼š`SELECT CURTIME();` è¿”å›å½“å‰æ—¶é—´ `15:30:00`.

- `CURRENT_TIMESTAMP() / NOW()`: è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´.
  - ç¤ºä¾‹ï¼š`SELECT NOW();` è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ `2024-11-06 15:30:45`.

- `LOCALTIME()`: è¿”å›å½“å‰æœ¬åœ°æ—¶é—´.
  - ç¤ºä¾‹ï¼š`SELECT LOCALTIME();` è¿”å›å½“å‰æœ¬åœ°æ—¶é—´ `15:30:00`.

- `LOCALTIMESTAMP()`: è¿”å›å½“å‰æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´.
  - ç¤ºä¾‹ï¼š`SELECT LOCALTIMESTAMP();` è¿”å›å½“å‰æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ `2024-11-06 15:30:45`.

- `SYSDATE()`: è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´.
  - ç¤ºä¾‹ï¼š`SELECT SYSDATE();` è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ `2024-11-06 15:30:45`.

- `UNIX_TIMESTAMP()`: è¿”å›å½“å‰çš„Unixæ—¶é—´æˆ³.
  - ç¤ºä¾‹ï¼š`SELECT UNIX_TIMESTAMP();` è¿”å›å½“å‰çš„Unixæ—¶é—´æˆ³ `1636200645`.

- `UTC_DATE()`: è¿”å›å½“å‰UTCæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT UTC_DATE();` è¿”å›UTCæ—¥æœŸ `2024-11-06`.

- `UTC_TIME()`: è¿”å›å½“å‰UTCæ—¶é—´çš„æ—¶é—´éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT UTC_TIME();` è¿”å›UTCæ—¶é—´ `07:30:45`.

- `UTC_TIMESTAMP()`: è¿”å›å½“å‰UTCæ—¶é—´çš„æ—¥æœŸå’Œæ—¶é—´.
  - ç¤ºä¾‹ï¼š`SELECT UTC_TIMESTAMP();` è¿”å›UTCæ—¥æœŸå’Œæ—¶é—´ `2024-11-06 07:30:45`.

#### 3.3ã€æ—¥æœŸ/æ—¶é—´æ ¼å¼è½¬æ¢å‡½æ•°

- `CONVERT_TZ(dt, from_tz, to_tz)`: å°†æ—¥æœŸä»ä¸€ä¸ªæ—¶åŒºè½¬æ¢åˆ°å¦ä¸€ä¸ªæ—¶åŒº.
  - ç¤ºä¾‹ï¼š`SELECT CONVERT_TZ('2024-11-06 12:00:00', 'UTC', 'America/New_York');`.

- `DATE(date)`: è¿”å›æ—¥æœŸæˆ–æ—¥æœŸæ—¶é—´å€¼çš„æ—¥æœŸéƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT DATE('2024-11-06 12:00:00');` è¿”å›æ—¥æœŸéƒ¨åˆ† `2024-11-06`.

- `DATE_FORMAT(date, format)`: å°†æ—¥æœŸæ ¼å¼åŒ–æˆæŒ‡å®šçš„å­—ç¬¦ä¸².
  - ç¤ºä¾‹ï¼š`SELECT DATE_FORMAT('2024-11-06', '%W, %M %e, %Y');` è¿”å›æ ¼å¼åŒ–åçš„æ—¥æœŸå­—ç¬¦ä¸²ã€‚

- `FROM_DAYS(days)`: å°†å¤©æ•°å€¼è½¬æ¢æˆæ—¥æœŸå€¼.
  - ç¤ºä¾‹ï¼š`SELECT FROM_DAYS(737999);` è¿”å›æ—¥æœŸ `2024-11-06`.

- `FROM_UNIXTIME(unix_timestamp, format)`: å°†Unixæ—¶é—´æˆ³è½¬æ¢æˆæ—¥æœŸæ ¼å¼çš„å­—ç¬¦ä¸².
  - ç¤ºä¾‹ï¼š`SELECT FROM_UNIXTIME(1636185600, '%Y-%m-%d %H:%i:%s');`.

- `GET_FORMAT(format_type)`: è¿”å›æ—¥æœŸæ ¼å¼çš„å­—ç¬¦ä¸².
  - ç¤ºä¾‹ï¼š`SELECT GET_FORMAT(DATE, 'EUR');`.

- `MAKEDATE(year, day_of_year)`: è¿”å›å¹´ä»½å’Œä¸€å¹´ä¸­çš„å¤©æ•°å¯¹åº”çš„æ—¥æœŸå€¼.
  - ç¤ºä¾‹ï¼š`SELECT MAKEDATE(2024, 310);` è¿”å›æ—¥æœŸ `2024-11-05`.

- `MAKETIME(hour, minute, second)`: è¿”å›æ—¶é—´å€¼.
  - ç¤ºä¾‹ï¼š`SELECT MAKETIME(12, 30, 45);` è¿”å›æ—¶é—´ `12:30:45`.

- `STR_TO_DATE(string, format)`: å°†å­—ç¬¦ä¸²è§£ææˆæ—¥æœŸæˆ–æ—¶é—´å€¼.
  - ç¤ºä¾‹ï¼š`SELECT STR_TO_DATE('2024-11-06', '%Y-%m-%d');` è¿”å›æ—¥æœŸ `2024-11-06`.

- `TIME(time)`: è¿”å›æ—¶é—´æˆ–æ—¥æœŸæ—¶é—´å€¼çš„æ—¶é—´éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT TIME('2024-11-06 12:30:00');` è¿”å›æ—¶é—´éƒ¨åˆ† `12:30:00`.

- `TIME_FORMAT(time, format)`: å°†æ—¶é—´æ ¼å¼åŒ–æˆæŒ‡å®šçš„å­—ç¬¦ä¸².
  - ç¤ºä¾‹ï¼š`SELECT TIME_FORMAT('12:30:45', '%H-%i-%s');` è¿”å›æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²ã€‚

- `TIMESTAMP(date, time)`: å°†æ—¥æœŸå’Œæ—¶é—´å€¼åˆå¹¶æˆæ—¥æœŸæ—¶é—´å€¼.
  - ç¤ºä¾‹ï¼š`SELECT TIMESTAMP('2024-11-06', '12:30:00');` è¿”å›æ—¥æœŸæ—¶é—´å€¼ `2024-11-06 12:30:00`.

#### 3.4ã€æ—¥æœŸ/æ—¶é—´è®¡ç®—å‡½æ•°

- `DATEDIFF(date1, date2)`: è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°å·®.
  - ç¤ºä¾‹ï¼š`SELECT DATEDIFF('2024-11-10', '2024-11-01');` è¿”å›å¤©æ•°å·® `9`.

- `DAY(date) / DAYOFMONTH(date)`: è¿”å›æ—¥æœŸçš„å¤©æ•°éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT DAY('2024-11-06');` è¿”å›å¤©æ•° `6`.

- `DAYNAME(date)`: è¿”å›æ—¥æœŸçš„æ˜ŸæœŸå‡ åç§°.
  - ç¤ºä¾‹ï¼š`SELECT DAYNAME('2024-11-06');` è¿”å›æ˜ŸæœŸå‡  `Monday`.

- `DAYOFWEEK(date)`: è¿”å›æ—¥æœŸçš„æ˜ŸæœŸå‡ ï¼Œ1è¡¨ç¤ºæ˜ŸæœŸæ—¥ï¼Œ7è¡¨ç¤ºæ˜ŸæœŸå…­.
  - ç¤ºä¾‹ï¼š`SELECT DAYOFWEEK('2024-11-06');` è¿”å›æ˜ŸæœŸå‡  `5`.

- `DAYOFYEAR(date)`: è¿”å›æ—¥æœŸçš„å¹´ä»½ä¸­çš„å¤©æ•°.
  - ç¤ºä¾‹ï¼š`SELECT DAYOFYEAR('2024-11-06');` è¿”å›å¹´ä»½ä¸­çš„å¤©æ•° `311`.

- `EXTRACT(unit FROM date)`: ä»æ—¥æœŸæˆ–æ—¶é—´å€¼ä¸­æå–æŒ‡å®šçš„éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT EXTRACT(MONTH FROM '2024-11-06');` è¿”å›æå–çš„éƒ¨åˆ† `11`.

- `HOUR(time)`: è¿”å›æ—¶é—´çš„å°æ—¶éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT HOUR('12:30:00');` è¿”å›å°æ—¶éƒ¨åˆ† `12`.

- `INTERVAL(expr, unit)`: è¿”å›æ—¶é—´é—´éš”çš„å€¼.
  - ç¤ºä¾‹ï¼š`SELECT INTERVAL 10 DAY;` è¿”å›æ—¶é—´é—´éš” `10`.

- `LAST_DAY(date)`: è¿”å›æ—¥æœŸæ‰€åœ¨æœˆä»½çš„æœ€åä¸€å¤©.
  - ç¤ºä¾‹ï¼š`SELECT LAST_DAY('2024-11-06');` è¿”å›æœ€åä¸€å¤©çš„æ—¥æœŸ `2024-11-30`.

- `MICROSECOND(time)`: è¿”å›æ—¶é—´å€¼çš„å¾®ç§’éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT MICROSECOND('12:30:45.123456');` è¿”å›å¾®ç§’éƒ¨åˆ† `123456`.

- `MINUTE(time)`: è¿”å›æ—¶é—´å€¼çš„åˆ†é’Ÿéƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT MINUTE('12:30:45');` è¿”å›åˆ†é’Ÿéƒ¨åˆ† `30`.

- `MONTH(date)`: è¿”å›æ—¥æœŸçš„æœˆä»½éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT MONTH('2024-11-06');` è¿”å›æœˆä»½éƒ¨åˆ† `11`.

- `MONTHNAME(date)`: è¿”å›æ—¥æœŸçš„æœˆä»½åç§°.
  - ç¤ºä¾‹ï¼š`SELECT MONTHNAME('2024-11-06');` è¿”å›æœˆä»½åç§° `November`.

- `PERIOD_ADD(period, n)`: å°†å‘¨æœŸå€¼åŠ ä¸ŠæŒ‡å®šçš„æ•°é‡.
  - ç¤ºä¾‹ï¼š`SELECT PERIOD_ADD(202411, 2);` è¿”å›åŠ ä¸Šæ•°é‡åçš„å‘¨æœŸå€¼ `202501`.

- `PERIOD_DIFF(period1, period2)`: è®¡ç®—ä¸¤ä¸ªå‘¨æœŸå€¼ä¹‹é—´çš„å·®.
  - ç¤ºä¾‹ï¼š`SELECT PERIOD_DIFF(202412, 202410);` è¿”å›å‘¨æœŸå€¼ä¹‹é—´çš„å·® `2`.

- `QUARTER(date)`: è¿”å›æ—¥æœŸæ‰€åœ¨çš„å­£åº¦.
  - ç¤ºä¾‹ï¼š`SELECT QUARTER('2024-11-06');` è¿”å›å­£åº¦ `4`.

- `SECOND(time)`: è¿”å›æ—¶é—´å€¼çš„ç§’éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT SECOND('12:30:45');` è¿”å›ç§’éƒ¨åˆ† `45`.

- `SEC_TO_TIME(seconds)`: å°†ç§’æ•°è½¬æ¢æˆæ—¶é—´å€¼.
  - ç¤ºä¾‹ï¼š`SELECT SEC_TO_TIME(3660);` è¿”å›æ—¶é—´å€¼ `01:01:00`.

- `TIME_TO_SEC(time)`: å°†æ—¶é—´å€¼è½¬æ¢æˆç§’æ•°.
  - ç¤ºä¾‹ï¼š`SELECT TIME_TO_SEC('01:30:00');` è¿”å›ç§’æ•° `5400`.

- `TIMEDIFF(time1, time2)`: è®¡ç®—ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„å·®.
  - ç¤ºä¾‹ï¼š`SELECT TIMEDIFF('12:30:00', '10:00:00');` è¿”å›æ—¶é—´å·® `02:30:00`.

- `TIMESTAMPADD(unit, interval, datetime_expr)`: å°†æ—¶é—´é—´éš”åŠ åˆ°æ—¥æœŸæ—¶é—´å€¼ä¸Š.
  - ç¤ºä¾‹ï¼š`SELECT TIMESTAMPADD(MINUTE, 30, '2024-11-06 12:00:00');`.

- `TIMESTAMPDIFF(unit, datetime_expr1, datetime_expr2)`: è®¡ç®—ä¸¤ä¸ªæ—¥æœŸæ—¶é—´å€¼ä¹‹é—´çš„æ—¶é—´å·®.
  - ç¤ºä¾‹ï¼š`SELECT TIMESTAMPDIFF(MINUTE, '2024-11-06 12:00:00', '2024-11-06 12:30:00');` è¿”å›æ—¶é—´å·® `30`.

- `TO_DAYS(date)`: å°†æ—¥æœŸå€¼è½¬æ¢æˆå¤©æ•°å€¼.
  - ç¤ºä¾‹ï¼š`SELECT TO_DAYS('2024-11-06');` è¿”å›å¤©æ•°å€¼ `737999`.

- `WEEK(date, mode)`: è¿”å›æ—¥æœŸæ‰€åœ¨çš„å‘¨æ•°.
  - ç¤ºä¾‹ï¼š`SELECT WEEK('2024-11-06');` è¿”å›å‘¨æ•° `45`.

- `WEEKDAY(date)`: è¿”å›æ—¥æœŸçš„æ˜ŸæœŸå‡ ï¼Œ0è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œ6è¡¨ç¤ºæ˜ŸæœŸæ—¥.
  - ç¤ºä¾‹ï¼š`SELECT WEEKDAY('2024-11-06');` è¿”å›æ˜ŸæœŸå‡  `4`.

- `WEEKOFYEAR(date)`: è¿”å›æ—¥æœŸæ‰€åœ¨çš„å‘¨æ•°.
  - ç¤ºä¾‹ï¼š`SELECT WEEKOFYEAR('2024-11-06');` è¿”å›å‘¨æ•° `45`.

- `YEAR(date)`: è¿”å›æ—¥æœŸçš„å¹´ä»½éƒ¨åˆ†.
  - ç¤ºä¾‹ï¼š`SELECT YEAR('2024-11-06');` è¿”å›å¹´ä»½éƒ¨åˆ† `2024`.

- `YEARWEEK(date, mode)`: è¿”å›æ—¥æœŸæ‰€åœ¨çš„å¹´ä»½å’Œå‘¨æ•°.
  - ç¤ºä¾‹ï¼š`SELECT YEARWEEK('2024-11-06');` è¿”å›å¹´ä»½å’Œå‘¨æ•° `2024-45`.

è¿™äº›æ—¥æœŸå’Œæ—¶é—´å‡½æ•°å¯ä»¥ç”¨äºæ—¥æœŸå’Œæ—¶é—´çš„æ“ä½œã€è½¬æ¢ã€æ ¼å¼åŒ–ç­‰æ“ä½œï¼Œèƒ½æ»¡è¶³MySQLä¸­å¤§éƒ¨åˆ†çš„æ—¥æœŸå’Œæ—¶é—´å¤„ç†éœ€æ±‚ã€‚

### 4ã€èšåˆå‡½æ•°

èšåˆå‡½æ•°ç”¨äºå¯¹ä¸€ç»„å€¼æ‰§è¡Œè®¡ç®—å¹¶è¿”å›å•ä¸ªå€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„èšåˆå‡½æ•°ï¼š

- `AVG()`: è®¡ç®—æŸä¸ªåˆ—çš„å¹³å‡å€¼.
  - ç¤ºä¾‹ï¼š`SELECT AVG(salary) FROM employees;` è¿”å›ç»“æœä¸ºå¹³å‡å·¥èµ„å€¼ã€‚

- `BIT_AND()`: å¯¹æŸä¸ªåˆ—çš„æ‰€æœ‰å€¼æ‰§è¡ŒæŒ‰ä½ANDè¿ç®—.
  - ç¤ºä¾‹ï¼š`SELECT BIT_AND(flags) FROM data_table;` è¿”å›æŒ‰ä½ANDè¿ç®—ç»“æœã€‚

- `BIT_OR()`: å¯¹æŸä¸ªåˆ—çš„æ‰€æœ‰å€¼æ‰§è¡ŒæŒ‰ä½ORè¿ç®—.
  - ç¤ºä¾‹ï¼š`SELECT BIT_OR(flags) FROM data_table;` è¿”å›æŒ‰ä½ORè¿ç®—ç»“æœã€‚

- `BIT_XOR()`: å¯¹æŸä¸ªåˆ—çš„æ‰€æœ‰å€¼æ‰§è¡ŒæŒ‰ä½XORè¿ç®—.
  - ç¤ºä¾‹ï¼š`SELECT BIT_XOR(flags) FROM data_table;` è¿”å›æŒ‰ä½XORè¿ç®—ç»“æœã€‚

- `COUNT()`: è®¡ç®—æŸä¸ªåˆ—ä¸­çš„è¡Œæ•°.
  - ç¤ºä¾‹ï¼š`SELECT COUNT(*) FROM products;` è¿”å›è¡Œæ•°è®¡æ•°ç»“æœã€‚

- `GROUP_CONCAT()`: å°†æŸä¸ªåˆ—ä¸­çš„æ‰€æœ‰å€¼è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸².
  - ç¤ºä¾‹ï¼š`SELECT GROUP_CONCAT(product_name) FROM order_details GROUP BY order_id;` è¿”å›è¿æ¥åçš„å­—ç¬¦ä¸²ã€‚

- `MAX()`: è®¡ç®—æŸä¸ªåˆ—çš„æœ€å¤§å€¼.
  - ç¤ºä¾‹ï¼š`SELECT MAX(price) FROM products;` è¿”å›æœ€å¤§å€¼ç»“æœã€‚

- `MIN()`: è®¡ç®—æŸä¸ªåˆ—çš„æœ€å°å€¼.
  - ç¤ºä¾‹ï¼š`SELECT MIN(quantity) FROM inventory;` è¿”å›æœ€å°å€¼ç»“æœã€‚

- `STD() / STDDEV()`: è®¡ç®—æŸä¸ªåˆ—çš„æ ‡å‡†å·®.
  - ç¤ºä¾‹ï¼š`SELECT STDDEV(sales) FROM monthly_data;` è¿”å›æ ‡å‡†å·®ç»“æœã€‚

- `STDDEV_POP()`: è®¡ç®—æŸä¸ªåˆ—çš„æ€»ä½“æ ‡å‡†å·®.
  - ç¤ºä¾‹ï¼š`SELECT STDDEV_POP(age) FROM population_data;` è¿”å›æ€»ä½“æ ‡å‡†å·®ç»“æœã€‚

- `STDDEV_SAMP()`: è®¡ç®—æŸä¸ªåˆ—çš„æ ·æœ¬æ ‡å‡†å·®.
  - ç¤ºä¾‹ï¼š`SELECT STDDEV_SAMP(sales) FROM sales_data;` è¿”å›æ ·æœ¬æ ‡å‡†å·®ç»“æœã€‚

- `SUM()`: è®¡ç®—æŸä¸ªåˆ—çš„æ€»å’Œ.
  - ç¤ºä¾‹ï¼š`SELECT SUM(total_sales) FROM yearly_data;` è¿”å›æ€»å’Œç»“æœã€‚

- `VAR_POP()`: è®¡ç®—æŸä¸ªåˆ—çš„æ€»ä½“æ–¹å·®.
  - ç¤ºä¾‹ï¼š`SELECT VAR_POP(income) FROM population_data;` è¿”å›æ€»ä½“æ–¹å·®ç»“æœã€‚

- `VAR_SAMP()`: è®¡ç®—æŸä¸ªåˆ—çš„æ ·æœ¬æ–¹å·®.
  - ç¤ºä¾‹ï¼š`SELECT VAR_SAMP(sales) FROM sales_data;` è¿”å›æ ·æœ¬æ–¹å·®ç»“æœã€‚

- `VARIANCE()`: è®¡ç®—æŸä¸ªåˆ—çš„æ–¹å·®.
  - ç¤ºä¾‹ï¼š`SELECT VARIANCE(temperature) FROM weather_data;` è¿”å›æ–¹å·®ç»“æœã€‚

è¿™äº›èšåˆå‡½æ•°å¯ä»¥ç”¨äºå¯¹MySQLä¸­çš„æ•°æ®è¿›è¡Œç»Ÿè®¡ã€è®¡ç®—å’Œåˆ†æï¼Œæ»¡è¶³å„ç§èšåˆæ“ä½œéœ€æ±‚ã€‚

### 5ã€æ§åˆ¶æµå‡½æ•°

åœ¨MySQLä¸­ï¼Œæ§åˆ¶æµå‡½æ•°ç”¨äºæ ¹æ®æ¡ä»¶æ‰§è¡Œç‰¹å®šæ“ä½œã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™äº›å‡½æ•°çš„è¯¦ç»†è¯´æ˜åŠç¤ºä¾‹ï¼š

1. `CASE`
`CASE` ç”¨äºæ‰§è¡Œä¸€ç³»åˆ—æ¡ä»¶æµ‹è¯•ï¼Œæ¯ä¸ªæµ‹è¯•éƒ½åŒ…å«ä¸€ä¸ªè¡¨è¾¾å¼å’Œä¸€ä¸ªç»“æœã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    name,
    CASE 
        WHEN age < 18 THEN 'Minor'
        WHEN age BETWEEN 18 AND 65 THEN 'Adult'
        ELSE 'Senior'
    END AS age_group
FROM 
    users;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`CASE` è¯­å¥æ ¹æ® `age` åˆ—çš„å€¼è¿”å›ä¸åŒçš„å¹´é¾„ç»„ã€‚

2. `IF`
`IF` ç”¨äºæ ¹æ®ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼çš„ç»“æœæ¥æ‰§è¡Œä¸åŒçš„è¯­å¥ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    name,
    IF(age >= 18, 'Adult', 'Minor') AS age_status
FROM 
    users;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`IF` å‡½æ•°æ ¹æ® `age` åˆ—çš„å€¼è¿”å› `'Adult'` æˆ– `'Minor'`ã€‚

3. `IFNULL`
`IFNULL` ç”¨äºæµ‹è¯•ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œå¦åˆ™è¿”å›è¡¨è¾¾å¼çš„å€¼ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    name,
    IFNULL(email, 'No email provided') AS email_status
FROM 
    users;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœ `email` åˆ—ä¸º `NULL`ï¼Œåˆ™è¿”å› `'No email provided'`ï¼Œå¦åˆ™è¿”å› `email` åˆ—çš„å€¼ã€‚

4. `NULLIF`
`NULLIF` ç”¨äºæµ‹è¯•ä¸¤ä¸ªè¡¨è¾¾å¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¿”å› `NULL`ï¼Œå¦åˆ™è¿”å›ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    name,
    NULLIF(age, 0) AS age
FROM 
    users;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœ `age` åˆ—çš„å€¼ä¸º `0`ï¼Œåˆ™è¿”å› `NULL`ï¼Œå¦åˆ™è¿”å› `age` åˆ—çš„å€¼ã€‚

5. `COALESCE`
`COALESCE` è¿”å›å‚æ•°åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªé `NULL` çš„å€¼ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    name,
    COALESCE(email, phone, 'No contact info') AS contact_info
FROM 
    users;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`COALESCE` å‡½æ•°è¿”å› `email`ã€`phone` åˆ—ä¸­ç¬¬ä¸€ä¸ªé `NULL` çš„å€¼ï¼Œå¦‚æœä¸¤è€…éƒ½ä¸º `NULL`ï¼Œåˆ™è¿”å› `'No contact info'`ã€‚

6. `GREATEST`
`GREATEST` è¿”å›å‚æ•°åˆ—è¡¨ä¸­çš„æœ€å¤§å€¼ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    GREATEST(10, 20, 30, 5) AS max_value;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`GREATEST` å‡½æ•°è¿”å› `30`ï¼Œå› ä¸ºå®ƒæ˜¯å‚æ•°åˆ—è¡¨ä¸­çš„æœ€å¤§å€¼ã€‚

7. `LEAST`
`LEAST` è¿”å›å‚æ•°åˆ—è¡¨ä¸­çš„æœ€å°å€¼ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    LEAST(10, 20, 30, 5) AS min_value;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`LEAST` å‡½æ•°è¿”å› `5`ï¼Œå› ä¸ºå®ƒæ˜¯å‚æ•°åˆ—è¡¨ä¸­çš„æœ€å°å€¼ã€‚

è¿™äº›æ§åˆ¶æµå‡½æ•°åœ¨MySQLä¸­éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¸®åŠ©ä½ æ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚

### 6ã€Jsonå‡½æ•°
JSONå‡½æ•°ä¸»è¦æ˜¯é’ˆå¯¹jsonç±»å‹è¿›è¡Œæ“ä½œçš„å‡½æ•°ã€‚

- `JSON_ARRAY([value[, value] ...])`: åˆ›å»ºä¸€ä¸ªJSONæ•°ç»„ï¼Œå‚æ•°ä¸ºJSONå€¼ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_ARRAY('apple', 42, 'banana');` è¿”å›ç»“æœä¸º `["apple", 42, "banana"]`

- [`JSON_ARRAYAGG(expr)`](https://dev.mysql.com/doc/refman/8.4/en/aggregate-functions.html#function_json-arrayagg): å°†è¡¨è¾¾å¼çš„ç»“æœä½œä¸ºJSONæ•°ç»„èšåˆï¼Œå¹¶è¿”å›ä¸€ä¸ªJSONæ•°ç»„ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_ARRAYAGG(name) FROM fruits;` è¿”å›ç»“æœä¸º `["apple", "banana", "cherry"]`

- `JSON_OBJECT(key, value[, key, value] ...)`: åˆ›å»ºä¸€ä¸ªJSONå¯¹è±¡ï¼Œå‚æ•°ä¸ºé”®å€¼å¯¹ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_OBJECT('name', 'apple', 'quantity', 10);` è¿”å›ç»“æœä¸º `{"name": "apple", "quantity": 10}`

- `JSON_OBJECTAGG(key, value)`: å°†é”®å€¼å¯¹çš„ç»“æœä½œä¸ºJSONå¯¹è±¡èšåˆï¼Œå¹¶è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_OBJECTAGG(name, quantity) FROM fruits;` è¿”å›ç»“æœä¸º `{"apple": 10, "banana": 20, "cherry": 15}`

- `JSON_EXTRACT(json_doc, path[, path] ...)`: ä»JSONæ–‡æ¡£ä¸­æå–æŒ‡å®šçš„å€¼ï¼Œè¿”å›ä¸€ä¸ªJSONå€¼æˆ–NULLã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_EXTRACT('{"name": "apple", "quantity": 10}', '$.name');` è¿”å›ç»“æœä¸º `"apple"`
  - ç¤ºä¾‹ï¼š`SELECT JSON_UNQUOTE(JSON_EXTRACT('["https://img.com/1.jpg""https://img.com/2.jpg",]','$[0]'));` è¿”å›ç»“æœä¸º `https://img.com/1.jpg`

- `JSON_UNQUOTE(json_val)`: å»é™¤JSONå­—ç¬¦ä¸²ä¸­çš„å¼•å·ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_UNQUOTE('"apple"');` è¿”å›ç»“æœä¸º `apple`

- `JSON_SEARCH(json_doc, one_or_all, search_str[, escape_char[, path] ...])`: åœ¨JSONæ–‡æ¡£ä¸­æœç´¢æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œè¿”å›åŒ¹é…çš„è·¯å¾„æˆ–NULLã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_SEARCH('{"name": "apple", "quantity": 10}', 'one', 'apple');` è¿”å›ç»“æœä¸º `$.name`

- `JSON_REPLACE(json_doc, path, val[, path, val] ...)`: ç”¨æŒ‡å®šçš„å€¼æ›¿æ¢JSONæ–‡æ¡£ä¸­çš„æŒ‡å®šè·¯å¾„çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªJSONæ–‡æ¡£ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_REPLACE('{"name": "apple", "quantity": 10}', '$.quantity', 20);` è¿”å›ç»“æœä¸º `{"name": "apple", "quantity": 20}`

- `JSON_SET(json_doc, path, val[, path, val] ...)`: è®¾ç½®JSONæ–‡æ¡£ä¸­æŒ‡å®šè·¯å¾„çš„å€¼ä¸ºæŒ‡å®šçš„å€¼ï¼Œè¿”å›ä¸€ä¸ªJSONæ–‡æ¡£ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_SET('{"name": "apple", "quantity": 10}', '$.quantity', 20);` è¿”å›ç»“æœä¸º `{"name": "apple", "quantity": 20}`

- `JSON_INSERT(json_doc, path, val[, path, val] ...)`: åœ¨JSONæ–‡æ¡£ä¸­æŒ‡å®šè·¯å¾„å¤„æ’å…¥æŒ‡å®šçš„å€¼ï¼Œè¿”å›ä¸€ä¸ªJSONæ–‡æ¡£ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_INSERT('{"name": "apple", "quantity": 10}', '$.price', 1.99);` è¿”å›ç»“æœä¸º `{"name": "apple", "quantity": 10, "price": 1.99}`

- `JSON_REMOVE(json_doc, path[, path] ...)`: ä»JSONæ–‡æ¡£ä¸­åˆ é™¤æŒ‡å®šè·¯å¾„çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªJSONæ–‡æ¡£ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_REMOVE('{"name": "apple", "quantity": 10}', '$.quantity');` è¿”å›ç»“æœä¸º `{"name": "apple"}`

- `JSON_DEPTH(json_doc)`: è¿”å›JSONæ–‡æ¡£çš„æœ€å¤§æ·±åº¦ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_DEPTH('{"name": "apple", "quantity": 10}');` è¿”å›ç»“æœä¸º `2`

- `JSON_KEYS(json_doc[, path])`: è¿”å›JSONæ–‡æ¡£ä¸­çš„æ‰€æœ‰é”®ï¼Œå¯æŒ‡å®šè·¯å¾„ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_KEYS('{"name": "apple", "quantity": 10}');` è¿”å›ç»“æœä¸º `["name", "quantity"]`

- `JSON_LENGTH(json_doc[, path])`: è¿”å›JSONæ–‡æ¡£ä¸­æŒ‡å®šè·¯å¾„çš„å€¼çš„æ•°é‡ï¼Œæˆ–JSONæ–‡æ¡£çš„é•¿åº¦ã€‚
  - ç¤ºä¾‹ï¼š`SELECT JSON_LENGTH('{"fruits": ["apple", "banana", "cherry"]}');` è¿”å›ç»“æœä¸º `3`

- `JSON_TYPE(json_val)`: è¿”å›JSONå€¼çš„ç±»å‹ï¼Œå¦‚OBJECTã€ARRAYã€STRINGã€NUMBERã€BOOLEANã€NULL.
  - ç¤ºä¾‹ï¼š`SELECT JSON_TYPE('{"name": "apple", "quantity": 10}');` è¿”å›ç»“æœä¸º `OBJECT`

- `JSON_MERGE_PATCH(json_doc, json_doc[, json_doc] ...)`: åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªJSONæ–‡æ¡£ï¼Œè¿”å›ä¸€ä¸ªåˆå¹¶åçš„JSONæ–‡æ¡£.
  - ç¤ºä¾‹ï¼š`SELECT JSON_MERGE_PATCH('{"name": "apple"}', '{"quantity": 10}');` è¿”å›ç»“æœä¸º `{"name": "apple", "quantity": 10}`

- `JSON_MERGE_PRESERVE(json_doc, json_doc[, json_doc] ...)`: åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªJSONæ–‡æ¡£ï¼Œä¿ç•™é‡å¤çš„é”®ï¼Œè¿”å›ä¸€ä¸ªåˆå¹¶åçš„JSONæ–‡æ¡£.
  - ç¤ºä¾‹ï¼š`SELECT JSON_MERGE_PRESERVE('{"name": "apple"}', '{"name": "banana"}');` è¿”å›ç»“æœä¸º `{"name": "banana"}`

- `JSON_CONTAINS(target, candidate[, path])`: æ£€æŸ¥JSONæ–‡æ¡£ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„å€¼ï¼Œè¿”å›1è¡¨ç¤ºåŒ…å«ï¼Œ0è¡¨ç¤ºä¸åŒ…å«.
  - ç¤ºä¾‹ï¼š`SELECT JSON_CONTAINS('{"fruits": ["apple", "banana"]}', json_quote('apple'),'$.fruits');` è¿”å›ç»“æœä¸º `1`

- `JSON_CONTAINS_PATH(json_doc, one_or_all, path[, path] ...)`: æ£€æŸ¥JSONæ–‡æ¡£ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„è·¯å¾„ï¼Œè¿”å›1è¡¨ç¤ºåŒ…å«ï¼Œ0è¡¨ç¤ºä¸åŒ…å«.
  - ç¤ºä¾‹ï¼š`SELECT JSON_CONTAINS_PATH('{"name": "apple", "quantity": 10}', 'one', '$.name');` è¿”å›ç»“æœä¸º `1`

- `JSON_QUOTE(string)`: å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªJSONå­—ç¬¦ä¸².
  - ç¤ºä¾‹ï¼š`SELECT JSON_QUOTE('apple');` è¿”å›ç»“æœä¸º `"apple"`

- `JSON_TABLE(expr, path COLUMNS (column_list))`: å°†JSONæ•°æ®å±•å¼€ä¸ºå…³ç³»è¡¨å½¢å¼ï¼Œè¿”å›ä¸€ä¸ªè™šæ‹Ÿè¡¨.
  - ç¤ºä¾‹ï¼š`SELECT * FROM JSON_TABLE('{"name": "apple", "quantity": 10}', '$' COLUMNS (name VARCHAR(50) PATH '$.name', quantity INT PATH '$.quantity')) AS jt;`

- `JSON_VALID(val)`: æ£€æŸ¥ç»™å®šçš„å€¼æ˜¯å¦æ˜¯æœ‰æ•ˆçš„JSONæ–‡æ¡£ï¼Œè¿”å›1è¡¨ç¤ºæœ‰æ•ˆï¼Œ0è¡¨ç¤ºæ— æ•ˆ.
  - ç¤ºä¾‹ï¼š`SELECT JSON_VALID('{"name": "apple", "quantity": 10}');` è¿”å›ç»“æœä¸º `1`

- `MEMBER OF()`: å®ƒæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨äº JSON æ•°ç»„ä¸­.
  - ç¤ºä¾‹ï¼š`SELECT 'apple' MEMBER OF('["apple", "banana", "cherry"]');` è¿”å›ç»“æœä¸º `1`

ç»¼åˆç¤ºä¾‹ï¼š
```sql
# åˆ é™¤æ•°ç»„ä¸­æŒ‡å®šå…ƒç´ 
SELECT JSON_REMOVE('["Asian Art", "Buddha", "Chinese Works of Art", "Gilt", "Lacquer", "Lacquered"]',
           JSON_UNQUOTE(
               JSON_SEARCH('["Asian Art", "Buddha", "Chinese Works of Art", "Gilt", "Lacquer", "Lacquered"]','one','Buddha')
           )
       );

# jsonä¸å­—ç¬¦ä¸²çš„è½¬æ¢
SELECT * FROM `product` p
WHERE CAST(p.`image_urls` AS CHAR) LIKE '%\r\n%'
AND p.`auction_id` = 1

UPDATE `product` p
SET p.`image_urls` = CAST(
    REPLACE(
            CAST(p.image_urls AS CHAR),
            '\\r\\n',
            ''
    ) AS JSON
)
WHERE p.`auction_id` = 1
```

### 7ã€çª—å£å‡½æ•°
åœ¨æ•°æ®åˆ†æå’Œå¤„ç†ä¸­ï¼Œçª—å£å‡½æ•°ï¼ˆWindow Functionsï¼‰æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„å·¥å…·ã€‚çª—å£å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨ä¸æ”¹å˜è¡Œæ•°çš„æƒ…å†µä¸‹ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œå¤æ‚çš„è®¡ç®—ã€‚

ä¸èšåˆå‡½æ•°ä¸åŒï¼Œçª—å£å‡½æ•°ä¸ä¼šå‡å°‘ç»“æœé›†çš„è¡Œæ•°ã€‚ç›¸åï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªä¸è¾“å…¥æ•°æ®ç›¸åŒæ•°é‡çš„ç»“æœé›†ï¼Œå¹¶ä¸ºæ¯ä¸€è¡Œæ·»åŠ ä¸€ä¸ªæ–°çš„åˆ—ï¼Œè¯¥åˆ—åŒ…å«çª—å£å‡½æ•°è®¡ç®—çš„ç»“æœã€‚

#### 7.1ã€åŸºæœ¬è¯­æ³•

```sql
SELECT column1, column2, 
       window_function(column3) OVER (window_clause)
FROM table_name;
```

- `column1`, `column2`: éœ€è¦é€‰æ‹©çš„åˆ—ã€‚
- `window_function(column3)`: è¦åº”ç”¨çš„çª—å£å‡½æ•°ã€‚
- `OVER (window_clause)`: å®šä¹‰çª—å£çš„å­å¥ã€‚

#### 7.2ã€çª—å£å­å¥ï¼ˆWindow Clauseï¼‰
çª—å£å­å¥ç”¨äºå®šä¹‰çª—å£çš„èŒƒå›´å’Œé¡ºåºã€‚å®ƒç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

1. **`PARTITION BY`**: åˆ†åŒºå­å¥ï¼Œç”¨äºå°†æ•°æ®åˆ’åˆ†ä¸ºä¸åŒçš„ç»„ã€‚æ¯ä¸ªç»„å†…çš„è¡Œå°†ç‹¬ç«‹è®¡ç®—çª—å£å‡½æ•°ã€‚
2. **`ORDER BY`**: æ’åºå­å¥ï¼Œç”¨äºç¡®å®šçª—å£å†…è¡Œçš„é¡ºåºã€‚
3. **`ROWS` æˆ– `RANGE`**: ç”¨äºå®šä¹‰çª—å£çš„è¾¹ç•ŒèŒƒå›´ï¼ŒæŒ‡å®šå“ªäº›è¡Œå±äºå½“å‰çª—å£ã€‚

##### aã€`PARTITION BY`
`PARTITION BY` å°†æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºç‹¬ç«‹è®¡ç®—çª—å£å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š `PARTITION BY`ï¼Œåˆ™æ•´ä¸ªç»“æœé›†è¢«è§†ä¸ºä¸€ä¸ªåˆ†åŒºã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    department, 
    employee_name, 
    salary,
    AVG(salary) OVER (PARTITION BY department) AS avg_salary_by_dept
FROM 
    employees;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`PARTITION BY department` å°†æ•°æ®æŒ‰éƒ¨é—¨åˆ†ç»„ï¼Œå¹¶è®¡ç®—æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ã€‚

##### bã€`ORDER BY`
`ORDER BY` ç”¨äºæŒ‡å®šçª—å£å†…è¡Œçš„é¡ºåºã€‚å®ƒå†³å®šäº†çª—å£å‡½æ•°çš„è®¡ç®—é¡ºåºï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ `LAG()`ã€`LEAD()`ã€`FIRST_VALUE()` ç­‰å‡½æ•°æ—¶éå¸¸é‡è¦ã€‚

**ç¤ºä¾‹ï¼š**
```sql
SELECT 
    department, 
    employee_name, 
    salary,
    RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS salary_rank
FROM 
    employees;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`ORDER BY salary DESC` æŒ‰å·¥èµ„é™åºæ’åˆ—ï¼Œ`RANK()` å‡½æ•°è®¡ç®—æ¯ä¸ªéƒ¨é—¨å†…å‘˜å·¥çš„å·¥èµ„æ’åã€‚

##### cã€`ROWS` æˆ– `RANGE`
`ROWS` å’Œ `RANGE` ç”¨äºå®šä¹‰çª—å£çš„è¾¹ç•ŒèŒƒå›´ï¼ŒæŒ‡å®šå“ªäº›è¡Œå±äºå½“å‰çª—å£ã€‚å¸¸è§çš„ç”¨æ³•åŒ…æ‹¬ï¼š
- **`ROWS BETWEEN ... AND ...`**: åŸºäºè¡Œçš„ç‰©ç†ä½ç½®å®šä¹‰çª—å£ã€‚
- **`RANGE BETWEEN ... AND ...`**: åŸºäºè¡Œçš„é€»è¾‘å€¼èŒƒå›´å®šä¹‰çª—å£ã€‚

**å¸¸è§è¾¹ç•Œå®šä¹‰ï¼š**
- `UNBOUNDED PRECEDING`: ä»åˆ†åŒºçš„ç¬¬ä¸€è¡Œå¼€å§‹ã€‚
- `UNBOUNDED FOLLOWING`: åˆ°åˆ†åŒºçš„æœ€åä¸€è¡Œç»“æŸã€‚
- `CURRENT ROW`: å½“å‰è¡Œã€‚
- `n PRECEDING`: å½“å‰è¡Œä¹‹å‰çš„ç¬¬nè¡Œã€‚
- `n FOLLOWING`: å½“å‰è¡Œä¹‹åçš„ç¬¬nè¡Œã€‚

**ç¤ºä¾‹ 1ï¼šä½¿ç”¨ `ROWS`**
```sql
SELECT 
    employee_name, 
    salary,
    AVG(salary) OVER (ORDER BY hire_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg_salary
FROM 
    employees;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`ROWS BETWEEN 2 PRECEDING AND CURRENT ROW` å®šä¹‰äº†çª—å£èŒƒå›´ä¸ºå½“å‰è¡ŒåŠå…¶å‰ä¸¤è¡Œï¼Œè®¡ç®—ç§»åŠ¨å¹³å‡å·¥èµ„ã€‚

**ç¤ºä¾‹ 2ï¼šä½¿ç”¨ `RANGE`**
```sql
SELECT 
    employee_name, 
    salary,
    SUM(salary) OVER (ORDER BY salary RANGE BETWEEN 100 PRECEDING AND 100 FOLLOWING) AS sum_salary_within_range
FROM 
    employees;
```
åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`RANGE BETWEEN 100 PRECEDING AND 100 FOLLOWING` å®šä¹‰äº†çª—å£èŒƒå›´ä¸ºå½“å‰è¡Œå·¥èµ„å€¼ Â±100 èŒƒå›´å†…çš„æ‰€æœ‰è¡Œï¼Œè®¡ç®—å·¥èµ„æ€»å’Œã€‚

##### dã€ç»¼åˆç¤ºä¾‹

å‡è®¾æœ‰ä¸€ä¸ªå‘˜å·¥è¡¨ `employees`ï¼ŒåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š

| employee_id | department | employee_name | salary | hire_date  |
|-------------|------------|---------------|--------|------------|
| 1           | HR         | Alice         | 5000   | 2020-01-01 |
| 2           | HR         | Bob           | 6000   | 2020-02-01 |
| 3           | IT         | Charlie       | 7000   | 2020-03-01 |
| 4           | IT         | David         | 8000   | 2020-04-01 |
| 5           | HR         | Eve           | 5500   | 2020-05-01 |

**æŸ¥è¯¢ï¼š**
```sql
SELECT 
    department, 
    employee_name, 
    salary,
    AVG(salary) OVER (PARTITION BY department ORDER BY hire_date ROWS BETWEEN 1 PRECEDING AND CURRENT ROW) AS moving_avg_salary
FROM 
    employees;
```

**ç»“æœï¼š**

| department | employee_name | salary | moving_avg_salary |
|------------|---------------|--------|-------------------|
| HR         | Alice         | 5000   | 5000.00           |
| HR         | Bob           | 6000   | 5500.00           |
| HR         | Eve           | 5500   | 5750.00           |
| IT         | Charlie       | 7000   | 7000.00           |
| IT         | David         | 8000   | 7500.00           |

**è¯´æ˜ï¼š**
- `PARTITION BY department`ï¼šæŒ‰éƒ¨é—¨åˆ†ç»„ã€‚
- `ORDER BY hire_date`ï¼šæŒ‰å…¥èŒæ—¥æœŸæ’åºã€‚
- `ROWS BETWEEN 1 PRECEDING AND CURRENT ROW`ï¼šçª—å£èŒƒå›´ä¸ºå½“å‰è¡ŒåŠå…¶å‰ä¸€è¡Œã€‚

é€šè¿‡åˆç†ä½¿ç”¨ `PARTITION BY`ã€`ORDER BY` å’Œ `ROWS`/`RANGE`ï¼Œå¯ä»¥çµæ´»å®šä¹‰çª—å£çš„èŒƒå›´å’Œé¡ºåºï¼Œæ»¡è¶³å¤æ‚çš„æ•°æ®åˆ†æéœ€æ±‚ã€‚

#### 7.3ã€æ’åå‡½æ•°

æ’åå‡½æ•°ç”¨äºä¸ºç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œåˆ†é…ä¸€ä¸ªæ’åã€‚å¸¸è§çš„æ’åå‡½æ•°åŒ…æ‹¬ï¼š

- **ROW_NUMBER()**: ä¸ºæ¯ä¸€è¡Œåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¡Œå·ï¼Œä»1å¼€å§‹ã€‚
- **RANK()**: ä¸ºæ¯ä¸€è¡Œåˆ†é…ä¸€ä¸ªæ’åï¼Œç›¸åŒçš„å€¼å…·æœ‰ç›¸åŒçš„æ’åï¼Œåç»­æ’åä¼šè·³è¿‡ã€‚
- **DENSE_RANK()**: ç±»ä¼¼äº`RANK()`ï¼Œä½†ä¸ä¼šè·³è¿‡æ’åã€‚
- **NTILE(n)**: å°†ç»“æœé›†åˆ†ä¸º`n`ä¸ªæ¡¶ï¼Œå¹¶ä¸ºæ¯ä¸€è¡Œåˆ†é…æ¡¶ç¼–å·ã€‚


å‡è®¾æœ‰ä¸€ä¸ªå‘˜å·¥è¡¨`employees`ï¼ŒåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š

| id | name    | department | salary |
|----|---------|------------|--------|
| 1  | Alice   | HR         | 5000   |
| 2  | Bob     | IT         | 6000   |
| 3  | Charlie | HR         | 5000   |
| 4  | David   | IT         | 7000   |
| 5  | Eve     | HR         | 4000   |

ä½¿ç”¨`ROW_NUMBER()`ä¸ºæ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥åˆ†é…è¡Œå·ï¼š

```sql
SELECT id, name, department, salary,
       ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary) as row_num
FROM employees;
```

ç»“æœï¼š

| id | name    | department | salary | row_num |
|----|---------|------------|--------|---------|
| 1  | Alice   | HR         | 5000   | 2       |
| 3  | Charlie | HR         | 5000   | 1       |
| 5  | Eve     | HR         | 4000   | 3       |
| 2  | Bob     | IT         | 6000   | 1       |
| 4  | David   | IT         | 7000   | 2       |

#### 7.4ã€èšåˆå‡½æ•°

èšåˆå‡½æ•°å¯ä»¥åº”ç”¨äºçª—å£ï¼Œä»¥ä¾¿åœ¨æ¯ä¸ªçª—å£å†…è¿›è¡Œèšåˆè®¡ç®—ã€‚å¸¸è§çš„èšåˆçª—å£å‡½æ•°åŒ…æ‹¬ï¼š

- **SUM()**: æ±‚å’Œ
- **AVG()**: å¹³å‡å€¼
- **MIN()**: æœ€å°å€¼
- **MAX()**: æœ€å¤§å€¼
- **COUNT()**: è®¡æ•°

è®¡ç®—æ¯ä¸ªéƒ¨é—¨çš„å·¥èµ„æ€»å’Œï¼š

```sql
SELECT department, name, salary,
       SUM(salary) OVER (PARTITION BY department) as dept_total_salary
FROM employees;
```

ç»“æœï¼š

| department | name    | salary | dept_total_salary |
|------------|---------|--------|-------------------|
| HR         | Alice   | 5000   | 14000             |
| HR         | Charlie | 5000   | 14000             |
| HR         | Eve     | 4000   | 14000             |
| IT         | Bob     | 6000   | 13000             |
| IT         | David   | 7000   | 13000             |

#### 7.5ã€ç§»åŠ¨å¹³å‡å’Œå…¶ä»–ç»Ÿè®¡å‡½æ•°

ä½ è¯´å¾—å¯¹ï¼Œ`AVG()` æœ¬èº«æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œè€Œä¸æ˜¯çª—å£å‡½æ•°ã€‚ä½†åœ¨ SQL ä¸­ï¼Œ`AVG()` å¯ä»¥é€šè¿‡ä¸ `OVER()` å­å¥ç»“åˆä½¿ç”¨æ¥å®ç°çª—å£è®¡ç®—çš„åŠŸèƒ½ã€‚ä¸ºäº†æ›´å‡†ç¡®åœ°è¡¨è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å†…å®¹ä¼˜åŒ–å¦‚ä¸‹ï¼š

---

#### 7.6ã€ç§»åŠ¨å¹³å‡å’Œå…¶ä»–ç»Ÿè®¡å‡½æ•°

ç§»åŠ¨å¹³å‡å’Œå…¶ä»–ç»Ÿè®¡å‡½æ•°å¸¸ç”¨äºåˆ†ææ—¶é—´åºåˆ—æ•°æ®æˆ–æ»‘åŠ¨çª—å£è®¡ç®—ã€‚å¸¸è§çš„çª—å£å‡½æ•°åŒ…æ‹¬ï¼š

- **LAG()**: è·å–å½“å‰è¡Œä¹‹å‰çš„æŸä¸€è¡Œçš„å€¼ã€‚
- **LEAD()**: è·å–å½“å‰è¡Œä¹‹åçš„æŸä¸€è¡Œçš„å€¼ã€‚
- **FIRST_VALUE()**: è·å–çª—å£å†…çš„ç¬¬ä¸€è¡Œçš„å€¼ã€‚
- **LAST_VALUE()**: è·å–çª—å£å†…çš„æœ€åä¸€è¡Œçš„å€¼ã€‚
- **NTH_VALUE()**: è·å–çª—å£å†…çš„ç¬¬nè¡Œçš„å€¼ã€‚

æ­¤å¤–ï¼Œ**èšåˆå‡½æ•°ï¼ˆå¦‚ `AVG()`ã€`SUM()` ç­‰ï¼‰** å¯ä»¥ä¸ `OVER()` å­å¥ç»“åˆä½¿ç”¨ï¼Œå®ç°çª—å£è®¡ç®—çš„åŠŸèƒ½ã€‚

å‡è®¾æœ‰ä¸€ä¸ªé”€å”®è®°å½•è¡¨ `sales`ï¼ŒåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š

| id | product | sale_date  | amount |
|----|---------|------------|--------|
| 1  | A       | 2024-01-01 | 100    |
| 2  | B       | 2024-01-02 | 150    |
| 3  | A       | 2024-01-03 | 200    |
| 4  | B       | 2024-01-04 | 250    |
| 5  | A       | 2024-01-05 | 300    |

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `AVG()` ä¸ `OVER()` å­å¥è®¡ç®—æ¯ä¸ªäº§å“çš„é”€å”®é¢ç§»åŠ¨å¹³å‡å€¼ï¼ˆçª—å£å¤§å°ä¸º3ï¼‰ï¼š

```sql
SELECT 
    product, 
    sale_date, 
    amount,
    AVG(amount) OVER (
        PARTITION BY product 
        ORDER BY sale_date 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) AS moving_avg
FROM 
    sales;
```

**ç»“æœï¼š**

| product | sale_date  | amount | moving_avg |
|---------|------------|--------|------------|
| A       | 2024-01-01 | 100    | 100.0000   |
| A       | 2024-01-03 | 200    | 150.0000   |
| A       | 2024-01-05 | 300    | 200.0000   |
| B       | 2024-01-02 | 150    | 150.0000   |
| B       | 2024-01-04 | 250    | 200.0000   |

**è¯´æ˜ï¼š**
1. **`ROWS BETWEEN 2 PRECEDING AND CURRENT ROW`**ï¼šå®šä¹‰äº†çª—å£èŒƒå›´ä¸ºå½“å‰è¡ŒåŠå…¶å‰ä¸¤è¡Œã€‚
2. **`PARTITION BY product`**ï¼šæŒ‰äº§å“åˆ†ç»„è®¡ç®—ç§»åŠ¨å¹³å‡å€¼ã€‚
3. **`ORDER BY sale_date`**ï¼šæŒ‰é”€å”®æ—¥æœŸæ’åºã€‚

---

**å…¶ä»–çª—å£å‡½æ•°ç¤ºä¾‹**

1. **`LAG()`**ï¼šè·å–å‰ä¸€è¡Œçš„å€¼ã€‚
   ```sql
   SELECT 
       product, 
       sale_date, 
       amount,
       LAG(amount, 1) OVER (PARTITION BY product ORDER BY sale_date) AS prev_amount
   FROM 
       sales;
   ```

2. **`LEAD()`**ï¼šè·å–åä¸€è¡Œçš„å€¼ã€‚
   ```sql
   SELECT 
       product, 
       sale_date, 
       amount,
       LEAD(amount, 1) OVER (PARTITION BY product ORDER BY sale_date) AS next_amount
   FROM 
       sales;
   ```

3. **`FIRST_VALUE()`**ï¼šè·å–çª—å£å†…çš„ç¬¬ä¸€è¡Œå€¼ã€‚
   ```sql
   SELECT 
       product, 
       sale_date, 
       amount,
       FIRST_VALUE(amount) OVER (PARTITION BY product ORDER BY sale_date) AS first_amount
   FROM 
       sales;
   ```

4. **`LAST_VALUE()`**ï¼šè·å–çª—å£å†…çš„æœ€åä¸€è¡Œå€¼ã€‚
   ```sql
   SELECT 
       product, 
       sale_date, 
       amount,
       LAST_VALUE(amount) OVER (PARTITION BY product ORDER BY sale_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_amount
   FROM 
       sales;
   ```

5. **`NTH_VALUE()`**ï¼šè·å–çª—å£å†…çš„ç¬¬nè¡Œå€¼ã€‚
   ```sql
   SELECT 
       product, 
       sale_date, 
       amount,
       NTH_VALUE(amount, 2) OVER (PARTITION BY product ORDER BY sale_date) AS second_amount
   FROM 
       sales;
   ```

é€šè¿‡è¿™äº›å‡½æ•°ï¼Œå¯ä»¥æ›´çµæ´»åœ°åˆ†ææ—¶é—´åºåˆ—æ•°æ®æˆ–æ»‘åŠ¨çª—å£ä¸­çš„æ•°æ®è¶‹åŠ¿ã€‚`AVG()` ç­‰èšåˆå‡½æ•°ç»“åˆ `OVER()` å­å¥ï¼Œèƒ½å¤Ÿå®ç°å¼ºå¤§çš„çª—å£è®¡ç®—åŠŸèƒ½ã€‚

#### 7.7ã€æ¡ˆä¾‹ä¸€ï¼šé”€å”®é¢è¶‹åŠ¿åˆ†æ

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†ç½‘ç«™çš„é”€å”®è®°å½•è¡¨`ecommerce_sales`ï¼ŒåŒ…å«ä»¥ä¸‹åˆ—ï¼š

- `sale_id`: é”€å”®ID
- `product_id`: äº§å“ID
- `sale_date`: é”€å”®æ—¥æœŸ
- `amount`: é”€å”®é‡‘é¢

æˆ‘ä»¬å¸Œæœ›åˆ†ææ¯ä¸ªäº§å“çš„é”€å”®é¢è¶‹åŠ¿ï¼Œå¹¶è®¡ç®—è¿‡å»7å¤©çš„å¹³å‡é”€å”®é¢ã€‚å¯ä»¥ä½¿ç”¨çª—å£å‡½æ•°æ¥å®ç°ï¼š

```sql
SELECT product_id, sale_date, amount,
       AVG(amount) OVER (PARTITION BY product_id ORDER BY sale_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as avg_7day_sales
FROM ecommerce_sales;
```

è¿™ä¸ªæŸ¥è¯¢å°†ä¸ºæ¯ä¸ªäº§å“è®¡ç®—è¿‡å»7å¤©çš„å¹³å‡é”€å”®é¢ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£é”€å”®è¶‹åŠ¿ã€‚

#### 7.8ã€æ¡ˆä¾‹äºŒï¼šåº“å­˜ç®¡ç†

åœ¨åº“å­˜ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦è·Ÿè¸ªæ¯ä¸ªä»“åº“çš„åº“å­˜å˜åŒ–æƒ…å†µã€‚å‡è®¾æœ‰ä¸€ä¸ªåº“å­˜è¡¨`inventory`ï¼ŒåŒ…å«ä»¥ä¸‹åˆ—ï¼š

- `warehouse_id`: ä»“åº“ID
- `product_id`: äº§å“ID
- `stock_date`: åº“å­˜æ—¥æœŸ
- `quantity`: åº“å­˜æ•°é‡

æˆ‘ä»¬å¸Œæœ›è®¡ç®—æ¯ä¸ªä»“åº“åœ¨è¿‡å»ä¸€ä¸ªæœˆå†…çš„åº“å­˜å˜åŒ–ç‡ã€‚å¯ä»¥ä½¿ç”¨çª—å£å‡½æ•°æ¥è®¡ç®—ï¼š

```sql
WITH MonthlyStock AS (
    SELECT warehouse_id, product_id, stock_date, quantity,
           LAG(quantity) OVER (PARTITION BY warehouse_id, product_id ORDER BY stock_date) as previous_quantity
    FROM inventory
),
MonthlyChange AS (
    SELECT warehouse_id, product_id, stock_date, quantity, previous_quantity,
           (quantity - previous_quantity) / previous_quantity as change_rate
    FROM MonthlyStock
    WHERE previous_quantity IS NOT NULL AND previous_quantity != 0
)
SELECT warehouse_id, product_id, stock_date, quantity, change_rate
FROM MonthlyChange;
```

è¿™ä¸ªæŸ¥è¯¢å°†è®¡ç®—æ¯ä¸ªä»“åº“æ¯ä¸ªäº§å“çš„æœˆåº¦åº“å­˜å˜åŒ–ç‡ï¼Œå¸®åŠ©æˆ‘ä»¬ç›‘æ§åº“å­˜æ³¢åŠ¨æƒ…å†µã€‚

### 8ã€æ­£åˆ™å‡½æ•°

MySQLæä¾›äº†ä¸€äº›æ­£åˆ™å‡½æ•°æ¥å¤„ç†åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²åŒ¹é…å’Œæ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ­£åˆ™å‡½æ•°ï¼š

- `REGEXP` (æˆ– `RLIKE`)ï¼šè¿™æ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå¯ä»¥åœ¨WHEREå­å¥ä¸­ä½¿ç”¨ï¼Œç”¨äºæµ‹è¯•ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ 
  - ç¤ºä¾‹ï¼š`SELECT column FROM table WHERE column REGEXP 'pattern';`

- `REGEXP_LIKE(string, pattern[, mode])`ï¼šå®ƒç±»ä¼¼äºREGEXPï¼Œä½†æä¾›äº†é¢å¤–çš„æ¨¡å¼åŒ¹é…æ¨¡å¼ï¼Œä¾‹å¦‚åŒºåˆ†å¤§å°å†™å’Œå¤šå›½è¯­è¨€æ”¯æŒã€‚ 
  - ç¤ºä¾‹ï¼š`SELECT column FROM table WHERE REGEXP_LIKE(column, 'pattern', 'i');`

- `REGEXP_REPLACE(string, pattern, replacement[, position[, occurrence[, match_type]]])`ï¼šå®ƒå°†å­—ç¬¦ä¸²ä¸­åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„éƒ¨åˆ†æ›¿æ¢ä¸ºæŒ‡å®šçš„æ›¿æ¢å­—ç¬¦ä¸²ã€‚ 
  - ç¤ºä¾‹ï¼š`SELECT REGEXP_REPLACE('abcde', 'b', 'z');`  ç»“æœä¸º 'azcde'

- `REGEXP_INSTR(string, pattern[, position[, occurrence[, return_end[, match_type]]]])`ï¼šå®ƒè¿”å›å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„ä½ç½®ã€‚ 
  - ç¤ºä¾‹ï¼š`SELECT REGEXP_INSTR('abcde', 'b');`  ç»“æœä¸º 2

- `REGEXP_SUBSTR(string, pattern[, position[, occurrence[, match_type]]])`ï¼šå®ƒä»å­—ç¬¦ä¸²ä¸­æå–åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„å­å­—ç¬¦ä¸²ã€‚ 
  - ç¤ºä¾‹ï¼š`SELECT REGEXP_SUBSTR('abcde', 'b.*d');`  ç»“æœä¸º 'bcd'

### 9ã€è‡ªå®šä¹‰å‡½æ•°
MySQLå…è®¸å¼€å‘äººå‘˜è‡ªå®šä¹‰å‡½æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥å®ç°è‡ªå·±çš„å‡½æ•°ã€‚ä¸‹é¢æ˜¯MySQLè‡ªå®šä¹‰å‡½æ•°çš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ï¼š

1. å‡½æ•°çš„å®šä¹‰

åœ¨MySQLä¸­ï¼Œè‡ªå®šä¹‰å‡½æ•°éœ€è¦ä½¿ç”¨CREATE FUNCTIONè¯­å¥è¿›è¡Œå®šä¹‰ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š

```sql
CREATE FUNCTION function_name (param1 type1, param2 type2, ...) RETURNS return_type
BEGIN
  -- å‡½æ•°ä½“
END;
```

å…¶ä¸­ï¼Œfunction_nameä¸ºå‡½æ•°åç§°ï¼Œparam1ã€param2ç­‰ä¸ºå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œtype1ã€type2ç­‰ä¸ºå‚æ•°çš„æ•°æ®ç±»å‹ï¼Œreturn_typeä¸ºå‡½æ•°è¿”å›å€¼çš„æ•°æ®ç±»å‹ã€‚å‡½æ•°ä½“éƒ¨åˆ†æ˜¯å‡½æ•°å®ç°çš„å…·ä½“å†…å®¹ï¼Œå¯ä»¥åŒ…æ‹¬å„ç§SQLè¯­å¥ã€æµç¨‹æ§åˆ¶è¯­å¥ç­‰ã€‚

2. å‡½æ•°çš„ä½¿ç”¨

å®šä¹‰å¥½å‡½æ•°åï¼Œå°±å¯ä»¥åœ¨MySQLä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚ä½¿ç”¨å‡½æ•°çš„è¯­æ³•å¦‚ä¸‹ï¼š

```sql
SELECT function_name(param1, param2, ...)
```

å…¶ä¸­ï¼Œfunction_nameä¸ºè‡ªå®šä¹‰å‡½æ•°çš„åç§°ï¼Œparam1ã€param2ç­‰ä¸ºå‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚

3. å‡½æ•°çš„ç¤ºä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°çš„ç¤ºä¾‹ï¼Œç”¨äºè®¡ç®—ä¸€ä¸ªæ•°çš„é˜¶ä¹˜ï¼š

```sql
CREATE FUNCTION factorial(n INT) RETURNS INT
BEGIN
  DECLARE result INT DEFAULT 1;
  DECLARE i INT DEFAULT 1;
  WHILE i <= n DO
    SET result = result * i;
    SET i = i + 1;
  END WHILE;
  RETURN result;
END;
```

å®šä¹‰å¥½è¿™ä¸ªå‡½æ•°åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼š

```sql
SELECT factorial(5); -- è¿”å›120
```

## å…­ã€é«˜çº§æŠ€å·§

### 1ã€å¤šè¡¨è¿æ¥æŸ¥è¯¢

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ•°æ®é€šå¸¸åˆ†æ•£åœ¨å¤šä¸ªè¡¨ä¸­ã€‚ä¸ºäº†ä»è¿™äº›è¡¨ä¸­è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œå¤šè¡¨è¿æ¥æŸ¥è¯¢ã€‚æ ¹æ®è¿æ¥æ–¹å¼çš„ä¸åŒï¼Œè¿æ¥æŸ¥è¯¢å¯ä»¥åˆ†ä¸ºå†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥å’Œå…¨è¿æ¥ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»è¿™äº›è¿æ¥ç±»å‹ã€‚

#### 1.1ã€å†…è¿æ¥ï¼ˆINNER JOINï¼‰

å†…è¿æ¥æ˜¯æœ€å¸¸ç”¨çš„è¿æ¥ç±»å‹ï¼Œå®ƒè¿”å›ä¸¤ä¸ªè¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚å½“è¿æ¥æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œå†…è¿æ¥å°†ä»ä¸¤ä¸ªè¡¨ä¸­è¿”å›åŒ¹é…çš„è®°å½•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å†…è¿æ¥ç¤ºä¾‹ï¼š

å‡è®¾æœ‰ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªæ˜¯`employees`ï¼Œå¦ä¸€ä¸ªæ˜¯`departments`ã€‚æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ¯ä¸ªå‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨åç§°ã€‚

```sql
SELECT employees.name, departments.department_name
FROM employees
INNER JOIN departments ON employees.department_id = departments.id;
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`INNER JOIN`å…³é”®å­—è¿æ¥äº†`employees`å’Œ`departments`ä¸¤ä¸ªè¡¨ï¼Œå¹¶ä½¿ç”¨`ON`å…³é”®å­—æŒ‡å®šäº†è¿æ¥æ¡ä»¶ï¼Œå³`employees.department_id = departments.id`ã€‚æŸ¥è¯¢ç»“æœå°†åŒ…å«æ»¡è¶³è¿æ¥æ¡ä»¶çš„è®°å½•ã€‚

#### 1.2ã€å·¦è¿æ¥ï¼ˆLEFT JOINï¼‰

å·¦è¿æ¥ï¼ˆä¹Ÿç§°ä¸ºå·¦å¤–è¿æ¥ï¼‰è¿”å›å·¦è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠä¸å·¦è¡¨åŒ¹é…çš„å³è¡¨è®°å½•ã€‚å¦‚æœå³è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼ŒæŸ¥è¯¢ç»“æœä¸­å°†æ˜¾ç¤ºNULLå€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå·¦è¿æ¥ç¤ºä¾‹ï¼š

å‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥åŠå…¶æ‰€åœ¨çš„éƒ¨é—¨åç§°ï¼Œå³ä½¿æŸäº›å‘˜å·¥æ²¡æœ‰åˆ†é…éƒ¨é—¨ã€‚

```sql
SELECT employees.name, departments.department_name
FROM employees
LEFT JOIN departments ON employees.department_id = departments.id;
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`LEFT JOIN`å…³é”®å­—è¿æ¥äº†`employees`å’Œ`departments`ä¸¤ä¸ªè¡¨ï¼Œå¹¶æŒ‡å®šäº†ç›¸åŒçš„è¿æ¥æ¡ä»¶ã€‚æŸ¥è¯¢ç»“æœå°†åŒ…å«å·¦è¡¨ï¼ˆemployeesï¼‰çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠä¸ä¹‹åŒ¹é…çš„å³è¡¨ï¼ˆdepartmentsï¼‰è®°å½•ã€‚

#### 1.3ã€å³è¿æ¥ï¼ˆRIGHT JOINï¼‰

å³è¿æ¥ï¼ˆä¹Ÿç§°ä¸ºå³å¤–è¿æ¥ï¼‰è¿”å›å³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠä¸å³è¡¨åŒ¹é…çš„å·¦è¡¨è®°å½•ã€‚å¦‚æœå·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼ŒæŸ¥è¯¢ç»“æœä¸­å°†æ˜¾ç¤ºNULLå€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå³è¿æ¥ç¤ºä¾‹ï¼š

å‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨åŠå…¶å‘˜å·¥åç§°ï¼Œå³ä½¿æŸäº›éƒ¨é—¨æ²¡æœ‰å‘˜å·¥ã€‚

```sql
SELECT employees.name, departments.department_name
FROM employees
RIGHT JOIN departments ON employees.department_id = departments.id;
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`RIGHT JOIN`å…³é”®å­—è¿æ¥äº†`employees`å’Œ`departments`ä¸¤ä¸ªè¡¨ï¼Œå¹¶æŒ‡å®šäº†ç›¸åŒçš„è¿æ¥æ¡ä»¶ã€‚æŸ¥è¯¢ç»“æœå°†åŒ…å«å³è¡¨ï¼ˆdepartmentsï¼‰çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠä¸ä¹‹åŒ¹é…çš„å·¦è¡¨ï¼ˆemployeesï¼‰è®°å½•ã€‚

#### 1.4ã€å…¨è¿æ¥ï¼ˆFULL JOINï¼‰

å…¨è¿æ¥ï¼ˆä¹Ÿç§°ä¸ºå…¨å¤–è¿æ¥ï¼‰è¿”å›å·¦è¡¨å’Œå³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚å¦‚æœæŸä¸ªè¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼ŒæŸ¥è¯¢ç»“æœä¸­å°†æ˜¾ç¤ºNULLå€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 8.0ç‰ˆæœ¬ä¸ç›´æ¥æ”¯æŒ`FULL JOIN`å…³é”®å­—ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆ`LEFT JOIN`å’Œ`RIGHT JOIN`æ¥å®ç°å…¨è¿æ¥çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¨è¿æ¥ç¤ºä¾‹ï¼š

å‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥åŠå…¶æ‰€åœ¨çš„éƒ¨é—¨åç§°ï¼ŒåŒæ—¶ä¹Ÿè¦åŒ…å«æ²¡æœ‰å‘˜å·¥çš„éƒ¨é—¨ã€‚

```sql
SELECT employees.name, departments.department_name
FROM employees
LEFT JOIN departments ON employees.department_id = departments.id
UNION
SELECT employees.name, departments.department_name
FROM employees
RIGHT JOIN departments ON employees.department_id = departments.id;
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨`LEFT JOIN`è·å–æ‰€æœ‰å‘˜å·¥åŠå…¶æ‰€åœ¨çš„éƒ¨é—¨åç§°ï¼Œç„¶åä½¿ç”¨`RIGHT JOIN`è·å–æ‰€æœ‰éƒ¨é—¨åŠå…¶å‘˜å·¥åç§°ã€‚é€šè¿‡`UNION`å…³é”®å­—å°†ä¸¤ä¸ªæŸ¥è¯¢ç»“æœåˆå¹¶ï¼Œä»è€Œå®ç°å…¨è¿æ¥çš„åŠŸèƒ½ã€‚æŸ¥è¯¢ç»“æœå°†åŒ…å«å·¦è¡¨ï¼ˆemployeesï¼‰å’Œå³è¡¨ï¼ˆdepartmentsï¼‰ä¸­çš„æ‰€æœ‰è®°å½•ã€‚

### 2ã€èšåˆå‡½æ•°ä¸åˆ†ç»„æŸ¥è¯¢

èšåˆå‡½æ•°ç”¨äºå¯¹ä¸€ç»„å€¼è¿›è¡Œè®¡ç®—ï¼Œå¹¶è¿”å›å•ä¸ªå€¼ã€‚å¸¸ç”¨çš„èšåˆå‡½æ•°æœ‰ï¼š`COUNT()`ã€`SUM()`ã€`AVG()`ã€`MIN()`ã€`MAX()`ç­‰ã€‚ä¸èšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨çš„`GROUP BY`å­å¥å¯ä»¥å®ç°æŒ‰ç‰¹å®šåˆ—å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåˆ†ç»„ã€‚

#### 2.1ã€èšåˆå‡½æ•°

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨èšåˆå‡½æ•°çš„ç¤ºä¾‹ï¼š

- `COUNT()`: è®¡ç®—è¡¨ä¸­è®°å½•çš„æ•°é‡ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢`employees`è¡¨ä¸­è®°å½•çš„æ•°é‡ï¼š

  ```sql
  SELECT COUNT(*) FROM employees;
  ```

- `SUM()`: è®¡ç®—è¡¨ä¸­æŸåˆ—å€¼çš„æ€»å’Œã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢`orders`è¡¨ä¸­æ‰€æœ‰è®¢å•çš„æ€»é‡‘é¢ï¼š

  ```sql
  SELECT SUM(total_amount) FROM orders;
  ```

- `AVG()`: è®¡ç®—è¡¨ä¸­æŸåˆ—å€¼çš„å¹³å‡å€¼ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢`employees`è¡¨ä¸­å‘˜å·¥çš„å¹³å‡å·¥èµ„ï¼š

  ```sql
  SELECT AVG(salary) FROM employees;
  ```

- `MIN()`: è®¡ç®—è¡¨ä¸­æŸåˆ—å€¼çš„æœ€å°å€¼ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢`employees`è¡¨ä¸­æœ€ä½å·¥èµ„ï¼š

  ```sql
  SELECT MIN(salary) FROM employees;
  ```

- `MAX()`: è®¡ç®—è¡¨ä¸­æŸåˆ—å€¼çš„æœ€å¤§å€¼ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢`employees`è¡¨ä¸­æœ€é«˜å·¥èµ„ï¼š

  ```sql
  SELECT MAX(salary) FROM employees;
  ```

#### 2.2ã€åˆ†ç»„æŸ¥è¯¢

`GROUP BY`å­å¥ç”¨äºå°†æŸ¥è¯¢ç»“æœæŒ‰ç…§ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—è¿›è¡Œåˆ†ç»„ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥æ•°é‡ï¼š

```sql
SELECT department_id, COUNT(*)
FROM employees
GROUP BY department_id;
```

`HAVING`å­å¥ç”¨äºè¿‡æ»¤åˆ†ç»„åçš„ç»“æœã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢å‘˜å·¥æ•°é‡è¶…è¿‡10äººçš„éƒ¨é—¨ï¼š

```sql
SELECT department_id, COUNT(*)
FROM employees
GROUP BY department_id
HAVING COUNT(*) > 10;
```

æ³¨æ„ï¼šåœ¨8.0ä¹‹å‰ï¼ŒGroup byä¼šé»˜è®¤æ ¹æ®ä½œç”¨å­—æ®µï¼ˆGroup byçš„åæ¥å­—æ®µï¼‰å¯¹ç»“æœè¿›è¡Œæ’åºã€‚åœ¨èƒ½åˆ©ç”¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼ŒGroup byä¸éœ€è¦é¢å¤–è¿›è¡Œæ’åºæ“ä½œï¼›ä½†å½“æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºæ—¶ï¼ŒMysqlä¼˜åŒ–å™¨å°±ä¸å¾—ä¸é€‰æ‹©é€šè¿‡ä½¿ç”¨ä¸´æ—¶è¡¨ç„¶åå†æ’åºçš„æ–¹å¼æ¥å®ç°GROUP BYäº†ï¼Œæ•ˆç‡ä½ä¸‹ã€‚åœ¨8.0ä¹‹åï¼Œç¦ç”¨äº†group byçš„éšå½¢æ’åºã€‚

### 3ã€å­æŸ¥è¯¢ä¸åµŒå¥—æŸ¥è¯¢

å­æŸ¥è¯¢æ˜¯åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­çš„æŸ¥è¯¢ã€‚å­æŸ¥è¯¢å¯ä»¥å‡ºç°åœ¨`SELECT`ã€`FROM`ã€`WHERE`å’Œ`HAVING`å­å¥ä¸­ã€‚æ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œå­æŸ¥è¯¢å¯ä»¥åˆ†ä¸ºæ ‡é‡å­æŸ¥è¯¢ã€è¡Œå­æŸ¥è¯¢å’Œè¡¨å­æŸ¥è¯¢ã€‚

#### 3.1ã€æ ‡é‡å­æŸ¥è¯¢

æ ‡é‡å­æŸ¥è¯¢è¿”å›å•ä¸ªå€¼ï¼Œå¯ä»¥åœ¨`SELECT`ã€`WHERE`å’Œ`HAVING`å­å¥ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢å·¥èµ„é«˜äºå¹³å‡å·¥èµ„çš„å‘˜å·¥ï¼š

```sql
SELECT name, salary
FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```

#### 3.2ã€è¡Œå­æŸ¥è¯¢

è¡Œå­æŸ¥è¯¢è¿”å›ä¸€è¡Œæ•°æ®ï¼Œå¯ä»¥åœ¨`WHERE`å­å¥ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢å·¥èµ„å’Œå¥–é‡‘éƒ½é«˜äºæŸä¸ªå‘˜å·¥çš„å…¶ä»–å‘˜å·¥ï¼š

```sql
SELECT name, salary, bonus
FROM employees
WHERE (salary, bonus) > (SELECT salary, bonus FROM employees WHERE name = 'John Doe');
```

#### 3.3ã€è¡¨å­æŸ¥è¯¢

è¡¨å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªè¡¨ï¼Œå¯ä»¥åœ¨`FROM`å­å¥ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ï¼š

```sql
SELECT departments.department_name, high_salaries.name, high_salaries.salary
FROM departments
INNER JOIN (
    SELECT department_id, name, salary
    FROM employees
    WHERE (department_id, salary) IN (
        SELECT department_id, MAX(salary)
        FROM employees
        GROUP BY department_id
    )
) AS high_salaries ON departments.id = high_salaries.department_id;
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨è¡¨å­æŸ¥è¯¢æ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ï¼Œç„¶åå°†å…¶ç»“æœä¸`departments`è¡¨è¿›è¡Œè¿æ¥ï¼Œä»¥è·å–éƒ¨é—¨åç§°ã€‚

### 4ã€ç´¢å¼•çš„åˆ›å»ºã€ä½¿ç”¨ä¸ä¼˜åŒ–

ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®åº“å¯¹è±¡ï¼Œç”¨äºæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚é€šè¿‡åœ¨è¡¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå¯ä»¥åŠ å¿«æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œã€‚ä½†æ˜¯ï¼Œç´¢å¼•å¹¶éä¸‡èƒ½çš„ï¼Œè¿‡å¤šçš„ç´¢å¼•å¯èƒ½ä¼šå½±å“æ•°æ®çš„æ’å…¥å’Œæ›´æ–°æ€§èƒ½ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•æ—¶ï¼Œéœ€è¦æƒè¡¡æŸ¥è¯¢æ€§èƒ½ä¸æ•°æ®ä¿®æ”¹æ€§èƒ½ä¹‹é—´çš„å¹³è¡¡ã€‚æœ¬èŠ‚å°†ä»‹ç»ç´¢å¼•çš„åˆ›å»ºã€ä½¿ç”¨ä¸ä¼˜åŒ–æ–¹æ³•ã€‚

#### 4.1ã€åˆ›å»ºç´¢å¼•

åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨`CREATE INDEX`è¯­å¥åˆ›å»ºç´¢å¼•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š

```sql
CREATE INDEX idx_employees_department_id ON employees(department_id);
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸º`employees`è¡¨çš„`department_id`åˆ—åˆ›å»ºäº†ä¸€ä¸ªåä¸º`idx_employees_department_id`çš„ç´¢å¼•ã€‚

é™¤äº†`CREATE INDEX`å¤–ï¼Œè¿˜å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨`CREATE TABLE`è¯­å¥ç›´æ¥åˆ›å»ºç´¢å¼•ã€‚ä¾‹å¦‚ï¼š

```sql
CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(255),
    department_id INT,
    INDEX idx_department_id (department_id)
);
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»º`employees`è¡¨æ—¶ä¸º`department_id`åˆ—åˆ›å»ºäº†ä¸€ä¸ªç´¢å¼•ã€‚

#### 4.2ã€ä½¿ç”¨ç´¢å¼•

å½“æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç´¢å¼•æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œç´¢å¼•çš„ä½¿ç”¨å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆçš„ã€‚ä»¥ä¸‹å‡ ç§æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼š

- ä½¿ç”¨`LIKE`æ“ä½œç¬¦è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢æ—¶ï¼Œä»¥é€šé…ç¬¦å¼€å¤´çš„æ¨¡å¼ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚
- åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè®¡ç®—æˆ–ä½¿ç”¨å‡½æ•°æ—¶ï¼Œç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ã€‚
- å½“æŸ¥è¯¢æ¡ä»¶ä¸­çš„`OR`æ“ä½œç¬¦æ¶‰åŠå¤šä¸ªåˆ—æ—¶ï¼Œç´¢å¼•å¯èƒ½æ— æ³•è¢«ä½¿ç”¨ã€‚

è¦æŸ¥çœ‹MySQLæ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨`EXPLAIN`è¯­å¥åˆ†ææŸ¥è¯¢è®¡åˆ’ã€‚ä¾‹å¦‚ï¼š

```sql
EXPLAIN SELECT * FROM employees WHERE department_id = 10;
```

è¿™ä¸ªæŸ¥è¯¢å°†è¿”å›ä¸€äº›å…³äºæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€å“ªä¸ªç´¢å¼•è¢«ä½¿ç”¨ä»¥åŠç´¢å¼•çš„ä½¿ç”¨æ•ˆæœç­‰ã€‚

#### 4.3ã€ç´¢å¼•ç±»å‹

MySQLæ”¯æŒå¤šç§ç±»å‹çš„ç´¢å¼•ï¼ŒæŒ‰ç…§æ•°æ®ç»“æ„åˆ†ç±»ï¼š
1. **B+Treeç´¢å¼•**ï¼šB+Treeï¼ˆBalance+ Treeï¼‰ç´¢å¼•æ˜¯MySQLä¸­æœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚å®ƒé€‚ç”¨äºå…¨å€¼åŒ¹é…å’ŒèŒƒå›´æŸ¥è¯¢ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒæ’åºå’Œåˆ†ç»„æ“ä½œã€‚
2. **Hashç´¢å¼•**ï¼šHashç´¢å¼•åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œé€‚ç”¨äºç­‰å€¼æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œå®ƒä¸é€‚ç”¨äºèŒƒå›´æŸ¥è¯¢ã€æ’åºå’Œåˆ†ç»„æ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¸æ”¯æŒæ˜¾å¼çš„Hashç´¢å¼•ï¼Œä½†ä¼šè‡ªåŠ¨åˆ›å»ºéšå¼çš„Hashç´¢å¼•æ¥ä¼˜åŒ–ç­‰å€¼æŸ¥è¯¢ã€‚
3. **Full-textç´¢å¼•**ï¼šå…¨æ–‡ç´¢å¼•ç”¨äºæ–‡æœ¬å†…å®¹çš„æœç´¢ï¼Œèƒ½å¤Ÿæä¾›åŸºäºå…³é”®è¯çš„æœç´¢åŠŸèƒ½ã€‚åœ¨MySQLä¸­ï¼Œå…¨æ–‡ç´¢å¼•ä¸»è¦åº”ç”¨äºMyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“ã€‚å…¨æ–‡ç´¢å¼•é»˜è®¤åˆ†è¯å™¨ä»…å¯¹è‹±æ–‡åšäº†ä¼˜åŒ–ï¼Œä¸”æŸ¥è¯¢åŠŸèƒ½æœ‰é™ï¼Œä¸€èˆ¬ä¸åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ï¼Œæ¨èä½¿ç”¨æœç´¢å¼•æ“ï¼Œå¦‚Elasticsearchã€‚
4. **ç©ºé—´ç´¢å¼•**ï¼šç©ºé—´ç´¢å¼•ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹çš„æŸ¥è¯¢ï¼Œèƒ½å¤Ÿæé«˜åœ°ç†ç©ºé—´æ•°æ®çš„æŸ¥è¯¢æ€§èƒ½ã€‚åœ¨MySQLä¸­ï¼Œç©ºé—´ç´¢å¼•åŸºäºR-Treeå®ç°ï¼Œå¹¶ä¸»è¦åº”ç”¨äºMyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“ã€‚

æŒ‰ç…§ç‰©ç†å­˜å‚¨åˆ†ç±»ï¼ˆå‚è€ƒä¸‹ä¸€èŠ‚ï¼‰ï¼š
1. èšç°‡ç´¢å¼•
2. è¾…åŠ©ç´¢å¼•

æŒ‰ç…§å­—æ®µç‰¹æ€§åˆ†ç±»ï¼š

##### aã€ä¸»é”®ç´¢å¼•ï¼ˆPrimary Key Indexï¼‰
```sql
CREATE TABLE table_name (
    column_name INT PRIMARY KEY,
    ...
);
```
ä¸»é”®ç´¢å¼•ç”¨äºå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œã€‚å®ƒæ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„ç´¢å¼•ç±»å‹ï¼Œç¡®ä¿æ¯ä¸ªç´¢å¼•é”®çš„å”¯ä¸€æ€§ï¼Œå¹¶ç”¨äºåŠ é€Ÿä¸ä¸»é”®ç›¸å…³çš„æŸ¥è¯¢ã€‚

##### bã€å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰
```sql
CREATE TABLE table_name (
    column_name INT UNIQUE,
    ...
);
```
å”¯ä¸€ç´¢å¼•ç¡®ä¿ç´¢å¼•åˆ—ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚ä¸ä¸»é”®ç´¢å¼•ä¸åŒï¼Œå”¯ä¸€ç´¢å¼•å…è®¸ç©ºå€¼ï¼Œä½†å¯¹äºéç©ºå€¼ï¼Œæ¯ä¸ªå€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚

å¯ä»¥å¯¹å¤šä¸ªå­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•ï¼š
```sql
ALTER TABLE table_name ADD UNIQUE INDEX index_name (column1, column2, ...);
```

##### cã€æ™®é€šç´¢å¼•ï¼ˆNormal Indexï¼‰
```sql
CREATE TABLE table_name (
    ...
    INDEX index_name (column_name),
    ...
);
```
æ™®é€šç´¢å¼•æ˜¯æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œç”¨äºåŠ å¿«ç‰¹å®šåˆ—çš„æŸ¥è¯¢é€Ÿåº¦ã€‚å®ƒå¯ä»¥åŸºäºå•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—åˆ›å»ºã€‚

##### dã€å‰ç¼€ç´¢å¼•ï¼ˆPrefix Indexï¼‰
```sql
CREATE TABLE table_name (
    ...
    INDEX index_name (column_name(prefix_length)),
    ...
);
```
å‰ç¼€ç´¢å¼•å…è®¸æ‚¨åœ¨ç´¢å¼•ä¸­ä»…åŒ…å«åˆ—å€¼çš„å‰ç¼€éƒ¨åˆ†ã€‚è¿™å¯¹äºè¾ƒé•¿çš„åˆ—æˆ–æ–‡æœ¬åˆ—å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´å¹¶æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚

##### eã€éšè—ç´¢å¼•ï¼ˆInvisible Indexï¼‰
```sql
ALTER TABLE table_name ALTER INDEX index_name INVISIBLE;
```
éšè—ç´¢å¼•æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç´¢å¼•ç±»å‹ï¼Œå®ƒåœ¨æŸ¥è¯¢ä¼˜åŒ–å™¨çš„è§†å›¾ä¸­ä¸å¯è§ã€‚é€šè¿‡éšè—ç´¢å¼•ï¼Œæ‚¨å¯ä»¥å¯¹æŸäº›æŸ¥è¯¢è¿›è¡Œç´¢å¼•è°ƒæ•´è€Œä¸å½±å“å…¶ä»–æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚

éšè—ç´¢å¼•ä¸»è¦åº”ç”¨äºç´¢å¼•çš„ è½¯åˆ é™¤ å’Œ ç°åº¦å‘å¸ƒã€‚

åœ¨ä¹‹å‰MySQLçš„ç‰ˆæœ¬ä¸­ï¼Œåªèƒ½é€šè¿‡æ˜¾å¼çš„æ–¹å¼åˆ é™¤ç´¢å¼•ï¼Œå¦‚æœåˆ é™¤åå‘ç°ç´¢å¼•åˆ é”™äº†ï¼Œåˆåªèƒ½é€šè¿‡åˆ›å»ºç´¢å¼•çš„æ–¹å¼å°†åˆ é™¤çš„ç´¢å¼•æ·»åŠ å›æ¥ï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„æ•°æ®é‡éå¸¸å¤§ï¼Œæˆ–è€…è¡¨æ¯”è¾ƒå¤§ï¼Œè¿™ç§æ“ä½œçš„æˆæœ¬éå¸¸é«˜ã€‚åœ¨MySQL 8.0ä¸­ï¼Œåªéœ€è¦å°†è¿™ä¸ªç´¢å¼•å…ˆè®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œä½¿æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å†ä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼Œä½†æ˜¯ï¼Œæ­¤æ—¶è¿™ä¸ªç´¢å¼•è¿˜æ˜¯éœ€è¦MySQLåå°è¿›è¡Œç»´æŠ¤ï¼Œå½“ç¡®è®¤å°†è¿™ä¸ªç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ç³»ç»Ÿä¸ä¼šå—åˆ°å½±å“æ—¶ï¼Œå†å°†ç´¢å¼•å½»åº•åˆ é™¤ã€‚è¿™å°±æ˜¯ç´¢å¼•è½¯åˆ é™¤åŠŸèƒ½ã€‚

ç°åº¦å‘å¸ƒï¼Œå°±æ˜¯è¯´åˆ›å»ºç´¢å¼•æ—¶ï¼Œé¦–å…ˆå°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œé€šè¿‡ä¿®æ”¹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å¼€å…³ï¼Œä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ï¼Œé€šè¿‡explainå¯¹ç´¢å¼•è¿›è¡Œæµ‹è¯•ï¼Œç¡®è®¤è¿™ä¸ªç´¢å¼•æœ‰æ•ˆï¼ŒæŸäº›æŸ¥è¯¢å¯ä»¥ä½¿ç”¨åˆ°è¿™ä¸ªç´¢å¼•ï¼Œå°±å¯ä»¥å°†å…¶è®¾ç½®ä¸ºå¯è§ç´¢å¼•ï¼Œå®Œæˆç°åº¦å‘å¸ƒçš„æ•ˆæœã€‚

åœ¨ç°åº¦å‘å¸ƒçš„åœºæ™¯ä¸­æˆ‘ä»¬éœ€è¦åŒè¿‡explainåˆ†æéšè—ç´¢å¼•æ˜¯å¦å¯¹æŸäº›SQLæœ‰å¸®åŠ©ï¼Œä½†æ˜¯éšè—ç´¢å¼•åˆä¸ç”Ÿæ•ˆï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ

åœ¨MySQL8 ä¸­æä¾›äº†ä¸€ç§æ–°çš„æµ‹è¯•æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡ä¼˜åŒ–å™¨çš„ä¸€ä¸ªå¼€å…³æ¥æ‰“å¼€æŸä¸ªè®¾ç½®ï¼Œä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç æŸ¥çœ‹è¿™ä¸ªå¼€å…³æ˜¯å¦å¼€å¯ï¼š
```sql
select @@optimizer_switch \G;
```
æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š
```sql
use_invisible_indexes=off
```
è¿™ä¸ªå¼€å…³é»˜è®¤æ˜¯offï¼Œoffè¡¨ç¤ºå…³é—­ï¼ŒONè¡¨ç¤ºå¼€å¯ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹SQLåœ¨å½“å‰ä¼šè¯ä¸­å¼€å¯å’Œå…³é—­ï¼ˆä¸å½±å“å…¶ä»–ä¼šè¯è¿›ç¨‹ï¼‰ï¼š
```sql
set session optimizer_switch="use_invisible_indexes=on";
```
ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡explainåˆ†æéšè—ç´¢å¼•æ˜¯å¦å¯¹æŸäº›SQLæœ‰å¸®åŠ©ã€‚

##### fã€é™åºç´¢å¼•ï¼ˆDescending Indexï¼‰
```sql
CREATE TABLE table_name (
    ...
    INDEX index_name (column_name DESC),
    ...
);
```
é™åºç´¢å¼•ç”¨äºå¯¹åˆ—è¿›è¡Œé™åºæ’åºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¢å¼•æ˜¯å‡åºçš„ï¼Œä½†é€šè¿‡åœ¨åˆ—ä¸ŠæŒ‡å®š `DESC` å¯ä»¥åˆ›å»ºé™åºç´¢å¼•ã€‚

éœ€è¦æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨äº†whereæŸ¥è¯¢ï¼Œé‚£ä¹ˆé™åºç´¢å¼•å°†ä¸ä¼šç”Ÿæ•ˆã€‚

##### gã€å‡½æ•°ç´¢å¼•ï¼ˆFunction Indexï¼‰
```sql
CREATE TABLE table_name (
    ...
    INDEX index_name (UPPER(column_name)),
    ...
);
```
å‡½æ•°ç´¢å¼•å…è®¸æ‚¨åœ¨ç´¢å¼•ä¸­ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ—åã€‚è¿™å¯ä»¥å¸®åŠ©åŠ é€Ÿç‰¹å®šå‡½æ•°çš„æŸ¥è¯¢ã€‚

##### hã€å¤šå€¼ç´¢å¼•ï¼ˆMulti-Valued Indexï¼‰
å¤šå€¼ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å€¼æ•°ç»„çš„åˆ—ä¸Šå®šä¹‰çš„äºŒçº§ç´¢å¼•ã€‚

â€œæ­£å¸¸â€ç´¢å¼•çš„æ¯ä¸ªæ•°æ®è®°å½•éƒ½æœ‰ä¸€ä¸ªç´¢å¼•è®°å½• ï¼ˆ1ï¼š1ï¼‰ã€‚å¤šå€¼ç´¢å¼•å¯ä»¥å…·æœ‰å•ä¸ªæ•°æ®è®°å½•çš„å¤šä¸ªç´¢å¼•è®°å½• ï¼ˆNï¼š1ï¼‰ã€‚

å¤šå€¼ç´¢å¼•ç”¨äºä¸º JSON æ•°ç»„ç¼–åˆ¶ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹ JSON æ–‡æ¡£ä¸­çš„é‚®æ”¿ç¼–ç æ•°ç»„ä¸Šå®šä¹‰çš„å¤šå€¼ç´¢å¼•å°†ä¸ºæ¯ä¸ªé‚®æ”¿ç¼–ç åˆ›å»ºä¸€ä¸ªç´¢å¼•è®°å½•ï¼Œæ¯ä¸ªç´¢å¼•è®°å½•å¼•ç”¨ç›¸åŒçš„æ•°æ®è®°å½•ã€‚
```json
{
    "user":"Bob",
    "user_id":31,
    "zipcode":[94477,94536]
}
```

å¯ä»¥å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•ï¼š
```sql
CREATE TABLE customers (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    modified DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    custinfo JSON,
    INDEX zips( (CAST(custinfo->'$.zipcode' AS UNSIGNED ARRAY)) )
    );
```

ä¹Ÿå¯ä»¥ä¹‹åæ·»åŠ ç´¢å¼•ï¼š
```sql
CREATE TABLE customers (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    modified DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    custinfo JSON
    );

ALTER TABLE customers ADD INDEX zips( (CAST(custinfo->'$.zipcode' AS UNSIGNED ARRAY)) );
```
ä¹Ÿå¯ä»¥ä½œä¸ºç»„åˆç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼š
```sql
ALTER TABLE customers ADD INDEX comp(id, modified,
    (CAST(custinfo->'$.zipcode' AS UNSIGNED ARRAY)) );
```
éªŒè¯ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆï¼š
```sql
explain
SELECT * FROM `customers` s WHERE 94477 member of (s.`custinfo`->'$.zipcode')
```

å¦‚æœå­—æ®µçš„å€¼æœ¬èº«å°±æ˜¯æ•°ç»„ï¼Œæ¯”å¦‚ï¼š
```sql
INSERT INTO customers VALUES
         (NULL, NOW(), '["Collectibles", "Gilt", "Ruby", "Silver"]');
```
é‚£ä¹ˆï¼Œæ–°å¢ç´¢å¼•çš„æ—¶å€™è¿™ä¹ˆåšï¼š
```sql
ALTER TABLE customers
        ADD INDEX idx_zips( (CAST(custinfo->'$' AS CHAR(256) ARRAY)) );
```
éªŒè¯ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆï¼š
```sql
explain
SELECT * FROM `customers` s WHERE 'Ruby' member of (s.`custinfo`->'$')
```

#### 4.4ã€InnoDBç´¢å¼•æ¨¡å‹

InnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨B-Treeä½œä¸ºä¸»è¦çš„ç´¢å¼•ç»“æ„ã€‚åœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®å’Œç´¢å¼•éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰çš„æ•°æ®ç»“æ„ä¸­ã€‚

æ¯ä¸ªInnoDBè¡¨éƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œç§°ä¸ºèšç°‡ç´¢å¼•ã€‚åŒæ—¶ï¼ŒInnoDBè¿˜æ”¯æŒè¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼‰ï¼Œä¹Ÿç§°ä¸ºéèšç°‡ç´¢å¼•ã€‚

1. **èšç°‡ç´¢å¼•**ï¼šèšç°‡ç´¢å¼•å°†è¡¨æ•°æ®å’Œç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·ï¼ŒæŒ‰ç…§ä¸»é”®é¡ºåºå­˜å‚¨ã€‚è¿™æ„å‘³ç€ï¼Œä¸»é”®æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢çš„æ€§èƒ½éå¸¸é«˜ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿå¯¼è‡´äº†æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œçš„æ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚

2. **è¾…åŠ©ç´¢å¼•**ï¼šè¾…åŠ©ç´¢å¼•å­˜å‚¨äº†å¯¹åº”åˆ—çš„å€¼ä»¥åŠæŒ‡å‘èšç°‡ç´¢å¼•çš„æŒ‡é’ˆã€‚è¿™æ„å‘³ç€ï¼Œåœ¨ä½¿ç”¨è¾…åŠ©ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œé¢å¤–çš„æŸ¥æ‰¾æ“ä½œï¼ˆå›è¡¨ï¼‰ä»¥è·å–å®Œæ•´çš„è¡Œæ•°æ®ã€‚

#### 4.5ã€ç´¢å¼•ç»´æŠ¤

ä¸ºäº†ä¿æŒç´¢å¼•çš„æ€§èƒ½ï¼Œéœ€è¦å®šæœŸè¿›è¡Œç´¢å¼•ç»´æŠ¤ï¼ŒåŒ…æ‹¬åˆ†æç´¢å¼•ã€ä¼˜åŒ–ç´¢å¼•å’Œé‡å»ºç´¢å¼•ã€‚

1. **åˆ†æç´¢å¼•**ï¼šä½¿ç”¨`ANALYZE TABLE`å‘½ä»¤å¯ä»¥æ”¶é›†è¡¨å’Œç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä»¥å¸®åŠ©ä¼˜åŒ–å™¨é€‰æ‹©æ›´ä¼˜çš„æŸ¥è¯¢è®¡åˆ’ã€‚

2. **ä¼˜åŒ–ç´¢å¼•**ï¼šä½¿ç”¨`OPTIMIZE TABLE`å‘½ä»¤å¯ä»¥æ•´ç†è¡¨å’Œç´¢å¼•çš„æ•°æ®ï¼Œä»¥æé«˜æŸ¥è¯¢å’Œæ’å…¥æ€§èƒ½ã€‚

3. **é‡å»ºç´¢å¼•**ï¼šå½“ç´¢å¼•å‡ºç°ç¢ç‰‡åŒ–æˆ–æ€§èƒ½ä¸‹é™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`ALTER TABLE ... DROP INDEX` å’Œ `ALTER TABLE ... ADD INDEX` å‘½ä»¤é‡å»ºç´¢å¼•ã€‚

##### aã€B+æ ‘çš„ç»´æŠ¤
åœ¨B+æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸­çš„å…³é”®å­—éƒ½æ˜¯æœ‰åºçš„ã€‚B+æ ‘é€šè¿‡ç»´æŠ¤è¿™ç§æœ‰åºæ€§ï¼Œå¯ä»¥å¿«é€Ÿåœ°æŸ¥æ‰¾å’Œéå†èŠ‚ç‚¹ä¸­çš„å…³é”®å­—ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ä¸ºäº†ä¿æŒèŠ‚ç‚¹ä¸­çš„å…³é”®å­—æœ‰åºï¼ŒB+æ ‘åœ¨æ’å…¥ã€åˆ é™¤èŠ‚ç‚¹æ—¶éœ€è¦è¿›è¡Œå¿…è¦çš„ç»´æŠ¤ã€‚

1. æ’å…¥èŠ‚ç‚¹

åœ¨B+æ ‘ä¸­æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆè¦æ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„æ’å…¥ä½ç½®ã€‚æ’å…¥ä½ç½®å¯ä»¥é€šè¿‡æŸ¥æ‰¾B+æ ‘çš„å¶å­èŠ‚ç‚¹å¾—åˆ°ã€‚æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦ä¿æŒèŠ‚ç‚¹ä¸­çš„å…³é”®å­—æœ‰åºæ€§ï¼Œå› æ­¤éœ€è¦å°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°æ­£ç¡®çš„ä½ç½®ã€‚æ’å…¥æ–°èŠ‚ç‚¹åï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„å…³é”®å­—æ•°é‡è¶…è¿‡äº†èŠ‚ç‚¹çš„å®¹é‡ï¼Œå°±éœ€è¦è¿›è¡ŒèŠ‚ç‚¹åˆ†è£‚æ“ä½œã€‚èŠ‚ç‚¹åˆ†è£‚æ“ä½œå¯ä»¥å°†å½“å‰èŠ‚ç‚¹åˆ†è£‚æˆä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œä¿æŒB+æ ‘çš„å¹³è¡¡ã€‚

2. åˆ é™¤èŠ‚ç‚¹

åœ¨B+æ ‘ä¸­åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆè¦æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ã€‚åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦ä¿æŒèŠ‚ç‚¹ä¸­çš„å…³é”®å­—æœ‰åºæ€§ï¼Œå› æ­¤éœ€è¦å°†åˆ é™¤åçš„èŠ‚ç‚¹é‡æ–°æ’åºã€‚å¦‚æœåˆ é™¤åèŠ‚ç‚¹ä¸­çš„å…³é”®å­—æ•°é‡ä½äºäº†èŠ‚ç‚¹çš„æœ€å°å®¹é‡ï¼Œå°±éœ€è¦è¿›è¡ŒèŠ‚ç‚¹åˆå¹¶æ“ä½œã€‚èŠ‚ç‚¹åˆå¹¶æ“ä½œå¯ä»¥å°†å½“å‰èŠ‚ç‚¹å’Œç›¸é‚»èŠ‚ç‚¹åˆå¹¶æˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œä¿æŒB+æ ‘çš„å¹³è¡¡ã€‚

ç»´æŠ¤B+æ ‘çš„æœ‰åºæ€§å¯ä»¥ä¿è¯æŸ¥è¯¢å’Œéå†èŠ‚ç‚¹æ—¶çš„æ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥ä¿æŒB+æ ‘çš„å¹³è¡¡ï¼Œé¿å…å‡ºç°è¿‡åº¦åˆ†è£‚æˆ–è€…è¿‡åº¦åˆå¹¶çš„æƒ…å†µã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡å’Œå®ç°B+æ ‘ç´¢å¼•æ—¶ï¼Œéœ€è¦å……åˆ†è€ƒè™‘ç»´æŠ¤B+æ ‘çš„æœ‰åºæ€§ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡å’Œä¿è¯æ•°æ®ç»“æ„çš„ç¨³å®šæ€§ã€‚

ä½¿ç”¨éæœ‰åºæ’å…¥çš„ä¸»é”®ï¼Œå†™æ•°æ®çš„æˆæœ¬ä¼šæ¯”è¾ƒé«˜ã€‚

#### 4.6ã€å›è¡¨

å½“ä½¿ç”¨è¾…åŠ©ç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œå›è¡¨æ“ä½œã€‚å›è¡¨æ˜¯æŒ‡é€šè¿‡è¾…åŠ©ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„èšç°‡ç´¢å¼•è®°å½•ä»¥è·å–å®Œæ•´çš„è¡Œæ•°æ®ã€‚ç”±äºå›è¡¨æ“ä½œéœ€è¦é¢å¤–çš„I/Oæ“ä½œï¼Œå› æ­¤ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚ä¸ºäº†å‡å°‘å›è¡¨æ¬¡æ•°ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚

æ¯”å¦‚å¯¹äºsql:`select * from t where k between 3 and 5`ã€‚è¿™é‡Œçš„kæ˜¯è¾…åŠ©ç´¢å¼•ã€‚è¿™ä¸ªSQLéœ€è¦æ‰§è¡Œå‡ æ¬¡æ ‘çš„æœç´¢æ“ä½œå‘¢ï¼Ÿ
éœ€è¦äº”æ¬¡ï¼š
1. åœ¨kç´¢å¼•æ ‘ä¸Šæ‰¾åˆ° k=3çš„è®°å½•ï¼Œå–å¾—ID=300;
2. å†åˆ°IDç´¢å¼•æ ‘æŸ¥åˆ°ID=300å¯¹åº”çš„R3;
3. åœ¨kç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼k=5ï¼Œå–å¾—ID=500;
4. å†å›åˆ°IDç´¢å¼•æ ‘æŸ¥åˆ°ID=500å¯¹åº”çš„R4;
5. åœ¨kç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼k=6,ä¸æ»¡è¶³æ¡ä»¶ï¼Œå¾ªç¯ç»“æŸã€‚

å¯ä»¥çœ‹åˆ°ï¼Œå›äº†ä¸¤æ¬¡è¡¨ã€‚

#### 4.7ã€è¦†ç›–ï¼ˆè”åˆï¼‰ç´¢å¼•

è¦†ç›–ç´¢å¼•æ˜¯ä¸€ç§åŒ…å«æŸ¥è¯¢æ‰€éœ€æ‰€æœ‰åˆ—çš„è¾…åŠ©ç´¢å¼•ã€‚ç”±äºè¦†ç›–ç´¢å¼•åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„æ•°æ®ï¼Œå› æ­¤åœ¨æŸ¥è¯¢æ—¶æ— éœ€è¿›è¡Œå›è¡¨æ“ä½œã€‚ä½¿ç”¨è¦†ç›–ç´¢å¼•å¯ä»¥å¤§å¹…æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è¡¨ä¸Šã€‚

è¦åˆ›å»ºè¦†ç›–ç´¢å¼•ï¼Œå¯ä»¥åœ¨`CREATE INDEX`è¯­å¥ä¸­åŒ…å«æ‰€æœ‰éœ€è¦çš„åˆ—ï¼Œä¾‹å¦‚ï¼š

```sql
CREATE INDEX idx_employees_name_department ON employees(name, department_id);
```

å¯ä»¥çœ‹åˆ°ï¼Œè¦†ç›–ç´¢å¼•æ˜¯å¤šä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œä¹Ÿå«è”åˆç´¢å¼•æˆ–è€…å¤åˆç´¢å¼•ã€ç»„åˆç´¢å¼•ã€‚

è”åˆç´¢å¼•éµä»æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå¦‚key(c1,c2,c3)ï¼Œé‚£ä¹ˆmysqlä»…å¯¹æœ€è¾¹çš„å‰ç¼€è¿›è¡Œæœ‰æ•ˆæŸ¥è¯¢ã€‚å¦‚c2=1ï¼Œåˆ™ç”¨ä¸åˆ°ç´¢å¼•ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªè¦c1å‡ºç°åœ¨whereä¸­ï¼Œå°±å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼Œä¸é¡ºåºæ— å…³ã€‚ä¾‹å¦‚c3=1 and c1 = 2ï¼Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„

åœ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. è¦†ç›–ç´¢å¼•åŒ…å«çš„åˆ—è¶Šå¤šï¼Œç´¢å¼•çš„å¤§å°è¶Šå¤§ï¼Œç»´æŠ¤æˆæœ¬è¶Šé«˜ã€‚
2. è¦†ç›–ç´¢å¼•é€‚ç”¨äºç»å¸¸å‡ºç°åœ¨æŸ¥è¯¢æ¡ä»¶å’Œç»“æœé›†ä¸­çš„åˆ—ã€‚
3. å½“æŸ¥è¯¢ä¸­çš„åˆ—è¢«ç´¢å¼•è¦†ç›–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`EXPLAIN`å‘½ä»¤æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’ä¸­çš„`Extra`åˆ—ï¼Œå®ƒåº”æ˜¾ç¤ºâ€œUsing indexâ€ã€‚

#### 4.8ã€æœ€ä½³å®è·µ

åœ¨åˆ›å»ºã€ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•æ—¶ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š

1. ä¸ºç»å¸¸å‡ºç°åœ¨æŸ¥è¯¢æ¡ä»¶å’Œæ’åºæ“ä½œä¸­çš„åˆ—åˆ›å»ºç´¢å¼•ã€‚
2. ä¸ºä¸»é”®åˆ›å»ºç´¢å¼•ã€‚
3. ä½¿ç”¨è¦†ç›–ç´¢å¼•é¿å…é¢å¤–çš„å›è¡¨æ“ä½œã€‚
4. å®šæœŸåˆ†æå’Œä¼˜åŒ–ç´¢å¼•ï¼Œä»¥ä¿æŒç´¢å¼•æ€§èƒ½ã€‚
5. é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè®¡ç®—æˆ–ä½¿ç”¨å‡½æ•°ï¼Œä»¥å……åˆ†åˆ©ç”¨ç´¢å¼•ä¼˜åŠ¿ã€‚
6. å½“æŸ¥è¯¢æ¡ä»¶ä¸­çš„`OR`æ“ä½œç¬¦æ¶‰åŠå¤šä¸ªåˆ—æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨è”åˆç´¢å¼•ã€‚

æ€»ä¹‹ï¼Œç´¢å¼•æ˜¯æé«˜æŸ¥è¯¢æ€§èƒ½çš„é‡è¦æ‰‹æ®µã€‚åœ¨åˆ›å»ºã€ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•æ—¶ï¼Œéœ€è¦å……åˆ†è€ƒè™‘å®é™…åº”ç”¨åœºæ™¯ï¼Œå¹¶æƒè¡¡æŸ¥è¯¢æ€§èƒ½ä¸æ•°æ®ä¿®æ”¹æ€§èƒ½ä¹‹é—´çš„å…³ç³»ã€‚

### 5ã€å­˜å‚¨è¿‡ç¨‹ä¸è§¦å‘å™¨

å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨æ˜¯æ•°æ®åº“ä¸­çš„ä¸¤ç§é‡è¦å¯¹è±¡ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æ›´å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚

#### 5.1ã€å­˜å‚¨è¿‡ç¨‹

å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ç§åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„é¢„å®šä¹‰SQLä»£ç å—ï¼Œå¯ä»¥è¢«è°ƒç”¨æ‰§è¡Œã€‚å­˜å‚¨è¿‡ç¨‹å¯ä»¥æ¥æ”¶å‚æ•°å¹¶è¿”å›ç»“æœï¼Œä»è€Œå®ç°å¤ç”¨å’Œå°è£…å¤æ‚é€»è¾‘ã€‚å­˜å‚¨è¿‡ç¨‹çš„ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬å‡å°‘ç½‘ç»œå¼€é”€ã€æé«˜æ€§èƒ½å’Œå®‰å…¨æ€§ä»¥åŠæ˜“äºç»´æŠ¤ã€‚

åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„è¯­æ³•å¦‚ä¸‹ï¼š

```sql
CREATE PROCEDURE procedure_name(parameter1, parameter2, ...)
BEGIN
    -- SQL statements
END;
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å­˜å‚¨è¿‡ç¨‹ç¤ºä¾‹ï¼Œç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼š

```sql
CREATE PROCEDURE add_numbers(IN a INT, IN b INT, OUT sum INT)
BEGIN
    SET sum = a + b;
END;
```

è°ƒç”¨å­˜å‚¨è¿‡ç¨‹çš„è¯­æ³•å¦‚ä¸‹ï¼š

```sql
CALL procedure_name(parameter1, parameter2, ...);
```

ä¾‹å¦‚ï¼Œè°ƒç”¨ä¸Šè¿°ç¤ºä¾‹ä¸­çš„å­˜å‚¨è¿‡ç¨‹ï¼š

```sql
SET @result = 0;
CALL add_numbers(5, 10, @result);
SELECT @result;
```

#### 5.2ã€è§¦å‘å™¨

è§¦å‘å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œå®ƒåœ¨æŸä¸ªäº‹ä»¶ï¼ˆå¦‚INSERTã€UPDATEæˆ–DELETEï¼‰å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œã€‚è§¦å‘å™¨å¯ä»¥ç”¨äºå®ç°æ•°æ®çš„è‡ªåŠ¨ç»´æŠ¤ã€çº¦æŸæ£€æŸ¥å’Œä¸šåŠ¡è§„åˆ™éªŒè¯ç­‰åŠŸèƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§¦å‘å™¨å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚

åˆ›å»ºè§¦å‘å™¨çš„è¯­æ³•å¦‚ä¸‹ï¼š

```sql
CREATE TRIGGER trigger_name
trigger_time trigger_event
ON table_name FOR EACH ROW
BEGIN
    -- SQL statements
END;
```

`trigger_time`å¯ä»¥æ˜¯`BEFORE`æˆ–`AFTER`ï¼Œè¡¨ç¤ºè§¦å‘å™¨åœ¨äº‹ä»¶å‘ç”Ÿå‰æˆ–å‘ç”Ÿåæ‰§è¡Œã€‚`trigger_event`å¯ä»¥æ˜¯`INSERT`ã€`UPDATE`æˆ–`DELETE`ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è§¦å‘å™¨ç¤ºä¾‹ï¼Œç”¨äºåœ¨`employees`è¡¨çš„`salary`å­—æ®µæ›´æ–°åè‡ªåŠ¨æ›´æ–°`salary_history`è¡¨ï¼š

```sql
CREATE TRIGGER update_salary_history
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    IF NEW.salary <> OLD.salary THEN
        INSERT INTO salary_history(employee_id, old_salary, new_salary, change_date)
        VALUES (OLD.id, OLD.salary, NEW.salary, NOW());
    END IF;
END;
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè§¦å‘å™¨å°†åœ¨`employees`è¡¨çš„`salary`å­—æ®µæ›´æ–°åè‡ªåŠ¨å°†å˜æ›´è®°å½•æ’å…¥åˆ°`salary_history`è¡¨ä¸­ã€‚

å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨æ˜¯æ•°æ®åº“ä¸­çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æ›´å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ä¸€è‡´æ€§ã€‚

### 6ã€å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆCommon Table Expressionsï¼‰

å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼ŒCommon Table Expressionsï¼‰æ˜¯ä¸€ç§ä¸´æ—¶ç»“æœé›†ï¼Œç”¨äºç®€åŒ–å¤æ‚çš„SQLæŸ¥è¯¢ã€‚CTEåœ¨æŸ¥è¯¢æ‰§è¡ŒæœŸé—´ä»…å­˜åœ¨äºå†…å­˜ä¸­ï¼Œå®ƒèƒ½å¤Ÿæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚CTEè¿˜å¯ä»¥ç”¨äºå®ç°é€’å½’æŸ¥è¯¢ï¼Œä»è€Œå¤„ç†å…·æœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®ã€‚

#### 6.1ã€åˆ›å»ºå’Œä½¿ç”¨CTE

åˆ›å»ºCTEçš„è¯­æ³•å¦‚ä¸‹ï¼š

```sql
WITH cte_name (column1, column2, ...)
AS (
    -- CTEçš„å®šä¹‰ï¼Œå¯ä»¥æ˜¯SELECTã€INSERTã€UPDATEæˆ–DELETEè¯­å¥
)
-- ä½¿ç”¨CTEçš„æŸ¥è¯¢
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„CTEç¤ºä¾‹ï¼Œç”¨äºè®¡ç®—å‘˜å·¥çš„å¹³å‡å·¥èµ„ï¼š

```sql
WITH avg_salaries (department_id, average_salary)
AS (
    SELECT department_id, AVG(salary)
    FROM employees
    GROUP BY department_id
)

--- 

SELECT e.id, e.name, e.department_id, e.salary, a.average_salary
FROM employees e
JOIN avg_salaries a ON e.department_id = a.department_id
```

`WITH`å‘½ååé¢çš„`column_list`å¯ä»¥çœç•¥ï¼Œå¦‚æœçœç•¥ï¼Œåˆ™è¡¨ç¤ºCTEçš„åˆ—ä¸æŸ¥è¯¢ä¸­çš„åˆ—ç›¸åŒã€‚
```sql
WITH avg_salaries
AS (
    SELECT department_id, AVG(salary) as average_salary
    FROM employees
    GROUP BY department_id
)
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåä¸º`avg_salaries`çš„CTEï¼Œç”¨äºè®¡ç®—å„éƒ¨é—¨çš„å¹³å‡å·¥èµ„ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸»æŸ¥è¯¢ä¸­å°†`employees`è¡¨ä¸CTEè¿›è¡Œè¿æ¥ï¼Œä»¥æ˜¾ç¤ºå‘˜å·¥çš„è¯¦ç»†ä¿¡æ¯å’Œå¯¹åº”éƒ¨é—¨çš„å¹³å‡å·¥èµ„ã€‚

#### 6.2ã€é€’å½’CTE

é€’å½’CTEæ˜¯ä¸€ç§ç‰¹æ®Šçš„CTEï¼Œå®ƒå¯ä»¥å¼•ç”¨è‡ªèº«ï¼Œä»è€Œå®ç°é€’å½’æŸ¥è¯¢ã€‚é€’å½’CTEé€šå¸¸ç”¨äºå¤„ç†å…·æœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®ï¼Œå¦‚ç»„ç»‡æ¶æ„ã€æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚

åˆ›å»ºé€’å½’CTEçš„è¯­æ³•å¦‚ä¸‹ï¼š

```sql
WITH RECURSIVE cte_name (column1, column2, ...)
AS (
    -- éé€’å½’éƒ¨åˆ†ï¼ˆåˆå§‹æŸ¥è¯¢ï¼‰
    UNION ALL
    -- é€’å½’éƒ¨åˆ†ï¼ˆå¼•ç”¨CTEçš„æŸ¥è¯¢ï¼‰
)
-- ä½¿ç”¨CTEçš„æŸ¥è¯¢
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é€’å½’CTEç¤ºä¾‹ï¼Œç”¨äºæŸ¥è¯¢å‘˜å·¥çš„ä¸Šçº§é¢†å¯¼ï¼š

```sql
WITH RECURSIVE employee_hierarchy
AS (
    -- éé€’å½’éƒ¨åˆ†ï¼ˆåˆå§‹æŸ¥è¯¢ï¼‰
    SELECT id, name, supervisor_id
    FROM employees
    WHERE id = 1
    UNION ALL
    -- é€’å½’éƒ¨åˆ†ï¼ˆå¼•ç”¨CTEçš„æŸ¥è¯¢ï¼‰
    SELECT e.id, e.name, e.supervisor_id
    FROM employees e
    JOIN employee_hierarchy eh ON e.supervisor_id = eh.id
)
SELECT * FROM employee_hierarchy;
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåä¸º`employee_hierarchy`çš„é€’å½’CTEã€‚ç„¶åï¼Œåœ¨ä¸»æŸ¥è¯¢ä¸­ä½¿ç”¨CTEæŸ¥è¯¢å‘˜å·¥çš„ä¸Šçº§é¢†å¯¼ã€‚

### 7ã€ä¸´æ—¶è¡¨
ä¸´æ—¶è¡¨ï¼ˆTemporary Tableï¼‰æ˜¯ä¸€ç§å­˜å‚¨ä¸´æ—¶æ•°æ®çš„è¡¨æ ¼ï¼Œå®ƒåœ¨åˆ›å»ºååªå­˜åœ¨äºå½“å‰çš„ä¼šè¯ä¸­ï¼Œå¹¶åœ¨ä¼šè¯ç»“æŸåè‡ªåŠ¨åˆ é™¤ã€‚

ä¸´æ—¶è¡¨å¯ä»¥å­˜å‚¨ä¸´æ—¶æ•°æ®ï¼Œå¯ä»¥åœ¨å¤šä¸ªæŸ¥è¯¢ä¹‹é—´å…±äº«æ•°æ®ï¼Œå¯ä»¥åœ¨å¤šä¸ªä¼šè¯ä¹‹é—´å…±äº«æ•°æ®ï¼Œå¯ä»¥ç”¨äºå­˜å‚¨ä¸­é—´ç»“æœï¼Œæé«˜æŸ¥è¯¢çš„æ€§èƒ½ã€‚

#### 7.1ã€ä¸´æ—¶è¡¨çš„è¯­æ³•

åœ¨MySQLä¸­ï¼Œåˆ›å»ºä¸´æ—¶è¡¨çš„è¯­æ³•ä¸åˆ›å»ºæ™®é€šè¡¨çš„è¯­æ³•ç›¸åŒï¼Œåªæ˜¯åœ¨è¡¨åå‰åŠ ä¸Šå…³é”®å­—TEMPORARYï¼Œè¡¨ç¤ºåˆ›å»ºçš„æ˜¯ä¸´æ—¶è¡¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼š

```
CREATE TEMPORARY TABLE temp_table (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    PRIMARY KEY (id)
);
```

#### 7.2ã€ä¸´æ—¶è¡¨çš„å±æ€§å’Œé™åˆ¶

ä¸æ™®é€šè¡¨ä¸€æ ·ï¼Œä¸´æ—¶è¡¨ä¹Ÿå…·æœ‰å„ç§å±æ€§å’Œé™åˆ¶ï¼Œä¾‹å¦‚è¡¨çš„å­˜å‚¨å¼•æ“ã€è¡¨çš„å­—ç¬¦é›†ç­‰ã€‚ä¸è¿‡ï¼Œç”±äºä¸´æ—¶è¡¨çš„ç‰¹æ®Šæ€§è´¨ï¼Œå…¶å…·æœ‰ä»¥ä¸‹é™åˆ¶ï¼š

- ä¸´æ—¶è¡¨åªå­˜åœ¨äºå½“å‰ä¼šè¯ä¸­ï¼Œä¸èƒ½åœ¨å…¶ä»–ä¼šè¯ä¸­è®¿é—®ã€‚
- ä¸´æ—¶è¡¨çš„æ•°æ®åªå­˜åœ¨äºå½“å‰ä¼šè¯ä¸­ï¼Œä¼šè¯ç»“æŸåä¼šè‡ªåŠ¨åˆ é™¤ã€‚
- ä¸´æ—¶è¡¨ä¸èƒ½æœ‰å¤–é”®çº¦æŸï¼Œå› ä¸ºå¤–é”®çº¦æŸéœ€è¦å¼•ç”¨å…¶ä»–è¡¨ã€‚

#### 7.3ã€ä¸´æ—¶è¡¨çš„ä½¿ç”¨

åˆ›å»ºä¸´æ—¶è¡¨åï¼Œå¯ä»¥ä½¿ç”¨INSERTã€UPDATEã€DELETEç­‰è¯­å¥å‘è¡¨ä¸­æ’å…¥æ•°æ®æˆ–ä¿®æ”¹æ•°æ®ã€‚ä¸´æ—¶è¡¨çš„ä½¿ç”¨æ–¹å¼ä¸æ™®é€šè¡¨ç›¸åŒï¼Œå¯ä»¥é€šè¿‡SELECTç­‰è¯­å¥æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥å‘ä¸´æ—¶è¡¨ä¸­æ’å…¥æ•°æ®ï¼š

```
INSERT INTO temp_table (name) VALUES ('John'), ('Mike'), ('Peter');
```

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥æŸ¥è¯¢ä¸´æ—¶è¡¨ä¸­çš„æ•°æ®ï¼š

```
SELECT * FROM temp_table;
```

#### 7.4ã€ä¸´æ—¶è¡¨çš„å®ç°åŸç†

##### aã€å†…å­˜ä¸´æ—¶è¡¨

åœ¨MySQLä¸­ï¼Œä¸´æ—¶è¡¨å¯ä»¥å­˜å‚¨åœ¨å†…å­˜ä¸­æˆ–è€…ç£ç›˜ä¸Šã€‚å¦‚æœä¸´æ—¶è¡¨çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¯ä»¥å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨çš„è¯­æ³•ä¸åˆ›å»ºæ™®é€šè¡¨çš„è¯­æ³•ç›¸åŒï¼Œä¾‹å¦‚ï¼š

```
CREATE TEMPORARY TABLE temp_table (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    PRIMARY KEY (id)
) ENGINE=MEMORY;
```

##### bã€ç£ç›˜ä¸´æ—¶è¡¨

å¦‚æœä¸´æ—¶è¡¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä¸èƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œéœ€è¦å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨HEAPæˆ–è€…MyISAMå­˜å‚¨å¼•æ“æ¥åˆ›å»ºç£ç›˜ä¸´æ—¶è¡¨ã€‚ä¾‹å¦‚ï¼š

```
CREATE TEMPORARY TABLE temp_table (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    PRIMARY KEY (id)
) ENGINE=HEAP;
```

æˆ–è€…ï¼š

```
CREATE TEMPORARY TABLE temp_table (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    PRIMARY KEY (id)
) ENGINE=MyISAM;
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç£ç›˜ä¸´æ—¶è¡¨å¯èƒ½ä¼šå¯¹æŸ¥è¯¢æ€§èƒ½å’Œå“åº”é€Ÿåº¦äº§ç”Ÿä¸€å®šçš„å½±å“ï¼Œå› æ­¤åœ¨åˆ›å»ºä¸´æ—¶è¡¨æ—¶éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚

##### cã€ä¸´æ—¶è¡¨çš„å­˜å‚¨å¼•æ“
åœ¨MySQLä¸­ï¼Œä¸´æ—¶è¡¨çš„å­˜å‚¨å¼•æ“å¯ä»¥æ˜¯ä»»ä½•ä¸€ç§åˆæ³•çš„å­˜å‚¨å¼•æ“ï¼Œä¾‹å¦‚InnoDBã€MyISAMã€MEMORYç­‰ã€‚ä¸è¿‡ï¼Œç”±äºä¸´æ—¶è¡¨çš„ç‰¹æ®Šæ€§è´¨ï¼Œæ¨èä½¿ç”¨MEMORYæˆ–è€…HEAPå­˜å‚¨å¼•æ“ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚

#### 7.5ã€å­æŸ¥è¯¢ä¸ä¸´æ—¶è¡¨
åœ¨MySQLä¸­ï¼Œå­æŸ¥è¯¢å¯èƒ½ä¼šåˆ›å»ºä¸´æ—¶è¡¨ï¼Œå…·ä½“å–å†³äºæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œå½“å­æŸ¥è¯¢éœ€è¦å°†ç»“æœä¿å­˜åœ¨ä¸´æ—¶è¡¨ä¸­æ—¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶è¡¨ï¼Œä¾‹å¦‚å½“å­æŸ¥è¯¢éœ€è¦ä½¿ç”¨ORDER BYæˆ–GROUP BYç­‰æ“ä½œæ—¶ã€‚æ­¤æ—¶ï¼ŒMySQLä¼šå°†å­æŸ¥è¯¢ç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œå¹¶å°†è¯¥ä¸´æ—¶è¡¨ä¸ä¸»æŸ¥è¯¢è¿›è¡ŒJoinæ“ä½œã€‚

ä¸´æ—¶è¡¨åœ¨æŸ¥è¯¢è¯­å¥ä¸­çš„ä½¿ç”¨æ˜¯MySQLçš„ä¼˜åŒ–å™¨è¿›è¡Œçš„å†³ç­–ï¼Œå…·ä½“å–å†³äºæŸ¥è¯¢çš„å¤æ‚æ€§å’Œæ•°æ®é‡ç­‰å› ç´ ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå­æŸ¥è¯¢ä¸­ä½¿ç”¨çš„è¡¨è¶Šå¤šï¼Œæ•°æ®é‡è¶Šå¤§ï¼Œä¸´æ—¶è¡¨çš„ä½¿ç”¨å°±è¶Šå¯èƒ½å‘ç”Ÿã€‚

### 8ã€è™šæ‹Ÿåˆ—
MySQL 5.7ç‰ˆæœ¬å¼•å…¥äº†è™šæ‹Ÿåˆ—ï¼ˆVirtual Columnsï¼‰çš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºè¡¨è¾¾å¼çš„è®¡ç®—åˆ—ï¼Œå®ƒçš„å€¼æ˜¯é€šè¿‡è®¡ç®—å…¶ä»–åˆ—çš„å€¼å¾—å‡ºçš„ï¼Œå¹¶ä¸”ä¸éœ€è¦å®é™…å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚è™šæ‹Ÿåˆ—æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥è·å–è¡ç”Ÿæ•°æ®ï¼Œè€Œæ— éœ€æ˜¾å¼åœ°å­˜å‚¨è¿™äº›æ•°æ®ã€‚

è™šæ‹Ÿåˆ—å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **è¡¨è¾¾å¼è®¡ç®—ï¼š** è™šæ‹Ÿåˆ—çš„å€¼æ˜¯é€šè¿‡è®¡ç®—å…¶ä»–åˆ—æˆ–è¡¨è¾¾å¼å¾—å‡ºçš„ã€‚å¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•°ã€ç®—æœ¯è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ç­‰æ¥å®šä¹‰è™šæ‹Ÿåˆ—çš„è®¡ç®—è§„åˆ™ã€‚

2. **ä¸å­˜å‚¨æ•°æ®ï¼š** è™šæ‹Ÿåˆ—ä¸éœ€è¦å®é™…å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå®ƒä»¬åªæ˜¯åœ¨æŸ¥è¯¢æ—¶åŠ¨æ€è®¡ç®—å‡ºæ¥çš„å€¼ã€‚è™šæ‹Ÿåˆ—çš„è®¡ç®—æ˜¯å®æ—¶è¿›è¡Œçš„ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½ä¼šé‡æ–°è®¡ç®—ã€‚

3. **æ•°æ®ç±»å‹å’Œçº¦æŸï¼š** è™šæ‹Ÿåˆ—å¯ä»¥ä½¿ç”¨ä»»ä½•åˆæ³•çš„æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥åº”ç”¨åˆ—çº§åˆ«çš„çº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚ NOT NULLã€UNIQUEã€DEFAULT å€¼ç­‰ã€‚

4. **ç´¢å¼•æ”¯æŒï¼š** è™šæ‹Ÿåˆ—å¯ä»¥ä¸ç´¢å¼•ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥åˆ›å»ºåŸºäºè™šæ‹Ÿåˆ—çš„ç´¢å¼•æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚

è¦åˆ›å»ºè™šæ‹Ÿåˆ—ï¼Œéœ€è¦ä½¿ç”¨ `GENERATED ALWAYS AS` å­å¥æ¥å®šä¹‰è™šæ‹Ÿåˆ—çš„è®¡ç®—è§„åˆ™ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºè™šæ‹Ÿåˆ—çš„ç¤ºä¾‹ï¼š

```sql
CREATE TABLE my_table (
  id INT,
  first_name VARCHAR(50),
  last_name VARCHAR(50),
  full_name VARCHAR(100) GENERATED ALWAYS AS (CONCAT(first_name, ' ', last_name)) VIRTUAL
);
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`full_name` æ˜¯ä¸€ä¸ªè™šæ‹Ÿåˆ—ï¼Œå®ƒçš„å€¼æ˜¯é€šè¿‡å°† `first_name` å’Œ `last_name` è¿›è¡Œè¿æ¥å¾—å‡ºçš„ã€‚æ¯å½“æŸ¥è¯¢åŒ…å« `full_name` åˆ—æ—¶ï¼ŒMySQL ä¼šåŠ¨æ€è®¡ç®—å¹¶è¿”å›è¯¥åˆ—çš„å€¼ã€‚

è™šæ‹Ÿåˆ—æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼æ¥è·å–è¡ç”Ÿæ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥å‡å°‘å†—ä½™å­˜å‚¨ã€‚

### 9ã€NULLå€¼çš„å¤„ç†
MySQLå»ºè¡¨çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®šåˆ—ä¸º`NOT NULL`ï¼Œé‚£ä¹ˆåˆ—çš„é»˜è®¤å€¼å°±æ˜¯`NULL`ã€‚

`NULL`æ˜¯ä¸€ç§ç‰¹æ®Šçš„å€¼ï¼Œè¡¨ç¤ºç¼ºå°‘æ•°æ®æˆ–è€…æœªçŸ¥æ•°æ®ã€‚åœ¨MySQLä¸­ï¼Œ`NULL`å€¼çš„å¤„ç†æ–¹å¼ä¸å…¶ä»–å€¼ä¸åŒï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚

#### 9.1ã€NULLå€¼çš„æ¯”è¾ƒä¸åˆ¤æ–­
åœ¨MySQLä¸­ï¼Œ`NULL`å€¼ä¸å…¶ä»–å€¼çš„æ¯”è¾ƒç»“æœéƒ½æ˜¯`NULL`ï¼Œå³`NULL = 1`ã€`NULL = 0`ã€`NULL = NULL`çš„ç»“æœéƒ½æ˜¯`NULL`ã€‚

å¯ä»¥ä½¿ç”¨`<=>`ç¬¦å·ã€`IFNULL`å‡½æ•°ã€`IS NULL`å’Œ`IS NOT NULL`æ¥åˆ¤æ–­`NULL`å€¼ã€‚

```sql
SELECT NULL = 1; -- NULL
SELECT NULL = 0; -- NULL
SELECT NULL = NULL; -- NULL
SELECT NULL <=> NULL; -- 1
SELECT IFNULL(NULL,'1'); -- 1
SELECT NULL IS NULL; -- 1
SELECT NULL IS NOT NULL; -- 0
```

#### 9.2ã€`count`å‡½æ•°å¯¹äº`NULL`çš„å¤„ç†
ä½¿ç”¨`count(*)` æˆ–è€…`count(null column)`ç»“æœä¸åŒï¼Œ`count(null column)<=count(*)`ã€‚

å‡è®¾nameæœ‰ä¸€åˆ—ä¸º`NULL`çš„æƒ…å†µä¸‹ï¼š
```sql
select count(*),count(name) from test;

+----------+------------+
|        2 |           1 |
```

#### 9.3ã€`NULL`å¯¹äºç´¢å¼•çš„å½±å“
MySQL ä¸­æ”¯æŒåœ¨å«æœ‰`NULL`å€¼çš„åˆ—ä¸Šä½¿ç”¨ç´¢å¼•ï¼Œä½†æ˜¯Oracleä¸æ”¯æŒã€‚è¿™å°±æ˜¯ä½ å¯èƒ½ä¼šå¬åˆ°`å¦‚æœåˆ—ä¸Šå«æœ‰NULLé‚£ä¹ˆå°†ä¼šä½¿ç´¢å¼•å¤±æ•ˆ`çš„åŸå› ã€‚

ä¸¥æ ¼æ¥è¯´ï¼Œè¿™å¥è¯å¯¹ä¸ MySQL æ¥è¯´æ˜¯ä¸å‡†ç¡®çš„ã€‚

#### 9.4ã€ä½¿ç”¨`NULL`å€¼çš„ç¼ºç‚¹
å¯¹å«æœ‰`NULL`å€¼çš„åˆ—è¿›è¡Œç»Ÿè®¡è®¡ç®—ï¼Œæ¯”å¦‚ï¼š`count()` `max()` `min()`ï¼Œç»“æœå¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„æœŸæœ›å€¼ï¼Œä¼šå¹²æ‰°æ’åºï¼Œåˆ†ç»„ï¼Œå»é‡ç»“æœã€‚

æœ‰çš„æ—¶å€™ä¸ºäº†æ¶ˆé™¤`NULL`å¸¦æ¥çš„æŠ€æœ¯å€ºåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨SQLä¸­ä½¿ç”¨`IFNULL()`æ¥ç¡®ä¿ç»“æœå¯æ§ï¼Œä½†æ˜¯è¿™ä½¿ç¨‹åºå˜å¾—å¤æ‚ã€‚

æŸäº›å…¬å¸ä¸æ¨èåœ¨åˆ—ä¸­è®¾ç½®`NULL`ä½œä¸ºåˆ—çš„é»˜è®¤å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨`NOT NULL`æ¶ˆé™¤é»˜è®¤è®¾ç½®ï¼Œä½¿ç”¨`0`æˆ–è€…`''`ç©ºå­—ç¬¦ä¸²æ¥ä»£æ›¿`NULL`ã€‚

### 10ã€æ­£åˆ™æŸ¥è¯¢
MySQLæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢ï¼Œä¸ºæ•°æ®åº“æŸ¥è¯¢æä¾›æ›´å¼ºå¤§å’Œçµæ´»çš„åŒ¹é…æ¨¡å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­—ç¬¦ä¸²æ¨¡å¼ï¼Œå¯ä»¥ç”¨æ¥åŒ¹é…ã€æŸ¥æ‰¾å’Œæ›¿æ¢æ–‡æœ¬ã€‚åœ¨MySQLä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨REGEXPæˆ–RLIKEå…³é”®å­—ï¼ˆå®ƒä»¬æ˜¯ç­‰ä»·çš„ï¼‰æ¥è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢ã€‚

æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•æ˜¯ï¼š

```sql
SELECT column
FROM table
WHERE column REGEXP 'pattern';
```

è¿™å°†è¿”å›æ‰€æœ‰åœ¨"column"ä¸­åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼'pattern'çš„è¡Œã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª"user"è¡¨ï¼Œå¹¶ä¸”ä½ æƒ³æ‰¾å‡ºæ‰€æœ‰ä»¥å­—æ¯"a"å¼€å§‹çš„ç”¨æˆ·åï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š

```sql
SELECT username
FROM user
WHERE username REGEXP '^a';
```

è¿™å°†è¿”å›æ‰€æœ‰ç”¨æˆ·åä»¥"a"å¼€å§‹çš„ç”¨æˆ·ã€‚

è¯·æ³¨æ„ï¼ŒMySQLä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚å¦‚æœä½ æƒ³è¿›è¡Œå¤§å°å†™ä¸æ•æ„Ÿçš„åŒ¹é…ï¼Œä½ å¯ä»¥ä½¿ç”¨REGEXP_LIKE()å‡½æ•°ï¼Œå¹¶æä¾›'i'æ ‡å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```sql
SELECT column
FROM table
WHERE REGEXP_LIKE(column, 'pattern', 'i');
```

è¿™å°†è¿”å›æ‰€æœ‰åœ¨"column"ä¸­åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼'pattern'çš„è¡Œï¼Œä¸è€ƒè™‘å¤§å°å†™ã€‚

ç„¶è€Œï¼Œæ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢çš„ç¼ºç‚¹æ˜¯å®ƒä»¬é€šå¸¸æ— æ³•åˆ©ç”¨ç´¢å¼•ï¼Œå› æ­¤å¯èƒ½æ¯”å…¶ä»–ç±»å‹çš„æŸ¥è¯¢æ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚ä½ å¯ä»¥é€šè¿‡å°†æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢ä¸å…¶ä»–ç±»å‹çš„æŸ¥è¯¢æ¡ä»¶ç»“åˆä½¿ç”¨ï¼Œæˆ–è€…é™åˆ¶æŸ¥è¯¢çš„èŒƒå›´æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

MySQLä½œä¸ºä¸€ç§é«˜æ€§èƒ½çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåœ¨å¤„ç†å¤§é‡æ•°æ®å’Œé«˜å¹¶å‘è®¿é—®æ—¶éœ€è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä»¥æé«˜ç³»ç»Ÿçš„ååé‡å’Œå“åº”é€Ÿåº¦ã€‚

### 1ã€ä¼˜åŒ–æŸ¥è¯¢è¯­å¥

æŸ¥è¯¢è¯­å¥æ˜¯MySQLæœ€å¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹ä¹‹ä¸€ã€‚ä¸‹é¢ä»‹ç»ä¸€äº›ä¼˜åŒ–æŸ¥è¯¢è¯­å¥çš„æ–¹æ³•ï¼š

1. ä½¿ç”¨ç´¢å¼•ï¼šç´¢å¼•æ˜¯æé«˜æŸ¥è¯¢æ€§èƒ½çš„é‡è¦æ‰‹æ®µï¼Œå¯ä»¥åŠ å¿«æ•°æ®çš„æŸ¥æ‰¾å’ŒåŒ¹é…ã€‚åœ¨ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œéœ€è¦è€ƒè™‘ç´¢å¼•çš„ç±»å‹ã€é€‰æ‹©åˆé€‚çš„åˆ—å’Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥ç­‰å› ç´ ã€‚
2. ä¼˜åŒ–æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶ï¼šé€šè¿‡åˆ†ææŸ¥è¯¢è¯­å¥çš„æ¡ä»¶ï¼Œå¯ä»¥å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰å‡å°‘æŸ¥è¯¢çš„IOå¼€é”€ï¼Œé¿å…å…¨è¡¨æ‰«æç­‰æ“ä½œã€‚
3. é¿å…ä½¿ç”¨SELECT *ï¼šé¿å…ä½¿ç”¨SELECT *å¯ä»¥å‡å°‘æŸ¥è¯¢çš„æ•°æ®é‡å’ŒIOå¼€é”€ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚
4. ä½¿ç”¨å†…è¿æ¥å’Œå·¦è¿æ¥ï¼šå†…è¿æ¥å’Œå·¦è¿æ¥æ˜¯ä¼˜åŒ–æŸ¥è¯¢è¯­å¥çš„é‡è¦æ‰‹æ®µï¼Œå¯ä»¥å°†å¤šå¼ è¡¨çš„æ•°æ®è¿›è¡Œè”åˆæŸ¥è¯¢ï¼Œå‡å°‘æ•°æ®åº“çš„IOå¼€é”€ã€‚
5. é¿å…åœ¨INåé¢ä½¿ç”¨å­æŸ¥è¯¢ï¼šå¯èƒ½å¯¼è‡´æŸ¥è¯¢è¯­å¥çš„æ•ˆç‡é™ä½ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨Joinæ“ä½œä»£æ›¿å­æŸ¥è¯¢ã€‚
6. åˆç†ä½¿ç”¨Group Byå’ŒOrder Byï¼šåœ¨ä½¿ç”¨Group Byå’ŒOrder Byæ—¶ï¼Œéœ€è¦æ³¨æ„ä½¿ç”¨åˆé€‚çš„ç´¢å¼•å’Œé¿å…ä½¿ç”¨å‡½æ•°ç­‰æ“ä½œï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚
7. é¿å…éšå¼è½¬æ¢ï¼šæ¯”å¦‚idæ˜¯longï¼Œå°±ä¸è¦ç”¨stringç±»å‹çš„idå»æŸ¥è¯¢
8. whereä¸­é¿å…ä½¿ç”¨å‡½æ•°ï¼šè¿™æ ·ä¼šä¸èµ°ç´¢å¼•
9. åªè¦ä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨limit 1
10. åƒä¸‡ä¸è¦order by rand()

### 2ã€explainè¯¦è§£

åœ¨ä¼˜åŒ–æŸ¥è¯¢è¯­å¥æ—¶ï¼Œå¯ä»¥é€šè¿‡explainå‘½ä»¤æ¥æŸ¥çœ‹æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œäº†è§£MySQLæ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„ã€‚

explainå‘½ä»¤å¯ä»¥å±•ç¤ºæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µã€è¡¨æ‰«ææ¬¡æ•°ç­‰ä¿¡æ¯ï¼Œä¸ºä¼˜åŒ–æŸ¥è¯¢è¯­å¥æä¾›å‚è€ƒã€‚

explainè¾“å‡ºçš„æ‰€æœ‰åˆ—å¦‚ä¸‹ï¼š

1. idï¼šæŸ¥è¯¢çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æŸ¥è¯¢ã€‚
2. select_typeï¼šæŸ¥è¯¢çš„ç±»å‹ï¼Œè¡¨ç¤ºæŸ¥è¯¢çš„å¤æ‚åº¦ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š
    - SIMPLEï¼šç®€å•çš„SELECTæŸ¥è¯¢ï¼Œä¸åŒ…å«å­æŸ¥è¯¢æˆ–UNIONæŸ¥è¯¢ã€‚
    - PRIMARYï¼šæŸ¥è¯¢ä¸­çš„æœ€å¤–å±‚æŸ¥è¯¢ï¼Œä¹Ÿç§°ä¸ºä¸»æŸ¥è¯¢ã€‚
    - UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åç»­æŸ¥è¯¢ã€‚
    - DEPENDENT UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åç»­æŸ¥è¯¢ï¼Œä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢çš„ç»“æœé›†ã€‚
    - SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢ã€‚
    - DEPENDENT SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼Œä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢çš„ç»“æœé›†ã€‚
    - DERIVEDï¼šæ´¾ç”Ÿè¡¨çš„SELECTæŸ¥è¯¢ï¼ŒåŒ…æ‹¬å­æŸ¥è¯¢ä¸­çš„æ´¾ç”Ÿè¡¨ã€‚
3. tableï¼šæŸ¥è¯¢çš„è¡¨åã€‚
4. partitionsï¼šæŸ¥è¯¢çš„åˆ†åŒºã€‚
5. typeï¼šç´¢å¼•çš„ç±»å‹ï¼Œè¡¨ç¤ºMySQLæ‰§è¡ŒæŸ¥è¯¢æ—¶é€‰æ‹©çš„ç´¢å¼•ç±»å‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š
    - nullï¼šä¸è®¿é—®ä»»ä½•è¡¨å’Œç´¢å¼•
    - constï¼šä½¿ç”¨å¸¸æ•°å€¼åŒ¹é…çš„ç´¢å¼•ï¼Œåªæœ‰ä¸€è¡Œç¬¦åˆæ¡ä»¶ï¼Œé€Ÿåº¦æœ€å¿«ã€‚
    - eq_refï¼šä½¿ç”¨å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®åŒ¹é…çš„ç´¢å¼•ï¼Œé€šå¸¸ç”¨äºè¿æ¥æŸ¥è¯¢ã€‚
    - refï¼šä½¿ç”¨éå”¯ä¸€ç´¢å¼•åŒ¹é…çš„ç´¢å¼•ï¼Œé€šå¸¸ç”¨äºæŸ¥è¯¢ç»“æœé›†è¾ƒå°çš„è¡¨ã€‚
    - rangeï¼šä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥æ‰¾åŒ¹é…çš„ç´¢å¼•ï¼Œé€šå¸¸ç”¨äºå¯¹ç´¢å¼•åˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ã€‚
    - indexï¼šè¿›è¡Œå…¨ç´¢å¼•æ‰«ææŸ¥æ‰¾åŒ¹é…çš„ç´¢å¼•ï¼Œé€šå¸¸ç”¨äºæŸ¥è¯¢ç»“æœé›†è¾ƒå°çš„è¡¨ã€‚
    - index_mergeï¼šä½¿ç”¨äº†ç´¢å¼•åˆå¹¶ä¼˜åŒ–ï¼ˆå¯¹å¤šä¸ªç´¢å¼•åˆ†åˆ«è¿›è¡Œæ¡ä»¶æ‰«æï¼Œç„¶åå°†å®ƒä»¬å„è‡ªçš„ç»“æœè¿›è¡Œåˆå¹¶ï¼‰
    - allï¼šè¿›è¡Œå…¨è¡¨æ‰«ææŸ¥æ‰¾åŒ¹é…çš„ç´¢å¼•ï¼Œé€Ÿåº¦æœ€æ…¢ã€‚
6. possible_keysï¼šå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ã€‚
7. keysï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚
8. key_lenï¼šç´¢å¼•ä½¿ç”¨çš„é•¿åº¦ã€‚
9. refï¼šç´¢å¼•çš„å‚è€ƒåˆ—ï¼Œè¡¨ç¤ºä½¿ç”¨çš„å“ªä¸ªåˆ—æˆ–å¸¸é‡ä¸ç´¢å¼•åˆ—è¿›è¡ŒåŒ¹é…ã€‚
10. rowsï¼šæ‰«æçš„è¡Œæ•°ï¼Œè¡¨ç¤ºMySQLé¢„è®¡è¦æ£€æŸ¥å¤šå°‘è¡Œæ¥æŸ¥æ‰¾æ‰€éœ€çš„è¡Œã€‚
11. filteredï¼šè¿”å›ç»“æœçš„è¡Œæ•°å æ€»è¡Œæ•°çš„æ¯”ä¾‹ï¼Œè¡¨ç¤ºMySQLè¿‡æ»¤äº†å¤šå°‘è¡Œã€‚
12. Extraï¼šé¢å¤–çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºMySQLåœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€äº›ç‰¹æ®ŠæŠ€æœ¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š
    - Using indexï¼šè¡¨ç¤ºMySQLä½¿ç”¨è¦†ç›–ç´¢å¼•æ¥é¿å…è¯»å–è¡Œçš„æ•°æ®ï¼Œä»è€ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚
    - Using whereï¼šè¡¨ç¤ºMySQLä½¿ç”¨WHEREè¿‡æ»¤å™¨æ¥æ£€ç´¢è¡Œï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç´¢å¼•ã€‚
    - Using temporaryï¼šè¡¨ç¤ºMySQLåˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶è¡¨æ¥å¤„ç†æŸ¥è¯¢ä¸­çš„ä¸€äº›æ•°æ®ï¼Œå¯èƒ½ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚
    - Using filesortï¼šè¡¨ç¤ºMySQLåœ¨å¯¹ç»“æœé›†è¿›è¡Œæ’åºæ—¶ä½¿ç”¨äº†æ–‡ä»¶æ’åºç®—æ³•ï¼Œå¯èƒ½ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚
    - Using join bufferï¼šè¡¨ç¤ºMySQLä½¿ç”¨äº†è¿æ¥ç¼“å­˜æ¥ä¼˜åŒ–è¿æ¥æ“ä½œçš„æ€§èƒ½ã€‚
    - Using index conditionï¼šè¡¨ç¤ºMySQLä½¿ç”¨ç´¢å¼•æ¡ä»¶æ¥è¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œå¯èƒ½ä¼šæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚
    - Impossible whereï¼šè¡¨ç¤ºæŸ¥è¯¢çš„WHEREæ¡ä»¶æ— æ³•åŒ¹é…ä»»ä½•è¡Œã€‚
    - Select tables optimized awayï¼šè¡¨ç¤ºMySQLä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œä»æŸ¥è¯¢ä¸­åˆ é™¤äº†ä¸éœ€è¦çš„è¡¨ï¼Œæé«˜äº†æŸ¥è¯¢é€Ÿåº¦ã€‚
    - Backward index scanï¼šmysql8çš„ä¸€ä¸ªä¼˜åŒ–ï¼Œè®©ç´¢å¼•ä»åå¾€å‰å»æ‰«æã€‚å¯¹äºå€’åºæŸ¥è¯¢éå¸¸æœ‰ç”¨ã€‚

é€šè¿‡åˆ†æexplainçš„è¾“å‡ºç»“æœï¼Œå¯ä»¥åˆ¤æ–­æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ•ˆç‡å’Œæ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼Œä»è€Œè¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è€ƒè™‘ä¼˜åŒ–æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶ã€å¢åŠ ç´¢å¼•æˆ–è€…è°ƒæ•´ç´¢å¼•çš„é¡ºåºç­‰æ–¹æ³•ï¼Œä»¥æé«˜æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ•ˆç‡ã€‚

### 3ã€åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—

æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯MySQLæä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡ä¸€å®šé˜ˆå€¼çš„æŸ¥è¯¢è¯­å¥ã€‚é€šè¿‡åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥å‘ç°æ•°æ®åº“çš„æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–ç‚¹ï¼Œä»è€Œå¯¹æ•°æ®åº“è¿›è¡Œä¼˜åŒ–ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼š

1. å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šå¯ä»¥é€šè¿‡ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ã€‚æ‰¾åˆ°my.cnfæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®é¡¹ï¼š

   ```ini
   slow_query_log = 1
   slow_query_log_file = /path/to/slow_query.log
   long_query_time = 1
   ```

   å…¶ä¸­ï¼Œ`slow_query_log`è¡¨ç¤ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œ`slow_query_log_file`æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ä½ç½®ï¼Œ`long_query_time`è¡¨ç¤ºæŸ¥è¯¢æ‰§è¡Œæ—¶é—´çš„é˜ˆå€¼ï¼Œå•ä½ä¸ºç§’ã€‚åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œè®¾ç½®æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’çš„æŸ¥è¯¢è¯­å¥ä¼šè¢«è®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚

2. æ”¶é›†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šMySQLæä¾›äº†`mysqldumpslow`å·¥å…·ï¼Œå¯ä»¥å¯¹æ…¢æŸ¥è¯¢æ—¥å¿—è¿›è¡Œåˆ†æå’Œè¿‡æ»¤ï¼Œæå–å‡ºå…³é”®ä¿¡æ¯ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ”¶é›†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š

   ```shell
   mysqldumpslow /path/to/slow_query.log > /path/to/slow_query_report.txt
   ```

   ä»¥ä¸Šå‘½ä»¤ä¼šå°†æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­çš„æŸ¥è¯¢è¯­å¥æŒ‰ç…§æ‰§è¡Œæ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ç­‰æŒ‡æ ‡è¿›è¡Œæ’åºï¼Œä¿å­˜åœ¨æŒ‡å®šçš„æŠ¥å‘Šæ–‡ä»¶ä¸­ã€‚

3. åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼šå¯ä»¥é€šè¿‡æŸ¥çœ‹æŠ¥å‘Šæ–‡ä»¶æ¥å‘ç°æŸ¥è¯¢æ€§èƒ½çš„ç“¶é¢ˆå’Œä¼˜åŒ–ç‚¹ã€‚å¯ä»¥æ ¹æ®æ‰§è¡Œæ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ç­‰æŒ‡æ ‡æ¥ç¡®å®šéœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢è¯­å¥ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è°ƒæ•´ã€‚

4. ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼šæ ¹æ®åˆ†æç»“æœï¼Œå¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ ç´¢å¼•ã€é‡æ„æŸ¥è¯¢è¯­å¥ã€ç¼“å­˜æŸ¥è¯¢ç»“æœç­‰æ“ä½œï¼Œä»¥æé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚

ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç°æŸ¥è¯¢æ€§èƒ½çš„ç“¶é¢ˆå’Œä¼˜åŒ–ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥é’ˆå¯¹æ€§åœ°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œæé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚

### 4ã€Performance Schema
Performance Schemaæ˜¯MySQLæä¾›çš„ä¸€ç§æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œç”¨äºæ”¶é›†å’Œå±•ç¤ºMySQLæ•°æ®åº“æœåŠ¡å™¨çš„æ€§èƒ½ä¿¡æ¯ã€‚

é€šè¿‡Performance Schemaï¼Œå¯ä»¥äº†è§£MySQLçš„è¿è¡ŒçŠ¶å†µã€è¯†åˆ«æ€§èƒ½ç“¶é¢ˆã€ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚

#### 4.1ã€Performance Schemaæ¦‚è¿°

Performance Schemaæ˜¯MySQL 5.5åŠä»¥ä¸Šç‰ˆæœ¬ä¸­æä¾›çš„ä¸€ç§æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œå¯ä»¥æ”¶é›†MySQLæœåŠ¡å™¨çš„æ€§èƒ½ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°å†…å­˜ä¸­æˆ–è€…æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œä¾›åç»­æŸ¥è¯¢å’Œåˆ†æã€‚

Performance Schemaå¯ä»¥æ”¶é›†çš„æ€§èƒ½ä¿¡æ¯åŒ…æ‹¬ï¼šSQLè¯­å¥çš„æ‰§è¡Œæ—¶é—´ã€IOè´Ÿè½½ã€é”ç­‰ä¿¡æ¯ï¼Œä»¥åŠå„ç§MySQLå†…éƒ¨å­ç³»ç»Ÿçš„æ€§èƒ½æŒ‡æ ‡ã€‚

ä¸å…¶ä»–ç›‘æ§å·¥å…·ç›¸æ¯”ï¼ŒPerformance Schemaå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

- ç²¾åº¦é«˜ï¼šå¯ä»¥æä¾›éå¸¸è¯¦ç»†çš„æ€§èƒ½ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸ªSQLè¯­å¥çš„æ‰§è¡Œæ—¶é—´ã€IOè´Ÿè½½ç­‰ç»†èŠ‚ä¿¡æ¯ã€‚
- ä½å¼€é”€ï¼šå¯ä»¥é€šè¿‡é…ç½®æ§åˆ¶Performance Schemaçš„é‡‡æ ·é¢‘ç‡å’Œé‡‡æ ·ç²’åº¦ï¼Œå‡å°‘å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚
- çµæ´»æ€§é«˜ï¼šå¯ä»¥æ ¹æ®éœ€è¦å¯¹ä¸åŒå­ç³»ç»Ÿçš„æ€§èƒ½ä¿¡æ¯è¿›è¡Œé‡‡æ ·å’Œè¿‡æ»¤ï¼Œå®ç°å®šåˆ¶åŒ–çš„ç›‘æ§æ–¹æ¡ˆã€‚

ä½†æ˜¯ï¼Œç”±äºPerformance Schemaæ”¶é›†çš„æ€§èƒ½ä¿¡æ¯è¾ƒä¸ºè¯¦ç»†ï¼Œå› æ­¤ä¹Ÿéœ€è¦è¾ƒé«˜çš„ç³»ç»Ÿé…ç½®å’Œèµ„æºæ¶ˆè€—ã€‚éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé…ç½®å’Œä½¿ç”¨ï¼Œé¿å…å¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆä¸å¿…è¦çš„å½±å“ã€‚

#### 4.2ã€Performance Schemaçš„ä½¿ç”¨æ–¹æ³•

Performance Schemaçš„ä½¿ç”¨æ–¹æ³•åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

##### aã€å¼€å¯Performance Schema

åœ¨MySQL 5.5åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼ŒPerformance Schemaé»˜è®¤æ˜¯å…³é—­çš„ã€‚éœ€è¦åœ¨my.cnfé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®é¡¹ï¼Œæ‰èƒ½å¼€å¯Performance Schemaï¼š

```ini
[mysqld]
performance_schema=1
```

ä»¥ä¸Šé…ç½®è¡¨ç¤ºå¼€å¯Performance SchemaåŠŸèƒ½ã€‚

##### bã€é…ç½®Performance Schema

Performance Schemaæä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é…ç½®Performance Schemaçš„é‡‡æ ·é¢‘ç‡ã€é‡‡æ ·ç²’åº¦ã€è¿‡æ»¤è§„åˆ™ç­‰ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç›‘æ§MySQLçš„æ€§èƒ½ã€‚

Performance Schemaçš„é…ç½®é¡¹å¯ä»¥é€šè¿‡SQLè¯­å¥è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨SQLè¯­å¥è¿›è¡Œé…ç½®ï¼š

```sql
SET GLOBAL performance_schema_events_waits_history_size = 10000;
SET GLOBAL performance_schema_max_statement_classes = 200;
```

ä»¥ä¸ŠSQLè¯­å¥åˆ†åˆ«è®¾ç½®Performance Schemaçš„ç­‰å¾…äº‹ä»¶å†å²è®°å½•å¤§å°å’Œæœ€å¤§è¯­å¥ç±»æ•°ã€‚

##### cã€æŸ¥è¯¢Performance Schemaçš„æ€§èƒ½ä¿¡æ¯

æŸ¥è¯¢Performance Schemaçš„æ€§èƒ½ä¿¡æ¯éœ€è¦ä½¿ç”¨SQLè¯­å¥ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLè¯­å¥æ¥æŸ¥è¯¢Performance Schemaçš„æ€§èƒ½ä¿¡æ¯ï¼š

```sql
SELECT * FROM performance_schema.events_waits_summary_global_by_event_name;
```

ä»¥ä¸ŠSQLè¯­å¥å¯ä»¥æŸ¥è¯¢ç­‰å¾…äº‹ä»¶çš„æ±‡æ€»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç­‰å¾…äº‹ä»¶åç§°ã€ç­‰å¾…äº‹ä»¶æ¬¡æ•°ã€ç­‰å¾…äº‹ä»¶æ€»æ—¶é—´ç­‰æŒ‡æ ‡ã€‚ç±»ä¼¼åœ°ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢å…¶ä»–å­ç³»ç»Ÿçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚ï¼š

```sql
-- æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°å’Œå¹³å‡æ‰§è¡Œæ—¶é—´
SELECT * FROM performance_schema.events_statements_summary_by_digest;

-- æŸ¥è¯¢é”ç­‰å¾…äº‹ä»¶çš„æ±‡æ€»ä¿¡æ¯
SELECT * FROM performance_schema.table_lock_waits_summary_by_table;
```

ä½¿ç”¨Performance Schemaå¯ä»¥éå¸¸æ–¹ä¾¿åœ°äº†è§£MySQLçš„æ€§èƒ½çŠ¶å†µï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ã€‚

#### 4.3ã€Performance Schemaçš„ä¼˜åŒ–å®è·µ

ä¸‹é¢ä»‹ç»ä¸€äº›å®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨Performance Schemaè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚

##### aã€ä¼˜åŒ–æŸ¥è¯¢è¯­å¥

æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½æ˜¯MySQLæ€§èƒ½ä¼˜åŒ–çš„å…³é”®ä¹‹ä¸€ã€‚é€šè¿‡Performance Schemaå¯ä»¥ç›‘æ§æ¯ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ—¶é—´ã€æ‰§è¡Œæ¬¡æ•°ç­‰æŒ‡æ ‡ï¼Œå¹¶è¯†åˆ«æ…¢æŸ¥è¯¢è¯­å¥ã€‚ä¸‹é¢ä»¥å®é™…æ¡ˆä¾‹ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨Performance Schemaä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·è¡¨`user`ï¼Œå…¶ä¸­åŒ…å«`id`ã€`name`å’Œ`age`ä¸‰ä¸ªå­—æ®µï¼Œç°åœ¨è¦æŸ¥è¯¢æ‰€æœ‰å¹´é¾„å¤§äºç­‰äº20å²çš„ç”¨æˆ·ï¼Œå¹¶æŒ‰ç…§IDå‡åºæ’åºã€‚æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š

```sql
SELECT id, name FROM user WHERE age >= 20 ORDER BY id ASC;
```

é€šè¿‡ä½¿ç”¨Performance Schemaï¼Œå¯ä»¥æ”¶é›†è¯¥æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½ä¿¡æ¯ï¼Œå¹¶æ‰¾åˆ°å…¶ä¼˜åŒ–ç‚¹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLè¯­å¥æ¥æŸ¥è¯¢è¯¥æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½ä¿¡æ¯ï¼š

```sql
SELECT * FROM performance_schema.events_statements_summary_by_digest
WHERE digest_text LIKE '%SELECT id, name FROM user WHERE age >= 20 ORDER BY id ASC%';
```

ä»¥ä¸ŠSQLè¯­å¥å¯ä»¥æŸ¥è¯¢è¯¥æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€æ€»æ‰§è¡Œæ—¶é—´ç­‰æŒ‡æ ‡ã€‚å¦‚æœå‘ç°è¯¥æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œä»¥ä¸‹ä¼˜åŒ–ï¼š

- æ·»åŠ ç´¢å¼•ï¼šå¦‚æœæŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨äº†WHEREå­å¥æˆ–è€…ORDER BYå­å¥ï¼Œå¯ä»¥æ·»åŠ é€‚å½“çš„ç´¢å¼•æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
- ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼šå¯ä»¥é€šè¿‡é‡æ„æŸ¥è¯¢è¯­å¥ã€åˆ†è§£æŸ¥è¯¢è¯­å¥ç­‰æ–¹å¼æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚

##### bã€ä¼˜åŒ–é”ç­‰å¾…äº‹ä»¶

é”ç­‰å¾…äº‹ä»¶æ˜¯MySQLæ€§èƒ½ä¼˜åŒ–çš„å¦ä¸€ä¸ªå…³é”®ç‚¹ã€‚é€šè¿‡Performance Schemaï¼Œå¯ä»¥ç›‘æ§é”ç­‰å¾…äº‹ä»¶çš„æƒ…å†µï¼Œå¹¶è¯†åˆ«é”ç­‰å¾…äº‹ä»¶çš„åŸå› ã€‚ä¸‹é¢ä»¥å®é™…æ¡ˆä¾‹ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨Performance Schemaä¼˜åŒ–é”ç­‰å¾…äº‹ä»¶ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¢å•è¡¨`order`ï¼Œå…¶ä¸­åŒ…å«`id`ã€`user_id`ã€`amount`å’Œ`status`å››ä¸ªå­—æ®µï¼Œç°åœ¨è¦å‘è¯¥è¡¨æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¹¶å°†è®¢å•çŠ¶æ€è®¾ç½®ä¸ºå·²å®Œæˆã€‚æ’å…¥è®°å½•çš„SQLè¯­å¥å¦‚ä¸‹ï¼š

```sql
INSERT INTO `order` (`user_id`, `amount`, `status`) VALUES (123, 100, 'COMPLETED');
```

é€šè¿‡ä½¿ç”¨Performance Schemaï¼Œå¯ä»¥æ”¶é›†è¯¥SQLè¯­å¥çš„æ€§èƒ½ä¿¡æ¯ï¼Œå¹¶æ‰¾åˆ°å…¶ä¼˜åŒ–ç‚¹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLè¯­å¥æ¥æŸ¥è¯¢è¯¥SQLè¯­å¥çš„æ€§èƒ½ä¿¡æ¯ï¼š

```sql
SELECT * FROM performance_schema.events_statements_summary_by_digest
WHERE digest_text LIKE '%INSERT INTO `order`%';
```

ä»¥ä¸ŠSQLè¯­å¥å¯ä»¥æŸ¥è¯¢è¯¥SQLè¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ã€æ€»æ‰§è¡Œæ—¶é—´ç­‰æŒ‡æ ‡ã€‚å¦‚æœå‘ç°è¯¥SQLè¯­å¥çš„é”ç­‰å¾…æ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œä»¥ä¸‹ä¼˜åŒ–ï¼š

- ä¼˜åŒ–é”ç­‰å¾…ç­–ç•¥ï¼šå¯ä»¥ä½¿ç”¨ä¸åŒçš„é”ç­‰å¾…ç­–ç•¥æ¥é¿å…é”ç­‰å¾…äº‹ä»¶ï¼Œä¾‹å¦‚ä½¿ç”¨è¡Œçº§é”æˆ–è€…ä¹è§‚é”ç­‰ã€‚
- ä¼˜åŒ–äº‹åŠ¡çš„èŒƒå›´ï¼šå¯ä»¥å°†äº‹åŠ¡çš„èŒƒå›´ç¼©å°ï¼Œå‡å°‘é”ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚

### 5ã€è¯»å†™åˆ†ç¦»ä¸ä¸»ä»å¤åˆ¶

#### 5.1ã€è¯»å†™åˆ†ç¦»çš„åŸç†ä¸ä¼˜ç‚¹

##### aã€è¯»å†™åˆ†ç¦»çš„åŸç†

è¯»å†™åˆ†ç¦»ï¼ˆRead-Write Separationï¼‰æ˜¯æŒ‡å°†æ•°æ®åº“çš„è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†ç¦»åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚åœ¨è¿™ç§æ¶æ„ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼ˆMasterï¼‰è´Ÿè´£å¤„ç†å†™æ“ä½œï¼Œä»¥åŠå¤šä¸ªä»æœåŠ¡å™¨ï¼ˆSlaveï¼‰è´Ÿè´£å¤„ç†è¯»æ“ä½œã€‚ä¸»æœåŠ¡å™¨ä¼šå°†æ•°æ®å˜æ›´åŒæ­¥åˆ°ä»æœåŠ¡å™¨ï¼Œä»è€Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

##### bã€è¯»å†™åˆ†ç¦»çš„ä¼˜ç‚¹

1. **è´Ÿè½½å‡è¡¡**ï¼šé€šè¿‡å°†è¯»æ“ä½œåˆ†å¸ƒåˆ°å¤šä¸ªä»æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥æœ‰æ•ˆå‡è½»ä¸»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚
2. **æé«˜ç³»ç»Ÿå¯ç”¨æ€§**ï¼šå½“ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°ä»æœåŠ¡å™¨ä¸Šç»§ç»­æä¾›æœåŠ¡ï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§ã€‚
3. **æé«˜æŸ¥è¯¢æ€§èƒ½**ï¼šä»æœåŠ¡å™¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åˆ›å»ºä¸åŒçš„ç´¢å¼•ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚
4. **å®ç°æ•°æ®å¤‡ä»½ä¸æ¢å¤**ï¼šä»æœåŠ¡å™¨å¯ä»¥ä½œä¸ºä¸»æœåŠ¡å™¨çš„æ•°æ®å¤‡ä»½ï¼Œä¾¿äºæ•°æ®æ¢å¤ã€‚

#### 5.2ã€ä¸»ä»å¤åˆ¶çš„åŸç†ä¸é…ç½®

##### aã€ä¸»ä»å¤åˆ¶çš„åŸç†

ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰æ˜¯æŒ‡ä¸»æœåŠ¡å™¨å°†æ•°æ®å˜æ›´åŒæ­¥åˆ°ä»æœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚åœ¨MySQLä¸­ï¼Œä¸»ä»å¤åˆ¶é€šå¸¸é‡‡ç”¨åŸºäºäºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼Œç®€ç§°binlogï¼‰çš„å¼‚æ­¥å¤åˆ¶æœºåˆ¶ã€‚ä¸»æœåŠ¡å™¨åœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šå°†å˜æ›´è®°å½•åˆ°binlogä¸­ï¼Œä»æœåŠ¡å™¨é€šè¿‡è·å–å¹¶æ‰§è¡Œè¿™äº›å˜æ›´è®°å½•ï¼Œå®ç°ä¸ä¸»æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥ã€‚

##### bã€é…ç½®ä¸»ä»å¤åˆ¶

é…ç½®ä¸»ä»å¤åˆ¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **é…ç½®ä¸»æœåŠ¡å™¨**ï¼šä¿®æ”¹ä¸»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œå¯ç”¨binlogï¼Œè®¾ç½®å”¯ä¸€çš„æœåŠ¡å™¨IDï¼ˆserver-idï¼‰ï¼Œå¹¶é‡å¯æœåŠ¡ã€‚
2. **é…ç½®ä»æœåŠ¡å™¨**ï¼šä¿®æ”¹ä»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®å”¯ä¸€çš„æœåŠ¡å™¨IDï¼ˆserver-idï¼‰ï¼Œå¹¶é‡å¯æœåŠ¡ã€‚
3. **åˆ›å»ºå¤åˆ¶ç”¨æˆ·**ï¼šåœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªå…·æœ‰å¤åˆ¶æƒé™çš„ç”¨æˆ·ï¼Œå¹¶è®°å½•ç”¨æˆ·ä¿¡æ¯ã€‚
4. **åˆå§‹åŒ–ä»æœåŠ¡å™¨æ•°æ®**ï¼šå°†ä¸»æœåŠ¡å™¨çš„æ•°æ®å¯¼å‡ºï¼Œå¹¶å¯¼å…¥åˆ°ä»æœåŠ¡å™¨ä¸Šï¼Œä¿è¯äºŒè€…æ•°æ®ä¸€è‡´ã€‚
5. **å¯åŠ¨ä¸»ä»å¤åˆ¶**ï¼šåœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡ŒCHANGE MASTERå‘½ä»¤ï¼ŒæŒ‡å®šä¸»æœåŠ¡å™¨çš„åœ°å€ã€ç«¯å£ã€å¤åˆ¶ç”¨æˆ·ä¿¡æ¯ä»¥åŠbinlogä½ç½®ç­‰ä¿¡æ¯ï¼Œç„¶åå¯åŠ¨ä»æœåŠ¡å™¨çš„å¤åˆ¶çº¿ç¨‹ã€‚

#### 5.3ã€ä¸»ä»å¤åˆ¶çš„å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–

##### aã€ä¸»ä»å»¶è¿Ÿ

ç”±äºä¸»ä»å¤åˆ¶é‡‡ç”¨å¼‚æ­¥å¤åˆ¶æœºåˆ¶ï¼Œä»æœåŠ¡å™¨å¯èƒ½ä¼šå‡ºç°ä¸ä¸»æœåŠ¡å™¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸ºå‡å°ä¸»ä»å»¶è¿Ÿï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š

1. **ä¼˜åŒ–ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥ç¨³å®šä¸”é«˜é€Ÿï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿã€‚
2. **å‡å°äº‹åŠ¡å¤§å°**ï¼šå°½é‡é¿å…æ‰§è¡Œå¤§äº‹åŠ¡ï¼Œä»¥å‡å°å•æ¬¡å¤åˆ¶çš„æ•°æ®é‡ï¼ŒåŠ å¿«å¤åˆ¶é€Ÿåº¦ã€‚
3. **ä¼˜åŒ–ä»æœåŠ¡å™¨ç¡¬ä»¶**ï¼šæé«˜ä»æœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®ï¼Œå¦‚CPUã€å†…å­˜å’Œç£ç›˜æ€§èƒ½ï¼Œä»¥åŠ å¿«æ•°æ®åŒæ­¥é€Ÿåº¦ã€‚
4. **å¹¶è¡Œå¤åˆ¶**ï¼šå¯ç”¨MySQLçš„å¹¶è¡Œå¤åˆ¶åŠŸèƒ½ï¼Œå…è®¸ä»æœåŠ¡å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªå¤åˆ¶çº¿ç¨‹ï¼Œæé«˜å¤åˆ¶æ•ˆç‡ã€‚

##### bã€ä¸»ä»ä¸ä¸€è‡´

ä¸»ä»ä¸ä¸€è‡´æ˜¯æŒ‡ä»æœåŠ¡å™¨çš„æ•°æ®ä¸ä¸»æœåŠ¡å™¨çš„æ•°æ®ä¸å®Œå…¨ç›¸åŒã€‚è¿™å¯èƒ½æ˜¯ç”±äºç½‘ç»œæ•…éšœã€ä»æœåŠ¡å™¨æ•…éšœæˆ–å…¶ä»–åŸå› å¯¼è‡´çš„ã€‚è§£å†³ä¸»ä»ä¸ä¸€è‡´çš„æ–¹æ³•åŒ…æ‹¬ï¼š

1. **ç›‘æ§ä¸»ä»çŠ¶æ€**ï¼šå®šæœŸæ£€æŸ¥ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶çŠ¶æ€ï¼Œç¡®ä¿å¤åˆ¶è¿‡ç¨‹æ­£å¸¸è¿›è¡Œã€‚
2. **æ•°æ®æ ¡éªŒ**ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚pt-table-checksumï¼‰å®šæœŸå¯¹æ¯”ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ï¼Œå‘ç°å¹¶ä¿®å¤ä¸ä¸€è‡´ã€‚
3. **æ•…éšœæ¢å¤**ï¼šå½“ä»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸»æœåŠ¡å™¨çš„å¤‡ä»½æ•°æ®è¿›è¡Œæ¢å¤ï¼Œç„¶åé‡æ–°å¯åŠ¨å¤åˆ¶ã€‚

#### 5.4ã€è¯»å†™åˆ†ç¦»ä¸ä¸»ä»å¤åˆ¶çš„ç»“åˆ

å°†è¯»å†™åˆ†ç¦»ä¸ä¸»ä»å¤åˆ¶ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜æ•°æ®åº“ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ç°è¿™ä¸€ç›®æ ‡çš„å…³é”®åœ¨äºåˆç†åœ°åˆ†é…è¯»å†™è¯·æ±‚ï¼š

1. **è¯»è¯·æ±‚åˆ†é…**ï¼šå°†è¯»è¯·æ±‚å‘é€åˆ°ä»æœåŠ¡å™¨ï¼Œä»¥å‡è½»ä¸»æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚å¯æ ¹æ®ä»æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µåŠ¨æ€è°ƒæ•´åˆ†é…ç­–ç•¥ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚
2. **å†™è¯·æ±‚åˆ†é…**ï¼šå°†å†™è¯·æ±‚å‘é€åˆ°ä¸»æœåŠ¡å™¨ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚å½“ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥å°†å†™è¯·æ±‚åˆ‡æ¢åˆ°å¤‡ç”¨ä¸»æœåŠ¡å™¨ä¸Šï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§ã€‚

ä¸ºå®ç°è¿™äº›åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ã€ä»£ç†æœåŠ¡å™¨ç­‰å·¥å…·ï¼Œå¦‚HAProxyã€MySQL Routerç­‰ã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©å®ç°è‡ªåŠ¨åˆ‡æ¢ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœæ¢å¤ç­‰åŠŸèƒ½ï¼Œæé«˜æ•°æ®åº“ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

### 6ã€ä¼˜åŒ–æç¤º
ä¼˜åŒ–æç¤ºï¼ˆOptimizer Hintsï¼‰æ˜¯MySQLä¸­çš„ä¸€ç§ç‰¹æ€§ï¼Œå®ƒå…è®¸åœ¨ç¼–å†™SQLæŸ¥è¯¢æ—¶å‘æŸ¥è¯¢ä¼˜åŒ–å™¨æä¾›å…³äºå¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯ã€‚ä¼˜åŒ–æç¤ºå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰‹åŠ¨å¹²é¢„æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å†³ç­–ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼˜åŒ–æç¤ºå¹¶éä¸‡èƒ½ï¼Œæ­£ç¡®ä½¿ç”¨å®ƒéœ€è¦å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†å’Œè¡¨ç»“æ„æœ‰ä¸€å®šçš„äº†è§£ã€‚æ­¤å¤–ï¼Œæ»¥ç”¨ä¼˜åŒ–æç¤ºå¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢æ€§èƒ½é™ä½ã€‚

åœ¨MySQL 8.0åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œä¼˜åŒ–æç¤ºä½¿ç”¨`/*+ ... */`æ³¨é‡Šå½¢å¼åŒ…å«åœ¨æŸ¥è¯¢ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ä¼˜åŒ–æç¤ºç¤ºä¾‹ï¼š

#### 6.1ã€ä½¿ç”¨æŒ‡å®šçš„ç´¢å¼•

å½“æŸ¥è¯¢ä¼˜åŒ–å™¨æ²¡æœ‰é€‰æ‹©åˆé€‚çš„ç´¢å¼•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`USE_INDEX`æˆ–`FORCE_INDEX`æç¤ºæŒ‡å®šè¦ä½¿ç”¨çš„ç´¢å¼•ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT /*+ USE_INDEX(idx_employees_name) */ * FROM employees WHERE name = 'John Doe';
```

#### 6.2ã€å¿½ç•¥æŒ‡å®šçš„ç´¢å¼•

å½“æŸ¥è¯¢ä¼˜åŒ–å™¨é”™è¯¯åœ°é€‰æ‹©äº†æŸä¸ªç´¢å¼•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`IGNORE_INDEX`æç¤ºå¿½ç•¥è¯¥ç´¢å¼•ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT /*+ IGNORE_INDEX(idx_employees_name) */ * FROM employees WHERE name = 'John Doe';
```

#### 6.3ã€æ§åˆ¶è¿æ¥é¡ºåº

åœ¨å¤šè¡¨è¿æ¥æŸ¥è¯¢ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`STRAIGHT_JOIN`æç¤ºå¼ºåˆ¶æŒ‰ç…§FROMå­å¥ä¸­çš„è¡¨é¡ºåºè¿›è¡Œè¿æ¥ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT /*+ STRAIGHT_JOIN */ e.name, d.name
FROM employees e
JOIN departments d ON e.department_id = d.id;
```

#### 6.4ã€æ§åˆ¶è¿æ¥ç±»å‹

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜åŒ–æç¤ºå¼ºåˆ¶ä½¿ç”¨ç‰¹å®šç±»å‹çš„è¿æ¥ï¼ˆå¦‚`NESTED_LOOP`ã€`HASH_JOIN`æˆ–`MERGE_JOIN`ï¼‰ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT /*+ HASH_JOIN(d) */ e.name, d.name
FROM employees e
JOIN departments d ON e.department_id = d.id;
```

#### 6.5ã€æ§åˆ¶å­æŸ¥è¯¢æ‰§è¡Œç­–ç•¥

å¯ä»¥ä½¿ç”¨ä¼˜åŒ–æç¤ºå¼ºåˆ¶å°†å­æŸ¥è¯¢è½¬æ¢ä¸ºè¿æ¥ï¼ˆ`SUBQUERY_TO_DERIVED`ï¼‰æˆ–å°†è¿æ¥è½¬æ¢ä¸ºå­æŸ¥è¯¢ï¼ˆ`DERIVED_TO_SUBQUERY`ï¼‰ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT /*+ SUBQUERY_TO_DERIVED(t2) */ *
FROM table1 t1
WHERE t1.id = (SELECT id FROM table2 t2 WHERE t2.t1_id = t1.id);
```

åœ¨ä½¿ç”¨ä¼˜åŒ–æç¤ºæ—¶éœ€è¦è°¨æ…ï¼Œå› ä¸ºæ»¥ç”¨å®ƒå¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢æ€§èƒ½é™ä½ã€‚åœ¨ä½¿ç”¨ä¼˜åŒ–æç¤ºä¹‹å‰ï¼Œå»ºè®®å…ˆåˆ†ææŸ¥è¯¢è®¡åˆ’å¹¶å……åˆ†äº†è§£æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å·¥ä½œåŸç†å’Œè¡¨ç»“æ„ã€‚

## å…«ã€åˆ†åº“åˆ†è¡¨

### 1ã€åˆ†åº“åˆ†è¡¨çš„æ¦‚å¿µä¸åœºæ™¯

éšç€ä¸šåŠ¡çš„å‘å±•å’Œæ•°æ®é‡çš„å¢é•¿ï¼Œå•ä¸€æ•°æ®åº“å¯èƒ½æ— æ³•æ»¡è¶³æ€§èƒ½ã€å®¹é‡å’Œå¯ç”¨æ€§çš„éœ€æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åˆ†åº“åˆ†è¡¨ï¼ˆShardingï¼‰çš„æ–¹å¼å¯¹æ•°æ®åº“è¿›è¡Œæ°´å¹³åˆ‡åˆ†ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å’Œè¡¨ä¸­ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯æ‰©å±•æ€§å’Œå¯ç”¨æ€§ã€‚

åˆ†åº“åˆ†è¡¨çš„ä¸»è¦åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š

1. æ•°æ®é‡å·¨å¤§ï¼šå½“å•è¡¨æ•°æ®é‡è¾¾åˆ°æ•°ç™¾ä¸‡ç”šè‡³æ•°åäº¿æ—¶ï¼ŒæŸ¥è¯¢å’Œç»´æŠ¤æ•°æ®çš„æ€§èƒ½å¯èƒ½å—åˆ°å½±å“ã€‚é€šè¿‡åˆ†åº“åˆ†è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªè¡¨ä¸­ï¼Œé™ä½å•è¡¨çš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚
2. é«˜å¹¶å‘è®¿é—®ï¼šåœ¨é«˜å¹¶å‘è®¿é—®çš„åœºæ™¯ä¸‹ï¼Œå•ä¸€æ•°æ®åº“å¯èƒ½æˆä¸ºç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆã€‚åˆ†åº“åˆ†è¡¨å¯ä»¥å°†è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸­ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚
3. å¯ç”¨æ€§ï¼šé€šè¿‡åˆ†åº“åˆ†è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ•°æ®åº“å®ä¾‹ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œé™ä½å•ç‚¹æ•…éšœçš„é£é™©ã€‚

### 2ã€åˆ†åº“åˆ†è¡¨ç­–ç•¥

åˆ†åº“åˆ†è¡¨çš„ç­–ç•¥ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
1. åŸºäºèŒƒå›´çš„åˆ†åº“åˆ†è¡¨ï¼šæ ¹æ®æ•°æ®çš„æŸä¸ªå±æ€§å€¼ï¼ˆå¦‚æ—¶é—´ã€IDç­‰ï¼‰åˆ’åˆ†èŒƒå›´ï¼Œå°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„åº“æˆ–è¡¨ä¸­ã€‚è¿™ç§ç­–ç•¥ç®€å•æ˜“å®ç°ï¼Œä½†éœ€è¦é¢„å…ˆè§„åˆ’å¥½æ•°æ®çš„åˆ†å¸ƒèŒƒå›´ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å‡åŒ€ã€‚
2. åŸºäºå“ˆå¸Œçš„åˆ†åº“åˆ†è¡¨ï¼šé€šè¿‡æŸä¸ªå±æ€§å€¼ï¼ˆå¦‚ç”¨æˆ·IDï¼‰è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ ¹æ®å“ˆå¸Œå€¼å°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„åº“æˆ–è¡¨ä¸­ã€‚è¿™ç§ç­–ç•¥å¯ä»¥å®ç°è¾ƒå¥½çš„æ•°æ®åˆ†å¸ƒï¼Œä½†åœ¨æ‰©å®¹æˆ–ç¼©å®¹æ—¶éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®è¿ç§»çš„å¼€é”€è¾ƒå¤§ã€‚
3. åŸºäºå–æ¨¡çš„åˆ†åº“åˆ†è¡¨ï¼šé€šè¿‡æŸä¸ªå±æ€§å€¼ï¼ˆå¦‚è®¢å•IDï¼‰å¯¹åº“æˆ–è¡¨çš„æ•°é‡å–æ¨¡ï¼Œå°†æ•°æ®åˆ†é…åˆ°ä¸åŒçš„åº“æˆ–è¡¨ä¸­ã€‚è¿™ç§ç­–ç•¥ç®€å•æ˜“å®ç°ï¼Œæ•°æ®åˆ†å¸ƒç›¸å¯¹å‡åŒ€ï¼Œä½†åœ¨æ‰©å®¹æˆ–ç¼©å®¹æ—¶å¯èƒ½éœ€è¦é‡æ–°åˆ†é…æ•°æ®ã€‚

### 3ã€åˆ†åº“åˆ†è¡¨å®ç°æ–¹å¼

åœ¨MySQLä¸­ï¼Œæœ‰å¤šç§æ–¹å¼å¯ä»¥å®ç°åˆ†åº“åˆ†è¡¨ï¼š

1. ä½¿ç”¨åº”ç”¨ç¨‹åºè¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®ç°åˆ†åº“åˆ†è¡¨çš„é€»è¾‘ï¼Œæ ¹æ®æ•°æ®çš„å±æ€§å€¼é€‰æ‹©åˆé€‚çš„æ•°æ®åº“å’Œè¡¨ã€‚è¿™ç§æ–¹å¼å¯¹åº”ç”¨ç¨‹åºçš„ä¾µå…¥æ€§è¾ƒå¤§ï¼Œä½†çµæ´»æ€§é«˜ï¼Œæ˜“äºå®ç°ã€‚
2. ä½¿ç”¨æ•°æ®åº“ä»£ç†è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼šé€šè¿‡æ•°æ®åº“ä»£ç†ï¼ˆå¦‚ShardingSphereã€MyCatç­‰ï¼‰å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªå’Œè·¯ç”±ï¼Œå°†è¯·æ±‚åˆ†é…åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸­ã€‚è¿™ç§æ–¹å¼å¯¹åº”ç”¨ç¨‹åºçš„ä¾µå…¥æ€§è¾ƒå°ï¼Œä½†éœ€è¦å¼•å…¥é¢å¤–çš„ç»„ä»¶è¿›è¡Œç®¡ç†å’Œç»´æŠ¤ã€‚
3. ä½¿ç”¨MySQLè‡ªå¸¦çš„åˆ†åŒºè¡¨åŠŸèƒ½è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼šåœ¨MySQL 5.1åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæä¾›äº†åˆ†åŒºè¡¨ï¼ˆPartitioningï¼‰çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†ä¸€ä¸ªå¤§è¡¨æŒ‰ç…§æŸä¸ªå±æ€§å€¼è¿›è¡Œåˆ†åŒºï¼Œå®ç°æ•°æ®çš„æ°´å¹³åˆ‡åˆ†ã€‚è¿™ç§æ–¹å¼ä¸éœ€è¦å¼•å…¥é¢å¤–çš„ç»„ä»¶ï¼Œä½†éœ€è¦å¯¹è¡¨ç»“æ„è¿›è¡Œä¿®æ”¹ã€‚

ä¸Šè¿°å®ç°æ–¹å¼çš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼š
- åˆ†åº“ï¼šæ•°æ®åº“ç³»ç»Ÿçš„CPUå’ŒIOèµ„æºç´§å¼ ï¼Œéœ€è¦å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸­ï¼Œå®ç°èµ„æºçš„åˆ†å¸ƒå¼åˆ©ç”¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å¤æ‚åº¦è¾ƒé«˜ã€‚
- åˆ†è¡¨ï¼šè¡¨æ•°æ®é‡å¤ªå¤§ï¼ŒæŸ¥è¯¢å’Œæ’å…¥æ€§èƒ½ä¸‹é™ï¼Œéœ€è¦æŠŠä¸€å¼ è¡¨æŒ‰ä¸€å®šçš„è§„åˆ™åˆ†è§£æˆNä¸ªå…·æœ‰ç‹¬ç«‹å­˜å‚¨ç©ºé—´çš„å®ä½“è¡¨ï¼Œæé«˜æŸ¥è¯¢å’Œæ’å…¥çš„æ€§èƒ½ã€‚å¤æ‚åº¦è¾ƒé«˜ã€‚
- åˆ†åŒºè¡¨ï¼šè¡¨æ•°æ®é‡å¤ªå¤§ï¼ŒæŸ¥è¯¢å’Œæ’å…¥æ€§èƒ½ä¸‹é™ï¼Œéœ€è¦æŠŠä¸€å¼ è¡¨çš„æ•°æ®åˆ†æˆNä¸ªåŒºå—ï¼Œåœ¨é€»è¾‘ä¸Šçœ‹æœ€ç»ˆåªæ˜¯ä¸€å¼ è¡¨ï¼Œä½†åº•å±‚æ˜¯ç”±Nä¸ªç‰©ç†åŒºå—ç»„æˆçš„ã€‚çµæ´»æ€§ä¸å¦‚åˆ†è¡¨ã€‚

å‚è€ƒèµ„æ–™ï¼š
- [ShardingSphere-åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶](https://shardingsphere.apache.org/document/4.1.1/cn/overview/)
- [MySqlåˆ†åŒºè¡¨æ€§èƒ½æµ‹è¯•](https://developer.aliyun.com/article/75306)

### 4ã€åˆ†åº“åˆ†è¡¨çš„ä¼˜ç¼ºç‚¹åŠå…¶åº”ç”¨å®è·µ

åˆ†åº“åˆ†è¡¨çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š

1. æé«˜äº†æ•°æ®åº“çš„æ€§èƒ½å’Œå®¹é‡ï¼šå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å’Œè¡¨ä¸­ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®çš„æ•ˆç‡ï¼Œå¢åŠ ç³»ç»Ÿçš„å®¹é‡å’Œå¯ç”¨æ€§ã€‚
2. æ”¹å–„äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼šå¯ä»¥æ ¹æ®æ•°æ®çš„å¢é•¿æƒ…å†µå¯¹æ•°æ®åº“è¿›è¡Œæ‰©å®¹æˆ–ç¼©å®¹ï¼Œå®ç°ç³»ç»Ÿçš„æ— ç¼æ‰©å±•ã€‚
3. æé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼šé€šè¿‡å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸­ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ï¼Œé™ä½å•ç‚¹æ•…éšœçš„é£é™©ã€‚

åˆ†åº“åˆ†è¡¨çš„ç¼ºç‚¹åŒ…æ‹¬ï¼š

1. ç®¡ç†å’Œç»´æŠ¤çš„æˆæœ¬å¢åŠ ï¼šåˆ†åº“åˆ†è¡¨åï¼Œéœ€è¦å¯¹å¤šä¸ªæ•°æ®åº“å’Œè¡¨è¿›è¡Œç®¡ç†å’Œç»´æŠ¤ï¼Œå¢åŠ äº†ç®¡ç†å’Œè¿ç»´çš„å¤æ‚æ€§å’Œæˆæœ¬ã€‚
2. å¯èƒ½å¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼šåœ¨åˆ†åº“åˆ†è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé¿å…æ•°æ®é‡å¤ã€ä¸¢å¤±æˆ–è€…ä¸ä¸€è‡´çš„é—®é¢˜ã€‚
3. éƒ¨åˆ†SQLè¯­å¥éš¾ä»¥ä¼˜åŒ–ï¼šå¯¹äºä¸€äº›è·¨åˆ†ç‰‡çš„SQLæŸ¥è¯¢ï¼ˆå¦‚Joinæ“ä½œï¼‰ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œå…¨å±€æ‰«æï¼Œå½±å“æ€§èƒ½ã€‚

åœ¨åº”ç”¨å®è·µä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯å’Œéœ€æ±‚é€‰æ‹©åˆé€‚çš„åˆ†åº“åˆ†è¡¨ç­–ç•¥å’Œå®ç°æ–¹å¼ã€‚åŒæ—¶ï¼Œåœ¨åˆ†åº“åˆ†è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘æ•°æ®çš„ä¸€è‡´æ€§å’Œæ€§èƒ½ä¼˜åŒ–ç­‰é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚

### 5ã€åˆ†åº“åˆ†è¡¨çš„æœªæ¥è¶‹åŠ¿ï¼šåˆ†å¸ƒå¼æ•°æ®åº“
åˆ†å¸ƒå¼æ•°æ®åº“æ˜¯æŒ‡å°†æ•°æ®åº“åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å‚¨å’Œå¤„ç†çš„ä¸€ç§æŠ€æœ¯ã€‚

ä¸ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“ç›¸æ¯”ï¼Œåˆ†å¸ƒå¼æ•°æ®åº“å…·æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š

1. é«˜å¯æ‰©å±•æ€§ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯ä»¥å°†æ•°æ®å’Œè®¡ç®—è´Ÿè½½åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚åŠ¨æ€å¢åŠ æˆ–å‡å°‘èŠ‚ç‚¹ï¼Œä»è€Œå®ç°é«˜å¯æ‰©å±•æ€§ã€‚è€Œåˆ†åº“åˆ†è¡¨å¯ä»¥å°†æ•°æ®å’Œè®¡ç®—è´Ÿè½½åˆ†æ•£åˆ°å¤šä¸ªå­æ•°æ®åº“å’Œè¡¨ä¸­ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¯æ‰©å±•æ€§ã€‚

2. é«˜å¯ç”¨æ€§ï¼šåˆ†å¸ƒå¼æ•°æ®åº“é€šè¿‡å°†æ•°æ®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šå®ç°é«˜å¯ç”¨æ€§ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šç»§ç»­æä¾›æœåŠ¡ã€‚è€Œåˆ†åº“åˆ†è¡¨å¯ä»¥å°†æ•°æ®å¤åˆ¶åˆ°å¤šä¸ªå­æ•°æ®åº“å’Œè¡¨ä¸­ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¯ç”¨æ€§ã€‚

3. æé«˜æ€§èƒ½ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯ä»¥å°†æ•°æ®å’Œè®¡ç®—è´Ÿè½½åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¹¶è¡Œå¤„ç†æ•°æ®å’Œè¯·æ±‚ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚è€Œåˆ†åº“åˆ†è¡¨å¯ä»¥å°†æ•°æ®å’Œè®¡ç®—è´Ÿè½½åˆ†æ•£åˆ°å¤šä¸ªå­æ•°æ®åº“å’Œè¡¨ä¸­ï¼Œè¿›ä¸€æ­¥æé«˜äº†æ€§èƒ½ã€‚

4. çµæ´»æ€§ï¼šåˆ†å¸ƒå¼æ•°æ®åº“å¯ä»¥æ ¹æ®éœ€æ±‚å°†æ•°æ®å’Œè®¡ç®—è´Ÿè½½åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥çµæ´»åœ°è¿›è¡Œè°ƒæ•´å’Œé…ç½®ã€‚è€Œåˆ†åº“åˆ†è¡¨å¯ä»¥å°†æ•°æ®å’Œè®¡ç®—è´Ÿè½½åˆ†æ•£åˆ°ä¸åŒçš„å­æ•°æ®åº“å’Œè¡¨ä¸­ï¼Œè¿›ä¸€æ­¥æé«˜äº†çµæ´»æ€§ã€‚

æˆ‘ä»¬ä»¥OLTPçš„åœºæ™¯ä¸ºä¾‹ï¼Œç›®å‰æµè¡Œçš„åˆ†å¸ƒå¼æ•°æ®åº“åŒ…æ‹¬TiDBã€OceanBaseã€CockroachDBç­‰ã€‚

æˆ‘ä»¬çœ‹TiDBçš„å®˜ç½‘ä»‹ç»ï¼š
> TiDB å…·å¤‡æ°´å¹³æ‰©å®¹æˆ–è€…ç¼©å®¹ã€é‡‘èçº§é«˜å¯ç”¨ã€å®æ—¶ HTAPã€äº‘åŸç”Ÿçš„åˆ†å¸ƒå¼æ•°æ®åº“ã€å…¼å®¹ MySQL 5.7 åè®®å’Œ MySQL ç”Ÿæ€ç­‰é‡è¦ç‰¹æ€§ã€‚
> TiDB é€‚åˆé«˜å¯ç”¨ã€å¼ºä¸€è‡´è¦æ±‚è¾ƒé«˜ã€æ•°æ®è§„æ¨¡è¾ƒå¤§ç­‰å„ç§åº”ç”¨åœºæ™¯ã€‚

TiDBçš„å®ç°åŸç†å‚è€ƒ [TiDB æ•´ä½“æ¶æ„](https://docs.pingcap.com/zh/tidb/stable/tidb-architecture)

## ä¹ã€äº‹åŠ¡ä¸éš”ç¦»

### 1ã€äº‹åŠ¡çš„æ¦‚å¿µä¸ç‰¹æ€§

äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä¸­ä¸€ä¸ªç‹¬ç«‹çš„ã€é€»è¾‘ä¸Šçš„æ“ä½œåºåˆ—ï¼ŒåŒ…æ‹¬å¯¹æ•°æ®çš„ä¸€ç³»åˆ—è¯»å–å’Œ/æˆ–ä¿®æ”¹æ“ä½œã€‚ä¸€ä¸ªäº‹åŠ¡åº”è¯¥å…·æœ‰ä»¥ä¸‹å››ä¸ªç‰¹æ€§ï¼Œç®€ç§°ä¸ºACIDç‰¹æ€§ï¼š

- åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥çš„æƒ…å†µã€‚
- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„çŠ¶æ€éƒ½å¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚ä¸€è‡´æ€§ä¿è¯äº†æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚
- éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¤šä¸ªäº‹åŠ¡åœ¨å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå®ƒä»¬ä¹‹é—´åº”è¯¥æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸åº”è¯¥å½±å“å…¶ä»–æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ã€‚
- æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶å¯¹æ•°æ®åº“çš„ä¿®æ”¹å°†æ°¸ä¹…ä¿å­˜ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚

### 2ã€äº‹åŠ¡éš”ç¦»çº§åˆ«

äº‹åŠ¡éš”ç¦»çº§åˆ«ç”¨æ¥å®šä¹‰äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ï¼Œä»¥è§£å†³å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œå¦‚è„è¯»ï¼ˆDirty Readï¼‰ã€ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable Readï¼‰å’Œå¹»è¯»ï¼ˆPhantom Readï¼‰ã€‚SQLæ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š

- è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼šäº‹åŠ¡å¯ä»¥è¯»å–å…¶ä»–æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚å¯èƒ½å¯¼è‡´è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚
- è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šäº‹åŠ¡åªèƒ½è¯»å–å…¶ä»–å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚å¯ä»¥é¿å…è„è¯»ï¼Œä½†ä»å¯èƒ½å¯¼è‡´ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚
- å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šåœ¨åŒä¸€äº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œç»“æœå§‹ç»ˆä¸€è‡´ã€‚å¯é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»å¯èƒ½å¯¼è‡´å¹»è¯»ã€‚
- ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šäº‹åŠ¡å®Œå…¨ä¸²è¡Œæ‰§è¡Œï¼Œæœ€ä¸¥æ ¼çš„éš”ç¦»çº§åˆ«ã€‚å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ï¼Œä½†å¹¶å‘æ€§èƒ½è¾ƒå·®ã€‚

### 3ã€MySQLçš„äº‹åŠ¡å®ç°ä¸ç®¡ç†

MySQLä½¿ç”¨`InnoDB`å¼•æ“ä½œä¸ºé»˜è®¤çš„äº‹åŠ¡å­˜å‚¨å¼•æ“ï¼Œå®ƒæ”¯æŒ`ACID`ç‰¹æ€§å’Œå››ç§éš”ç¦»çº§åˆ«ã€‚ä»¥ä¸‹æ˜¯MySQLä¸­äº‹åŠ¡çš„å®ç°ä¸ç®¡ç†ï¼š

#### 3.1ã€äº‹åŠ¡æ“ä½œå‘½ä»¤

- **å¼€å¯äº‹åŠ¡**ï¼šå¯ä»¥é€šè¿‡å‘½ä»¤`START TRANSACTION`æˆ–`BEGIN`æ¥æ˜¾å¼å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚åœ¨è‡ªåŠ¨æäº¤æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªå•ç‹¬çš„SQLè¯­å¥éƒ½è¢«è§†ä¸ºä¸€ä¸ªäº‹åŠ¡ã€‚

```sql
-- æ˜¾å¼å¼€å¯äº‹åŠ¡
START TRANSACTION;
-- æˆ–è€…
BEGIN;

-- æŸ¥çœ‹è‡ªåŠ¨æäº¤çŠ¶æ€
SHOW VARIABLES LIKE 'autocommit';

-- å…³é—­è‡ªåŠ¨æäº¤
SET autocommit = 0;
```

- **æäº¤äº‹åŠ¡**ï¼šä½¿ç”¨`COMMIT`å‘½ä»¤æäº¤äº‹åŠ¡ï¼Œå°†å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ°¸ä¹…ä¿å­˜ã€‚

```sql
COMMIT;
```

- **å›æ»šäº‹åŠ¡**ï¼šä½¿ç”¨`ROLLBACK`å‘½ä»¤å›æ»šäº‹åŠ¡ï¼Œæ’¤é”€å¯¹æ•°æ®åº“çš„ä¿®æ”¹ã€‚

```sql
ROLLBACK;
```

- **ä¿å­˜ç‚¹ï¼ˆSavepointï¼‰**ï¼šå¯ä»¥åœ¨äº‹åŠ¡ä¸­è®¾ç½®ä¿å­˜ç‚¹ï¼Œç”¨äºåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å›æ»šåˆ°æŸä¸ªç‰¹å®šç‚¹ã€‚

```sql
-- åˆ›å»ºä¿å­˜ç‚¹
SAVEPOINT sp1;

-- æ‰§è¡Œä¸€äº›æ“ä½œ
UPDATE accounts SET balance = balance - 100 WHERE id = 1;

-- åˆ›å»ºå¦ä¸€ä¸ªä¿å­˜ç‚¹
SAVEPOINT sp2;

-- æ‰§è¡Œæ›´å¤šæ“ä½œ
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

-- å›æ»šåˆ°sp1
ROLLBACK TO sp1;

-- é‡Šæ”¾ä¿å­˜ç‚¹
RELEASE SAVEPOINT sp1;
```

#### 3.2ã€MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å®ç°åŸç†

`InnoDB`å¼•æ“é€šè¿‡`MVCC`æœºåˆ¶å®ç°é«˜å¹¶å‘æ€§èƒ½ã€‚`MVCC`çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

##### aã€éšè—åˆ—
æ¯ä¸ª`InnoDB`è¡¨éƒ½æœ‰ä¸‰ä¸ªéšè—åˆ—ï¼š
- `DB_TRX_ID`ï¼š6å­—èŠ‚ï¼Œè®°å½•æœ€åä¸€æ¬¡æ’å…¥æˆ–æ›´æ–°è¯¥è¡Œçš„äº‹åŠ¡ID
- `DB_ROLL_PTR`ï¼š7å­—èŠ‚ï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘`undo log`è®°å½•
- `DB_ROW_ID`ï¼š6å­—èŠ‚ï¼Œè¡ŒIDï¼ˆå¦‚æœæ²¡æœ‰ä¸»é”®æ—¶ä½¿ç”¨ï¼‰

##### bã€Undo Log
`Undo Log`ä¿å­˜äº†æ•°æ®çš„å†å²ç‰ˆæœ¬ï¼Œç”¨äºäº‹åŠ¡å›æ»šå’Œ`MVCC`è¯»å–ï¼š

```sql
-- æŸ¥çœ‹undo logç›¸å…³å‚æ•°
SHOW VARIABLES LIKE '%undo%';

-- æŸ¥çœ‹undoè¡¨ç©ºé—´
SELECT * FROM information_schema.FILES WHERE FILE_TYPE='UNDO LOG';
```

##### cã€Read View
`Read View`æ˜¯äº‹åŠ¡åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®åº“å¿«ç…§ï¼ŒåŒ…å«ï¼š
- `m_ids`ï¼šæ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨
- `min_trx_id`ï¼šæœ€å°æ´»è·ƒäº‹åŠ¡ID
- `max_trx_id`ï¼šä¸‹ä¸€ä¸ªè¦åˆ†é…çš„äº‹åŠ¡ID
- `creator_trx_id`ï¼šåˆ›å»ºè¯¥`Read View`çš„äº‹åŠ¡ID

##### dã€å¯è§æ€§åˆ¤æ–­è§„åˆ™

```sql
-- ç¤ºä¾‹ï¼šæ¼”ç¤ºMVCCçš„å¯è§æ€§
-- Session 1
START TRANSACTION;
SELECT * FROM users WHERE id = 1;  -- çœ‹åˆ°ç‰ˆæœ¬1

-- Session 2
START TRANSACTION;
UPDATE users SET name = 'new_name' WHERE id = 1;
COMMIT;

-- Session 1ï¼ˆåœ¨å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼‰
SELECT * FROM users WHERE id = 1;  -- ä»ç„¶çœ‹åˆ°ç‰ˆæœ¬1
COMMIT;
```

#### 3.3ã€é”æœºåˆ¶è¯¦è§£

`InnoDB`æä¾›å¤šç§é”ç±»å‹ï¼š

##### aã€è¡Œçº§é”ç±»å‹
- **è®°å½•é”ï¼ˆRecord Lockï¼‰**ï¼šé”å®šç´¢å¼•è®°å½•
- **é—´éš™é”ï¼ˆGap Lockï¼‰**ï¼šé”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™
- **ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰**ï¼šè®°å½•é”+é—´éš™é”çš„ç»„åˆ

```sql
-- æŸ¥çœ‹å½“å‰é”ä¿¡æ¯
SELECT * FROM performance_schema.data_locks;

-- æŸ¥çœ‹é”ç­‰å¾…ä¿¡æ¯
SELECT * FROM performance_schema.data_lock_waits;
```

##### bã€æ„å‘é”
æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­è¡¨ä¸­æ˜¯å¦æœ‰è¡Œé”ï¼š
- `IS`ï¼ˆæ„å‘å…±äº«é”ï¼‰ï¼šäº‹åŠ¡æƒ³è¦è·å–è¡¨ä¸­æŸäº›è¡Œçš„å…±äº«é”
- `IX`ï¼ˆæ„å‘æ’ä»–é”ï¼‰ï¼šäº‹åŠ¡æƒ³è¦è·å–è¡¨ä¸­æŸäº›è¡Œçš„æ’ä»–é”

#### 3.4ã€äº‹åŠ¡éš”ç¦»çº§åˆ«å®è·µ

```sql
-- æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ«
SELECT @@tx_isolation;
-- MySQL 8.0ä½¿ç”¨
SELECT @@transaction_isolation;

-- è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- è®¾ç½®å…¨å±€éš”ç¦»çº§åˆ«
SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ;
```

##### aã€éš”ç¦»çº§åˆ«å¯¹æ¯”ç¤ºä¾‹

```sql
-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE test_isolation (
    id INT PRIMARY KEY,
    value INT
);

INSERT INTO test_isolation VALUES (1, 100), (2, 200);

-- è„è¯»ç¤ºä¾‹ï¼ˆREAD UNCOMMITTEDï¼‰
-- Session 1
SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
START TRANSACTION;
SELECT * FROM test_isolation WHERE id = 1;

-- Session 2
START TRANSACTION;
UPDATE test_isolation SET value = 150 WHERE id = 1;
-- ä¸æäº¤

-- Session 1
SELECT * FROM test_isolation WHERE id = 1;  -- èƒ½çœ‹åˆ°æœªæäº¤çš„150

-- ä¸å¯é‡å¤è¯»ç¤ºä¾‹ï¼ˆREAD COMMITTEDï¼‰
-- Session 1
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
START TRANSACTION;
SELECT * FROM test_isolation WHERE id = 1;  -- value = 100

-- Session 2
UPDATE test_isolation SET value = 150 WHERE id = 1;
COMMIT;

-- Session 1
SELECT * FROM test_isolation WHERE id = 1;  -- value = 150ï¼ˆå˜åŒ–äº†ï¼‰

-- å¹»è¯»ç¤ºä¾‹ï¼ˆREPEATABLE READï¼‰
-- Session 1
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
START TRANSACTION;
SELECT COUNT(*) FROM test_isolation WHERE value > 100;  -- å‡è®¾æ˜¯1

-- Session 2
INSERT INTO test_isolation VALUES (3, 300);
COMMIT;

-- Session 1
SELECT COUNT(*) FROM test_isolation WHERE value > 100;  -- ä»ç„¶æ˜¯1
UPDATE test_isolation SET value = value + 10 WHERE value > 100;  -- ä¼šæ›´æ–°2è¡Œï¼
```

#### 3.5ã€äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ§åˆ¶äº‹åŠ¡å¤§å°**ï¼šé¿å…å¤§äº‹åŠ¡ï¼Œå°†å¤§äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡
2. **å°½å¿«æäº¤**ï¼šå‡å°‘é”æŒæœ‰æ—¶é—´
3. **åˆç†ä½¿ç”¨ç´¢å¼•**ï¼šé¿å…å…¨è¡¨æ‰«æå¯¼è‡´çš„è¡¨é”
4. **é¿å…æ­»é”**ï¼šæŒ‰ç›¸åŒé¡ºåºè®¿é—®è¡¨å’Œè¡Œ
5. **ç›‘æ§é•¿äº‹åŠ¡**ï¼š

```sql
-- æŸ¥æ‰¾é•¿äº‹åŠ¡
SELECT * FROM information_schema.INNODB_TRX 
WHERE TIME_TO_SEC(TIMEDIFF(NOW(), trx_started)) > 60;

-- æŸ¥çœ‹äº‹åŠ¡é”ç­‰å¾…
SHOW ENGINE INNODB STATUS;
```

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚é€‰æ‹©åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€‚å½“é™ä½éš”ç¦»çº§åˆ«ä»¥æé«˜æ€§èƒ½ï¼Œä½†éœ€è¦æƒè¡¡å¯èƒ½å‡ºç°çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚åä¹‹ï¼Œåœ¨éœ€è¦ä¸¥æ ¼ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ä¸‹ï¼Œåº”é€‰æ‹©è¾ƒé«˜çš„éš”ç¦»çº§åˆ«ï¼Œå¦‚ä¸²è¡ŒåŒ–ã€‚

## åã€é”æœºåˆ¶

### 1ã€é”çš„æ¦‚å¿µä¸åˆ†ç±»

åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œé”æ˜¯ä¸€ç§ç”¨äºå®ç°å¹¶å‘æ§åˆ¶çš„æœºåˆ¶ã€‚å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œé”å¯ä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚æ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼ï¼Œé”å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š

- **å…±äº«é”ï¼ˆShared Locksï¼‰**ï¼šå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–åŒä¸€æ•°æ®é¡¹ï¼Œä½†åœ¨æŒæœ‰å…±äº«é”çš„æƒ…å†µä¸‹ï¼Œä¸å…è®¸ä»»ä½•äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚
- **æ’ä»–é”ï¼ˆExclusive Locksï¼‰**ï¼šå½“ä¸€ä¸ªäº‹åŠ¡æŒæœ‰æ’ä»–é”æ—¶ï¼Œä¸å…è®¸å…¶ä»–äº‹åŠ¡è¯»å–æˆ–ä¿®æ”¹æ­¤æ•°æ®é¡¹ã€‚æ’ä»–é”ç”¨äºæ•°æ®ä¿®æ”¹æ“ä½œï¼Œå¦‚æ›´æ–°ã€åˆ é™¤ç­‰ã€‚
- **æ„å‘é”ï¼ˆIntention Locksï¼‰**ï¼šæ„å‘é”æ˜¯ä¸€ç§é¢„å…ˆå£°æ˜é”ç±»å‹çš„é”ï¼Œç”¨äºé¿å…é”å†²çªã€‚æ„å‘é”åˆ†ä¸ºæ„å‘å…±äº«é”ï¼ˆIntention Shared Locksï¼‰å’Œæ„å‘æ’ä»–é”ï¼ˆIntention Exclusive Locksï¼‰ã€‚
- **è®°å½•é”ï¼ˆRecord Locksï¼‰**ï¼šè®°å½•é”æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­çš„å•ä¸ªè®°å½•è¿›è¡ŒåŠ é”ï¼Œç”¨äºä¿æŠ¤æ•°æ®è¡Œã€‚
- **è¡¨é”ï¼ˆTable Locksï¼‰**ï¼šè¡¨é”æ˜¯å¯¹æ•´ä¸ªæ•°æ®è¡¨è¿›è¡ŒåŠ é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¡¨ä¸­çš„ä»»ä½•è®°å½•è¿›è¡Œæ“ä½œã€‚
- **é¡µé”ï¼ˆPage Locksï¼‰**ï¼šé¡µé”æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­çš„ä¸€é¡µæ•°æ®è¿›è¡ŒåŠ é”ï¼Œä»‹äºè®°å½•é”å’Œè¡¨é”ä¹‹é—´ã€‚

### 2ã€MySQLçš„é”å®ç°

MySQLæ ¹æ®å­˜å‚¨å¼•æ“çš„ä¸åŒï¼Œå®ç°äº†ä¸åŒçš„é”æœºåˆ¶ã€‚è¿™é‡Œä»¥InnoDBå­˜å‚¨å¼•æ“ä¸ºä¾‹ï¼Œä»‹ç»MySQLçš„é”å®ç°ã€‚

- **è¡Œçº§é”ï¼ˆRow-level Lockingï¼‰**ï¼šInnoDBå­˜å‚¨å¼•æ“æ”¯æŒè¡Œçº§é”ï¼Œå³å¯¹å•ä¸ªæ•°æ®è¡Œè¿›è¡ŒåŠ é”ã€‚è¡Œçº§é”å¯ä»¥æœ‰æ•ˆå‡å°‘é”å†²çªï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚åœ¨InnoDBä¸­ï¼Œè¡Œçº§é”åŒ…æ‹¬è®°å½•é”ã€é—´éš™é”ï¼ˆGap Locksï¼‰å’Œä¸´é”®é”ï¼ˆNext-key Locksï¼‰ã€‚
- **è¡¨çº§é”ï¼ˆTable-level Lockingï¼‰**ï¼šMyISAMå­˜å‚¨å¼•æ“ä½¿ç”¨è¡¨çº§é”æ¥å®ç°é”æœºåˆ¶ã€‚è¡¨çº§é”ç²’åº¦è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´é”å†²çªå’Œæ€§èƒ½é—®é¢˜ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒInnoDBä¹Ÿä¼šä½¿ç”¨è¡¨çº§é”ã€‚

### 3ã€é”çš„ä¼˜åŒ–ä¸åº”ç”¨åœºæ™¯

æ ¹æ®å®é™…åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„é”ç­–ç•¥ï¼Œå¯ä»¥æé«˜æ•°æ®åº“æ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é”ä¼˜åŒ–å’Œåº”ç”¨åœºæ™¯çš„å»ºè®®ï¼š

#### 3.1ã€é”ä¼˜åŒ–ç­–ç•¥

##### aã€é¿å…é•¿æ—¶é—´æŒæœ‰é”
é•¿æ—¶é—´æŒæœ‰é”å¯èƒ½å¯¼è‡´å…¶ä»–äº‹åŠ¡ç­‰å¾…ï¼Œé™ä½ç³»ç»Ÿå¹¶å‘æ€§èƒ½ï¼š

```sql
-- ä¸å¥½çš„åšæ³•ï¼šå¤§äº‹åŠ¡
START TRANSACTION;
SELECT * FROM orders WHERE status = 'pending';
-- è¿›è¡Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆè€—æ—¶ï¼‰
UPDATE orders SET status = 'processed' WHERE id IN (...);
COMMIT;

-- å¥½çš„åšæ³•ï¼šæ‹†åˆ†äº‹åŠ¡
START TRANSACTION;
SELECT * FROM orders WHERE status = 'pending';
COMMIT;

-- å¤„ç†ä¸šåŠ¡é€»è¾‘

START TRANSACTION;
UPDATE orders SET status = 'processed' WHERE id IN (...);
COMMIT;
```

##### bã€å°½é‡ä½¿ç”¨è¡Œçº§é”
åœ¨`InnoDB`å­˜å‚¨å¼•æ“ä¸­ï¼Œè¡Œçº§é”èƒ½å¤Ÿæœ‰æ•ˆé™ä½é”å†²çªçš„å¯èƒ½æ€§ï¼š

```sql
-- ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼ˆè¡Œçº§é”ï¼‰
UPDATE users SET balance = balance - 100 WHERE id = 1;

-- é¿å…æ— ç´¢å¼•æ¡ä»¶ï¼ˆå¯èƒ½å¯¼è‡´è¡¨é”ï¼‰
UPDATE users SET balance = balance - 100 WHERE name = 'John';  -- nameæ— ç´¢å¼•
```

##### cã€åˆç†ä½¿ç”¨ç´¢å¼•
ä½¿ç”¨ç´¢å¼•å¯ä»¥å¸®åŠ©æ•°æ®åº“æ›´ç²¾ç¡®åœ°é”å®šæ•°æ®è¡Œï¼š

```sql
-- åˆ›å»ºåˆé€‚çš„ç´¢å¼•
CREATE INDEX idx_status ON orders(status);
CREATE INDEX idx_user_date ON transactions(user_id, created_date);

-- æŸ¥çœ‹é”å®šçš„è¡Œæ•°
SHOW STATUS LIKE 'Innodb_row_lock%';
```

#### 3.2ã€æ­»é”æ£€æµ‹ä¸å¤„ç†

##### aã€æ­»é”çš„äº§ç”Ÿ
æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”çš„æƒ…å†µï¼š

```sql
-- ç¤ºä¾‹ï¼šæ­»é”åœºæ™¯
-- Transaction 1
START TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
-- ç­‰å¾…...
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

-- Transaction 2ï¼ˆåŒæ—¶æ‰§è¡Œï¼‰
START TRANSACTION;
UPDATE accounts SET balance = balance - 50 WHERE id = 2;
-- ç­‰å¾…...
UPDATE accounts SET balance = balance + 50 WHERE id = 1;
-- æ­»é”å‘ç”Ÿï¼
```

##### bã€æ­»é”æ£€æµ‹
MySQLä¼šè‡ªåŠ¨æ£€æµ‹æ­»é”å¹¶é€‰æ‹©å›æ»šå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ï¼š

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„æ­»é”ä¿¡æ¯
SHOW ENGINE INNODB STATUS\G

-- æŸ¥çœ‹æ­»é”ç›¸å…³å‚æ•°
SHOW VARIABLES LIKE 'innodb_deadlock_detect';
SHOW VARIABLES LIKE 'innodb_lock_wait_timeout';

-- ç›‘æ§æ­»é”
SELECT * FROM performance_schema.events_errors_summary_by_thread_by_error 
WHERE ERROR_NAME = 'ER_LOCK_DEADLOCK';
```

##### cã€é¿å…æ­»é”çš„æœ€ä½³å®è·µ

1. **æŒ‰ç›¸åŒé¡ºåºè®¿é—®è¡¨å’Œè¡Œ**ï¼š
```sql
-- æ‰€æœ‰äº‹åŠ¡éƒ½æŒ‰idå‡åºæ›´æ–°
START TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```

2. **ä½¿ç”¨è¾ƒå°çš„äº‹åŠ¡**ï¼š
```sql
-- å°†å¤§äº‹åŠ¡æ‹†åˆ†ä¸ºå°äº‹åŠ¡
-- æ‰¹é‡æ›´æ–°æ—¶ä½¿ç”¨LIMIT
UPDATE large_table SET status = 'processed' 
WHERE status = 'pending' 
LIMIT 1000;
```

3. **è®¾ç½®é”ç­‰å¾…è¶…æ—¶**ï¼š
```sql
-- è®¾ç½®é”ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
SET innodb_lock_wait_timeout = 50;

-- åœ¨åº”ç”¨å±‚å¤„ç†è¶…æ—¶
BEGIN;
-- æ‰§è¡ŒSQL
-- å¦‚æœè¶…æ—¶ï¼Œæ•è·å¼‚å¸¸å¹¶é‡è¯•
COMMIT;
```

#### 3.3ã€ä¹è§‚é”ä¸æ‚²è§‚é”

##### aã€æ‚²è§‚é”å®ç°
æ‚²è§‚é”å‡è®¾ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œæå‰åŠ é”ï¼š

```sql
-- ä½¿ç”¨SELECT ... FOR UPDATEåŠ æ‚²è§‚é”
START TRANSACTION;
SELECT * FROM inventory WHERE product_id = 1 FOR UPDATE;
-- æ£€æŸ¥åº“å­˜
UPDATE inventory SET quantity = quantity - 1 WHERE product_id = 1;
COMMIT;

-- ä½¿ç”¨LOCK IN SHARE MODEåŠ å…±äº«é”
SELECT * FROM products WHERE id = 1 LOCK IN SHARE MODE;
```

##### bã€ä¹è§‚é”å®ç°
ä¹è§‚é”é€šè¿‡ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³å®ç°ï¼š

```sql
-- æ·»åŠ ç‰ˆæœ¬å·å­—æ®µ
ALTER TABLE products ADD COLUMN version INT DEFAULT 0;

-- æ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·
UPDATE products 
SET price = 99.99, version = version + 1 
WHERE id = 1 AND version = 5;

-- æ£€æŸ¥å½±å“è¡Œæ•°ï¼Œå¦‚æœä¸º0è¯´æ˜ç‰ˆæœ¬å·²å˜åŒ–
-- åº”ç”¨å±‚ä»£ç ç¤ºä¾‹
IF (affected_rows == 0) {
    -- ç‰ˆæœ¬å†²çªï¼Œé‡æ–°è¯»å–å¹¶é‡è¯•
}
```

#### 3.4ã€é”ç›‘æ§ä¸è¯Šæ–­

```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…
SELECT 
    r.trx_id waiting_trx_id,
    r.trx_mysql_thread_id waiting_thread,
    r.trx_query waiting_query,
    b.trx_id blocking_trx_id,
    b.trx_mysql_thread_id blocking_thread,
    b.trx_query blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;

-- æŸ¥çœ‹é”çš„è¯¦ç»†ä¿¡æ¯
SELECT * FROM performance_schema.data_locks;

-- æŸ¥çœ‹å…ƒæ•°æ®é”
SELECT * FROM performance_schema.metadata_locks;

-- ç»ˆæ­¢é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡
KILL CONNECTION <thread_id>;
```

#### 3.5ã€ç‰¹å®šåœºæ™¯çš„é”ç­–ç•¥

##### aã€é«˜å¹¶å‘ç§’æ€åœºæ™¯
```sql
-- ä½¿ç”¨Redisåˆ†å¸ƒå¼é”æˆ–é˜Ÿåˆ—
-- æ•°æ®åº“å±‚é¢ä½¿ç”¨ä¹è§‚é”
UPDATE products 
SET stock = stock - 1 
WHERE id = 1 AND stock > 0;
```

##### bã€æ‰¹é‡æ•°æ®å¤„ç†
```sql
-- åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é•¿æ—¶é—´é”è¡¨
DELIMITER $$
CREATE PROCEDURE batch_update()
BEGIN
    DECLARE done INT DEFAULT 0;
    REPEAT
        UPDATE large_table 
        SET processed = 1 
        WHERE processed = 0 
        LIMIT 1000;
        
        SET done = ROW_COUNT();
        -- æš‚åœï¼Œè®©å…¶ä»–äº‹åŠ¡æ‰§è¡Œ
        DO SLEEP(0.1);
    UNTIL done < 1000 END REPEAT;
END$$
DELIMITER ;
```

##### cã€è¯»å†™åˆ†ç¦»åœºæ™¯
```sql
-- ä¸»åº“å†™å…¥
INSERT INTO orders (...) VALUES (...);

-- ä»åº“è¯»å–ï¼ˆé¿å…é”ç«äº‰ï¼‰
SELECT * FROM orders WHERE user_id = 1;
```

é€šè¿‡ä»¥ä¸Šä¼˜åŒ–æªæ–½å’Œåº”ç”¨åœºæ™¯çš„é€‰æ‹©ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜MySQLæ•°æ®åº“çš„æ€§èƒ½å’Œå¹¶å‘èƒ½åŠ›ï¼Œæ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ã€‚

## åä¸€ã€å¤‡ä»½ä¸æ¢å¤

### 1ã€å¤‡ä»½ç­–ç•¥ä¸å·¥å…·

å¤‡ä»½æ˜¯ç¡®ä¿æ•°æ®å®‰å…¨å’Œå¯ç”¨æ€§çš„é‡è¦æ‰‹æ®µã€‚MySQLæ•°æ®åº“æ”¯æŒä¸¤ç§ä¸»è¦çš„å¤‡ä»½ç­–ç•¥ï¼šç‰©ç†å¤‡ä»½å’Œé€»è¾‘å¤‡ä»½ã€‚

#### 1.1ã€ç‰©ç†å¤‡ä»½

ç‰©ç†å¤‡ä»½æ˜¯æŒ‡å°†æ•°æ®åº“ä¸­çš„æ•°æ®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶å’Œå…¶ä»–ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°å¤‡ä»½ä»‹è´¨çš„è¿‡ç¨‹ã€‚ç‰©ç†å¤‡ä»½é€šå¸¸æ›´å¿«ï¼Œæ¢å¤æ—¶ä¹Ÿèƒ½èŠ‚çœæ—¶é—´ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ç‰©ç†å¤‡ä»½å·¥å…·ï¼š

- **`mysqldump`**: `mysqldump`å·¥å…·å¯ä»¥å°†æ•°æ®åº“æ•°æ®å¯¼å‡ºä¸ºSQLè¯­å¥ï¼Œä½†ä¹Ÿå¯ä»¥å¯¼å‡ºä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨`--hex-blob`é€‰é¡¹ï¼‰ï¼Œä»è€Œå®ç°ç‰©ç†å¤‡ä»½ã€‚
- **`mysqlhotcopy`**: `mysqlhotcopy`å·¥å…·å¯ä»¥åœ¨çº¿è¿›è¡Œç‰©ç†å¤‡ä»½ï¼Œä½†ä»…é€‚ç”¨äºMyISAMå’ŒArchiveå­˜å‚¨å¼•æ“ã€‚
- **Percona XtraBackup**: Percona XtraBackupæ˜¯ä¸€ä¸ªå¼€æºçš„ç‰©ç†å¤‡ä»½å·¥å…·ï¼Œæ”¯æŒåœ¨çº¿å¤‡ä»½InnoDBå’ŒXtraDBå­˜å‚¨å¼•æ“çš„æ•°æ®ã€‚

#### 1.2ã€é€»è¾‘å¤‡ä»½

é€»è¾‘å¤‡ä»½æ˜¯æŒ‡å°†æ•°æ®åº“ä¸­çš„æ•°æ®å¯¼å‡ºä¸ºé€»è¾‘æ ¼å¼ï¼ˆå¦‚SQLè¯­å¥ï¼‰ï¼Œè¿™ç§å¤‡ä»½æ–¹æ³•å…·æœ‰æ›´å¥½çš„å¯ç§»æ¤æ€§ï¼Œä½†å¤‡ä»½å’Œæ¢å¤é€Ÿåº¦é€šå¸¸è¾ƒæ…¢ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·ï¼š

- **`mysqldump`**: `mysqldump`å·¥å…·æ˜¯MySQLå®˜æ–¹æä¾›çš„é€»è¾‘å¤‡ä»½å·¥å…·ï¼Œå¯ä»¥å°†æ•°æ®åº“æ•°æ®å¯¼å‡ºä¸ºSQLè¯­å¥ã€‚
- **`mysqlpump`**: `mysqlpump`å·¥å…·ä¸`mysqldump`ç±»ä¼¼ï¼Œä½†æ”¯æŒå¹¶è¡Œå¤‡ä»½ï¼Œæ€§èƒ½æ›´é«˜ã€‚
- **`MyDumper`**: [MyDumper](https://github.com/mydumper/mydumper)æ˜¯ä¸€ä¸ªå¼€æºçš„é€»è¾‘å¤‡ä»½å·¥å…·ï¼Œå…·æœ‰å¹¶è¡Œå¤‡ä»½ã€å‹ç¼©å¤‡ä»½ç­‰åŠŸèƒ½ï¼Œæ€§èƒ½ä¼˜äº`mysqldump`ã€‚

### 2ã€æ¢å¤ç­–ç•¥ä¸æ–¹æ³•

æ ¹æ®å¤‡ä»½æ•°æ®å’Œæ¢å¤éœ€æ±‚çš„ä¸åŒï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„æ¢å¤ç­–ç•¥å’Œæ–¹æ³•ã€‚

#### 2.1ã€å…¨é‡æ¢å¤

å…¨é‡æ¢å¤æ˜¯æŒ‡ä½¿ç”¨å…¨é‡å¤‡ä»½æ•°æ®å°†æ•°æ®åº“æ¢å¤åˆ°å¤‡ä»½æ—¶çš„çŠ¶æ€ã€‚å…¨é‡æ¢å¤é€‚ç”¨äºæ•°æ®ä¸¢å¤±æˆ–æŸåçš„æƒ…å†µï¼Œæ¢å¤è¿‡ç¨‹ç›¸å¯¹ç®€å•ã€‚

å¸¸ç”¨çš„å·¥å…·ï¼š
- `mysql`: ä½¿ç”¨mysqlå®¢æˆ·ç«¯å·¥å…·ï¼Œå¯ä»¥æ‰§è¡Œç”±mysqldumpç”Ÿæˆçš„SQLè„šæœ¬æ–‡ä»¶ï¼Œå®ç°å…¨é‡æ¢å¤ã€‚
- `mysqlhotcopy`: å¯¹äºMyISAMå’ŒArchiveå­˜å‚¨å¼•æ“ï¼Œå¯ä»¥ä½¿ç”¨mysqlhotcopyå·¥å…·è¿›è¡Œæ¢å¤ã€‚
- `Percona XtraBackup`: ä½¿ç”¨Percona XtraBackupå·¥å…·ç”Ÿæˆçš„å¤‡ä»½æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡innobackupexæˆ–xtrabackupå‘½ä»¤è¿›è¡Œæ¢å¤ã€‚

#### 2.2ã€å¢é‡æ¢å¤

å¢é‡æ¢å¤æ˜¯æŒ‡åœ¨å…¨é‡æ¢å¤çš„åŸºç¡€ä¸Šï¼Œåº”ç”¨å¢é‡å¤‡ä»½æ•°æ®å°†æ•°æ®åº“æ¢å¤åˆ°æŸä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ã€‚å¢é‡æ¢å¤å¯ä»¥å‡å°‘æ•°æ®ä¸¢å¤±çš„é£é™©ï¼Œä½†æ¢å¤è¿‡ç¨‹è¾ƒä¸ºå¤æ‚ã€‚

å¸¸ç”¨çš„å·¥å…·ï¼š
- `Percona XtraBackup`: Percona XtraBackupä¸ä»…æ”¯æŒå…¨é‡æ¢å¤ï¼Œè¿˜æ”¯æŒå¢é‡æ¢å¤ã€‚é€šè¿‡--incrementalé€‰é¡¹å¯ä»¥å®ç°å¢é‡å¤‡ä»½ï¼Œç„¶åå†ä½¿ç”¨innobackupexæˆ–xtrabackupå‘½ä»¤è¿›è¡Œæ¢å¤ã€‚
- `mysqlbinlog`: mysqlbinlogå·¥å…·å¯ä»¥è§£æäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼ˆBinary Logsï¼‰ï¼Œå°†å…¶è½¬æ¢ä¸ºSQLè¯­å¥ï¼Œç„¶åé€šè¿‡mysqlå®¢æˆ·ç«¯å·¥å…·æ‰§è¡Œï¼Œå®ç°å¢é‡æ¢å¤ã€‚

#### 2.3ã€ç‚¹æ—¶é—´æ¢å¤

ç‚¹æ—¶é—´æ¢å¤ï¼ˆPITRï¼‰æ˜¯æŒ‡å°†æ•°æ®åº“æ¢å¤åˆ°æŸä¸ªç‰¹å®šæ—¶é—´ç‚¹çš„çŠ¶æ€ã€‚é€šè¿‡åº”ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logsï¼‰æˆ–å…¶ä»–å¢é‡å¤‡ä»½æ•°æ®ï¼Œå¯ä»¥å®ç°ç‚¹æ—¶é—´æ¢å¤ã€‚ç‚¹æ—¶é—´æ¢å¤é€‚ç”¨äºè¯¯æ“ä½œæˆ–éƒ¨åˆ†æ•°æ®æŸåçš„æƒ…å†µï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ•°æ®ä¸¢å¤±ã€‚

å¸¸ç”¨çš„å·¥å…·ï¼š
- `mysqlbinlog`: ç‚¹æ—¶é—´æ¢å¤ï¼ˆPITRï¼‰å¯ä»¥é€šè¿‡mysqlbinlogå·¥å…·å®ç°ã€‚ä½¿ç”¨--start-datetimeå’Œ--stop-datetimeé€‰é¡¹ï¼Œå¯ä»¥æŒ‡å®šéœ€è¦æ¢å¤çš„æ—¶é—´èŒƒå›´ã€‚è§£æå‡ºç›¸åº”æ—¶é—´èŒƒå›´å†…çš„SQLè¯­å¥åï¼Œé€šè¿‡mysqlå®¢æˆ·ç«¯å·¥å…·æ‰§è¡Œï¼Œå®ç°ç‚¹æ—¶é—´æ¢å¤ã€‚

#### 2.4ã€æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤çš„æœ€ä½³å®è·µ

ä¸ºäº†ç¡®ä¿æ•°æ®å®‰å…¨å’Œå¯ç”¨æ€§ï¼Œéµå¾ªä»¥ä¸‹å¤‡ä»½ä¸æ¢å¤çš„æœ€ä½³å®è·µæ˜¯éå¸¸é‡è¦çš„ï¼š

- **å®šæœŸå¤‡ä»½**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œæ•°æ®å˜åŒ–æƒ…å†µï¼Œåˆ¶å®šåˆç†çš„å¤‡ä»½è®¡åˆ’ï¼Œå®šæœŸè¿›è¡Œå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½ã€‚
- **å¤‡ä»½éªŒè¯**ï¼šå®šæœŸéªŒè¯å¤‡ä»½æ•°æ®çš„å®Œæ•´æ€§å’Œå¯ç”¨æ€§ï¼Œç¡®ä¿åœ¨éœ€è¦æ—¶èƒ½å¤Ÿé¡ºåˆ©æ¢å¤ã€‚
- **ç¦»çº¿å­˜å‚¨å¤‡ä»½**ï¼šå°†å¤‡ä»½æ•°æ®å­˜å‚¨åœ¨ç¦»çº¿ä»‹è´¨ï¼ˆå¦‚ç£å¸¦ã€å…‰ç›˜ç­‰ï¼‰ï¼Œä»¥é˜²æ­¢åœ¨çº¿å­˜å‚¨è®¾å¤‡çš„æ•…éšœå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚
- **è¿œç¨‹å¤‡ä»½**ï¼šå°†å¤‡ä»½æ•°æ®å­˜å‚¨åœ¨è¿œç¨‹ä½ç½®ï¼Œä»¥é˜²æ­¢æœ¬åœ°ç¾éš¾å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚
- **ç›‘æ§å¤‡ä»½ä»»åŠ¡**ï¼šå¯¹å¤‡ä»½ä»»åŠ¡è¿›è¡Œç›‘æ§ï¼Œç¡®ä¿å¤‡ä»½ä»»åŠ¡æŒ‰è®¡åˆ’æ‰§è¡Œï¼Œå¹¶åŠæ—¶å¤„ç†å¤‡ä»½å¤±è´¥ç­‰å¼‚å¸¸æƒ…å†µã€‚
- **æ¢å¤æ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ¢å¤æ¼”ç»ƒï¼ŒéªŒè¯æ¢å¤æµç¨‹çš„å¯è¡Œæ€§ï¼Œæé«˜æ¢å¤èƒ½åŠ›ã€‚
- **æ–‡æ¡£åŒ–å¤‡ä»½ä¸æ¢å¤æµç¨‹**ï¼šç¼–å†™è¯¦ç»†çš„å¤‡ä»½ä¸æ¢å¤æµç¨‹æ–‡æ¡£ï¼Œç¡®ä¿åœ¨ç´§æ€¥æƒ…å†µä¸‹èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°æ¢å¤æ‰€éœ€çš„ä¿¡æ¯ã€‚

éµå¾ªä»¥ä¸Šæœ€ä½³å®è·µï¼Œå¯ä»¥æœ‰æ•ˆä¿éšœMySQLæ•°æ®åº“çš„æ•°æ®å®‰å…¨å’Œå¯ç”¨æ€§ï¼Œé™ä½æ•°æ®ä¸¢å¤±é£é™©ã€‚

## åäºŒã€MySQLå®‰å…¨ç®¡ç†

ç¡®ä¿æ•°æ®åº“çš„å®‰å…¨æ€§æ˜¯éå¸¸é‡è¦çš„ï¼Œæœ¬ç« å°†ä»‹ç»MySQLçš„å®‰å…¨ç®¡ç†ç›¸å…³å†…å®¹ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¸æƒé™ç®¡ç†ã€æ•°æ®åº“åŠ å¯†ä¸å®‰å…¨ä¼ è¾“ã€å®¡è®¡æ—¥å¿—ä¸ç›‘æ§ä»¥åŠå¸¸è§å®‰å…¨æ¼æ´ä¸é˜²èŒƒã€‚

### 1ã€ç”¨æˆ·ä¸æƒé™ç®¡ç†

ç”¨æˆ·å’Œæƒé™ç®¡ç†æ˜¯æ•°æ®åº“å®‰å…¨ç®¡ç†çš„åŸºç¡€ã€‚åœ¨MySQLä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è¿›è¡Œç”¨æˆ·ä¸æƒé™ç®¡ç†ï¼š

- **åˆ›å»ºç”¨æˆ·**ï¼šä½¿ç”¨`CREATE USER`è¯­å¥åˆ›å»ºæ–°ç”¨æˆ·ï¼Œå¹¶é€šè¿‡`IDENTIFIED BY`æŒ‡å®šå¯†ç ã€‚ä¾‹å¦‚ï¼š`CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';`ã€‚
- **æˆæƒ**ï¼šä½¿ç”¨`GRANT`è¯­å¥ä¸ºç”¨æˆ·åˆ†é…æƒé™ï¼Œä¾‹å¦‚ï¼š`GRANT SELECT, INSERT ON database_name.* TO 'username'@'localhost';`ã€‚
- **æ’¤é”€æƒé™**ï¼šä½¿ç”¨`REVOKE`è¯­å¥æ’¤é”€ç”¨æˆ·çš„æƒé™ï¼Œä¾‹å¦‚ï¼š`REVOKE INSERT ON database_name.* FROM 'username'@'localhost';`ã€‚
- **åˆ é™¤ç”¨æˆ·**ï¼šä½¿ç”¨`DROP USER`è¯­å¥åˆ é™¤ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š`DROP USER 'username'@'localhost';`ã€‚
- **ä¿®æ”¹å¯†ç **ï¼šä½¿ç”¨`ALTER USER`è¯­å¥ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œä¾‹å¦‚ï¼š`ALTER USER 'username'@'localhost' IDENTIFIED BY 'new_password';`ã€‚

ä¸ºäº†ç¡®ä¿æ•°æ®åº“å®‰å…¨ï¼Œåº”éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆç”¨æˆ·å¿…è¦çš„æƒé™ã€‚

### 2ã€æ•°æ®åº“åŠ å¯†ä¸å®‰å…¨ä¼ è¾“
æ•°æ®åº“åŠ å¯†å’Œå®‰å…¨ä¼ è¾“æ˜¯ç¡®ä¿æ•°æ®å®‰å…¨çš„å…³é”®æªæ–½ã€‚åœ¨MySQLä¸­ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•å®ç°æ•°æ®åŠ å¯†å’Œå®‰å…¨ä¼ è¾“ï¼š

- **æ•°æ®åŠ å¯†**ï¼šå¯ä»¥ä½¿ç”¨MySQLçš„å†…ç½®åŠ å¯†å‡½æ•°ï¼ˆå¦‚`AES_ENCRYPT()`ã€`AES_DECRYPT()`ç­‰ï¼‰è¿›è¡Œæ•°æ®åŠ å¯†ã€‚æ­¤å¤–ï¼ŒMySQL Enterpriseç‰ˆè¿˜æä¾›äº†é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰åŠŸèƒ½ï¼Œå¯ä»¥è‡ªåŠ¨åŠ å¯†å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ã€‚
- **å®‰å…¨ä¼ è¾“**ï¼šä¸ºäº†ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å®‰å…¨ï¼Œå¯ä»¥å¯ç”¨SSL/TLSåŠ å¯†ã€‚åœ¨MySQLæœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡`require_secure_transport`é€‰é¡¹å¯ç”¨å®‰å…¨ä¼ è¾“ï¼Œå¹¶é…ç½®ç›¸åº”çš„è¯ä¹¦æ–‡ä»¶ã€‚

### 3ã€å®¡è®¡æ—¥å¿—ä¸ç›‘æ§

å®¡è®¡æ—¥å¿—å’Œç›‘æ§æ˜¯æ•°æ®åº“å®‰å…¨ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨MySQLä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è¿›è¡Œå®¡è®¡æ—¥å¿—ä¸ç›‘æ§ï¼š

- **å®¡è®¡æ—¥å¿—**ï¼šMySQL Enterpriseç‰ˆæä¾›äº†å®¡è®¡æ—¥å¿—æ’ä»¶ï¼Œå¯ä»¥è®°å½•ç”¨æˆ·çš„æ“ä½œæ—¥å¿—ã€‚å¯¹äºç¤¾åŒºç‰ˆï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆå¦‚`MariaDB Audit Plugin`ï¼‰å®ç°å®¡è®¡åŠŸèƒ½ã€‚
- **ç›‘æ§**ï¼šå¯ä»¥ä½¿ç”¨`SHOW PROCESSLIST`å‘½ä»¤æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼›ä½¿ç”¨`SHOW STATUS`å‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`Performance Schema`æ”¶é›†æ€§èƒ½æ•°æ®ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜ã€‚

### 4ã€å¸¸è§å®‰å…¨æ¼æ´ä¸é˜²èŒƒ

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„MySQLå®‰å…¨æ¼æ´åŠé˜²èŒƒæ–¹æ³•ï¼š

- **å¼±å¯†ç **ï¼šä½¿ç”¨å¼ºå¯†ç ç­–ç•¥ï¼Œé¿å…ç®€å•æˆ–è€…æ˜“çŒœçš„å¯†ç ï¼Œå¢åŠ å¯†ç çš„å¤æ‚æ€§å’Œé•¿åº¦ã€‚
- **SQLæ³¨å…¥**ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ï¼Œä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆä¾‹å¦‚ï¼š`PreparedStatements`ï¼‰ä»¥é¿å…SQLæ³¨å…¥æ”»å‡»ã€‚
- **æœªæˆæƒè®¿é—®**ï¼šé™åˆ¶ç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®æƒé™ï¼Œå®æ–½IPåœ°å€ç™½åå•ç­–ç•¥ï¼Œä»…å…è®¸ç‰¹å®šIPåœ°å€è®¿é—®æ•°æ®åº“ã€‚
- **æš´åŠ›ç ´è§£**ï¼šé™åˆ¶ç”¨æˆ·ç™»å½•å¤±è´¥æ¬¡æ•°ï¼Œè¶…è¿‡ä¸€å®šæ¬¡æ•°åé”å®šè´¦æˆ·ï¼›å¯ç”¨é˜²ç«å¢™ï¼Œé™åˆ¶å¤–éƒ¨å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚
- **ä¿¡æ¯æ³„éœ²**ï¼šä¸è¦åœ¨é”™è¯¯ä¿¡æ¯ä¸­æ³„éœ²æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®åº“ç”¨æˆ·åã€å¯†ç ç­‰ã€‚
- **ä¸å®‰å…¨é…ç½®**ï¼šå®šæœŸæ£€æŸ¥å’Œæ›´æ–°æ•°æ®åº“é…ç½®ï¼Œç¡®ä¿æ•°æ®åº“è½¯ä»¶è¿è¡Œåœ¨å®‰å…¨çš„ç¯å¢ƒä¸­ã€‚ä¾‹å¦‚ï¼Œç¦ç”¨ä¸å¿…è¦çš„å­˜å‚¨å¼•æ“ã€é™åˆ¶æ–‡ä»¶æƒé™ç­‰ã€‚

éµå¾ªä»¥ä¸Šå®‰å…¨ç®¡ç†å®è·µï¼Œå¯ä»¥æœ‰æ•ˆæé«˜MySQLæ•°æ®åº“çš„å®‰å…¨æ€§ï¼Œé™ä½å—åˆ°æ”»å‡»å’Œæ•°æ®æ³„éœ²çš„é£é™©ã€‚åœ¨å®é™…è¿ç»´ä¸­ï¼Œåº”æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚å’Œå®‰å…¨ç­–ç•¥ï¼Œç»“åˆå¤šç§å®‰å…¨æªæ–½ï¼Œç¡®ä¿æ•°æ®åº“å®‰å…¨ã€‚

## åä¸‰ã€å·¥å…·
Mysqlå¯è§†åŒ–å·¥å…·æ¨èï¼š
- [SQLyog](https://webyog.com/product/sqlyog/)
- [Navicat](https://www.navicat.com.cn/products/navicat-for-mysql)
- [MySQL Workbench](https://www.mysql.com/cn/products/workbench/)
- [HeidiSQL](https://www.heidisql.com/)
- [DBeaver](https://dbeaver.io/)

Mysqlæ•°æ®åŒæ­¥å·¥å…·æ¨èï¼š
- [Canal](https://github.com/alibaba/canal)
- [Apache SeaTunnel](https://seatunnel.apache.org/)

## åå››ã€æ€»ç»“
æœ¬æ–‡ä»å„ä¸ªæ–¹é¢å±•ç¤ºäº†MySQLæ•°æ®åº“çš„å…³é”®çŸ¥è¯†ç‚¹ã€‚

é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œè¯»è€…å¯ä»¥æ·±å…¥äº†è§£MySQLæ•°æ®åº“çš„ç‰¹æ€§ã€åŠŸèƒ½å’Œåº”ç”¨åœºæ™¯ï¼ŒæŒæ¡ä½¿ç”¨MySQLè¿›è¡Œæ•°æ®æ“ä½œå’Œç®¡ç†çš„åŸºæœ¬æŠ€å·§ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€å¤‡ä»½æ¢å¤å’Œå®‰å…¨ç®¡ç†ã€‚

å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©è¯»è€…åœ¨æ•°æ®åº“é¢†åŸŸå»ºç«‹æ‰å®çš„åŸºç¡€ï¼Œæ›´å¥½åœ°åº”ç”¨MySQLæ•°æ®åº“è§£å†³å®é™…é—®é¢˜ã€‚

**ç¥ä½ å˜å¾—æ›´å¼ºï¼**
