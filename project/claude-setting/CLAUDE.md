# 基础规则

## 思考与沟通原则
- 使用英语思考，但始终最终用中文表达。  
- 遇到模糊问题，先反问用户，确保理解准确。  
- 遇到复杂问题，自动开启 **think hard** 模式：展示推理过程、分析选项、给出方案，而不是立刻执行。

## 最佳实践守则
- 当用户指示执行明显不合理或违背业界最佳实践的操作时，必须给出明确警告：  
  ✅ 值得做：[原因] / ❌ 不值得做：[原因]  
  并等待用户二次确认后再执行。  

## 代码质量与工程规范
- 创建新的程序类或方法时，必须添加**完善的文档注释**。  
- 执行完整任务后，**必须进行代码审查**，并给出品味评分：  
  - 🟢 好品味  
  - 🟡 凑合  
  - 🔴 垃圾  
  若发现致命问题或垃圾代码，**直接指出最糟糕的部分**，但不主动重构，等待用户确认后再行动。

## 环境与编码细节
- **没有特别说明时，默认需要提供完整、可运行的解决方案**。  
- **Java 的 `properties` 文件使用 ISO-8859-1 编码**，写入中文时必须进行 Unicode 转义（如 `\u4E2D\u6587`）或使用工具处理，避免乱码。


# 编码哲学

## 通用
1. 函数必须短小精悍，只做一件事并做好
2. 复杂性是万恶之源

## Python
1. **可读性至上（Readability counts）**  
   代码是给人读的，其次才是给机器执行。缩进、命名、结构都要清晰如散文。

2. **简洁优于复杂（Simple is better than complex）**  
   追求用最少、最直接的代码表达逻辑，避免过度工程。

3. **显式优于隐式（Explicit is better than implicit）**  
   行为应清晰可见，拒绝“魔法”或隐藏副作用。

4. **应该有一种——最好只有一种——显而易见的方式做事**  
   鼓励统一风格，减少选择焦虑（如 PEP 8）。

5. **错误不应被静默（Errors should never pass silently）**  
   用异常明确暴露问题，除非你**明确**选择忽略。

### Java
1. **强类型与编译时安全（Type safety first）**  
   通过静态类型、泛型、编译检查，在编码阶段捕获错误。

2. **面向对象为核心（Everything is an object）**  
   封装、继承、多态是组织代码的基础，强调类与接口的设计。符合SOLID 原则。

3. **“约定优于配置” + “显式优于魔法”**  
   虽然 Spring 等框架引入约定，但 Java 本身偏好显式声明（如 `public static void main`）。

4. **健壮性与可维护性优先于简洁**  
   宁愿多写几行清晰、类型安全的代码，也不追求“聪明”但脆弱的写法。

# 工具使用

## 文档工具
1. **查看官方文档**
   - `resolve-library-id` - 解析库名到 Context7 ID
   - `get-library-docs` - 获取最新官方文档

2. **搜索真实代码**
   - `searchGitHub` - 搜索 GitHub 上的实际使用案例

## 编写规范文档工具
编写需求和设计文档时使用 `specs-workflow`：

1. **检查进度**: `action.type="check"` 
2. **初始化**: `action.type="init"`
3. **更新任务**: `action.type="complete_task"`

路径：`/docs/specs/*`

# Java规范
## API
- **总是优先使用最新标准 API**（需先确认当前 Java 版本），例如用 `HttpClient` 而非老旧的 `URLConnection`。

## 单元测试
* 阅读获取项目的基础测试框架，一般默认为Junit 5 + Mockito + AssertJ。
* 测试类与被测类保持同名，放在 src/test/java；类名以 Test 结尾。
* 遵循 AAA（Arrange-Act-Assert）模式，用空行分隔结构。
* 测试方法名采用 methodName_shouldExpected_whenContext 格式。
* 每个测试独立运行，避免依赖顺序；禁用 sleep、随机数、真实时间。
* 使用 AssertJ 进行断言，表达业务语义。
* 对于异常测试，明确断言异常类型与信息。
* 优先使用 @ParameterizedTest 覆盖边界值、等价类与特殊情况。
* Mock 仅用于外部依赖（DB、HTTP 等），业务逻辑尽量用真实对象。
* 保持单元测试快速、轻量，关键分支和边界必须覆盖。
* 推荐使用 @Nested 对同一方法的不同场景分组，配合 @ParameterizedTest 提升可读性与覆盖度。
* @DisplayName 使用中文，如果和 @ParameterizedTest 配合，请注意展示参数内容。
* 行覆盖 ≥ 80%，分支 ≥ 60%。关键域（安全、金额、幂等）：行 ≥ 90%，分支 ≥ 80%，PIT Mutation ≥ 65%。